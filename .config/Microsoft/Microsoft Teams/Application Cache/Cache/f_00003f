var $jscomp={scope:{},getGlobal:function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global?global:e}};$jscomp.global=$jscomp.getGlobal(this),$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol),$jscomp.initSymbol=function(){}},$jscomp.symbolCounter_=0,$jscomp.Symbol=function(e){return"jscomp_symbol_"+e+$jscomp.symbolCounter_++},$jscomp.initSymbolIterator=function(){$jscomp.initSymbol(),$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator")),$jscomp.initSymbolIterator=function(){}},$jscomp.makeIterator=function(e){if($jscomp.initSymbolIterator(),e[$jscomp.global.Symbol.iterator])return e[$jscomp.global.Symbol.iterator]();var t=0;return{next:function(){return t==e.length?{done:!0}:{done:!1,value:e[t++]}}}},$jscomp.arrayFromIterator=function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n},$jscomp.arrayFromIterable=function(e){return e instanceof Array?e:$jscomp.arrayFromIterator($jscomp.makeIterator(e))},$jscomp.inherits=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e;for(var r in t)if($jscomp.global.Object.defineProperties){var i=$jscomp.global.Object.getOwnPropertyDescriptor(t,r);i&&$jscomp.global.Object.defineProperty(e,r,i)}else e[r]=t[r]},$jscomp.array=$jscomp.array||{},$jscomp.array.done_=function(){return{done:!0,value:void 0}},$jscomp.array.arrayIterator_=function(e,t){e instanceof String&&(e=String(e));var n=0;$jscomp.initSymbol(),$jscomp.initSymbolIterator();var r={},i=(r.next=function(){if(n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return i.next=$jscomp.array.done_,$jscomp.array.done_()},r[Symbol.iterator]=function(){return i},r);return i},$jscomp.array.findInternal_=function(e,t,n){e instanceof String&&(e=String(e));for(var r=e.length,i=0;i<r;i++){var o=e[i];if(t.call(n,o,i,e))return{i:i,v:o}}return{i:-1,v:void 0}},$jscomp.array.from=function(e,t,n){t=void 0===t?function(e){return e}:t;var r=[];if($jscomp.initSymbol(),$jscomp.initSymbolIterator(),e[Symbol.iterator]){$jscomp.initSymbol(),$jscomp.initSymbolIterator(),e=e[Symbol.iterator]();for(var i;!(i=e.next()).done;)r.push(t.call(n,i.value))}else{i=e.length;for(var o=0;o<i;o++)r.push(t.call(n,e[o]))}return r},$jscomp.array.of=function(e){for(var t=[],n=0;n<arguments.length;++n)t[n-0]=arguments[n];return $jscomp.array.from(t)},$jscomp.array.entries=function(){return $jscomp.array.arrayIterator_(this,function(e,t){return[e,t]})},$jscomp.array.entries$install=function(){Array.prototype.entries||(Array.prototype.entries=$jscomp.array.entries)},$jscomp.array.keys=function(){return $jscomp.array.arrayIterator_(this,function(e){return e})},$jscomp.array.keys$install=function(){Array.prototype.keys||(Array.prototype.keys=$jscomp.array.keys)},$jscomp.array.values=function(){return $jscomp.array.arrayIterator_(this,function(e,t){return t})},$jscomp.array.values$install=function(){Array.prototype.values||(Array.prototype.values=$jscomp.array.values)},$jscomp.array.copyWithin=function(e,t,n){var r=this.length;if(e=Number(e),t=Number(t),n=Number(null!=n?n:r),e<t)for(n=Math.min(n,r);t<n;)t in this?this[e++]=this[t++]:(delete this[e++],t++);else for(n=Math.min(n,r+t-e),e+=n-t;n>t;)--n in this?this[--e]=this[n]:delete this[e];return this},$jscomp.array.copyWithin$install=function(){Array.prototype.copyWithin||(Array.prototype.copyWithin=$jscomp.array.copyWithin)},$jscomp.array.fill=function(e,t,n){for(null!=n&&e.length||(n=this.length||0),n=Number(n),t=Number((void 0===t?0:t)||0);t<n;t++)this[t]=e;return this},$jscomp.array.fill$install=function(){Array.prototype.fill||(Array.prototype.fill=$jscomp.array.fill)},$jscomp.array.find=function(e,t){return $jscomp.array.findInternal_(this,e,t).v},$jscomp.array.find$install=function(){Array.prototype.find||(Array.prototype.find=$jscomp.array.find)},$jscomp.array.findIndex=function(e,t){return $jscomp.array.findInternal_(this,e,t).i},$jscomp.array.findIndex$install=function(){Array.prototype.findIndex||(Array.prototype.findIndex=$jscomp.array.findIndex)},$jscomp.Map=function(e){if(e=void 0===e?[]:e,this.data_={},this.head_=$jscomp.Map.createHead_(),this.size=0,e)for(var t=(e=$jscomp.makeIterator(e)).next();!t.done;t=e.next())t=t.value,this.set(t[0],t[1])},$jscomp.Map.checkBrowserConformance_=function(){var e=$jscomp.global.Map;if(!e||!e.prototype.entries||!Object.seal)return!1;try{var t=Object.seal({x:4}),n=new e($jscomp.makeIterator([[t,"s"]]));if("s"!=n.get(t)||1!=n.size||n.get({x:4})||n.set({x:4},"t")!=n||2!=n.size)return!1;var r=n.entries(),i=r.next();return!i.done&&i.value[0]==t&&"s"==i.value[1]&&!((i=r.next()).done||4!=i.value[0].x||"t"!=i.value[1]||!r.next().done)}catch(e){return!1}},$jscomp.Map.createHead_=function(){var e={};return e.previous=e.next=e.head=e},$jscomp.Map.getId_=function(e){return e instanceof Object?($jscomp.Map.key_ in e||e instanceof Object&&Object.isExtensible&&Object.isExtensible(e)&&$jscomp.Map.defineProperty_(e,$jscomp.Map.key_,++$jscomp.Map.index_),$jscomp.Map.key_ in e?e[$jscomp.Map.key_]:" "+e):String(e)},$jscomp.Map.prototype.set=function(e,t){var n=(i=this.maybeGetEntry_(e)).id,r=i.list,i=i.entry;return r||(r=this.data_[n]=[]),i?i.value=t:(i={next:this.head_,previous:this.head_.previous,head:this.head_,key:e,value:t},r.push(i),this.head_.previous.next=i,this.head_.previous=i,this.size++),this},$jscomp.Map.prototype.delete=function(e){var t=this.maybeGetEntry_(e);e=t.id;var n=t.list,r=t.index;return!(!(t=t.entry)||!n)&&(n.splice(r,1),n.length||delete this.data_[e],t.previous.next=t.next,t.next.previous=t.previous,t.head=null,this.size--,!0)},$jscomp.Map.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=$jscomp.Map.createHead_(),this.size=0},$jscomp.Map.prototype.has=function(e){return!!this.maybeGetEntry_(e).entry},$jscomp.Map.prototype.get=function(e){return(e=this.maybeGetEntry_(e).entry)&&e.value},$jscomp.Map.prototype.maybeGetEntry_=function(e){var t=$jscomp.Map.getId_(e),n=this.data_[t];if(n)for(var r=0;r<n.length;r++){var i=n[r];if(e!==e&&i.key!==i.key||e===i.key)return{id:t,list:n,index:r,entry:i}}return{id:t,list:n,index:-1,entry:void 0}},$jscomp.Map.prototype.entries=function(){return this.iter_(function(e){return[e.key,e.value]})},$jscomp.Map.prototype.keys=function(){return this.iter_(function(e){return e.key})},$jscomp.Map.prototype.values=function(){return this.iter_(function(e){return e.value})},$jscomp.Map.prototype.forEach=function(e,t){for(var n=$jscomp.makeIterator(this.entries()),r=n.next();!r.done;r=n.next())r=r.value,e.call(t,r[1],r[0],this)},$jscomp.Map.prototype.iter_=function(e){var t=this,n=this.head_;$jscomp.initSymbol(),$jscomp.initSymbolIterator();var r={};return r.next=function(){if(n){for(;n.head!=t.head_;)n=n.previous;for(;n.next!=n.head;)return n=n.next,{done:!1,value:e(n)};n=null}return{done:!0,value:void 0}},r[Symbol.iterator]=function(){return this},r},$jscomp.Map.index_=0,$jscomp.Map.defineProperty_=Object.defineProperty?function(e,t,n){Object.defineProperty(e,t,{value:String(n)})}:function(e,t,n){e[t]=String(n)},$jscomp.Map.Entry_=function(){},$jscomp.Map.ASSUME_NO_NATIVE=!1,$jscomp.Map$install=function(){$jscomp.initSymbol(),$jscomp.initSymbolIterator(),!$jscomp.Map.ASSUME_NO_NATIVE&&$jscomp.Map.checkBrowserConformance_()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.key_=Symbol("map-id-key")),$jscomp.Map$install=function(){}},$jscomp.math=$jscomp.math||{},$jscomp.math.clz32=function(e){if(0==(e=Number(e)>>>0))return 32;var t=0;return 0==(4294901760&e)&&(e<<=16,t+=16),0==(4278190080&e)&&(e<<=8,t+=8),0==(4026531840&e)&&(e<<=4,t+=4),0==(3221225472&e)&&(e<<=2,t+=2),0==(2147483648&e)&&t++,t},$jscomp.math.imul=function(e,t){var n=65535&(e=Number(e)),r=65535&(t=Number(t));return n*r+((e>>>16&65535)*r+n*(t>>>16&65535)<<16>>>0)|0},$jscomp.math.sign=function(e){return 0===(e=Number(e))||isNaN(e)?e:0<e?1:-1},$jscomp.math.log10=function(e){return Math.log(e)/Math.LN10},$jscomp.math.log2=function(e){return Math.log(e)/Math.LN2},$jscomp.math.log1p=function(e){if(.25>(e=Number(e))&&-.25<e){for(var t=e,n=1,r=e,i=0,o=1;i!=r;)t*=e,o*=-1,r=(i=r)+o*t/++n;return r}return Math.log(1+e)},$jscomp.math.expm1=function(e){if(.25>(e=Number(e))&&-.25<e){for(var t=e,n=1,r=e,i=0;i!=r;)t*=e/++n,r=(i=r)+t;return r}return Math.exp(e)-1},$jscomp.math.cosh=function(e){return e=Number(e),(Math.exp(e)+Math.exp(-e))/2},$jscomp.math.sinh=function(e){return 0===(e=Number(e))?e:(Math.exp(e)-Math.exp(-e))/2},$jscomp.math.tanh=function(e){if(0===(e=Number(e)))return e;var t=(1-(t=Math.exp(2*-Math.abs(e))))/(1+t);return 0>e?-t:t},$jscomp.math.acosh=function(e){return e=Number(e),Math.log(e+Math.sqrt(e*e-1))},$jscomp.math.asinh=function(e){if(0===(e=Number(e)))return e;var t=Math.log(Math.abs(e)+Math.sqrt(e*e+1));return 0>e?-t:t},$jscomp.math.atanh=function(e){return e=Number(e),($jscomp.math.log1p(e)-$jscomp.math.log1p(-e))/2},$jscomp.math.hypot=function(e,t,n){for(var r=[],i=2;i<arguments.length;++i)r[i-2]=arguments[i];e=Number(e),t=Number(t);for(var o=Math.max(Math.abs(e),Math.abs(t)),a=$jscomp.makeIterator(r),i=a.next();!i.done;i=a.next())o=Math.max(o,Math.abs(i.value));if(1e100<o||1e-100>o){for(a=(e/=o)*e+(t/=o)*t,i=(r=$jscomp.makeIterator(r)).next();!i.done;i=r.next())i=i.value,i=Number(i)/o,a+=i*i;return Math.sqrt(a)*o}for(o=e*e+t*t,i=(r=$jscomp.makeIterator(r)).next();!i.done;i=r.next())i=i.value,i=Number(i),o+=i*i;return Math.sqrt(o)},$jscomp.math.trunc=function(e){if(e=Number(e),isNaN(e)||1/0===e||-1/0===e||0===e)return e;var t=Math.floor(Math.abs(e));return 0>e?-t:t},$jscomp.math.cbrt=function(e){if(0===e)return e;e=Number(e);var t=Math.pow(Math.abs(e),1/3);return 0>e?-t:t},$jscomp.number=$jscomp.number||{},$jscomp.number.isFinite=function(e){return"number"==typeof e&&(!isNaN(e)&&1/0!==e&&-1/0!==e)},$jscomp.number.isInteger=function(e){return!!$jscomp.number.isFinite(e)&&e===Math.floor(e)},$jscomp.number.isNaN=function(e){return"number"==typeof e&&isNaN(e)},$jscomp.number.isSafeInteger=function(e){return $jscomp.number.isInteger(e)&&Math.abs(e)<=$jscomp.number.MAX_SAFE_INTEGER},$jscomp.number.EPSILON=Math.pow(2,-52),$jscomp.number.MAX_SAFE_INTEGER=9007199254740991,$jscomp.number.MIN_SAFE_INTEGER=-9007199254740991,$jscomp.object=$jscomp.object||{},$jscomp.object.assign=function(e,t){for(var n=[],r=1;r<arguments.length;++r)n[r-1]=arguments[r];for(r=(n=$jscomp.makeIterator(n)).next();!r.done;r=n.next())if(r=r.value)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e},$jscomp.object.is=function(e,t){return e===t?0!==e||1/e==1/t:e!==e&&t!==t},$jscomp.Set=function(e){if(e=void 0===e?[]:e,this.map_=new $jscomp.Map,e)for(var t=(e=$jscomp.makeIterator(e)).next();!t.done;t=e.next())this.add(t.value);this.size=this.map_.size},$jscomp.Set.checkBrowserConformance_=function(){var e=$jscomp.global.Set;if(!e||!e.prototype.entries||!Object.seal)return!1;var t=Object.seal({x:4});if((e=new e($jscomp.makeIterator([t]))).has(t)||1!=e.size||e.add(t)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var n=(e=e.entries()).next();return!n.done&&n.value[0]==t&&n.value[1]==t&&(!(n=e.next()).done&&n.value[0]!=t&&4==n.value[0].x&&n.value[1]==n.value[0]&&e.next().done)},$jscomp.Set.prototype.add=function(e){return this.map_.set(e,e),this.size=this.map_.size,this},$jscomp.Set.prototype.delete=function(e){return e=this.map_.delete(e),this.size=this.map_.size,e},$jscomp.Set.prototype.clear=function(){this.map_.clear(),this.size=0},$jscomp.Set.prototype.has=function(e){return this.map_.has(e)},$jscomp.Set.prototype.entries=function(){return this.map_.entries()},$jscomp.Set.prototype.values=function(){return this.map_.values()},$jscomp.Set.prototype.forEach=function(e,t){var n=this;this.map_.forEach(function(r){return e.call(t,r,r,n)})},$jscomp.Set.ASSUME_NO_NATIVE=!1,$jscomp.Set$install=function(){!$jscomp.Set.ASSUME_NO_NATIVE&&$jscomp.Set.checkBrowserConformance_()?$jscomp.Set=$jscomp.global.Set:($jscomp.Map$install(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values),$jscomp.Set$install=function(){}},$jscomp.string=$jscomp.string||{},$jscomp.string.noRegExp_=function(e,t){if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+t+" must not be a regular expression")},$jscomp.string.fromCodePoint=function(e){for(var t=[],n=0;n<arguments.length;++n)t[n-0]=arguments[n];for(var n="",r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next()){if(r=r.value,0>(r=+r)||1114111<r||r!==Math.floor(r))throw new RangeError("invalid_code_point "+r);65535>=r?n+=String.fromCharCode(r):(r-=65536,n+=String.fromCharCode(r>>>10&1023|55296),n+=String.fromCharCode(1023&r|56320))}return n},$jscomp.string.repeat=function(e){var t=this.toString();if(0>e||1342177279<e)throw new RangeError("Invalid count value");e|=0;for(var n="";e;)1&e&&(n+=t),(e>>>=1)&&(t+=t);return n},$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)},$jscomp.string.codePointAt=function(e){var t=this.toString(),n=t.length;if(0<=(e=Number(e)||0)&&e<n){e|=0;var r=t.charCodeAt(e);return 55296>r||56319<r||e+1===n?r:56320>(e=t.charCodeAt(e+1))||57343<e?r:1024*(r-55296)+e+9216}},$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)},$jscomp.string.includes=function(e,t){return t=void 0===t?0:t,$jscomp.string.noRegExp_(e,"includes"),-1!==this.toString().indexOf(e,t)},$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)},$jscomp.string.startsWith=function(e,t){t=void 0===t?0:t,$jscomp.string.noRegExp_(e,"startsWith");var n=this.toString();e+="";for(var r=n.length,i=e.length,o=Math.max(0,Math.min(0|t,n.length)),a=0;a<i&&o<r;)if(n[o++]!=e[a++])return!1;return a>=i},$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)},$jscomp.string.endsWith=function(e,t){$jscomp.string.noRegExp_(e,"endsWith");var n=this.toString();e+="",void 0===t&&(t=n.length);for(var r=Math.max(0,Math.min(0|t,n.length)),i=e.length;0<i&&0<r;)if(n[--r]!=e[--i])return!1;return 0>=i},$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=0<a.length&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3]))c.label=n[1];else if(6===n[0]&&c.label<a[1])c.label=a[1],a=n;else{if(!(a&&c.label<a[2])){a[2]&&c.ops.pop(),c.trys.pop();continue}c.label=a[2],c.ops.push(n)}}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return $jscomp.initSymbol(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};define("logger",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.tracing=!1,this.mslogger_=void 0,this.tag=e,this.enabled=!0}return e.prototype.setMSLogger=function(e){this.mslogger_=e},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(void 0!=this.mslogger_?this.mslogger_.info(this.tag+" "+e):console.log(this.tag+" "+e))},e.prototype.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.tracing&&this.log.apply(this,e)},e}();t.Logger=n,t.logger=new n("[HdxWebRTC.js]"),t.logger.enabled=!0}),define("util",["require","exports","logger"],function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),e=function(){function e(){}return e.stringifyArray=function(e){for(var t="[",n=0;n<e.length;++n)0!=n&&(t+=","),t+=this.stringify(e[n]);return t+"]"},e.stringifyObject=function(e){var t,n="{",r=!0;for(t in e)r?r=!1:n+=",",n=n+'"'+t+'":',n=e[t]instanceof Array?n+this.stringifyArray(e[t]):"object"==typeof e[t]?n+this.stringifyObject(e[t]):n+JSON.stringify(e[t]);return n+"}"},e.stringify=function(e){return"object"==typeof e?"[object Array]"==Object.prototype.toString.call(e)?this.stringifyArray(e):this.stringifyObject(e):JSON.stringify(e)},e.GetObjectPropertyDescriptor=function(e,t){for(var n=void 0;e!=Object.prototype&&void 0===(n=Object.getOwnPropertyDescriptor(e,t));)e=e.__proto__;return n},e.sendEvent=function(e,t){try{var r=document.createEvent("Event");r.initEvent(t,!0,!0),e.dispatchEvent(r)}catch(e){n.logger.log('sendEvent(): exception dispatching "'+t+'" event: '+e.message)}},e}(),t.Util=e}),define("webrpcclassinfo",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HDXMS_VERSION="1.9.0.0";A=function(e,t,n,r){this.major=e,this.minor=t,this.revision=n,this.build=r};t.VersionData=A;n=function(){};t.FeatureData=n;var n=function(e,t){this.fature=e,this.version=t},r=function(e,t,n,r,i){this.family=e,this.version=t,this.architecture=n,this.distro=r,this.edition=i};t.OSInfo=r,r=function(e,t){this.machine_id=e,this.user_id=t},t.EndpointId=r,t.FEATURE_vda_service_no_buffer_limit="wsservice_no_buffer_limit",t.FEATURE_vda_app_sharing="webrtc_app_sharing",t.FEATURE_vda_multi_window="webrtc_multi_window",t.FEATURE_ms_teams_redirection="ms_teams_redirection",t.FEATURE_ms_teams_desktop_sharing="ms_teams_desktop_sharing",t.FEATURE_ms_teams_speaking_indicator="ms_teams_speaking_indicator",t.FEATURE_ms_teams_common_media_constraints="ms_teams_common_media_constraints",t.FEATURE_ms_teams_1911="ms_teams_1911",t.FEATURE_ms_teams_pstn="ms_teams_pstn",t.FEATURE_ms_teams_1912="ms_teams_1912",t.FEATURE_ms_teams_mstrack_constraints="ms_teams_mstrack_constraints",t.FEATURE_ms_teams_osinfo="ms_teams_osinfo",t.FEATURE_ms_teams_endpoint_id="ms_teams_endpoint_id",t.FEATURE_ms_teams_remote_audio_notifications="ms_teams_remote_audio_notifications",t.FEATURE_ms_teams_device_group_id="ms_teams_device_group_id",t.FEATURE_ms_teams_dtmf="ms_teams_dtmf",t.FEATURE_ms_teams_video_placement="ms_teams_video_placement",t.FEATURE_ms_teams_monitor_sharing="ms_teams_multi_monitor_sharing",t.FEATURE_ms_teams_app_sharing="ms_teams_app_sharing",t.FEATURE_ms_teams_codec_capability="ms_teams_codec_capability",t.FEATURE_ms_teams_e911="ms_teams_e911",t.FEATURE_ms_teams_gtc="ms_teams_gtc",t.FEATURE_ms_teams_multi_window="ms_teams_multi_windows",t.FEATURE_ms_teams_webrtc_1dot0="ms_teams_webrtc_1.0",t.FEATURE_ms_teams_data_channel="ms_teams_data_channel",t.FEATURE_ms_teams_no_vd_buffer_limit="ms_teams_no_vd_buffer_limit",new n(t.FEATURE_ms_teams_redirection,new A(1,1,0,0)),new n(t.FEATURE_ms_teams_desktop_sharing,new A(1,2,0,0)),new n(t.FEATURE_ms_teams_speaking_indicator,new A(1,2,0,0)),new n(t.FEATURE_ms_teams_common_media_constraints,new A(1,4,0,0)),new n(t.FEATURE_ms_teams_1911,new A(1,4,0,0)),new n(t.FEATURE_ms_teams_1912,new A(1,5,0,0)),new n(t.FEATURE_ms_teams_mstrack_constraints,new A(1,6,0,0)),new n(t.FEATURE_ms_teams_pstn,new A(1,6,0,0)),new n(t.FEATURE_ms_teams_osinfo,new A(1,7,0,0)),new n(t.FEATURE_ms_teams_endpoint_id,new A(1,7,0,0)),new n(t.FEATURE_ms_teams_remote_audio_notifications,new A(1,7,0,0)),new n(t.FEATURE_ms_teams_device_group_id,new A(1,7,0,0)),new n(t.FEATURE_ms_teams_codec_capability,new A(1,7,0,0)),new n(t.FEATURE_ms_teams_dtmf,new A(1,7,0,0)),new n(t.FEATURE_ms_teams_video_placement,new A(1,7,0,0)),new n(t.FEATURE_ms_teams_monitor_sharing,new A(1,7,0,0)),new n(t.FEATURE_ms_teams_app_sharing,new A(1,8,0,0)),new n(t.FEATURE_ms_teams_webrtc_1dot0,new A(1,8,0,0)),new n(t.FEATURE_ms_teams_data_channel,new A(1,8,0,0)),new n(t.FEATURE_ms_teams_e911,new A(1,13,0,0)),new n(t.FEATURE_ms_teams_multi_window,new A(1,14,0,0)),new n(t.FEATURE_ms_teams_gtc,new A(1,19,0,0)),t.FEATURE_public_screenshare="screenshare",t.FEATURE_public_redirection="redirection",t.FEATURE_public_speaking_indicator="speaking_indicator",t.FEATURE_public_pstn="pstn",t.FEATURE_public_osinfo="osinfo",t.FEATURE_public_endpoint_id="endpointid",t.FEATURE_public_remote_audio_notifications="remoteaudionotifications",t.FEATURE_public_device_group_id="compositedevices",t.FEATURE_public_dtmf="dtmf",t.FEATURE_public_monitor_sharing="multimonitorscreenshare",t.FEATURE_public_app_sharing="appshare",t.FEATURE_public_codec_capability="codec_capability",t.FEATURE_public_e911="e911",t.FEATURE_public_gtc="givecontrol",t.FEATURE_public_webrtc1dot0="webrtc1.0",t.FEATURE_public_data_channel="datachannel",t.FEATURE_public_vdnobuflimit="vdnobuflimit",t.FEATURE_public_multi_window="multiwindow",t.featureNameMap={},t.featureNameMap[t.FEATURE_public_screenshare]=[t.FEATURE_ms_teams_desktop_sharing],t.featureNameMap[t.FEATURE_public_redirection]=[t.FEATURE_ms_teams_redirection],t.featureNameMap[t.FEATURE_public_speaking_indicator]=[t.FEATURE_ms_teams_speaking_indicator],t.featureNameMap[t.FEATURE_public_pstn]=[t.FEATURE_ms_teams_pstn],t.featureNameMap[t.FEATURE_public_osinfo]=[t.FEATURE_ms_teams_osinfo],t.featureNameMap[t.FEATURE_public_endpoint_id]=[t.FEATURE_ms_teams_endpoint_id],t.featureNameMap[t.FEATURE_public_remote_audio_notifications]=[t.FEATURE_ms_teams_remote_audio_notifications],t.featureNameMap[t.FEATURE_public_device_group_id]=[t.FEATURE_ms_teams_device_group_id],t.featureNameMap[t.FEATURE_public_dtmf]=[t.FEATURE_ms_teams_dtmf],t.featureNameMap[t.FEATURE_public_monitor_sharing]=[t.FEATURE_ms_teams_monitor_sharing],t.featureNameMap[t.FEATURE_public_app_sharing]=[t.FEATURE_ms_teams_app_sharing],t.featureNameMap[t.FEATURE_public_codec_capability]=[t.FEATURE_ms_teams_codec_capability],t.featureNameMap[t.FEATURE_public_e911]=[t.FEATURE_ms_teams_e911],t.featureNameMap[t.FEATURE_public_gtc]=[t.FEATURE_ms_teams_gtc],t.featureNameMap[t.FEATURE_public_webrtc1dot0]=[t.FEATURE_ms_teams_webrtc_1dot0],t.featureNameMap[t.FEATURE_public_multi_window]=[t.FEATURE_ms_teams_multi_window],t.featureNameMap[t.FEATURE_public_data_channel]=[t.FEATURE_ms_teams_data_channel],t.featureNameMap[t.FEATURE_public_vdnobuflimit]=[t.FEATURE_ms_teams_no_vd_buffer_limit],function(e){e[e.EngineControl=0]="EngineControl",e[e.RTCPeerConnection=1]="RTCPeerConnection",e[e.RTCSessionDescription=2]="RTCSessionDescription",e[e.RTCIceCandidate=3]="RTCIceCandidate",e[e.RTCIceCandidateEvent=4]="RTCIceCandidateEvent",e[e.MediaDevices=5]="MediaDevices",e[e.MediaDeviceInfo=6]="MediaDeviceInfo",e[e.MediaStreamTrack=7]="MediaStreamTrack",e[e.MediaStreamEvent=8]="MediaStreamEvent",e[e.MediaStream=9]="MediaStream",e[e.NavigatorUserMedia=10]="NavigatorUserMedia",e[e.VideoElement=11]="VideoElement",e[e.AudioElement=12]="AudioElement",e[e.RTCRtpReceiver=13]="RTCRtpReceiver",e[e.RTCRtpSender=14]="RTCRtpSender",e[e.RTCDtlsTransport=15]="RTCDtlsTransport",e[e.RTCIceTransport=16]="RTCIceTransport",e[e.RTCDTMFSender=17]="RTCDTMFSender",e[e.RTCDTMFToneChangeEvent=18]="RTCDTMFToneChangeEvent",e[e.RTCIceCandidatePair=19]="RTCIceCandidatePair",e[e.RTCRtpTransceiver=20]="RTCRtpTransceiver",e[e.ScreenSharingRemote=21]="ScreenSharingRemote",e[e.ScreenSource=22]="ScreenSource",e[e.E911Service=23]="E911Service",e[e.GiveTakeControl=24]="GiveTakeControl",e[e.RTCDataChannel=25]="RTCDataChannel",e[e.RTCSctpTransport=26]="RTCSctpTransport"}(A=t.class_id_t||(t.class_id_t={})),function(e){e[e.ctor=0]="ctor",e[e.version=1]="version",e[e.feature_flags=2]="feature_flags",e[e.version_info=3]="version_info",e[e.osinfo=4]="osinfo",e[e.endpoint_id=5]="endpoint_id"}(n=t.method_id_EngineControl_t||(t.method_id_EngineControl_t={})),function(e){e[e.ctor=0]="ctor",e[e.localDescription=1]="localDescription",e[e.remoteDescription=2]="remoteDescription",e[e.readyState=3]="readyState",e[e.iceState=4]="iceState",e[e.localStreams=5]="localStreams",e[e.remoteStreams=6]="remoteStreams",e[e.createOffer=7]="createOffer",e[e.createAnswer=8]="createAnswer",e[e.setLocalDescription=9]="setLocalDescription",e[e.setRemoteDescription=10]="setRemoteDescription",e[e.updateIce=11]="updateIce",e[e.addIceCandidate=12]="addIceCandidate",e[e.addStream=13]="addStream",e[e.removeStream=14]="removeStream",e[e.close=15]="close",e[e.iceConnectionState=16]="iceConnectionState",e[e.iceGatheringState=17]="iceGatheringState",e[e.signalingState=18]="signalingState",e[e.onaddstream=19]="onaddstream",e[e.onicecandidate=20]="onicecandidate",e[e.oniceconnectionstatechange=21]="oniceconnectionstatechange",e[e.onicegatheringstatechange=22]="onicegatheringstatechange",e[e.onsignalingstatechange=23]="onsignalingstatechange",e[e.onnegotiationneeded=24]="onnegotiationneeded",e[e.onremovestream=25]="onremovestream",e[e.getStats=26]="getStats",e[e.getReceivers=27]="getReceivers",e[e.getSenders=28]="getSenders",e[e.addTrack=29]="addTrack",e[e.removeTrack=30]="removeTrack",e[e.ontrack=31]="ontrack",e[e.setLocalDescription_v2=32]="setLocalDescription_v2",e[e.setRemoteDescription_v2=33]="setRemoteDescription_v2",e[e.addTransceiverWithTrack=34]="addTransceiverWithTrack",e[e.addTransceiverWithKind=35]="addTransceiverWithKind",e[e.getTransceivers=36]="getTransceivers",e[e.onconnectionstatechange=37]="onconnectionstatechange",e[e.sctp=38]="sctp",e[e.ondatachannel=39]="ondatachannel",e[e.createDataChannel=40]="createDataChannel",e[e.getStats_v2=41]="getStats_v2"}(r=t.method_id_RTCPeerConnection_t||(t.method_id_RTCPeerConnection_t={}));var i;!function(e){e[e.ctor=0]="ctor",e[e.enumerateDevices=1]="enumerateDevices",e[e.getDisplayMedia=2]="getDisplayMedia",e[e.ondevicechange=3]="ondevicechange"}(i=t.method_id_MediaDevices_t||(t.method_id_MediaDevices_t={}));var o;!function(e){e[e.ctor=0]="ctor",e[e.deviceId=1]="deviceId",e[e.kind=2]="kind",e[e.label=3]="label",e[e.groupId=4]="groupId"}(o=t.method_id_MediaDeviceInfo_t||(t.method_id_MediaDeviceInfo_t={}));var a;!function(e){e[e.ctor=0]="ctor",e[e.type=1]="type",e[e.sdp=2]="sdp"}(a=t.method_id_RTCSessionDescription_t||(t.method_id_RTCSessionDescription_t={}));var s;!function(e){e[e.ctor=0]="ctor",e[e.kind=1]="kind",e[e.id=2]="id",e[e.label=3]="label",e[e.enabled=4]="enabled",e[e.muted=5]="muted",e[e.readyState=6]="readyState",e[e.onended=7]="onended",e[e.onmute=8]="onmute",e[e.onunmute=9]="onunmute",e[e.clone=10]="clone",e[e.stop=11]="stop",e[e.getCapabilities=12]="getCapabilities",e[e.getSettings=13]="getSettings",e[e.applyConstraints=14]="applyConstraints",e[e.getConstraints=15]="getConstraints"}(s=t.method_id_MediaStreamTrack_t||(t.method_id_MediaStreamTrack_t={}));var c;!function(e){e[e.ctor=0]="ctor",e[e.id=1]="id",e[e.getAudioTracks=2]="getAudioTracks",e[e.getVideoTracks=3]="getVideoTracks",e[e.getTracks=4]="getTracks",e[e.getTrackById=5]="getTrackById",e[e.addTrack=6]="addTrack",e[e.removeTrack=7]="removeTrack",e[e.clone=8]="clone",e[e.active=9]="active"}(c=t.method_id_MediaStream_t||(t.method_id_MediaStream_t={}));var d;!function(e){e[e.ctor=0]="ctor",e[e.getUserMedia=1]="getUserMedia",e[e.setCodecCapabilities=2]="setCodecCapabilities",e[e.getCapabilities=3]="getCapabilities"}(d=t.method_id_NavigatorUserMedia_t||(t.method_id_NavigatorUserMedia_t={}));var l;!function(e){e[e.ctor=0]="ctor",e[e.candidate=1]="candidate",e[e.sdpMid=2]="sdpMid",e[e.sdpMLineIndex=3]="sdpMLineIndex"}(l=t.method_id_RTCIceCandidate_t||(t.method_id_RTCIceCandidate_t={}));var u;!function(e){e[e.ctor=0]="ctor",e[e.candidate=1]="candidate"}(u=t.method_id_RTCIceCandidateEvent_t||(t.method_id_RTCIceCandidateEvent_t={}));var _;!function(e){e[e.ctor=0]="ctor",e[e.stream=1]="stream"}(_=t.method_id_MediaStreamEvent_t||(t.method_id_MediaStreamEvent_t={}));var g;!function(e){e[e.ctor=0]="ctor",e[e.sinkId=1]="sinkId",e[e.connectTo=2]="connectTo",e[e.disconnect=3]="disconnect",e[e.setFrame=4]="setFrame",e[e.addClipRect=5]="addClipRect",e[e.removeClipRect=6]="removeClipRect",e[e.onerror=7]="onerror",e[e.onvideoframechanged=8]="onvideoframechanged",e[e.placement=9]="placement"}(g=t.method_id_VideoElement_t||(t.method_id_VideoElement_t={}));var h;!function(e){e[e.ctor=0]="ctor",e[e.sinkId=1]="sinkId",e[e.srcObject=2]="srcObject",e[e.src=3]="src",e[e.play=4]="play",e[e.pause=5]="pause"}(h=t.method_id_AudioElement_t||(t.method_id_AudioElement_t={}));var f;!function(e){e[e.ctor=0]="ctor",e[e.track=1]="track",e[e.getContributingSources=2]="getContributingSources",e[e.getSynchronizationSources=3]="getSynchronizationSources",e[e.transport=4]="transport",e[e.rtcpTransport=5]="rtcpTransport",e[e.getCapabilities=6]="getCapabilities",e[e.getParameters=7]="getParameters",e[e.getStats=8]="getStats",e[e.getCapabilities_v2=9]="getCapabilities_v2"}(f=t.method_id_RTCRtpReceiver_t||(t.method_id_RTCRtpReceiver_t={}));var p;!function(e){e[e.ctor=0]="ctor",e[e.track=1]="track",e[e.transport=2]="transport",e[e.rtcpTransport=3]="rtcpTransport",e[e.dtmf=4]="dtmf",e[e.getCapabilities=5]="getCapabilities",e[e.getParameters=6]="getParameters",e[e.setParameters=7]="setParameters",e[e.replaceTrack=8]="replaceTrack",e[e.getStats=9]="getStats",e[e.setStreams=10]="setStreams",e[e.getCapabilities_v2=11]="getCapabilities_v2"}(p=t.method_id_RTCRtpSender_t||(t.method_id_RTCRtpSender_t={}));var m;!function(e){e[e.ctor=0]="ctor",e[e.transport=1]="transport",e[e.state=2]="state",e[e.getRemoteCertificates=3]="getRemoteCertificates",e[e.onstatechange=4]="onstatechange",e[e.onerror=5]="onerror"}(m=t.method_id_RTCDtlsTransport_t||(t.method_id_RTCDtlsTransport_t={}));var v;!function(e){e[e.ctor=0]="ctor",e[e.role=1]="role",e[e.component=2]="component",e[e.state=3]="state",e[e.gatheringState=4]="gatheringState",e[e.localcandidates=5]="localcandidates",e[e.remotecandidates=6]="remotecandidates",e[e.onstatechange=7]="onstatechange",e[e.ongatheringstatechange=8]="ongatheringstatechange",e[e.onselectedcandidatepairchange=9]="onselectedcandidatepairchange"}(v=t.method_id_RTCIceTransport_t||(t.method_id_RTCIceTransport_t={}));var y;!function(e){e[e.ctor=0]="ctor",e[e.insertDTMF=1]="insertDTMF",e[e.ontonechange=2]="ontonechange",e[e.canInsertDTMF=3]="canInsertDTMF",e[e.toneBuffer=4]="toneBuffer"}(y=t.method_id_RTCDTMFSender_t||(t.method_id_RTCDTMFSender_t={}));var C;!function(e){e[e.ctor=0]="ctor",e[e.tone=1]="tone",e[e.tone_buffer=2]="tone_buffer"}(C=t.method_id_RTCDTMFToneChangeEvent_t||(t.method_id_RTCDTMFToneChangeEvent_t={}));var b;!function(e){e[e.ctor=0]="ctor",e[e.local=1]="local",e[e.remote=2]="remote"}(b=t.method_id_RTCIceCandidatePair_t||(t.method_id_RTCIceCandidatePair_t={}));var R;!function(e){e[e.ctor=0]="ctor",e[e.mid=1]="mid",e[e.sender=2]="sender",e[e.receiver=3]="receiver",e[e.direction=4]="direction",e[e.currentDirection=5]="currentDirection",e[e.stop=6]="stop",e[e.setCodecPreferences=7]="setCodecPreferences"}(R=t.method_id_RTCRtpTransceiver_t||(t.method_id_RTCRtpTransceiver_t={}));var T;!function(e){e[e.ctor=0]="ctor",e[e.getScreensAsync=1]="getScreensAsync",e[e.onscreentopologychanged=2]="onscreentopologychanged"}(T=t.method_id_VDISharingRemote_t||(t.method_id_VDISharingRemote_t={}));var S;!function(e){e[e.ctor=0]="ctor",e[e.srcid=1]="srcid",e[e.deviceid=2]="deviceid",e[e.type=3]="type",e[e.name=4]="name",e[e.imagedata=5]="imagedata",e[e.hwnd=6]="hwnd",e[e.origin=7]="origin",e[e.caption=8]="caption",e[e.pid=9]="pid",e[e.bounds=10]="bounds"}(S=t.method_id_ScreenSource_t||(t.method_id_ScreenSource_t={}));var w;!function(e){e[e.ctor=0]="ctor",e[e.getE911Info=1]="getE911Info",e[e.onupdate=2]="onupdate"}(w=t.method_id_E911Service_t||(t.method_id_E911Service_t={}));var E;!function(e){e[e.ctor=0]="ctor",e[e.createVirtualCursor=1]="createVirtualCursor",e[e.destroyCursor=2]="destroyCursor",e[e.showVirtualCursor=3]="showVirtualCursor",e[e.setAvatar=4]="setAvatar",e[e.injectMouseEvent=5]="injectMouseEvent",e[e.injectKeyboardEvent=6]="injectKeyboardEvent",e[e.injectClipboardText=7]="injectClipboardText",e[e.dispose=8]="dispose"}(E=t.method_id_GiveTakeControl_t||(t.method_id_GiveTakeControl_t={}));var k;!function(e){e[e.ctor=0]="ctor",e[e.label=1]="label",e[e.ordered=2]="ordered",e[e.maxPacketLifeTime=3]="maxPacketLifeTime",e[e.maxRetransmits=4]="maxRetransmits",e[e.protocol=5]="protocol",e[e.negotiated=6]="negotiated",e[e.id=7]="id",e[e.readyState=8]="readyState",e[e.bufferedAmount=9]="bufferedAmount",e[e.bufferedAmountLowThreshold=10]="bufferedAmountLowThreshold",e[e.onopen=11]="onopen",e[e.onbufferedamountlow=12]="onbufferedamountlow",e[e.onerror=13]="onerror",e[e.onclosing=14]="onclosing",e[e.onclose=15]="onclose",e[e.onmessage=16]="onmessage",e[e.close=17]="close",e[e.send_text=18]="send_text",e[e.send_binary=19]="send_binary"}(k=t.method_id_RTCDataChannel_t||(t.method_id_RTCDataChannel_t={}));var I;!function(e){e[e.ctor=0]="ctor",e[e.transport=1]="transport",e[e.state=2]="state",e[e.maxMessageSize=3]="maxMessageSize",e[e.maxChannels=4]="maxChannels",e[e.onstatechange=5]="onstatechange"}(I=t.method_id_RTCSctpTransport_t||(t.method_id_RTCSctpTransport_t={}));var j=function(e,n,r,i,o){void 0===o&&(o=t.FEATURE_ms_teams_redirection),this.iid=e,this.mid=n,this.name=r,this.isprop=i,this.feature=o};t.WebrpcMethodInfo=j;var P=function(e,t,n){this.id=e,this.name=t,this.methods=n};t.WebrpcClassInfo=P;var D=new function(e,t){this.name=e,this.classes=t}("msteams_class_library",[new P(A.EngineControl,"EngineControl",[new j(A.EngineControl,n.ctor,"ctor",!1),new j(A.EngineControl,n.version,"version",!0),new j(A.EngineControl,n.feature_flags,"feature_flags",!0),new j(A.EngineControl,n.version_info,"version_info",!0,t.FEATURE_ms_teams_desktop_sharing),new j(A.EngineControl,n.osinfo,"osinfo",!0,t.FEATURE_ms_teams_osinfo),new j(A.EngineControl,n.endpoint_id,"endpoint_id",!0,t.FEATURE_ms_teams_endpoint_id)]),new P(A.RTCPeerConnection,"RTCPeerConnection",[new j(A.RTCPeerConnection,r.ctor,"ctor",!1),new j(A.RTCPeerConnection,r.localDescription,"localDescription",!0),new j(A.RTCPeerConnection,r.remoteDescription,"remoteDescription",!0),new j(A.RTCPeerConnection,r.readyState,"readyState",!0),new j(A.RTCPeerConnection,r.iceState,"iceState",!0),new j(A.RTCPeerConnection,r.localStreams,"localStreams",!0),new j(A.RTCPeerConnection,r.remoteStreams,"remoteStreams",!0),new j(A.RTCPeerConnection,r.createOffer,"createOffer",!1),new j(A.RTCPeerConnection,r.createAnswer,"createAnswer",!1),new j(A.RTCPeerConnection,r.setLocalDescription,"setLocalDescription",!1),new j(A.RTCPeerConnection,r.setRemoteDescription,"setRemoteDescription",!1),new j(A.RTCPeerConnection,r.updateIce,"updateIce",!0),new j(A.RTCPeerConnection,r.addIceCandidate,"addIceCandidate",!0),new j(A.RTCPeerConnection,r.addStream,"addStream",!0),new j(A.RTCPeerConnection,r.removeStream,"removeStream",!0),new j(A.RTCPeerConnection,r.close,"close",!0),new j(A.RTCPeerConnection,r.iceConnectionState,"iceConnectionState",!0),new j(A.RTCPeerConnection,r.iceGatheringState,"iceGatheringState",!0),new j(A.RTCPeerConnection,r.signalingState,"signalingState",!0),new j(A.RTCPeerConnection,r.onaddstream,"onaddstream",!0),new j(A.RTCPeerConnection,r.onicecandidate,"onicecandidate",!0),new j(A.RTCPeerConnection,r.oniceconnectionstatechange,"oniceconnectionstatechange",!0),new j(A.RTCPeerConnection,r.onicegatheringstatechange,"onicegatheringstatechange",!0),new j(A.RTCPeerConnection,r.onsignalingstatechange,"onsignalingstatechange",!0),new j(A.RTCPeerConnection,r.onnegotiationneeded,"onnegotiationneeded",!0),new j(A.RTCPeerConnection,r.onremovestream,"onremovestream",!0),new j(A.RTCPeerConnection,r.getStats,"getStats",!1),new j(A.RTCPeerConnection,r.getReceivers,"getReceivers",!1,t.FEATURE_ms_teams_speaking_indicator),new j(A.RTCPeerConnection,r.getSenders,"getSenders",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCPeerConnection,r.addTrack,"addTrack",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCPeerConnection,r.removeTrack,"removeTrack",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCPeerConnection,r.ontrack,"ontrack",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCPeerConnection,r.setLocalDescription_v2,"setLocalDescription_v2",!1,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCPeerConnection,r.setRemoteDescription_v2,"setRemoteDescription_v2",!1,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCPeerConnection,r.addTransceiverWithTrack,"addTransceiverWithTrack",!1,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCPeerConnection,r.addTransceiverWithKind,"addTransceiverWithKind",!1,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCPeerConnection,r.getTransceivers,"getTransceivers",!1,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCPeerConnection,r.onconnectionstatechange,"onconnectionstatechange",!0,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCPeerConnection,r.sctp,"sctp",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCPeerConnection,r.ondatachannel,"ondatachannel",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCPeerConnection,r.createDataChannel,"createDataChannel",!1,t.FEATURE_ms_teams_data_channel),new j(A.RTCPeerConnection,r.getStats_v2,"getStats_v2",!1,t.FEATURE_ms_teams_webrtc_1dot0)]),new P(A.RTCSessionDescription,"RTCSessionDescription",[new j(A.RTCSessionDescription,a.ctor,"ctor",!1),new j(A.RTCSessionDescription,a.type,"type",!0),new j(A.RTCSessionDescription,a.sdp,"sdp",!0)]),new P(A.RTCIceCandidate,"RTCIceCandidate",[new j(A.RTCIceCandidate,l.ctor,"ctor",!1),new j(A.RTCIceCandidate,l.candidate,"candidate",!0),new j(A.RTCIceCandidate,l.sdpMid,"sdpMid",!0),new j(A.RTCIceCandidate,l.sdpMLineIndex,"sdpMLineIndex",!0)]),new P(A.RTCIceCandidateEvent,"RTCIceCandidateEvent",[new j(A.RTCIceCandidateEvent,u.ctor,"ctor",!1),new j(A.RTCIceCandidateEvent,u.candidate,"candidate",!0)]),new P(A.MediaDevices,"MediaDevices",[new j(A.MediaDevices,i.ctor,"ctor",!1),new j(A.MediaDevices,i.enumerateDevices,"enumerateDevices",!1),new j(A.MediaDevices,i.getDisplayMedia,"getDisplayMedia",!1,t.FEATURE_ms_teams_desktop_sharing),new j(A.MediaDevices,i.ondevicechange,"ondevicechange",!0,t.FEATURE_ms_teams_speaking_indicator)]),new P(A.MediaDeviceInfo,"MediaDeviceInfo",[new j(A.MediaDeviceInfo,o.ctor,"ctor",!1),new j(A.MediaDeviceInfo,o.deviceId,"deviceId",!0),new j(A.MediaDeviceInfo,o.kind,"kind",!0),new j(A.MediaDeviceInfo,o.label,"label",!0),new j(A.MediaDeviceInfo,o.groupId,"groupId",!0)]),new P(A.MediaStreamTrack,"MediaStreamTrack",[new j(A.MediaStreamTrack,s.ctor,"ctor",!1),new j(A.MediaStreamTrack,s.clone,"clone",!1),new j(A.MediaStreamTrack,s.stop,"stop",!1),new j(A.MediaStreamTrack,s.getCapabilities,"getCapabilities",!1),new j(A.MediaStreamTrack,s.getSettings,"getSettings",!1),new j(A.MediaStreamTrack,s.applyConstraints,"applyConstraints",!1,t.FEATURE_ms_teams_desktop_sharing),new j(A.MediaStreamTrack,s.kind,"kind",!0),new j(A.MediaStreamTrack,s.id,"id",!0),new j(A.MediaStreamTrack,s.label,"label",!0),new j(A.MediaStreamTrack,s.enabled,"enabled",!0),new j(A.MediaStreamTrack,s.muted,"muted",!0),new j(A.MediaStreamTrack,s.readyState,"readyState",!0),new j(A.MediaStreamTrack,s.onended,"onended",!0),new j(A.MediaStreamTrack,s.onmute,"onmute",!0),new j(A.MediaStreamTrack,s.onunmute,"onunmute",!0),new j(A.MediaStreamTrack,s.getConstraints,"getConstraints",!1,t.FEATURE_ms_teams_mstrack_constraints)]),new P(A.MediaStream,"MediaStream",[new j(A.MediaStream,c.ctor,"ctor",!1),new j(A.MediaStream,c.id,"id",!0),new j(A.MediaStream,c.getAudioTracks,"getAudioTracks",!1),new j(A.MediaStream,c.getVideoTracks,"getVideoTracks",!1),new j(A.MediaStream,c.getTracks,"getTracks",!1),new j(A.MediaStream,c.getTrackById,"getTrackById",!1),new j(A.MediaStream,c.addTrack,"addTrack",!1),new j(A.MediaStream,c.removeTrack,"removeTrack",!1),new j(A.MediaStream,c.clone,"clone",!0),new j(A.MediaStream,c.active,"active",!0)]),new P(A.NavigatorUserMedia,"NavigatorUserMedia",[new j(A.NavigatorUserMedia,d.ctor,"ctor",!1),new j(A.NavigatorUserMedia,d.getUserMedia,"getUserMedia",!1),new j(A.NavigatorUserMedia,d.setCodecCapabilities,"setCodecCapabilities",!1,t.FEATURE_ms_teams_codec_capability),new j(A.NavigatorUserMedia,d.getCapabilities,"getRtpCapabilities",!1,t.FEATURE_ms_teams_webrtc_1dot0)]),new P(A.MediaStreamEvent,"MediaStreamEvent",[new j(A.MediaStreamEvent,_.ctor,"ctor",!1),new j(A.MediaStreamEvent,_.stream,"stream",!0)]),new P(A.VideoElement,"VideoElement",[new j(A.VideoElement,g.ctor,"ctor",!1),new j(A.VideoElement,g.sinkId,"sinkId",!0),new j(A.VideoElement,g.connectTo,"connectTo",!1),new j(A.VideoElement,g.disconnect,"disconnect",!1),new j(A.VideoElement,g.setFrame,"setFrame",!1),new j(A.VideoElement,g.addClipRect,"addClipRect",!1),new j(A.VideoElement,g.removeClipRect,"removeClipRect",!1),new j(A.VideoElement,g.onerror,"onerror",!0),new j(A.VideoElement,g.onvideoframechanged,"onvideoframechanged",!0),new j(A.VideoElement,g.placement,"placement",!0,t.FEATURE_ms_teams_video_placement)]),new P(A.AudioElement,"AudioElement",[new j(A.AudioElement,h.ctor,"ctor",!1),new j(A.AudioElement,h.sinkId,"sinkId",!0),new j(A.AudioElement,h.srcObject,"srcObject",!0),new j(A.AudioElement,h.src,"src",!0),new j(A.AudioElement,h.play,"play",!1),new j(A.AudioElement,h.pause,"pause",!1)]),new P(A.RTCRtpReceiver,"RTCRtpReceiver",[new j(A.RTCRtpReceiver,f.ctor,"ctor",!1,t.FEATURE_ms_teams_speaking_indicator),new j(A.RTCRtpReceiver,f.track,"track",!0,t.FEATURE_ms_teams_speaking_indicator),new j(A.RTCRtpReceiver,f.getContributingSources,"getContributingSources",!1,t.FEATURE_ms_teams_speaking_indicator),new j(A.RTCRtpReceiver,f.getSynchronizationSources,"getSynchronizationSources",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpReceiver,f.transport,"transport",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpReceiver,f.rtcpTransport,"rtcptransport",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpReceiver,f.getCapabilities,"getCapabilities",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpReceiver,f.getParameters,"getParameters",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpReceiver,f.getStats,"getStats",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpReceiver,f.getCapabilities_v2,"getCapabilities_v2",!1,t.FEATURE_ms_teams_webrtc_1dot0)]),new P(A.RTCRtpSender,"RTCRtpSender",[new j(A.RTCRtpSender,p.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpSender,p.track,"track",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpSender,p.transport,"transport",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpSender,p.rtcpTransport,"rtcpTransport",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpSender,p.dtmf,"dtmf",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpSender,p.getCapabilities,"getCapabilities",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpSender,p.getParameters,"getParameters",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpSender,p.setParameters,"setParameters",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpSender,p.replaceTrack,"replaceTrack",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpSender,p.getStats,"getStats",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpSender,p.setStreams,"setStreams",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCRtpSender,p.getCapabilities_v2,"getCapabilities_v2",!1,t.FEATURE_ms_teams_webrtc_1dot0)]),new P(A.RTCDtlsTransport,"RTCDtlsTransport",[new j(A.RTCDtlsTransport,m.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCDtlsTransport,m.transport,"transport",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCDtlsTransport,m.state,"state",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCDtlsTransport,m.getRemoteCertificates,"getRemoteCertificates",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCDtlsTransport,m.onstatechange,"onstatechange",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCDtlsTransport,m.onerror,"onerror",!0,t.FEATURE_ms_teams_pstn)]),new P(A.RTCIceTransport,"RTCIceTransport",[new j(A.RTCIceTransport,v.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCIceTransport,v.role,"role",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCIceTransport,v.component,"component",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCIceTransport,v.state,"state",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCIceTransport,v.gatheringState,"gatheringState",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCIceTransport,v.localcandidates,"localcandidates",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCIceTransport,v.remotecandidates,"remotecandidates",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCIceTransport,v.onstatechange,"onstatechange",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCIceTransport,v.ongatheringstatechange,"ongatheringstatechange",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCIceTransport,v.onselectedcandidatepairchange,"onselectedcandidatepairchange",!0,t.FEATURE_ms_teams_pstn)]),new P(A.RTCDTMFSender,"RTCDTMFSender",[new j(A.RTCDTMFSender,y.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCDTMFSender,y.insertDTMF,"insertDTMF",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCDTMFSender,y.ontonechange,"ontonechange",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCDTMFSender,y.canInsertDTMF,"canInsertDTMF",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCDTMFSender,y.toneBuffer,"toneBuffer",!0,t.FEATURE_ms_teams_pstn)]),new P(A.RTCDTMFToneChangeEvent,"RTCDTMFToneChangeEvent",[new j(A.RTCDTMFToneChangeEvent,C.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCDTMFToneChangeEvent,C.tone,"tone",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCDTMFToneChangeEvent,C.tone_buffer,"tone_buffer",!0,t.FEATURE_ms_teams_pstn)]),new P(A.RTCIceCandidatePair,"RTCIceCandidatePair",[new j(A.RTCIceCandidatePair,b.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new j(A.RTCIceCandidatePair,b.local,"local",!0,t.FEATURE_ms_teams_pstn),new j(A.RTCIceCandidatePair,b.remote,"remote",!0,t.FEATURE_ms_teams_pstn)]),new P(A.RTCRtpTransceiver,"RTCRtpTransceiver",[new j(A.RTCRtpTransceiver,R.ctor,"ctor",!1,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCRtpTransceiver,R.mid,"mid",!0,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCRtpTransceiver,R.sender,"sender",!0,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCRtpTransceiver,R.receiver,"receiver",!0,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCRtpTransceiver,R.direction,"direction",!0,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCRtpTransceiver,R.currentDirection,"currentDirection",!0,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCRtpTransceiver,R.stop,"stop",!1,t.FEATURE_ms_teams_webrtc_1dot0),new j(A.RTCRtpTransceiver,R.setCodecPreferences,"setCodecPreferences",!1,t.FEATURE_ms_teams_webrtc_1dot0)]),new P(A.ScreenSharingRemote,"ScreenSharingRemote",[new j(A.ScreenSharingRemote,T.ctor,"ctor",!1,t.FEATURE_ms_teams_monitor_sharing),new j(A.ScreenSharingRemote,T.getScreensAsync,"getScreensAsync",!1,t.FEATURE_ms_teams_monitor_sharing),new j(A.ScreenSharingRemote,T.onscreentopologychanged,"onscreentopologychanged",!0,t.FEATURE_ms_teams_monitor_sharing)]),new P(A.ScreenSource,"ScreenSource",[new j(A.ScreenSource,S.ctor,"ctor",!1,t.FEATURE_ms_teams_monitor_sharing),new j(A.ScreenSource,S.srcid,"srcid",!0,t.FEATURE_ms_teams_monitor_sharing),new j(A.ScreenSource,S.deviceid,"deviceid",!0,t.FEATURE_ms_teams_monitor_sharing),new j(A.ScreenSource,S.type,"type",!0,t.FEATURE_ms_teams_monitor_sharing),new j(A.ScreenSource,S.name,"name",!0,t.FEATURE_ms_teams_monitor_sharing),new j(A.ScreenSource,S.imagedata,"imagedata",!0,t.FEATURE_ms_teams_monitor_sharing),new j(A.ScreenSource,S.hwnd,"hwnd",!0,t.FEATURE_ms_teams_monitor_sharing),new j(A.ScreenSource,S.origin,"origin",!0,t.FEATURE_ms_teams_monitor_sharing),new j(A.ScreenSource,S.caption,"caption",!0,t.FEATURE_ms_teams_monitor_sharing),new j(A.ScreenSource,S.pid,"pid",!0,t.FEATURE_ms_teams_monitor_sharing),new j(A.ScreenSource,S.bounds,"bounds",!0,t.FEATURE_ms_teams_gtc)]),new P(A.E911Service,"E911Service",[new j(A.E911Service,w.ctor,"ctor",!1,t.FEATURE_ms_teams_e911),new j(A.E911Service,w.getE911Info,"getE911Info",!1,t.FEATURE_ms_teams_e911),new j(A.E911Service,w.onupdate,"onupdate",!0,t.FEATURE_ms_teams_e911)]),new P(A.GiveTakeControl,"GiveTakeControl",[new j(A.GiveTakeControl,E.ctor,"ctor",!1,t.FEATURE_ms_teams_gtc),new j(A.GiveTakeControl,E.createVirtualCursor,"createVirtualCursor",!1,t.FEATURE_ms_teams_gtc),new j(A.GiveTakeControl,E.destroyCursor,"destroyCursor",!1,t.FEATURE_ms_teams_gtc),new j(A.GiveTakeControl,E.showVirtualCursor,"showVirtualCursor",!1,t.FEATURE_ms_teams_gtc),new j(A.GiveTakeControl,E.setAvatar,"setAvatar",!1,t.FEATURE_ms_teams_gtc),new j(A.GiveTakeControl,E.injectMouseEvent,"injectMouseEvent",!1,t.FEATURE_ms_teams_gtc),new j(A.GiveTakeControl,E.injectKeyboardEvent,"injectKeyboardEvent",!1,t.FEATURE_ms_teams_gtc),new j(A.GiveTakeControl,E.injectClipboardText,"injectClipboardText",!1,t.FEATURE_ms_teams_gtc),new j(A.GiveTakeControl,E.dispose,"dispose",!1,t.FEATURE_ms_teams_gtc)]),new P(A.RTCDataChannel,"RTCDataChannel",[new j(A.RTCDataChannel,k.ctor,"ctor",!1,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.label,"label",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.ordered,"ordered",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.maxPacketLifeTime,"maxPacketLifeTime",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.maxRetransmits,"maxRetransmits",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.protocol,"protocol",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.negotiated,"negotiated",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.id,"id",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.readyState,"readyState",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.bufferedAmount,"bufferedAmount",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.bufferedAmountLowThreshold,"bufferedAmountLowThreshold",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.onopen,"onopen",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.onbufferedamountlow,"onbufferedamountlow",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.onerror,"onerror",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.onclosing,"onclosing",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.onclose,"onclose",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.onmessage,"onmessage",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.close,"close",!1,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.send_text,"send_text",!1,t.FEATURE_ms_teams_data_channel),new j(A.RTCDataChannel,k.send_binary,"send_binary",!1,t.FEATURE_ms_teams_data_channel)]),new P(A.RTCSctpTransport,"RTCSctpTransport",[new j(A.RTCSctpTransport,I.ctor,"ctor",!1,t.FEATURE_ms_teams_data_channel),new j(A.RTCSctpTransport,I.transport,"transport",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCSctpTransport,I.state,"state",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCSctpTransport,I.maxMessageSize,"maxMessageSize",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCSctpTransport,I.maxChannels,"maxChannels",!0,t.FEATURE_ms_teams_data_channel),new j(A.RTCSctpTransport,I.onstatechange,"onstatechange",!0,t.FEATURE_ms_teams_data_channel)])]),A=function(){function e(){}return e.getInterfaceByid=function(e){for(var t=0,n=D.classes;t<n.length;t++){var r=n[t];if(r.id==e)return r}return null},e.getMethodByid=function(e,t){if(null!=(r=this.getInterfaceByid(e)))for(var n=0,r=r.methods;n<r.length;n++){var i=r[n];if(i.mid==t)return i}return null},e.getMethodFeatureByid=function(e,t){if(null!=(r=this.getInterfaceByid(e)))for(var n=0,r=r.methods;n<r.length;n++){var i=r[n];if(i.mid==t)return i.feature}return null},e.composeClassInfoData=function(e){if(void 0==(e=e.hdr))return"*** Invalid packet: Couldn't find hdr object ***";if(void 0==(t=e.proc))return"";e=t.iid;for(var t=t.methodid,n=0,r=D.classes;n<r.length;n++){var i=r[n];if(i.id==e)for(var o=0,a=i.methods;o<a.length;o++){var s=a[o];if(s.mid==t)return i.name+"::"+s.name}}return""},e}();t.WebrpcClassLibInfoUtil=A}),define("wsjsonutil",["require","exports","webrpcclassinfo"],function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e[e.req=0]="req",e[e.reply=1]="reply",e[e.event_req=2]="event_req",e[e.event_reply=3]="event_reply"}(r=t.ws_msg_type_t||(t.ws_msg_type_t={})),e=function(){function e(){}return e.createMessageByid=function(e,t,r,i,o,a){for(var s=[],c=6;c<arguments.length;c++)s[c-6]=arguments[c];return(c=n.WebrpcClassLibInfoUtil.getMethodByid(i,o))&&c.isprop||(e=!1),this.createMessage.apply(this,[r,e,t,i,o,a].concat(s))},e.createMessage=function(e,t,n,r,i,o){for(var a=[],s=6;s<arguments.length;s++)a[s-6]=arguments[s];return{v:"webrtc",hdr:{version:this._version,msg_type:this.getMsgType(e),modifier:t,destroy:n,proc:{iid:r,methodid:i}},objref:{oid:o},params:a.slice()}},e.getMsgType=function(e){var t="";switch(e){default:t="req";break;case r.reply:t="reply";break;case r.event_req:t="event-req";break;case r.event_reply:t="event-reply"}return t},e._version=1,e}(),t.WsJsonUtil=e}),define("garbagecollector",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.parent_=this.object_=null,this.children_=[],this.object_=e}return e.prototype.addChild=function(e){e.parent_!=this&&(e.parent_=this,this.children_.push(e))},e.prototype.removeChild=function(e){var t=this.children_.indexOf(e);this.children_.splice(t,1),e.parent_=null},e}(),r=function(){function e(){this.root_=new n(null)}return e.prototype.trackObject=function(e,t){if(void 0===t&&(t=null),null===this.findNode(e,this.root_)){var r=this.findNode(t,this.root_),i=new n(e);r?r.addChild(i):this.root_.addChild(i)}},e.prototype.releaseObject=function(e){return null!==(e=this.findNode(e,this.root_))&&e!==this.root_&&(this.destroyNodeObjectRecurse(e),e.parent_.removeChild(e),!0)},e.prototype.destroyNodeObjectRecurse=function(e){for(var t=0,n=e.children_;t<n.length;t++)this.destroyNodeObjectRecurse(n[t]);e.object_.destroy()},e.prototype.setParent=function(e,t){var n=this.findNode(e,this.root_);if(null===n)return!1;var r=this.findNode(t,this.root_);return null!==r&&(n.parent_===r||(n.parent_.removeChild(n),r.addChild(n),!0))},e.prototype.reset=function(){this.root_.children_=[]},e.prototype.findNode=function(e,t){if(t.object_===e)return t;for(var n=null,r=0,i=t.children_;r<i.length&&null===(n=this.findNode(e,i[r]));r++);return n},e}();t.GC=r,t.gc=new r}),define("proxyobject","require exports hdxms logger wsjsonutil garbagecollector webrpcclassinfo".split(" "),function(e,t,n,r,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t,n){this.resolve=e,this.reject=t,this.name=n}return e.prototype.post=function(e){1==e?(r.logger.log('deferred_action.post(): resolving "'+this.name+'"'),this.resolve()):(r.logger.log('deferred_action.post(): rejecting "'+this.name+'"'),this.reject())},e}();t.deferred_action=s;var c=function(e,t){this.id=e,this.is_null=t};t.rpc_callback=c;var d=function(){function e(e,t,n){this.success=new c(e<<16,t),this.fail=new c(e<<16|1,t),this.id=e,this.oneShot=n}return e.prototype.resolve=function(e){r.logger.trace("callback.resolve() called. [id="+this.id+"]"),null!=this.handler&&this.handler(e)},e.prototype.reject=function(e){null!=this.err_handler&&this.err_handler(e)},e.prototype.then=function(e){this.handler=e},e.prototype.prom=function(){var e=this;return new Promise(function(t,n){e.handler=t,e.err_handler=n})},e}();t.callback=d;var l;!function(e){e[e.NotConfigured=0]="NotConfigured",e[e.Configured=1]="Configured",e[e.Error=2]="Error",e[e.Destroyed=3]="Destroyed"}(l||(l={}));var u;!function(e){e[e.Local=0]="Local",e[e.Remote=1]="Remote",e[e.Pseudo=2]="Pseudo"}(u=t.ProxyMode||(t.ProxyMode={})),e=function(){function e(t,s,c,d,_){void 0===_&&(_=null);for(var g=[],h=5;h<arguments.length;h++)g[h-5]=arguments[h];var f=this;this.hdxms=n.getRedirector(),this.iid=s,this.oid=c,this.mode=d,this.proxystate=l.NotConfigured,this.deferredActions=[],this.cbs=new Map,d===u.Local?(h=!1,this.iid===a.class_id_t.EngineControl&&(h=!0),this.hdxms.startRedirection(h,this.user_friendly_id()).then(function(){f.oid=e.nextId++,r.logger.log(f.user_friendly_id()+" assigned local oid:"+f.oid);var t=a.WebrpcClassLibInfoUtil.getMethodFeatureByid(s,0);return f.hdxms.WSSendObjectWrapper(t,s,0,i.WsJsonUtil.createMessageByid.apply(i.WsJsonUtil,[!1,!1,i.ws_msg_type_t.req,s,0,f.oid].concat(g)))}).then(function(e){r.logger.trace("ProxyObject: setting state to configured. (iid: "+f.iid+" oid: "+f.oid+")");var n=f.oid;f.proxystate=l.Configured,f.oid=f.param0(e),r.logger.log(f.user_friendly_id()+" assigned remote oid for local oid:"+n),f.onConnected(),_&&_(),o.gc.trackObject(f,t)}).catch(function(){f.proxystate=l.Error,f.onConnected()})):d===u.Remote&&(this.proxystate=l.Configured,o.gc.trackObject(this,t))}return e.prototype.bind=function(e,t){if(r.logger.trace("ProxyObject: binding object. (iid: "+this.iid+" oid: "+t+" mode: "+this.mode+")"),this.mode===u.Pseudo){this.proxystate=l.Configured;var n=this.oid;this.oid=t,r.logger.log(this.user_friendly_id()+" assigned remote oid for local oid:"+n),this.onConnected(),o.gc.trackObject(this,e),this.mode=u.Remote}else this.mode===u.Remote?r.logger.log("ProxyObject: binding already complete."):r.logger.log("ProxyObject: binding failure. incorrect mode!")},e.prototype.reconstructor=function(e,t,n){for(var s=this,c=[],d=3;d<arguments.length;d++)c[d-3]=arguments[d];this.proxystate=l.NotConfigured,this.deferredActions=[],d=a.WebrpcClassLibInfoUtil.getMethodFeatureByid(t,0),this.hdxms.WSSendObjectWrapper(d,t,0,i.WsJsonUtil.createMessageByid.apply(i.WsJsonUtil,[!1,!1,i.ws_msg_type_t.req,t,0,this.oid].concat(c))).then(function(t){r.logger.trace("ProxyObject: setting state to configured. (iid: "+s.iid+" oid: "+s.oid+")");var n=s.oid;s.proxystate=l.Configured,s.oid=s.param0(t),r.logger.log(s.user_friendly_id()+" assigned remote oid for local oid:"+n),s.onConnected(),o.gc.trackObject(s,e)}).catch(function(){s.proxystate=l.Error,s.onConnected()})},e.prototype.setParent=function(e){o.gc.setParent(this,e)},e.prototype.release=function(){r.logger.log(this.user_friendly_id()+".release() called."),o.gc.releaseObject(this)},e.prototype.destroy=function(){r.logger.log(this.user_friendly_id()+".destroy() called."),this.proxystate=l.Destroyed;var e=a.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,0);this.hdxms.WSSendObjectWrapper(e,this.iid,0,i.WsJsonUtil.createMessageByid(!1,!0,i.ws_msg_type_t.req,this.iid,0,this.oid))},e.prototype.isdestroyed=function(){return this.proxystate==l.Destroyed},e.prototype.onConnected=function(){for(;this.deferredActions&&0<this.deferredActions.length;)this.deferredActions.shift().post(this.proxystate==l.Configured)},e.prototype.isPseudo=function(){return this.mode==u.Pseudo},e.prototype.checkState=function(e,t){var n=this;0>=e?(r.logger.log("ProxyObject.checkState() timeout waiting for connection response! failed. (iid: "+n.iid+" oid: "+n.oid+")"),n.onConnected()):setTimeout(function(){n.proxystate==l.Configured?n.onConnected():n.proxystate==l.Error?n.onConnected():n.proxystate==l.Destroyed?n.onConnected():(r.logger.log('ProxyObject.checkState(): count= "'+e+'". (iid: '+n.iid+" oid: "+n.oid+")"),n.checkState(--e,t))},t)},e.prototype.waitUntilConnected=function(e){var t=this;return new Promise(function(n,i){t?(r.logger.trace("ProxyObject.waitUntilConnected(): readyState="+t.proxystate+". (iid: "+t.iid+" oid: "+t.oid+")"),t.proxystate==l.Destroyed?(t.onConnected(),r.logger.trace("rejecting already destroyed Object:"+t.user_friendly_id()),i("Object already destroyed :"+t.user_friendly_id())):t.proxystate==l.Configured?(t.onConnected(),n()):t.proxystate==l.Error?(r.logger.trace("ProxyObject.waitUntilConnected(): readyState="+t.proxystate+". (iid: "+t.iid+" oid: "+t.oid+")"),t.onConnected(),i()):(r.logger.log('ProxyObject.waitUntilConnected(): deferring action "'+e+'". (iid: '+t.iid+" oid: "+t.oid+")"),t.deferredActions.push(new s(n,i,e)),t.checkState(15,1e3))):i("Invalid Object")})},e.prototype.remoteInvoke=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return this.proxystate==l.Destroyed?(r.logger.trace("rejecting already destroyed Object:"+this.user_friendly_id()),Promise.reject("Cannot invoke destroyed object :"+this.user_friendly_id())):this.proxystate==l.Error?(r.logger.trace("rejecting already error state Object:"+this.user_friendly_id()),Promise.reject("Cannot invoke object in Error state:"+this.user_friendly_id())):(o=a.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,t),this.hdxms.WSSendObjectWrapper(o,this.iid,t,i.WsJsonUtil.createMessageByid.apply(i.WsJsonUtil,[e,!1,i.ws_msg_type_t.req,this.iid,t,this.oid].concat(n))))},e.prototype.logRemoteInvokeError=function(e,t){var n=e;return n?r.logger.log(this.user_friendly_id()+t+" with error: "+n.message):this.param0?(r.logger.log(this.user_friendly_id()+t+" with error: "+this.param0(e)),n=new DOMException(t+" with error: "+this.param0(e),this.user_friendly_id())):(r.logger.log(this.user_friendly_id()+t),n=new DOMException(t,this.user_friendly_id())),n},e.prototype.registerCallbacks=function(t,n,r){this.unregisterCallbacks(r);var i=e.nextcbid++,o=new d(i,n,t);return n||(t||this.cbs.set(r,i),this.hdxms.registerHandler(this.iid,this.oid,o)),o},e.prototype.unregisterCallbacks=function(e){this.cbs.has(e)?(this.hdxms.unregisterHandler(this.iid,this.oid,this.cbs.get(e)),this.cbs.delete(e)):r.logger.trace(this.cbs)},e.prototype.object_id=function(){return this.oid},e.prototype.param0=function(e){var t={};return e&&e.params&&(t=e.params[0]),t},e.prototype.isNullCallback=function(e){return void 0==e||null==e},e.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.oid+"]"},e.prototype.isRedirected=function(){return this.hdxms.isRedirected()},e.prototype.isValid=function(){return!(this.proxystate===l.Error||this.proxystate===l.Destroyed)},e.prototype.registerStateChangeNotification=function(e){this.hdxms.registerStateChangeNotification(e)},e.prototype.unregisterStateChangeNotification=function(e){this.hdxms.unregisterStateChangeNotification(e)},e.nextId=0,e.nextcbid=0,e}(),t.ProxyObject=e}),define("telemetry",["require","exports","hdxms","logger"],function(e,t,n,r){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.unknown=0]="unknown",e[e.active=1]="active",e[e.idle=2]="idle"}(t.tel_CallState||(t.tel_CallState={})),function(e){e[e.unknown=0]="unknown",e[e.incoming=1]="incoming",e[e.outgoing=2]="outgoing"}(t.tel_CallDirection||(t.tel_CallDirection={})),function(e){e[e.unknown=0]="unknown",e[e.audio=1]="audio",e[e.video=2]="video",e[e.multi=3]="multi",e[e.dshare=4]="dshare"}(t.tel_CallType||(t.tel_CallType={}));var i;!function(e){e[e.Unknown=0]="Unknown",e[e.Cap=1]="Cap",e[e.Init=2]="Init",e[e.Data=3]="Data"}(i=t.tel_cmd||(t.tel_cmd={})),t.tel_key_ConferenceCallDuration="ConferenceCallDuration",t.tel_key_AudioCallDuration="AudioCallDuration",t.tel_key_VideoCallDuration="VideoCallDuration",t.tel_key_ScreensharingCallDuration="ScreensharingCallDuration",t.tel_key_CallEstIncoming="CallEstIncoming",t.tel_key_CallEstOutgoing="CallEstOutgoing",t.tel_key_AudioDeviceUsed="AudioDeviceUsed",t.tel_key_VideoDeviceUsed="VideoDeviceUsed",t.tel_key_SpeakerDeviceUsed="SpeakerDeviceUsed",t.tel_key_PerfCallDirection="PerfCallDirection",t.tel_key_PerfCallState="PerfCallState",t.tel_key_PerfCallType="PerfCallType",t.tel_key_VerWebrpc="VerWebrpc",t.tel_key_VerWebrtcCodecs="VerWebrtcCodecs",t.tel_key_VerReceiver="VerReceiver",t.tel_key_VerVda="VerVda",t.tel_key_VerEndpoint="VerEndpoint",t.tel_key_VerTypeScript="VerTypeScript",t.tel_key_OSFamily="OSFamily",t.tel_key_OSVersion="OSVersion",t.tel_key_OSArchitecture="OSArchitecture",t.tel_key_OSDistro="OSDistro",t.tel_key_OSEdition="OSEdition";var o=function(){function e(e,t,n,r){this.cmd=e,this.key=t,this.value=n,this.flags=r}return e.prototype.SendTelemetryData=function(e){e.SendTelemetryData(this.cmd,this.key,this.value,this.flags)},e}();e=function(){function e(){this.id=0,this.deferredData=[]}return e.prototype.reset=function(){this.id=0,this.deferredData=[]},e.prototype.onInitialized=function(e){for(this.id=e;this.deferredData&&0<this.deferredData.length;)this.deferredData.shift().SendTelemetryData(this)},e.prototype.SendTelemetryInit=function(){0<this.id&&this.reset();try{n.getRedirector().WSSendObject({v:"telemetry",hdr:{command:i.Init,id:0},init:{domain:"HDXMM Teams",subdomain:"Teams",feature:"msteams",version:"1.1.1.1"}})}catch(e){r.logger.log(e)}},e.prototype.SendTelemetryData=function(e,t,a,s){if(e!=i.Data)r.logger.log("invalid telemetry command!");else if(0==this.id)this.deferredData.push(new o(e,t,a,s));else try{n.getRedirector().WSSendObject({v:"telemetry",hdr:{command:e,id:this.id},data:{key:t,value:a,flags:s}})}catch(e){r.logger.log(e)}},e}(),t.Telemetry=e}),define("enginecontrol","require exports webrpcclassinfo hdxms proxyobject logger".split(" "),function(e,t,n,r,i,o){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Webrpc=0]="Webrpc",e[e.WebrtcCodecs=1]="WebrtcCodecs",e[e.Receiver=2]="Receiver",e[e.Vda=3]="Vda",e[e.Endpoint=4]="Endpoint",e[e.TypeScript=5]="TypeScript",e[e.Max=6]="Max"}(t.VersionType||(t.VersionType={})),e=function(e){function t(){return e.call(this,null,n.class_id_t.EngineControl,0,i.ProxyMode.Local)||this}return __extends(t,e),t.prototype.bind=function(){o.logger.log(this.user_friendly_id()+".bind() called."),this.reconstructor(null,n.class_id_t.EngineControl,0)},t.prototype.syncBarrier=function(){var e=this;return o.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,i){e.waitUntilConnected("EngineControl.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_EngineControl_t.version,{major:0,minor:0,revision:0,build:0}),e.remoteInvoke(!1,n.method_id_EngineControl_t.feature_flags,[])])}).then(function(t){o.logger.log(e.user_friendly_id()+"received webrpc version and supported feature list."),t=t.map(function(t){return e.param0(t)}),e.version_=t[0],e.features_=t[1],r.getRedirector().setFeatures(e.features_),t=[];for(var i=0,a=e.features_;i<a.length;i++){var s=a[i];"ms_teams_desktop_sharing"===s.name&&s.value?t.push(e.remoteInvoke(!1,n.method_id_EngineControl_t.version_info,[])):"ms_teams_osinfo"===s.name&&s.value?t.push(e.remoteInvoke(!1,n.method_id_EngineControl_t.osinfo,{family:"",version:"",architecture:"",distro:"",edition:""})):"ms_teams_endpoint_id"===s.name&&s.value&&t.push(e.remoteInvoke(!1,n.method_id_EngineControl_t.endpoint_id,{machine_id:"",user_id:""}))}if(0<t.length)return Promise.all(t)}).then(function(r){if(void 0===r)o.logger.log(e.user_friendly_id()+"release-1905 client.");else{o.logger.log(e.user_friendly_id()+"release-1906 or later client: received detailed client version list.");for(var i=0;i<r.length;i++){var a=r[i];a.hdr.proc.iid==n.class_id_t.EngineControl&&a.hdr.proc.methodid==n.method_id_EngineControl_t.version_info?e.versions_=e.param0(a):a.hdr.proc.iid==n.class_id_t.EngineControl&&a.hdr.proc.methodid==n.method_id_EngineControl_t.osinfo?e.osinfo_=e.param0(a):a.hdr.proc.iid==n.class_id_t.EngineControl&&a.hdr.proc.methodid==n.method_id_EngineControl_t.endpoint_id&&(e.endpointid_=e.param0(a))}}t(e)}).catch(function(t){t=e.logRemoteInvokeError(t,"failure to retrieve version/feature related client info."),i(t)})})},t}(i.ProxyObject),t.EngineControl=e}),define("remotesession","require exports hdxms webrpcclassinfo enginecontrol logger webrpcclassinfo telemetry".split(" "),function(e,t,n,r,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var c;!function(e){e[e.Unknown=0]="Unknown",e[e.Windows=1]="Windows",e[e.Linux=2]="Linux"}(c=t.RemoteType||(t.RemoteType={}));var d=function(){};t.SessionInfo=d,e=function(){function e(){var e=this;this.isremote_=!1,this.isremote_=!0,this.type_=c.Windows,this.address_="0.0.0.0",this.sessioninfo_=null,n.getRedirector().setRemoteSessionInfoCb(function(){return e.remoteSessionInfo()}),this.enginecontrol_=new i.EngineControl}return e.prototype.release=function(){n.getRedirector().setRemoteSessionInfoCb(null)},e.prototype.user_friendly_id=function(){return"[RemoteSession]"},e.prototype.getFeatureFlags=function(){var e={};return null!==this.enginecontrol_&&null!==this.enginecontrol_.features_&&void 0!==this.enginecontrol_.features_&&this.enginecontrol_.features_.forEach(function(t){e[t.name]=t.value}),e},e.prototype.isFeatureSupported=function(e){if("video"===e)return!0;if(!(e in a.featureNameMap))return!1;e=a.featureNameMap[e];for(var t=this.getFeatureFlags(),n=0;n<e.length;n++)if(!(e[n]in t)||!0!==t[e[n]])return!1;return!0},e.isFeaturePstnSupported=function(){return e.pstn_},e.isFeatureDtmfSupported=function(){return e.dtmfswitch_},e.isFeaturAppshareSupported=function(){return e.appshare_},e.isFeatureGtcSupported=function(){return e.gtcswitch_},e.isFeatureWebrtc1dot0Supported=function(){return e.webrtc1dot0_},e.isFeatureE911Supported=function(){return e.e911switch_},e.isFeatureDataChannelSupported=function(){return e.datachannel_},e.isFeatureVdNoBufferLimitSupported=function(){return e.vdnobuflimit_},e.prototype.getSessionInfo=function(){return o.logger.log(this.user_friendly_id()+".getSessionInfo() called."),null!=this.sessioninfo_?Promise.resolve(this.sessioninfo_):Promise.reject()},e.prototype.remoteSessionInfo=function(){var t=this,a=this;return o.logger.log(a.user_friendly_id()+".remoteSessionInfo() called."),new Promise(function(c,l){a.enginecontrol_.syncBarrier().then(function(n){if(o.logger.log(a.user_friendly_id()+"enginecontrol info received!"),a.sessioninfo_=new d,a.sessioninfo_.type_script=r.HDXMS_VERSION,a.sessioninfo_.webrpc=n.version_.major.toString()+"."+n.version_.minor.toString()+"."+n.version_.revision.toString()+"."+n.version_.build.toString(),void 0!=n.versions_&&null!=n.versions_){a.SendTelemetryData(s.tel_key_VerTypeScript,r.HDXMS_VERSION,0);for(var l=0,u=0,_=n.versions_;u<_.length;u++){var g=(g=_[u]).major.toString()+"."+g.minor.toString()+"."+g.revision.toString()+"."+g.build.toString();switch(l){case i.VersionType.Webrpc:a.sessioninfo_.webrpc=g,a.SendTelemetryData(s.tel_key_VerWebrpc,g,0);break;case i.VersionType.WebrtcCodecs:a.sessioninfo_.webrtc_codecs=g,a.SendTelemetryData(s.tel_key_VerWebrtcCodecs,g,0);break;case i.VersionType.Receiver:a.sessioninfo_.receiver=g,a.SendTelemetryData(s.tel_key_VerReceiver,g,0);break;case i.VersionType.Vda:a.sessioninfo_.vda=g,a.SendTelemetryData(s.tel_key_VerVda,g,0);break;case i.VersionType.Endpoint:a.sessioninfo_.endpoint=g,a.SendTelemetryData(s.tel_key_VerEndpoint,g,0);break;default:o.logger.log(a.user_friendly_id()+"Unknown version type!")}l++}}void 0!=n.osinfo_&&null!=n.osinfo_&&(a.sessioninfo_.osinfo=n.osinfo_,n.osinfo_.family.includes("Darwin")&&n.osinfo_.edition.includes("Mac")?a.sessioninfo_.clientPlatform="Mac":a.sessioninfo_.clientPlatform=n.osinfo_.family,a.SendTelemetryData(s.tel_key_OSFamily,n.osinfo_.family,0),a.SendTelemetryData(s.tel_key_OSVersion,n.osinfo_.version,0),a.SendTelemetryData(s.tel_key_OSArchitecture,n.osinfo_.architecture,0),a.SendTelemetryData(s.tel_key_OSDistro,n.osinfo_.distro,0),a.SendTelemetryData(s.tel_key_OSEdition,n.osinfo_.edition,0)),void 0!=n.endpointid_&&null!=n.endpointid_&&(a.sessioninfo_.endpointId=n.endpointid_.machine_id),e.pstn_=t.isFeatureSupported(r.FEATURE_public_pstn),e.dtmfswitch_=t.isFeatureSupported(r.FEATURE_public_dtmf),e.appshare_=t.isFeatureSupported(r.FEATURE_public_app_sharing),e.e911switch_=t.isFeatureSupported(r.FEATURE_public_e911),e.gtcswitch_=t.isFeatureSupported(r.FEATURE_public_gtc),e.webrtc1dot0_=t.isFeatureSupported(r.FEATURE_public_webrtc1dot0),e.datachannel_=t.isFeatureSupported(r.FEATURE_public_data_channel),e.vdnobuflimit_=t.isFeatureSupported(r.FEATURE_public_vdnobuflimit),c(a.sessioninfo_),a.enginecontrol_.release()}).catch(function(){n.getRedirector().isPingActive()?a.retrySessionInfo():(l(),a.enginecontrol_.release(),a.enginecontrol_=null)})})},e.prototype.retrySessionInfo=function(){var e=this;setTimeout(function(){o.logger.log("checking if we are connected..."),e.enginecontrol_.bind(),n.getRedirector().handleRemoteSessionInfo()},15e3)},e.prototype.SendTelemetryData=function(e,t,r){n.getRedirector().telemetry.SendTelemetryData(s.tel_cmd.Data,e,t,r)},e.pstn_=!1,e.dtmfswitch_=!1,e.appshare_=!1,e.gtcswitch_=!1,e.e911switch_=!1,e.webrtc1dot0_=!1,e.datachannel_=!1,e.vdnobuflimit_=!1,e}(),t.RemoteSession=e}),define("screensharing","require exports proxyobject webrpcclassinfo logger hdxms screensharingutil remotesession".split(" "),function(e,t,n,r,i,o,a,s){function c(e,t){return void 0!==e.find(function(e){return e===t})}function d(e,t,n){t/=140;var r=n/90,i=(n=document.createElement("canvas")).getContext("2d");return n.width=e.width*t,n.height=e.height*r,i.putImageData(e,0,0),1==t&&1==r||(i.scale(t,r),i.drawImage(n,0,0)),e=document.createElement("img"),e.src=n.toDataURL(),e}Object.defineProperty(t,"__esModule",{value:!0});var l;!function(e){e[e.Legacy=0]="Legacy",e[e.MonitorsAndApps=10]="MonitorsAndApps"}(l||(l={})),e=function(e,t,n){this.data=e,this.height=t,this.width=n},t.ImageDataRemote=e,e=function(){function e(){this.local_=this.remote_=null}return e.prototype.user_friendly_id=function(){return this.constructor.name+"[]"},Object.defineProperty(e.prototype,"onscreentopologychanged",{set:function(e){this.remote_||(this.remote_=new u),this.remote_.onscreentopologychanged=e,this.local_||(this.local_=new _),this.local_.onscreentopologychanged=e},enumerable:!0,configurable:!0}),e.prototype.getWindowsAsync=function(){var e=this;return i.logger.log(this.user_friendly_id()+".getWindowsAsync() called."),null==this.local_&&(this.local_=new _),new Promise(function(t,n){var r=[];e.local_.getWindowsAsync().then(function(n){n&&(r=n),i.logger.log(e.user_friendly_id()+".getWindowsAsync() returning sources"),t(r)}).catch(function(){i.logger.log("ScreenSharing.getWindowsAsync(): rejected"),t(r)})})},e.prototype.getScreensAsync=function(){var e=this;return i.logger.log(this.user_friendly_id()+".getScreensAsync() called."),null==this.remote_&&(this.remote_=new u),new Promise(function(t,n){var r=[];e.remote_.getScreensAsync().then(function(e){e&&(r=e),t(r)}).catch(function(){i.logger.log("ScreenSharing.getScreensAsync(): rejected"),t(r)})})},e.prototype.setScreenSharePanelId=function(e,t){var n=this;return i.logger.log(this.user_friendly_id()+".setScreenSharePanelId() called. id="+e+" appshare="+t),new Promise(function(r,o){var a=n.remote_.getSourceIndex(e);0<=a?n.remote_.setActive(a).then(function(e){r(e)}).catch(function(){i.logger.log("ScreenSharing.setScreenSharePanelId(): rejected"),o()}):t&&0<=(a=n.local_.getSourceIndex(e))?n.local_.setActive(!0,a).then(function(e){r(e)}).catch(function(){i.logger.log("ScreenSharing.setScreenSharePanelId(): rejected"),o()}):(i.logger.log("ScreenSharing.setScreenSharePanelId(): legacy screen sharing"),r(""))})},e.prototype.stopAppshare=function(){i.logger.log(this.user_friendly_id()+".stopAppshare() called."),this.local_.setActive(!1).then(function(e){i.logger.log("ScreenSharing.stopAppshare(): success, deviceid=",e)}).catch(function(){i.logger.log("ScreenSharing.stopAppshare(): failure")})},e}(),t.ScreenSharing=e;var u=function(e){function t(){var t=e.call(this,null,r.class_id_t.ScreenSharingRemote,0,n.ProxyMode.Local)||this;return i.logger.log(t.user_friendly_id()+".constructor"),t.sources_=[],t}return __extends(t,e),t.prototype.getSourceIndex=function(e){i.logger.log(this.user_friendly_id()+".getSourceIndex() called. uniqueid="+e);for(var t=-1,n=0;n<this.sources_.length;n++)if(this.sources_[n].getId()==e){t=n;break}return t},Object.defineProperty(t.prototype,"onscreentopologychanged",{get:function(){return this.onscreentopologychanged_},set:function(e){var t=this;this.onscreentopologychanged_=e,this.waitUntilConnected(this.user_friendly_id()+".onscreentopologychanged").then(function(){var e=t.registerCallbacks(!1,t.isNullCallback(t.onscreentopologychanged_),r.method_id_VDISharingRemote_t.onscreentopologychanged);return e.then(function(){i.logger.log(t.user_friendly_id()+"onscreentopologychanged event received!!!"),t.onscreentopologychanged_&&t.onscreentopologychanged_()}),t.remoteInvoke(!0,r.method_id_VDISharingRemote_t.onscreentopologychanged,e.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onscreentopologychanged() failed!")})},enumerable:!0,configurable:!0}),t.prototype.getScreensAsync=function(){var e=this;i.logger.log(this.user_friendly_id()+".getScreensAsync() called.");var t=this.sources_;this.sources_=[];var a=o.getRedirector().vdabufferNoLimit()&&s.RemoteSession.isFeatureVdNoBufferLimitSupported();return new Promise(function(o,s){e.waitUntilConnected(e.user_friendly_id()+".getScreensAsync").then(function(){return e.remoteInvoke(!1,r.method_id_VDISharingRemote_t.getScreensAsync,a,[])}).then(function(r){var a=[];r.params[0].forEach(function(r){var o=t.find(function(e){return e.object_id()===r.oid});void 0===o&&(i.logger.log(e.user_friendly_id()+" create a ScreenSource with oid:"+r.oid),o=new h(e,r.oid,n.ProxyMode.Remote)),a.push(o.syncBarrier())}),Promise.all(a.map(function(e){return e.then(function(e){return{value:e,status:"fulfilled"}},function(e){return{value:e,status:"rejected"}})})).then(function(n){var r=n.filter(function(e){return"fulfilled"===e.status}).map(function(e){return e.value});e.sources_=r,t.filter(function(e){return!c(r,e)}).forEach(function(e){return e.release()}),o(r)}).catch(function(n){n=e.logRemoteInvokeError(n,".getScreensAsync() failed!"),t.forEach(function(e){e.release()}),s(n)})}).catch(function(n){n=e.logRemoteInvokeError(n,".getScreensAsync() failed!"),t.forEach(function(e){e.release()}),s(n)})})},t.prototype.setActive=function(e){var t=this;return i.logger.log(this.user_friendly_id()+".setActive() called. index="+e),new Promise(function(n,r){0<=e&&e<t.sources_.length?n(t.sources_[e].getDeviceId()):r()})},t}(n.ProxyObject);t.ScreenSharingRemote=u;var _=function(){function e(){i.logger.log(this.user_friendly_id()+".constructor"),this.sources_=[],this.lastactive_=-1}return e.prototype.user_friendly_id=function(){return this.constructor.name+"[]"},Object.defineProperty(e.prototype,"onscreentopologychanged",{set:function(e){o.getRedirector().screenshare.setTopologyChangeCB(e)},enumerable:!0,configurable:!0}),e.prototype.getSourceIndex=function(e){i.logger.log(this.user_friendly_id()+".getSourceIndex() called. uniqueid="+e);for(var t=-1,n=0;n<this.sources_.length;n++)if(this.sources_[n].getId()==e){t=n;break}return t},e.prototype.getWindowsAsync=function(){var e=this;i.logger.log(this.user_friendly_id()+".getWindowsAsync() called.");var t=this.sources_;return this.sources_=[],new Promise(function(n,r){e.getWindowsAsyncInternal().then(function(r){if(r=r.map(function(e){var n=t.find(function(t){return t.equivalent(e)});return void 0!==n?n:e}),0<=e.lastactive_&&e.lastactive_<t.length){var i=t[e.lastactive_];-1==r.findIndex(function(e){return e==i})&&r.splice(e.lastactive_,0,i)}e.sources_=r,n(e.sources_)}).catch(function(){i.logger.log(e.user_friendly_id()+".getWindowsAsync(): rejected"),r()})})},e.prototype.getWindowsAsyncInternal=function(){var e=new a.getSourcesReqData(2);return new Promise(function(t,n){o.getRedirector().screenshare.getSources(t,n,e).then(function(e){t(e)}).catch(function(){n()})})},e.prototype.validSrcIndex=function(e){return 0<=e&&e<this.sources_.length},e.prototype.setActive=function(e,t){var n=this;return i.logger.log(this.user_friendly_id()+".setActive() called. index="+t),new Promise(function(r,s){if(e||(t=n.lastactive_),n.validSrcIndex(t)){var c=n.sources_[t],d=void 0;if(e){if(t!=n.lastactive_&&n.validSrcIndex(n.lastactive_)){var l=n.sources_[n.lastactive_],d=new a.setActiveReqData(l.srcid,l.hwnd,l.origin,l.pid,!0,!0,!1);o.getRedirector().screenshare.setActive(r,s,d).then(function(e){n.sources_[n.lastactive_].deviceid=e.bufferid}).catch(function(){i.logger.log(n.user_friendly_id()+"failed to deactivate: srcid="+l.srcid)})}n.lastactive_=t,d=new a.setActiveReqData(c.srcid,c.hwnd,c.origin,c.pid,!0,!0,!0)}else n.lastactive_=-1,d=new a.setActiveReqData(c.srcid,c.hwnd,c.origin,c.pid,!0,!0,!1);o.getRedirector().screenshare.setActive(r,s,d).then(function(o){i.logger.log(n.user_friendly_id()+"setActive success: srcid="+o.srcid+" deviceid="+o.bufferid),n.sources_[t].deviceid=o.bufferid,r(e?"RemoteApplication-"+o.bufferid:o.bufferid)}).catch(function(){i.logger.log(n.user_friendly_id()+"setActive failed: srcid="+c.srcid),s()})}else s()})},e}();t.ScreenSharingVda=_;var g=function(){function e(){}return e.Width=140,e.Height=90,e}();e=function(){function e(e,t,n,r,i,o,a,s,c,d){this.uniqueid_=h.nextId_++,this.srcid_=e,this.deviceid_=t,this.type_=n,this.imagedata_=r,this.icon_=i,this.name_=o,this.hwnd_=a,this.origin_=s,this.caption_=c,this.pid_=d}return e.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.uniqueid_+"]"},Object.defineProperty(e.prototype,"srcid",{get:function(){return this.srcid_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hwnd",{get:function(){return this.hwnd_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"origin",{get:function(){return this.origin_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pid",{get:function(){return this.pid_},enumerable:!0,configurable:!0}),e.prototype.getId=function(){return this.uniqueid_},e.prototype.getDeviceId=function(){return this.deviceid_},Object.defineProperty(e.prototype,"deviceid",{set:function(e){this.deviceid_=e},enumerable:!0,configurable:!0}),e.prototype.getType=function(){return this.type_},e.prototype.getPreview=function(e,t,n){return i.logger.log(this.user_friendly_id()+".getPreview() called, width:"+e+" height:"+t+" asImage:"+n),Promise.reject(null)},e.prototype.getPreviewAsync=function(e,t,n){return i.logger.log(this.user_friendly_id()+".getPreviewAsync() called, width:"+e+" height:"+t),!0===n?(e=d(this.imagedata_,g.Width,g.Height),Promise.resolve({data:e.src.replace(/^data:image\/(png|jpg);base64,/,"")})):Promise.resolve(this.imagedata_)},e.prototype.getDescription=function(){return this.name_},e.prototype.getIcon=function(e,t,n){return!0===n?(e=d(this.icon_,g.Width,g.Height),Promise.resolve({data:e.src.replace(/^data:image\/(png|jpg);base64,/,"")})):Promise.resolve(this.icon_)},e.prototype.getBounds=function(){return{x:0,y:0,width:0,height:0}},e.prototype.equivalent=function(e){return this.pid_===e.pid_&&this.hwnd_===e.hwnd_},e}(),t.ScreenSourceVda=e;var h=function(e){function t(n,o,s){return n=e.call(this,n,r.class_id_t.ScreenSource,o,s)||this,n.screenshare_=new a.ScreenShareUtil,n.uniqueid_=t.nextId_++,i.logger.log(n.user_friendly_id()+".constructor"),n}return __extends(t,e),t.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.uniqueid_+"]"},t.prototype.toJSImageData=function(e){var t=atob(e.data.toString()),t=this.screenshare_.str2ab(t),t=new Uint8ClampedArray(t,0,t.byteLength);this.imagedata_=new ImageData(t,e.width,e.height)},t.prototype.syncBarrier=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,o=this;return __generator(this,function(a){switch(a.label){case 0:return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),[4,this.waitUntilConnected("ScreenSource.syncBarrier")];case 1:return a.sent(),[4,Promise.all([this.remoteInvoke(!1,r.method_id_ScreenSource_t.srcid,0),this.remoteInvoke(!1,r.method_id_ScreenSource_t.deviceid,""),this.remoteInvoke(!1,r.method_id_ScreenSource_t.type,0),this.remoteInvoke(!1,r.method_id_ScreenSource_t.name,""),this.remoteInvoke(!1,r.method_id_ScreenSource_t.imagedata),this.remoteInvoke(!1,r.method_id_ScreenSource_t.hwnd,""),this.remoteInvoke(!1,r.method_id_ScreenSource_t.origin,0),this.remoteInvoke(!1,r.method_id_ScreenSource_t.caption,""),this.remoteInvoke(!1,r.method_id_ScreenSource_t.pid,0)])];case 2:return t=a.sent(),e=t.map(function(e){return o.param0(e)}),this.srcid_=e[0],this.deviceid_=e[1],this.type_=e[2],this.name_=e[3],n=e[4],this.hwnd_=e[5],this.origin_=e[6],this.caption_=e[7],this.pid_=e[8],this.toJSImageData(n),[4,this.remoteInvoke(!1,r.method_id_ScreenSource_t.bounds,0).then(function(e){o.bounds_=o.param0(e)}).catch(function(e){o.bounds_=void 0,i.logger.log(o.user_friendly_id()+".syncBarrier() getBounds failed with error = "+e)})];case 3:return a.sent(),[2,new Promise(function(e){e(o)})]}})})},t.prototype.getId=function(){return this.uniqueid_},t.prototype.getDeviceId=function(){return this.deviceid_},t.prototype.getType=function(){return this.type_},t.prototype.getPreview=function(e,t,n){return i.logger.log(this.user_friendly_id()+".getPreview() called, width:"+e+" height:"+t+" asImage:"+n),Promise.reject(null)},t.prototype.getPreviewAsync=function(e,t,n){return i.logger.log(this.user_friendly_id()+".getPreviewAsync() called, width:"+e+" height:"+t),!0===n?(e=d(this.imagedata_,g.Width,g.Height),Promise.resolve({data:e.src.replace(/^data:image\/(png|jpg);base64,/,"")})):Promise.resolve(this.imagedata_)},t.prototype.getDescription=function(){return this.name_},t.prototype.getIcon=function(e,t){return Promise.resolve(this.imagedata_)},t.prototype.getBounds=function(){return this.bounds_||{x:0,y:0,width:0,height:0}},t.nextId_=l.MonitorsAndApps,t}(n.ProxyObject);t.ScreenSource=h}),define("screensharingutil",["require","exports","hdxms","screensharing","logger"],function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o;!function(e){e[e.Unknown=0]="Unknown",e[e.Cap=1]="Cap",e[e.GetSources=2]="GetSources",e[e.SetActive=3]="SetActive",e[e.TopologyChanged=4]="TopologyChanged"}(o=t.sshare_cmd||(t.sshare_cmd={}));var a;!function(e){e[e.Unknown=0]="Unknown",e[e.Initialized=1]="Initialized",e[e.Error=2]="Error"}(a=t.sshare_state||(t.sshare_state={})),e=function(e){this.origin=e},t.getSourcesReqData=e,e=function(e,t,n,r,i,o,a){this.srcid=e,this.hwnd=t,this.origin=n,this.pid=r,this.border=i,this.cursor=o,this.activate=a},t.setActiveReqData=e;var s=function(e,t,n){this.srcid=e,this.origin=t,this.bufferid=n};t.setActiveRespData=s;var c=function(){function e(e,t,n,r,i){this.id_=e,this.resolve_=t,this.reject_=n,this.cmd_=r,this.data_=i,this.sent_=!1}return e.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.id_+"]"},e.prototype.cmdString=function(){return this.cmd_==o.Cap?"Cap":this.cmd_==o.GetSources?"GetSources":this.cmd_==o.SetActive?"SetActive":"Unknown"},e}();t.CmdInfo=c;var d=function(){};t.BitmapFileHeader=d;var l=function(){};t.BitmapInfoHeader=l;var u=function(){};t.Bitmap=u,e=function(){function e(){this.cmdque_=[]}return e.prototype.reqid=function(){return e.nextId++},e.prototype.user_friendly_id=function(){return this.constructor.name+"[]"},e.prototype.stateString=function(){return e.state_==a.Initialized?"Initialized":e.state_==a.Error?"Error":"Unknown"},e.prototype.reset=function(){e.state_=a.Unknown,this.cmdque_=[]},e.prototype.dispatchCmds=function(){var t=this;e.state_==a.Initialized?this.cmdque_.forEach(function(e){0==e.sent_&&(e.cmd_==o.GetSources?(t.WSSendGetSources(e.id_,e.data_),e.sent_=!0):e.cmd_==o.SetActive?(t.WSSendSetActive(e.id_,e.data_),e.sent_=!0):i.logger.log(e.user_friendly_id()+".dispatchCmds(): invalid cmd: "+e.cmdString()))}):e.state_==a.Error?(this.cmdque_.forEach(function(e){i.logger.log(e.user_friendly_id()+".dispatchCmds(): purging cmd: "+e.cmdString()),e.reject_()}),this.cmdque_=[]):i.logger.log(this.user_friendly_id()+".dispatchCmds(): invalid state: "+this.stateString())},e.prototype.finalizeCmd=function(e,t,n){for(var r=0;r<this.cmdque_.length;r++){var o=this.cmdque_[r];if(void 0!=t&&t==o.id_&&1==o.sent_||void 0==t&&1==o.sent_){i.logger.log(o.user_friendly_id()+".finalizeCmd(): purging cmd: "+o.cmdString()),e?void 0!=n?o.resolve_(n):o.resolve_():o.reject_(),this.cmdque_.splice(r,1);break}}},e.prototype.onInitialized=function(t){i.logger.log(this.user_friendly_id()+".onInitialized(): init: "+t+" state:"+this.stateString()),e.state_!=a.Initialized&&(e.state_=t?a.Initialized:a.Error),this.dispatchCmds()},e.prototype.onInitComplete=function(){i.logger.log(this.user_friendly_id()+".onInitComplete(): state:"+this.stateString()),e.state_==a.Unknown&&(e.state_=a.Error,i.logger.log(this.user_friendly_id()+".onInitComplete(): items in queue:"+this.cmdque_.length),this.dispatchCmds())},e.prototype.onError=function(t){i.logger.log(this.user_friendly_id()+".onError(): state: "+this.stateString()),e.state_==a.Unknown?(e.state_=a.Error,this.dispatchCmds()):e.state_==a.Initialized&&this.finalizeCmd(!1,t)},e.prototype.ab2str=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},e.prototype.str2ab=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0,i=e.length;r<i;r++)n[r]=e.charCodeAt(r);return t},e.prototype.getBMP=function(e){var t=new DataView(e),n=new u;return n.fileheader=new d,n.fileheader.bfType=t.getUint16(0,!0),n.fileheader.bfSize=t.getUint32(2,!0),n.fileheader.bfReserved1=t.getUint16(6,!0),n.fileheader.bfReserved2=t.getUint16(8,!0),n.fileheader.bfOffBits=t.getUint32(10,!0),n.infoheader=new l,n.infoheader.biSize=t.getUint32(14,!0),n.infoheader.biWidth=t.getUint32(18,!0),n.infoheader.biHeight=t.getUint32(22,!0),n.infoheader.biPlanes=t.getUint16(26,!0),n.infoheader.biBitCount=t.getUint16(28,!0),n.infoheader.biCompression=t.getUint32(30,!0),n.infoheader.biSizeImage=t.getUint32(34,!0),n.infoheader.biXPelsPerMeter=t.getUint32(38,!0),n.infoheader.biYPelsPerMeter=t.getUint32(42,!0),n.infoheader.biClrUsed=t.getUint32(46,!0),n.infoheader.biClrImportant=t.getUint32(50,!0),t=n.fileheader.bfOffBits,n.stride=4*Math.floor((n.infoheader.biBitCount*n.infoheader.biWidth+31)/32),n.pixels=new Uint8Array(e,t),n},e.prototype.convertToImageData=function(e){var t=document.createElement("canvas").getContext("2d"),n=e.infoheader.biWidth,r=e.infoheader.biHeight,i=(t=t.createImageData(n,r)).data,o=e.pixels;e=e.stride;for(var a=0;a<r;++a)for(var s=0;s<n;++s){var c=4*(s+n*(r-a)),d=4*s+e*a;i[c]=o[d+2],i[c+1]=o[d+1],i[c+2]=o[d],i[c+3]=255}return t},e.prototype.onGetSources=function(e,t){this.sources_=[];var n=this;t.sources.forEach(function(e){var t=e.image,i=atob(t.data),i=n.str2ab(i),i=new Uint8ClampedArray(i,0,i.byteLength),t=new ImageData(i,t.width,t.height),i=e.icon,o=atob(i.data),o=n.str2ab(o),o=new Uint8ClampedArray(o,0,o.byteLength),i=new ImageData(o,i.width,i.height);e=new r.ScreenSourceVda(e.srcid,e.devicdid,e.type,t,i,e.name,e.hwnd,e.origin,e.caption,e.pid),n.sources_.push(e)}),this.finalizeCmd(!0,e,this.sources_)},e.prototype.getSources=function(t,n,r){var i=this;return new Promise(function(t,n){if(e.state_!=a.Error){var s=new c(i.reqid(),t,n,o.GetSources,r);i.cmdque_.push(s)}else n();e.state_==a.Initialized&&i.dispatchCmds()})},e.prototype.onSetActive=function(e,t){var n=new s(t.srcid,t.origin,t.bufferid);this.finalizeCmd(!0,e,n)},e.prototype.setActive=function(t,n,r){var i=this;return new Promise(function(t,n){if(e.state_!=a.Error){var s=new c(i.reqid(),t,n,o.SetActive,r);i.cmdque_.push(s)}else n();e.state_==a.Initialized&&i.dispatchCmds()})},e.prototype.setTopologyChangeCB=function(e){this.onwindowtopologychanged_=e},e.prototype.onToplogyChanged=function(){this.onwindowtopologychanged_&&this.onwindowtopologychanged_()},e.prototype.WSSendGetSources=function(e,t){try{n.getRedirector().WSSendObject({v:"appsharing",hdr:{command:o.GetSources,id:e},data:{origin:t.origin}})}catch(e){i.logger.log(e)}},e.prototype.WSSendSetActive=function(e,t){try{n.getRedirector().WSSendObject({v:"appsharing",hdr:{command:o.SetActive,id:e},data:{srcid:t.srcid,hwnd:t.hwnd,origin:t.origin,pid:t.pid,border:t.border,cursor:t.cursor,activate:t.activate}})}catch(e){i.logger.log(e)}},e.state_=a.Unknown,e.nextId=0,e}(),t.ScreenShareUtil=e}),define("hdxms","require exports proxyobject logger webrpcclassinfo wsjsonutil telemetry screensharingutil".split(" "),function(e,t,n,r,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var c,d=function(e,t,n,r,i,o,a){this.resolve=e,this.reject=t,this.iid=n,this.oid=r,this.cbid=i,this.oneShot=o,this.mid=a};!function(e){e[e.rpc_status_success=0]="rpc_status_success",e[e.rpc_status_unspecified_error=1]="rpc_status_unspecified_error",e[e.rpc_status_unexpected=2]="rpc_status_unexpected",e[e.rpc_status_index_out_of_bounds=3]="rpc_status_index_out_of_bounds",e[e.rpc_status_missing_parameter=4]="rpc_status_missing_parameter",e[e.rpc_status_missing_return_value=5]="rpc_status_missing_return_value",e[e.rpc_status_invalid_object=6]="rpc_status_invalid_object",e[e.rpc_status_user_exception=7]="rpc_status_user_exception",e[e.rpc_status_system_error=8]="rpc_status_system_error"}(c=t.WebrpcStatusCode||(t.WebrpcStatusCode={}));var l;!function(e){e[e.NotRedirected=0]="NotRedirected",e[e.Connecting=1]="Connecting",e[e.Binding=2]="Binding",e[e.Redirected=3]="Redirected"}(l=t.RedirectionStatus||(t.RedirectionStatus={})),e=function(){function e(){this.handlers_=[],this.pingactive=!1,this.status=l.NotRedirected,this.reqs=[],this.cbs=[],this.deferredActions=[],this.telemetry_=new a.Telemetry,this.screenshare_=new s.ScreenShareUtil,this.stateChangeNotifcations=[],this.vdafeatures_=[]}return Object.defineProperty(e.prototype,"telemetry",{get:function(){return this.telemetry_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenshare",{get:function(){return this.screenshare_},enumerable:!0,configurable:!0}),e.prototype.stopAppshare=function(){var e=window.stopAppshare;e&&e()},e.prototype.setRemoteSessionInfoCb=function(e){this.remoteSessionInfoCb=e},e.prototype.setFeatures=function(e){this.features=e,this.screenshare.onInitComplete(),this.handlers_.forEach(function(t,n){t.init(e)})},e.prototype.getFeatureValue=function(e){var t=this.features.find(function(t){return t.name===e});return void 0!==t&&t.value},e.prototype.onRedirectionComplete=function(){for(;this.deferredActions&&0<this.deferredActions.length;)this.deferredActions.shift().post(this.status==l.Redirected)},e.prototype.connectToService=function(){return r.logger.log("Redirection status: Connecting..."),this.status=l.Connecting,new Promise(function(e,t){var n=new WebSocket("wss://127.0.0.1:9002");n.onopen=function(){e(n)},n.onerror=function(e){r.logger.log("websocket connection error: "+e.type),t(e)}})},e.prototype.waitUntilRedirected=function(e){var t=this;return new Promise(function(n,i){t.status==l.Redirected?n():0>=e?i():setTimeout(function(){r.logger.log("waitUntilRedirected() timeout. count="+e),t.status!=l.Redirected?t.waitUntilRedirected(--e).then(function(){n()}).catch(function(){i()}):n()},2e3)})},e.prototype.handleRemoteSessionInfo=function(){var e=this;r.logger.log("handleRemoteSessionInfo called.");var t=this;t.remoteSessionInfoCb?t.remoteSessionInfoCb().then(function(n){r.logger.log("remoteSessionInfo success! info:"+JSON.stringify(n)),r.logger.log("Redirection status: Redirected"),t.status=l.Redirected,t.pingConnectionEnd(),(0,window.onVdiClientConnected)(),e.telemetry.SendTelemetryInit(),t.onRedirectionComplete()}).catch(function(){r.logger.log("remoteSessionInfo failure!"),t.suspendRedirection(!0),t.onRedirectionComplete()}):(r.logger.log("remoteSessionInfoCb is invalid!"),t.suspendRedirection(!0),t.onRedirectionComplete())},e.prototype.startRedirection=function(e,t){var i=this,o=window.onVdiClientDisconnected;return new Promise(function(a,s){i.status!=l.Redirected?(r.logger.log("Attempting to start redirection: "+t),!1===e?i.deferredActions.push(new n.deferred_action(a,s,t)):i.connectToService().then(function(e){r.logger.log("Redirection status: Binding..."),i.status=l.Binding,i.websocket=e,i.websocket.onmessage=function(e){i.onWSMessage(e)},i.websocket.onclose=function(e){i.onWSClose(e)},a(),i.handleRemoteSessionInfo()}).catch(function(e){r.logger.log("Unable to connect to websocket service!"),s(),i.suspendRedirection(!0),i.onRedirectionComplete(),o(!0)})):(r.logger.log("Redirection already started."),a())})},e.prototype.suspendRedirection=function(e){var t=this;r.logger.log("Suspending redirection."),this.handlers_.forEach(function(e,t){e.reset()}),(0,window.onVdiClientDisconnected)(!1);var n=!1;e=window.getCitrixMSTeamsRedir;var i,o=window.getCitrixWebrtcRedir;e?i=e:o&&(i=o),i&&i().then(function(e){r.logger.log("sucesss on disconnect"+e),"1"==e&&(n=!0,r.logger.log("Reg key exists while disconnecting")),t.status===l.Redirected&&1==n&&(r.logger.log("Calling ping not normal disconnect"),t.pingConnectionBegin(!1)),r.logger.log("Redirection status: NotRedirected"),t.status=l.NotRedirected}).catch(function(){r.logger.log("Failure to Read MS Teams redir Reg Key, not retrying...")}),this.dispatchStateChangeNotifications()},e.prototype.onWSOpen=function(){},e.prototype.onWSClose=function(e){r.logger.log("disconnected from websocket service.");try{this.suspendRedirection(!0)}catch(e){r.logger.log("suspendRedirection(): exception closing WebSocket: "+e.message)}},e.prototype.onWSError=function(){try{this.suspendRedirection(!0)}catch(e){r.logger.log("suspendRedirection(): exception on WebSocket error: "+e.message)}},e.prototype.WSSendObjectWrapper=function(e,t,n,r){a=!0;t!=i.class_id_t.EngineControl||n!=i.method_id_EngineControl_t.ctor&&n!=i.method_id_EngineControl_t.version&&n!=i.method_id_EngineControl_t.feature_flags||(a=!1);var o=!0;if(a&&(o=!1,void 0!=this.features))for(var a=0,s=this.features;a<s.length;a++){var c=s[a];if(!0===c.value&&c.name==e){o=!0;break}}return 1==o?this.WSSendObject(r):Promise.reject("Cannot invoke method that is not supported by webrpc: iid("+t+") mid("+n+")")},e.prototype.WSSendObject=function(e){var t=this;return new Promise(function(n,o){if("webrtc"==e.v){var a=e.hdr.proc.iid,s=e.hdr.proc.methodid,c=e.objref.oid;e.hdr.destroy||(a=new d(n,o,a,c,0,!0,s),t.reqs.push(a)),a=JSON.stringify(e),r.logger.trace("WSSendObject: >>> "+i.WebrpcClassLibInfoUtil.composeClassInfoData(e)+" "+a);try{t.websocket.send(a)}catch(e){r.logger.log("WSSendObject(): exception: "+e.message),o(e.message)}}else if("overlay"==e.v){a=JSON.stringify(e),r.logger.log("HDXMS: SendOverlayData: >>> "+a+"'");try{t.websocket.send(a)}catch(e){r.logger.log("WSSendObject(): exception: "+e.message),o(e.message)}}else if("telemetry"==e.v){a=JSON.stringify(e),r.logger.log("HDXMS: SendTelemetryData: >>> "+a+"'");try{t.websocket.send(a)}catch(e){r.logger.log("WSSendObject(): exception: "+e.message),o(e.message)}}else if("appsharing"==e.v){a=JSON.stringify(e),r.logger.log("HDXMS: SendScreenSharingData: >>> "+a+"'");try{t.websocket.send(a)}catch(e){r.logger.log("WSSendObject(): exception: "+e.message),o(e.message)}}else r.logger.log("HDXMS: Unknown protocol: '"+JSON.stringify(e)+"'")})},e.prototype.webrpcStatusCodeToName=function(e){switch(e){case c.rpc_status_success:e="rpc_status_success";break;case c.rpc_status_unspecified_error:e="rpc_status_unspecified_error";break;case c.rpc_status_unexpected:e="rpc_status_unexpected";break;case c.rpc_status_index_out_of_bounds:e="rpc_status_index_out_of_bounds";break;case c.rpc_status_missing_parameter:e="rpc_status_missing_parameter";break;case c.rpc_status_missing_return_value:e="rpc_status_missing_return_value";break;case c.rpc_status_invalid_object:e="rpc_status_invalid_object";break;case c.rpc_status_user_exception:e="rpc_status_user_exception";break;case c.rpc_status_system_error:e="rpc_status_system_error";break;default:e="unknown"}return e},e.prototype.parceWebrpcError=function(e,t){void 0===e&&(e=t&&0<t.length?t[0].category||t[0].code||t[0].message?c.rpc_status_system_error:c.rpc_status_user_exception:c.rpc_status_unspecified_error);var n;switch(e){case c.rpc_status_unspecified_error:case c.rpc_status_unexpected:case c.rpc_status_index_out_of_bounds:case c.rpc_status_missing_parameter:case c.rpc_status_missing_return_value:case c.rpc_status_invalid_object:n=new DOMException(this.webrpcStatusCodeToName(e),this.webrpcStatusCodeToName(e));break;case c.rpc_status_user_exception:n=t&&0<t.length?new DOMException(t[0],this.webrpcStatusCodeToName(e)):new DOMException(this.webrpcStatusCodeToName(e),this.webrpcStatusCodeToName(e));break;case c.rpc_status_system_error:if(t&&0<t.length){n=Object.create(DOMException);var r={value:null,writable:!0,enumerable:!1,Configurable:!0};r.value=t[0].category,Object.defineProperty(n,"name",r),r.value=t[0].code,Object.defineProperty(n,"code",r),r.value=t[0].message,Object.defineProperty(n,"message",r)}else n=new DOMException(this.webrpcStatusCodeToName(e),this.webrpcStatusCodeToName(e))}return n},e.prototype.onWSMessage=function(e){e=e.data;var t;try{t=JSON.parse(e)}catch(t){return console.log("invalid JSON!!!"),console.log(t),void console.log(e)}if("webrtc"==t.v){r.logger.trace("onWSMessage: <<< "+i.WebrpcClassLibInfoUtil.composeClassInfoData(t)+" "+e);var n=t.hdr.proc.iid,a=t.hdr.proc.methodid,c=t.objref.oid,d=t.status;if(t.hdr.msg_type==o.WsJsonUtil.getMsgType(o.ws_msg_type_t.reply))0<=(e=this.reqs.findIndex(function(e){return e.iid==n&&e.oid==c&&e.mid==a}))?0==d?this.reqs.splice(e,1).shift().resolve(t):(d=this.parceWebrpcError(d,t.params),this.reqs.splice(e,1).shift().reject(d)):(r.logger.log("HDXMS didnt find this one. (reqs)"),r.logger.log(this.reqs));else if(t.hdr.msg_type==o.WsJsonUtil.getMsgType(o.ws_msg_type_t.event_req)){var l=t.func.id;0<=(e=this.cbs.findIndex(function(e){return e.iid==n&&e.oid==c&&e.cbid==l>>16}))?(0==(65535&l)?this.cbs[e].resolve(t):(d=this.parceWebrpcError(d,t.params),this.cbs[e].reject(d)),1==this.cbs[e].oneShot&&this.cbs.splice(e,1)):(r.logger.log("HDXMS didnt find this one. (cbs)"),r.logger.log(this.cbs))}else r.logger.log("HDXMS Received bogus message: "+e+"'")}else if("telemetry"==t.v)0==t.status&&2==(2147483647&(e=t.hdr.command))&&(d=t.hdr.id,this.telemetry.onInitialized(d),r.logger.log("Telemetry init response received"));else if("features"==t.v){if(e=t.features,"feature-support"==t.command)for(r.logger.log("features capabilities received, features:"+e),this.vdafeatures_=e,d=0;d<e.length;d++)e[d]===i.FEATURE_vda_app_sharing&&this.screenshare.onInitialized(!0);this.clientViewportMode_=t.client_viewport_mode,r.logger.log("features client_viewport_mode value: "+this.clientViewportMode_)}else"appsharing"==t.v?0==(e=t.status)?(e=t.hdr.command,d=t.hdr.id,(2147483647&e)==s.sshare_cmd.GetSources?(r.logger.log("appsharing GetSources response received"),this.screenshare.onGetSources(d,t.data)):(2147483647&e)==s.sshare_cmd.SetActive?(r.logger.log("appsharing SetActive response received"),this.screenshare.onSetActive(d,t.data)):(2147483647&e)==s.sshare_cmd.TopologyChanged?(r.logger.log("appsharing Window topology changed cmd received"),this.screenshare.onToplogyChanged()):(r.logger.log("invalid command reply:"+e),this.screenshare.onError(d))):(r.logger.log("invalid status reply:"+e),d=t.hdr.id,this.screenshare.onError(d)):void 0!=(d=this.handlers_.find(function(e){return e.name==t.v}))?d.on_message(t):r.logger.log("HDXMS: Unknown protocol: "+e+"'")},e.prototype.clearReqs=function(){r.logger.log("clearReqs()"),this.reqs.forEach(function(e,t){e.reject()}),this.reqs=[]},e.prototype.registerHandler=function(e,t,n){e=new d(n.resolve.bind(n),n.reject.bind(n),e,t,n.id,n.oneShot,0),this.cbs.push(e)},e.prototype.unregisterHandler=function(e,t,n){var i=this.cbs.findIndex(function(r){return r.iid==e&&r.oid==t&&r.cbid==n});0<=i?this.cbs.splice(i,1):(r.logger.log("HDXMS Didnt find this callback in the list!"),console.log(this.cbs))},e.prototype.isRedirected=function(){return this.status===l.Redirected||this.status===l.Binding||this.status===l.Connecting},e.prototype.isPingActive=function(){return this.pingactive},e.prototype.pingConnectionBegin=function(e){r.logger.log("Started timer"),this.pingactive=!0;var t=window.onVdiClientDisconnectedTimer;1==e?(r.logger.log("checking if we are connected..."),t()):this.conntimer=setTimeout(function(){r.logger.log("checking if we are connected..."),t()},15e3)},e.prototype.pingConnectionEnd=function(){this.pingactive=!1,clearTimeout(this.conntimer)},e.prototype.SendTelemetryData_Speaker=function(e){this.telemetry.SendTelemetryData(a.tel_cmd.Data,a.tel_key_SpeakerDeviceUsed,e,0)},e.prototype.registerStateChangeNotification=function(e){this.stateChangeNotifcations.push(e)},e.prototype.unregisterStateChangeNotification=function(e){this.stateChangeNotifcations=this.stateChangeNotifcations.filter(function(t){return t!=e})},e.prototype.dispatchStateChangeNotifications=function(){this.stateChangeNotifcations.forEach(function(e){e()})},e.prototype.vdabufferNoLimit=function(){for(var e=!1,t=0,n=this.vdafeatures_;t<n.length;t++)if(n[t]===i.FEATURE_vda_service_no_buffer_limit){e=!0;break}return e},Object.defineProperty(e.prototype,"clientViewportMode",{get:function(){return this.clientViewportMode_||"unknown"},enumerable:!0,configurable:!0}),e.prototype.addProtocolHandler=function(e){void 0==this.handlers_.find(function(t){return t.name==e.name})&&this.handlers_.push(e)},e}(),t.HdxMediaStream=e;var u=new e;t.getRedirector=function(){return u}}),define("codeccapability",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){this.name=e,this.enabled=t};t.CodecCapability=n,n=function(e){this.codecs=e},t.CodecCapabilities=n}),define("remotemedia","require exports webrpcclassinfo proxyobject logger hdxms telemetry".split(" "),function(e,t,n,r,i,o,a){function s(e){for(var t=[],n=0;n<e.length;n++)t.push({oid:e[n].object_id()});return t}Object.defineProperty(t,"__esModule",{value:!0});var c;t.enumerateddecices=c;var d=function(e,t){this.type=e,this.target=t},l=function(){function e(){this.is_local_clone=!1,this.clone_id=this.clone_count=0}return e.prototype.clone=function(){this.clone_count++;var t=new e;return t.is_local_clone=!0,t.clone_id=this.clone_count,t},e.prototype.synchronize=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.is_local_clone?[2,e.asyncClone()]:[2,e]})})},e}(),u=function(e){function t(t,i){var o=e.call(this,t,n.class_id_t.MediaStreamTrack,i,r.ProxyMode.Remote)||this;return o.refCount_=0,o.refCount_++,o.clone_state=new l,o}return __extends(t,e),t.prototype.dumpInfo=function(){i.logger.log(this.user_friendly_id()+".dumpInfo() [id="+this.id+"] kind="+this.kind+" label="+this.label+" refcount="+this.refcount)},Object.defineProperty(t.prototype,"refcount",{get:function(){return this.refCount_},enumerable:!0,configurable:!0}),t.prototype.addRef=function(){this.refCount_++,i.logger.log(this.user_friendly_id()+".addRef() called. [id="+this.id+"] refcount="+this.refCount_)},Object.defineProperty(t.prototype,"onended",{get:function(){return i.logger.log(this.user_friendly_id()+".get_onended() called. [id="+this.id+"]"),this.onended_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_onended() called. [id="+this.id+"]"),this.onended_=e,this.waitUntilConnected("MediaStreamTrack.onended").then(function(){var r=t.registerCallbacks(!1,t.isNullCallback(e),n.method_id_MediaStreamTrack_t.onended);return r.then(function(e){i.logger.log(t.user_friendly_id()+"onended event received!!!"),e=new d("ended",t),t.readyState_="ended",t.onended_(e)}),t.remoteInvoke(!0,n.method_id_MediaStreamTrack_t.onended,r.success)}).catch(function(e){t.logRemoteInvokeError(e,".onended failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onmute",{get:function(){return i.logger.log(this.user_friendly_id()+".get_onmute() called. [id="+this.id+"]"),this.onmute_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_onmute() called. [id="+this.id+"]"),this.onmute_=e,this.waitUntilConnected("MediaStreamTrack.onmute").then(function(){var r=t.registerCallbacks(!1,t.isNullCallback(e),n.method_id_MediaStreamTrack_t.onmute);return r.then(function(e){i.logger.log(t.user_friendly_id()+"onmute event received!!!"),e=new d("mute",t),t.muted=!0,t.onmute_(e)}),t.remoteInvoke(!0,n.method_id_MediaStreamTrack_t.onmute,r.success)}).catch(function(e){t.logRemoteInvokeError(e,".onmute failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onunmute",{get:function(){return i.logger.log(this.user_friendly_id()+".get_onunmute() called. [id="+this.id+"]"),this.onunmute_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_onunmute() called. [id="+this.id+"]"),this.onunmute_=e,this.waitUntilConnected("MediaStreamTrack.onunmute").then(function(){var r=t.registerCallbacks(!1,t.isNullCallback(e),n.method_id_MediaStreamTrack_t.onunmute);return r.then(function(e){i.logger.log("onunmute event received!!!"),e=new d("unmute",t),t.muted=!1,t.onunmute_(e)}),t.remoteInvoke(!0,n.method_id_MediaStreamTrack_t.onunmute,r.success)}).catch(function(e){t.logRemoteInvokeError(e,".onunmute failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onstop",{set:function(e){this.onstop_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return i.logger.log(this.user_friendly_id()+".get_enabled() called. [id="+this.id+", value="+this.enabled_+"]"),this.enabled_},set:function(e){i.logger.log(this.user_friendly_id()+".set_enabled() called. [id="+this.id+", value="+e+"]"),this.enabled_=e,this.remoteInvoke(!0,n.method_id_MediaStreamTrack_t.enabled,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return i.logger.log(this.user_friendly_id()+".get_readyState() called. [id="+this.id+"]"),this.readyState_},enumerable:!0,configurable:!0}),t.prototype.asyncClone=function(){return __awaiter(this,void 0,void 0,function(){var e,r,i;return __generator(this,function(o){switch(o.label){case 0:return[4,this.waitUntilConnected("RemoteMediaTrack.asyncClone")];case 1:return o.sent(),[4,this.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.clone,[])];case 2:return e=o.sent(),r=this.param0(e),i=new t(this,r.oid),[2,i.syncBarrier()]}})})},t.prototype.clone=function(){i.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]");var e=this.clone_state.clone(),n=new t(this,this.object_id());return n.id=this.id+"."+e.clone_id.toString(),n.label=this.label,n.kind=this.kind,n.enabled_=this.enabled_,n.muted=this.muted,n.readyState_=this.readyState_,n.trackSettings_=this.trackSettings_,n.clone_state=e,n.constraints_=this.constraints_,n.capabilities_=this.capabilities_,n},t.prototype.stop=function(){var e=this;i.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"] refcount="+this.refCount_),this.readyState_="ended",0<this.refCount_&&0==--this.refCount_&&(i.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"] remote invoking..."),this.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.stop).catch(function(t){e.logRemoteInvokeError(t,".stop failed!")}),"video"==this.kind&&"remoteapp-track"==this.label&&o.getRedirector().stopAppshare(),null!==this.onstop_&&void 0!=this.onstop_)&&this.onstop_()},t.prototype.getCapabilities=function(){return this.capabilities_},t.prototype.getConstraints=function(){return this.constraints_},t.prototype.getSettings=function(){return"audio"==this.kind?function(e){return{deviceId:e.deviceId,echoCancellation:e.echoCancellation}}(this.trackSettings_):function(e){return{aspectRatio:e.aspectRatio,deviceId:e.deviceId,frameRate:e.frameRate,height:e.height,width:e.width}}(this.trackSettings_)},t.prototype.applyConstraints=function(e){var t=this;return i.logger.log(this.user_friendly_id()+".applyConstraints() called."),new Promise(function(r,i){t.waitUntilConnected("MediaStreamTrack.applyConstraints").then(function(){return Promise.all([t.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.applyConstraints,e),t.syncBarrier()])}).catch(function(){i({name:"OverconstrainedError",message:"Failed to apply constraints."})}).then(function(){return t.constraints_=e,t.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.getConstraints)}).then(function(e){t.constraints_=t.param0(e)}).catch(function(e){t.logRemoteInvokeError(e,".syncBarrier() remote client does not support getConstraints method. Ignore it")}).then(function(){return r()})})},t.convertReadyState=function(e){return 0==e?"live":"ended"},t.prototype.syncBarrier=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(r,i){e.waitUntilConnected("MediaStreamTrack.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.kind,""),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.id,""),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.label,""),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.enabled,!1),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.muted,!1),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.readyState,0),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.getSettings),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.getCapabilities)])}).then(function(n){var i=0;n=n.map(function(t){return e.param0(t)}),e.kind=n[0],e.id=n[1],e.label=n[2],e.enabled_=n[3],e.muted=n[4],i=n[5],e.trackSettings_=n[6],e.capabilities_=n[7],e.readyState_=t.convertReadyState(i),r(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),i(t)})})},t}(r.ProxyObject);t.RemoteMediaTrack=u;var _=function(){},g=function(e){function t(t,i,o,a){return void 0===o&&(o=r.ProxyMode.Local),void 0===a&&(a=[]),t=e.call(this,t,n.class_id_t.MediaStream,i,o,null,s(a))||this,t.clone_state=new l,t.tracks_=a,t}return __extends(t,e),t.prototype.dumpInfo=function(){i.logger.log(this.user_friendly_id()+".dumpInfo() [id="+this.id+"] active="+this.active_+" num tracks="+this.tracks_.length);for(var e=0,t=this.tracks_;e<t.length;e++){var n=t[e];n&&n.dumpInfo()}},t.prototype.toJSON=function(){var e=new _;return e.id=this.id,e.active=this.active_,e.oid=this.object_id(),"RemoteStream:"+JSON.stringify(e)},Object.defineProperty(t.prototype,"active",{get:function(){return i.logger.log(this.user_friendly_id()+".get active() called. [id="+this.id+"] active="+this.active_),this.active_},enumerable:!0,configurable:!0}),t.prototype.getAudioTracks=function(){i.logger.log(this.user_friendly_id()+".getAudioTracks() called. [id="+this.id+"]");for(var e=[],t=0,n=this.tracks_;t<n.length;t++){var r=n[t];"audio"==r.kind&&e.push(r)}return e},t.prototype.getVideoTracks=function(){i.logger.log(this.user_friendly_id()+".getVideoTracks() called. [id="+this.id+"]");for(var e=[],t=0,n=this.tracks_;t<n.length;t++){var r=n[t];"video"==r.kind&&e.push(r)}return e},t.prototype.getTracks=function(){return i.logger.log(this.user_friendly_id()+".getTracks() called. [id="+this.id+"]"),this.tracks_},t.prototype.getTrackById=function(e){i.logger.log(this.user_friendly_id()+".getTrackById() called. [id="+this.id+"]");for(var t=0,n=this.tracks_;t<n.length;t++){var r=n[t];if(r.id==e)return r}},t.prototype.addTrack=function(e){var t=this;i.logger.log(this.user_friendly_id()+".addTrack() called. [id="+this.id+"]"),this.tracks_.push(e),e&&e.dumpInfo();var r=this;this.waitUntilConnected("MediaStream.addTrack").then(function(){return i.logger.log(r.user_friendly_id()+".addTrack remote invoking"),r.remoteInvoke(!1,n.method_id_MediaStream_t.addTrack,{oid:e.object_id()})}).then(function(){i.logger.log(r.user_friendly_id()+".addTrack success")}).catch(function(e){t.logRemoteInvokeError(e,".addTrack failed!")})},t.prototype.removeTrack=function(e){var t=this;i.logger.log(this.user_friendly_id()+".removeTrack() called. [id="+this.id+"]");var r=this.tracks_.indexOf(e);this.tracks_.splice(r,1);var o=this;this.waitUntilConnected("MediaStream.removeTrack").then(function(){return i.logger.log(o.user_friendly_id()+".removeTrack remote invoking"),o.remoteInvoke(!1,n.method_id_MediaStream_t.removeTrack,{oid:e.object_id()})}).then(function(){i.logger.log(o.user_friendly_id()+".removeTrack success")}).catch(function(e){t.logRemoteInvokeError(e,".removeTrack failed!")})},t.prototype.asyncClone=function(){return __awaiter(this,void 0,void 0,function(){var e,o,a;return __generator(this,function(s){switch(s.label){case 0:return i.logger.log(this.user_friendly_id()+".asyncClone() called. [id="+this.id+"]"),[4,this.waitUntilConnected("asyncClone")];case 1:return s.sent(),[4,this.remoteInvoke(!1,n.method_id_MediaStream_t.clone,[])];case 2:return e=s.sent(),console.log(e),o=this.param0(e),a=new t(this,o.oid,r.ProxyMode.Remote),[2,a.syncBarrier()]}})})},t.prototype.clone=function(){i.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]");var e=this.clone_state.clone(),n=new t(this,this.object_id(),r.ProxyMode.Remote);return n.id=this.id+"."+e.clone_id.toString(),this.tracks_.forEach(function(e){e.addRef()}),n.tracks_=this.tracks_,n.clone_state=e,n},t.prototype.syncBarrier=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called. [id="+this.id+"]"),new Promise(function(t,r){e.waitUntilConnected("MediaStream.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_MediaStream_t.id,""),e.remoteInvoke(!1,n.method_id_MediaStream_t.active,!1),e.remoteInvoke(!1,n.method_id_MediaStream_t.getTracks,[])])}).then(function(t){i.logger.log(e.user_friendly_id()+".syncBarrier() remote success"),t=t.map(function(t){return e.param0(t)}),e.id=t[0],e.active_=t[1],t=t[2];for(var n=[],r=0;r<t.length;r++)!function(t){var r=e.tracks_.find(function(e){return e.object_id()===t.oid});void 0===r&&(i.logger.log(e.user_friendly_id()+" adding a RemoteMediaTrack with oid:"+t.oid),r=new u(e,t.oid)),n.push(r.syncBarrier())}(t[r]);return Promise.all(n)}).then(function(n){e.tracks_=[],n.forEach(function(t){t.onstop=function(){var t=!0;e.tracks_.forEach(function(e){"ended"!=e.readyState&&(t=!1)}),t&&e.release()},e.tracks_.push(t)}),t(e)}).catch(function(t){e.logRemoteInvokeError(t,".syncBarrier failed!"),r()})})},t}(r.ProxyObject);t.RemoteStream=g,e=function(e){function t(t,i){return e.call(this,t,n.class_id_t.MediaStreamEvent,i,r.ProxyMode.Remote)||this}return __extends(t,e),t.prototype.syncBarrier=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,i){e.waitUntilConnected("MediaStreamEvent.syncBarrier").then(function(){return e.remoteInvoke(!1,n.method_id_MediaStreamEvent_t.stream,{oid:0})}).then(function(t){return new g(e,t.params[0].oid,r.ProxyMode.Remote).syncBarrier()}).then(function(n){e.stream=n,t(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),i(t)})})},t}(r.ProxyObject),t.RemoteStreamEvent=e;var h=function(e){function t(t){return e.call(this,null,n.class_id_t.MediaDeviceInfo,t,r.ProxyMode.Remote)||this}return __extends(t,e),t.prototype.convertKind=function(e){return 0==e?"audioinput":1==e?"audiooutput":"videoinput"},t.prototype.syncBarrier=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,r){e.waitUntilConnected("RemoteDeviceInfo.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_MediaDeviceInfo_t.deviceId,""),e.remoteInvoke(!1,n.method_id_MediaDeviceInfo_t.kind,0),e.remoteInvoke(!1,n.method_id_MediaDeviceInfo_t.label,""),e.remoteInvoke(!1,n.method_id_MediaDeviceInfo_t.groupId,"")])}).then(function(n){e.kind=e.convertKind(e.param0(n.splice(1,1)[0])),n=n.map(function(t){return e.param0(t)}),e.deviceId=n[0],e.label=n[1],e.groupId=n[2],t(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),r(t)})})},t}(r.ProxyObject);t.RemoteDeviceInfo=h,e=function(e){function a(){var t=e.call(this,null,n.class_id_t.MediaDevices,0,r.ProxyMode.Local,function(){t.setDeviceChangeCallback()})||this;return t.devices_=[],t}return __extends(a,e),Object.defineProperty(a.prototype,"panelid",{set:function(e){this.panelid_=e},enumerable:!0,configurable:!0}),a.prototype.clearPanelId=function(){this.panelid_=-1},a.prototype.enumerateDevices=function(){var e=this;return i.logger.log(this.user_friendly_id()+".enumerateDevices() called"),new Promise(function(r,o){e.waitUntilConnected("RemoteDevices.enumerateDevices").then(function(){return i.logger.log(e.user_friendly_id()+".enumerateDevices() remote invoking..."),e.remoteInvoke(!1,n.method_id_MediaDevices_t.enumerateDevices,[])}).then(function(t){var n=[];return t.params[0].forEach(function(t){var r=e.devices_.find(function(e){return e.object_id()===t.oid});void 0===r?(r=new h(t.oid),n.push(r.syncBarrier())):n.push(r)}),Promise.all(n)}).then(function(n){i.logger.log(e.user_friendly_id()+".enumerateDevices: returning enumerated devices with ids ["+n.map(function(e){return e.object_id()})+"]"),r(n),i.logger.log(e.user_friendly_id()+".enumerateDevices: resolved promise"),e.devices_.forEach(function(e){for(var t=!0,r=0;r<n.length;r++)if(e===n[r]){t=!1;break}t&&e.release()}),e.devices_=n,t.enumerateddecices=c=n}).catch(function(t){e.logRemoteInvokeError(t,".enumerateDevices() failed, resolving with empty list."),e.devices_=[],r([])})})},a.prototype.getDisplayMedia=function(e){var t=this;return new Promise(function(i,o){t.waitUntilConnected("RemoteDevices.getDisplayMedia").then(function(){return t.IsPanelIdValid()}).then(function(){void 0!==e.video&&null!==e.video&&void 0!==t.panelid_&&(e.video.deviceId=t.panelid_);var r=t.prepareDisplayConstraints(e);return t.remoteInvoke(!1,n.method_id_MediaDevices_t.getDisplayMedia,r)}).then(function(e){return new g(null,e.params[0].oid,r.ProxyMode.Remote).syncBarrier()}).then(function(e){i(e)}).catch(function(e){e=t.logRemoteInvokeError(e,".getDisplayMedia() failed!"),o(e)})})},a.prototype.setDeviceChangeCallback=function(){var e=this;i.logger.log(this.user_friendly_id()+".set_DeviceChangeCallback() called."),this.waitUntilConnected("MediaDevices.ondevicechange").then(function(){var t=e.registerCallbacks(!1,!1,n.method_id_MediaDevices_t.ondevicechange);return t.then(function(){i.logger.log(e.user_friendly_id()+".ondevicechange(): callback received!!!"),navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange"))}),e.remoteInvoke(!0,n.method_id_MediaDevices_t.ondevicechange,t.success)}).catch(function(t){e.logRemoteInvokeError(t,".set_ondevicechange() failed!")})},a.prototype.prepareDisplayConstraints=function(e){if(o.getRedirector().getFeatureValue(n.FEATURE_ms_teams_common_media_constraints))return e;var t={frameRate:15,width:{max:1920},height:{max:1080}};return void 0!==e.video&&null!==e.video&&void 0!==(e=e.video).frameRate&&void 0!==e.width&&void 0!==e.height&&(t.frameRate=e.frameRate,t.width.max=e.width.max||e.width,t.height.max=e.height.max||e.height),{video:t}},a.prototype.IsPanelIdValid=function(){var e=this;return new Promise(function(t,n){if(-1!==e.panelid_)i.logger.log(e.user_friendly_id()+".IsPanelIdValid() resolving with panelid_:"+e.panelid_),t();else var r=0,o=setInterval(function(){i.logger.log(e.user_friendly_id()+".IsPanelIdValid() waiting panelid_:"+e.panelid_),50<=r?(n(),clearInterval(o),i.logger.log(e.user_friendly_id()+".IsPanelIdValid(): PanelId is invalid.")):(++r,-1!=e.panelid_&&(t(),clearInterval(o),i.logger.log(e.user_friendly_id()+".IsPanelIdValid(): PanelId is valid.")))},10)})},a}(r.ProxyObject),t.RemoteDevices=e,e=function(e){function t(){return e.call(this,null,n.class_id_t.NavigatorUserMedia,0,r.ProxyMode.Local)||this}return __extends(t,e),t.getCapabilities=function(e){return i.logger.log(this.constructor.name+".getCapabilities() called:"+e+" caps:"+t.caps_),t.caps_[e]},t.resetcaps=function(){t.caps_={}},t.prototype.getCapabilities=function(){var e=this;return i.logger.log(this.user_friendly_id()+".getCapabilities() called: "),new Promise(function(r,i){e.waitUntilConnected(e.user_friendly_id()+".getCapabilities").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_NavigatorUserMedia_t.getCapabilities,"audio"),e.remoteInvoke(!1,n.method_id_NavigatorUserMedia_t.getCapabilities,"video")])}).then(function(n){t.caps_.audio=e.param0(n[0]),t.caps_.video=e.param0(n[1]),r(t.caps_)}).catch(function(t){t=e.logRemoteInvokeError(t,".getCapabilities() failed!"),i(t)})})},t.prototype.setCodecCapabilities=function(e){var t=this;return i.logger.log(this.user_friendly_id()+".setCodecCapabilities : set codecCapabilities to "+JSON.stringify(e)),new Promise(function(r,o){t.waitUntilConnected("NavigatorUserMedia.setCodecCapabilities").then(function(){return t.remoteInvoke(!1,n.method_id_NavigatorUserMedia_t.setCodecCapabilities,e)}).then(function(){i.logger.log(t.user_friendly_id()+".setCodecCapabilities() success."),r(!0),t.getCapabilities()}).catch(function(e){e=t.logRemoteInvokeError(e,".setCodecCapabilities() failed!"),o(e)})})},t.prototype.webkitGetUserMedia=function(e,t,n){this.getUserMedia(e,t,n)},t.prototype.LogTelemetryDevice_=function(e){try{if(void 0!==e.audio){var t,n=e.audio.deviceId;c.forEach(function(e){n==e.deviceId&&(t=e.label)}),i.logger.log(t),this.SendTelemetryData(a.tel_key_AudioDeviceUsed,t,0)}if(void 0!==e.video){var r,o=e.video.mandatory.sourceId;c.forEach(function(e){o==e.deviceId&&(r=e.label)}),i.logger.log(r),this.SendTelemetryData(a.tel_key_VideoDeviceUsed,r,0)}}catch(e){i.logger.log(e)}},t.prototype.getUserMedia=function(e,t,n){return i.logger.log(this.user_friendly_id()+".getUserMedia() called: "+JSON.stringify(e)),t&&n?this.getUserMedia_v1(e,t,n):this.getUserMedia_v2(e)},t.prototype.getUserMedia_v2=function(e){var t=this;return i.logger.log(this.user_friendly_id()+".getUserMedia_v2() called: "+JSON.stringify(e)),new Promise(function(n,r){t.getUserMediaPrivate(e,n,r)})},t.prototype.getUserMedia_v1=function(e,t,n){return i.logger.log(this.user_friendly_id()+".getUserMedia_v1() called: "+JSON.stringify(e)),this.getUserMediaPrivate(e,t,n)},t.prototype.getUserMediaPrivate=function(e,t,a){var s=this;this.waitUntilConnected("NavigatorUserMedia.getUserMediaPrivate").then(function(){var t=s.registerCallbacks(!0,!1,n.method_id_NavigatorUserMedia_t.getUserMedia);if(e&&void 0!==e.audio&&0==Object.keys(e.audio).length&&(e.audio={dummy:1}),e&&void 0!==e.video){var r=e.video;void 0==r.mandatory.maxFrameRate&&(r.mandatory.maxFrameRate=30),void 0==r.mandatory.minWidth&&(r.mandatory.minWidth=360),void 0==r.mandatory.maxWidth&&(r.mandatory.maxWidth=1920),void 0==r.mandatory.minHeight&&(r.mandatory.minHeight=180),void 0==r.mandatory.maxHeight&&(r.mandatory.maxHeight=1080)}return s.remoteInvoke(!1,n.method_id_NavigatorUserMedia_t.getUserMedia,e,t.success,t.fail),t.prom()}).then(function(e){return i.logger.log(s.user_friendly_id()+".getUserMediaPrivate: received success callback!"),new g(null,s.param0(e).oid,r.ProxyMode.Remote).syncBarrier()}).then(function(n){i.logger.log(s.user_friendly_id()+".getUserMediaPrivate: MediaStream ready to deliver",JSON.stringify(n)),0==n.getTracks().length?(i.logger.log(s.user_friendly_id()+".getUserMediaPrivate: reporting no tracks as error."),a({constraintName:"",name:"OverconstrainedError",message:""})):(s.LogTelemetryDevice_(e),t(n))}).catch(function(e){s.logRemoteInvokeError(e,".getUserMediaPrivate() failed!"),a(o.getRedirector().getFeatureValue(n.FEATURE_ms_teams_1912)?s.param0&&e?s.param0(e):{constraintName:"",name:"OverconstrainedError",message:""}:{constraintName:"",name:"OverconstrainedError",message:""})})},t.prototype.SendTelemetryData=function(e,t,n){o.getRedirector().telemetry.SendTelemetryData(a.tel_cmd.Data,e,t,n)},t.caps_={},t}(r.ProxyObject),t.NavigatorUserMedia=e}),define("icecandidate",["require","exports","proxyobject","webrpcclassinfo","logger"],function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),e=function(e){function t(t,n,i){for(var o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return e.apply(this,[t,r.class_id_t.RTCIceCandidate,n,i,null].concat(o))||this}return __extends(t,e),Object.defineProperty(t.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sdpMid",{get:function(){return this.sdpMid_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sdpMLineIndex",{get:function(){return this.sdpMLineIndex_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected("IceCandidate.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,r.method_id_RTCIceCandidate_t.candidate,""),e.remoteInvoke(!1,r.method_id_RTCIceCandidate_t.sdpMid,""),e.remoteInvoke(!1,r.method_id_RTCIceCandidate_t.sdpMLineIndex,0)])}).then(function(n){n=n.map(function(t){return e.param0(t)}),e.candidate_=n[0],e.sdpMid_=n[1],e.sdpMLineIndex_=n[2],t(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier failed!"),n(t)})})},t}(n.ProxyObject),t.IceCandidate=e,e=function(e){function t(t,i){return e.call(this,t,r.class_id_t.RTCIceCandidatePair,i,n.ProxyMode.Remote)||this}return __extends(t,e),Object.defineProperty(t.prototype,"local",{get:function(){return this.local_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remote",{get:function(){return this.remote_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected("IceCandidatePair.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,r.method_id_RTCIceCandidatePair_t.local,{}),e.remoteInvoke(!1,r.method_id_RTCIceCandidatePair_t.remote,{})])}).then(function(n){n=n.map(function(t){return e.param0(t)}),e.local_=n[0],e.remote_=n[1],t(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier failed!"),n(t)})})},t}(n.ProxyObject),t.IceCandidatePair=e}),define("stats",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.items=[]}return e.fromJSON=function(t){for(var n=new e,i=0;i<t.length;i++){var o=r.fromJSON(t[i]);n.items.push(o)}return n},e.toRTCStatsReport=function(e){return e},e.prototype.toJSON=function(){return JSON.stringify(this.items)},e.prototype.result=function(){return this.items},e}();t.StatsReport=n;var r=function(){function e(){this.names_=[],this.stat_=new Map,this.id="",this.timestamp=0,this.type=""}return e.fromJSON=function(t){var n=new e;return n.id=t.id||"",n.timestamp=t.timestamp||"",n.type=t.type||"",Object.keys(t).forEach(function(e){"id"!==e&&"timestamp"!==e&&"type"!==e&&(n.names_.push(e),n.stat_.set(e,t[e]))}),n},e.prototype.toJSON=function(){return JSON.stringify({id:this.id,timestamp:this.timestamp,type:this.type,stat:this.stat_})},e.prototype.names=function(){return this.names_},e.prototype.stat=function(e){return this.stat_.get(e)},e}();t.Stats=r}),define("rtpsender","require exports proxyobject webrpcclassinfo logger remotemedia stats remotesession".split(" "),function(e,t,n,r,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t,o){var a=e.call(this,t,r.class_id_t.RTCDTMFToneChangeEvent,o,n.ProxyMode.Remote)||this;return i.logger.log(a.user_friendly_id()+".constructor"),a}return __extends(t,e),t.prototype.syncBarrier=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n=this;return __generator(this,function(o){switch(o.label){case 0:return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),[4,this.waitUntilConnected("DTMFToneChangeEvent.syncBarrier")];case 1:return o.sent(),[4,Promise.all([this.remoteInvoke(!1,r.method_id_RTCDTMFToneChangeEvent_t.tone,""),this.remoteInvoke(!1,r.method_id_RTCDTMFToneChangeEvent_t.tone_buffer,"")])];case 2:return t=o.sent(),e=t.map(function(e){return n.param0(e)}),this.tone=e[0],this.tone_buffer_=e[1],[2,this]}})})},Object.defineProperty(t.prototype,"tone_buffer",{get:function(){return this.tone_buffer_},enumerable:!0,configurable:!0}),t}(n.ProxyObject);t.DTMFToneChangeEvent=c;var d=function(e){function t(t,o){var a=e.call(this,t,r.class_id_t.RTCDTMFSender,o,n.ProxyMode.Remote)||this;return i.logger.log(a.user_friendly_id()+".constructor"),a.canInsertDTMF=!0,a.toneBuffer_="",a}return __extends(t,e),t.prototype.insertDTMF=function(e,t,n){var o=this;void 0===t&&(t=100),void 0===n&&(n=70),i.logger.log(this.user_friendly_id()+".insertDTMF() called, tones: "+e),this.waitUntilConnected("DtmfSender.insertDTMF").then(function(){return o.remoteInvoke(!1,r.method_id_RTCDTMFSender_t.insertDTMF,e,t,n)}).then(function(){i.logger.log(o.user_friendly_id()+".insertDTMF() success, tones: "+e)}).catch(function(e){o.logRemoteInvokeError(e,".insertDTMF() failed!")})},Object.defineProperty(t.prototype,"ontonechange",{get:function(){return this.ontonechange_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_ontonechange() called."),this.ontonechange_=e,this.waitUntilConnected("DtmfSender.ontonechange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCDTMFSender_t.ontonechange);return n.then(function(e){i.logger.log(t.user_friendly_id()+".ontonechange callback received!"),new c(t,t.param0(e).oid).syncBarrier().then(function(e){i.logger.log(t.user_friendly_id()+"tone: "+e.tone+" tone_buffer: "+e.tone_buffer),t.toneBuffer_=e.tone_buffer,t.ontonechange_(e)}).catch(function(e){t.logRemoteInvokeError(e,".toneEvt.syncBarrier() failed!")})}),t.remoteInvoke(!0,r.method_id_RTCDTMFSender_t.ontonechange,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_ontonechange() failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toneBuffer",{get:function(){return i.logger.log(this.user_friendly_id()+".toneBuffer() called."),this.toneBuffer_},enumerable:!0,configurable:!0}),t}(n.ProxyObject);t.DtmfSender=d;var l=function(e){function t(t,o){var a=e.call(this,t,r.class_id_t.RTCIceTransport,o,n.ProxyMode.Remote)||this;return i.logger.log(a.user_friendly_id()+".constructor"),a.selectedPair=null,a.localCandidates_=[],a.remoteCandidates_=[],a}return __extends(t,e),t.prototype.syncBarrier=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(n,o){e.waitUntilConnected("IceTransport.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,r.method_id_RTCIceTransport_t.role,0),e.remoteInvoke(!1,r.method_id_RTCIceTransport_t.component,0),e.remoteInvoke(!1,r.method_id_RTCIceTransport_t.state,0),e.remoteInvoke(!1,r.method_id_RTCIceTransport_t.gatheringState,0)])}).then(function(r){i.logger.log(e.user_friendly_id()+".syncBarrier success.");var o=0,a=0;r=r.map(function(t){return e.param0(t)}),e.role_=r[0],e.component_=r[1],o=r[2],a=r[3],e.state_=t.convertState(o),e.gatheringState_=t.convertGatheringState(a),n(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),o(t)})})},t.prototype.syncCandidates=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncCandidates() called."),new Promise(function(t,n){e.waitUntilConnected("IceTransport.syncCandidates").then(function(){return Promise.all([e.remoteInvoke(!1,r.method_id_RTCIceTransport_t.localcandidates,[]),e.remoteInvoke(!1,r.method_id_RTCIceTransport_t.remotecandidates,[])])}).then(function(n){i.logger.log(e.user_friendly_id()+".syncCandidates success."),n=n.map(function(t){return e.param0(t)}),e.localCandidates_=n[0],e.remoteCandidates_=n[1],t(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncCandidates() failed!"),n(t)})})},Object.defineProperty(t.prototype,"role",{get:function(){return this.role_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){return this.component_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"State",{get:function(){return this.state_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gatheringState",{get:function(){return this.gatheringState_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onstatechange",{get:function(){return this.onstatechange_},set:function(e){var n=this;i.logger.log(this.user_friendly_id()+".set_onstatechange() called."),this.onstatechange_=e,this.waitUntilConnected("IceTransport.onstatechange").then(function(){var o=n.registerCallbacks(!1,n.isNullCallback(e),r.method_id_RTCIceTransport_t.onstatechange);return o.then(function(e){i.logger.log(n.user_friendly_id()+".onstatechange callback received!"),n.syncCandidates().then(function(e){i.logger.log(n.user_friendly_id()+"received updated ice candidates!")}),n.state_=t.convertState(n.param0(e)),i.logger.log(n.user_friendly_id()+"state: "+n.state_),n.onstatechange_()}),n.remoteInvoke(!0,r.method_id_RTCIceTransport_t.onstatechange,o.success)}).catch(function(e){n.logRemoteInvokeError(e,".set_onstatechange failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ongatheringstatechange",{get:function(){return this.ongatheringstatechange_},set:function(e){var n=this;i.logger.log(this.user_friendly_id()+".set_ongatheringstatechange() called."),this.ongatheringstatechange_=e,this.waitUntilConnected("IceTransport.ongatheringstatechange").then(function(){var o=n.registerCallbacks(!1,n.isNullCallback(e),r.method_id_RTCIceTransport_t.ongatheringstatechange);return o.then(function(e){i.logger.log(n.user_friendly_id()+".ongatheringstatechange callback received!"),n.syncCandidates().then(function(e){i.logger.log(n.user_friendly_id()+"received updated ice candidates!")}),n.gatheringState_=t.convertGatheringState(n.param0(e)),i.logger.log(n.user_friendly_id()+"gatheringState: "+n.gatheringState_),n.ongatheringstatechange_()}),n.remoteInvoke(!0,r.method_id_RTCIceTransport_t.ongatheringstatechange,o.success)}).catch(function(e){n.logRemoteInvokeError(e,".set_ongatheringstatechange failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onselectedcandidatepairchange",{get:function(){return this.onselectedcandidatepairchange_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_onselectedcandidatepairchange() called."),this.onselectedcandidatepairchange_=e,this.waitUntilConnected("IceTransport.onselectedcandidatepairchange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCIceTransport_t.onselectedcandidatepairchange);return n.then(function(e){i.logger.log(t.user_friendly_id()+".onselectedcandidatepairchange callback received!"),t.syncCandidates().then(function(e){i.logger.log(t.user_friendly_id()+"received updated ice candidates!")}),t.selectedPair=t.param0(e),i.logger.log(t.user_friendly_id()+"selectedPair: "+t.selectedPair),t.onselectedcandidatepairchange_()}),t.remoteInvoke(!0,r.method_id_RTCIceTransport_t.onselectedcandidatepairchange,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onselectedcandidatepairchange failed!")})},enumerable:!0,configurable:!0}),t.prototype.getLocalCandidates=function(){return this.localCandidates_},t.prototype.getRemoteCandidates=function(){return this.remoteCandidates_},t.prototype.getLocalParameters=function(){return null},t.prototype.getRemoteParameters=function(){return null},t.prototype.getSelectedCandidatePair=function(){return this.selectedPair},t.convertState=function(e){return 0==e?"new":1==e?"checking":2==e?"connected":3==e?"completed":4==e?"failed":5==e?"disconnected":"closed"},t.convertGatheringState=function(e){return 0==e?"new":1==e?"gathering":"complete"},t}(n.ProxyObject);t.IceTransport=l;var u;!function(e){e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.closed=3]="closed",e[e.failed=4]="failed",e[e.max=5]="max"}(u||(u={}));var _=function(e){function t(t,o){var a=e.call(this,t,r.class_id_t.RTCDtlsTransport,o,n.ProxyMode.Remote)||this;return i.logger.log(a.user_friendly_id()+".constructor"),a.state_="new",a.transport_=null,a.remoteCertificates_=[],a}return __extends(t,e),t.prototype.dumpInfo=function(){i.logger.log("DtlsTransport["+this.object_id()+"].dumpInfo():"),i.logger.log("    - state:"+this.state_),i.logger.log("    - transport:"+this.transport_)},t.prototype.syncBarrier=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(n,o){e.waitUntilConnected("DtlsTransport.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,r.method_id_RTCDtlsTransport_t.transport,{}),e.remoteInvoke(!1,r.method_id_RTCDtlsTransport_t.state,0),e.remoteInvoke(!1,r.method_id_RTCDtlsTransport_t.getRemoteCertificates,[])])}).then(function(r){var a;i.logger.log(e.user_friendly_id()+".syncBarrier remote success.");var s;r=(a=r.map(function(t){return e.param0(t)}))[0],s=a[1],e.remoteCertificates_=a[2],e.state_=t.convertState(s),a=[],void 0==r||0!=r.is_null||null!==e.transport_&&e.transport_.object_id()==r.oid||(e.transport_=new l(e,r.oid),a.push(e.transport_.syncBarrier())),Promise.all(a).then(function(){i.logger.log(e.user_friendly_id()+".syncBarrier success"),n(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".prop.syncBarrier failed!"),o(t)})}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier failed!"),o(t)})})},Object.defineProperty(t.prototype,"transport",{get:function(){return this.transport_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return i.logger.log(this.user_friendly_id()+".get_state() called: "+this.state_),this.state_},enumerable:!0,configurable:!0}),t.prototype.getRemoteCertificates=function(){return this.remoteCertificates_},Object.defineProperty(t.prototype,"onstatechange",{get:function(){return this.onstatechange_},set:function(e){var n=this;i.logger.log(this.user_friendly_id()+".set_onstatechange() called."),this.onstatechange_=e,this.waitUntilConnected("DtlsTransport.onstatechange").then(function(){var o=n.registerCallbacks(!1,n.isNullCallback(e),r.method_id_RTCDtlsTransport_t.onstatechange);return o.then(function(e){i.logger.log(n.user_friendly_id()+".onstatechange callback received!"),n.state_=t.convertState(n.param0(e)),i.logger.log(n.user_friendly_id()+"state_: "+n.state_),n.onstatechange_()}),n.remoteInvoke(!0,r.method_id_RTCDtlsTransport_t.onstatechange,o.success)}).catch(function(e){n.logRemoteInvokeError(e,".set_onstatechange failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onerror",{get:function(){return this.onerror_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_onerror() called."),this.onerror_=e,this.waitUntilConnected("DtlsTransport.onerror").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCDtlsTransport_t.onerror);return n.then(function(e){i.logger.log(t.user_friendly_id()+".onerror callback received!"),e=t.param0(e),i.logger.log(t.user_friendly_id()+"error: "+e),t.onerror_(e)}),t.remoteInvoke(!0,r.method_id_RTCDtlsTransport_t.onerror,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onerror failed!")})},enumerable:!0,configurable:!0}),t.convertState=function(e){return e==u.new?"new":e==u.connecting?"connecting":e==u.connected?"connected":e==u.closed?"closed":"failed"},t}(n.ProxyObject);t.DtlsTransport=_,e=function(e){function t(t,n,r,o){return t=e.call(this,t,n,r,o)||this,i.logger.log(t.user_friendly_id()+".constructor base"),t.track_=null,t.transport_=null,t.rtcpTransport_=null,t}return __extends(t,e),t.prototype.syncBarrierBase=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncBarrierBase() called."),new Promise(function(t,n){var a,c,d;e instanceof g?(a=r.method_id_RTCRtpSender_t.track,c=r.method_id_RTCRtpSender_t.transport,d=r.method_id_RTCRtpSender_t.rtcpTransport):e instanceof h&&(a=r.method_id_RTCRtpReceiver_t.track,c=r.method_id_RTCRtpReceiver_t.transport,d=r.method_id_RTCRtpReceiver_t.rtcpTransport),e.waitUntilConnected("RtpSenderReceiver.syncBarrierBase").then(function(){return s.RemoteSession.isFeaturePstnSupported()&&s.RemoteSession.isFeatureDtmfSupported()?Promise.all([e.remoteInvoke(!1,a,{oid:e.object_id()}),e.remoteInvoke(!1,c,{oid:e.object_id()}),e.remoteInvoke(!1,d,{oid:e.object_id()})]):Promise.all([e.remoteInvoke(!1,a,{oid:e.object_id()})])}).then(function(r){var a;i.logger.log(e.user_friendly_id()+".syncBarrierBase remote success.");var s;r=(a=r.map(function(t){return e.param0(t)}))[0],s=a[1],a=a[2];var c=[];void 0!=r&&!1===r.is_null&&(null===e.track_||e.track_.object_id()!=r.oid?e.track_=new o.RemoteMediaTrack(e,r.oid):e.track_.bind(e,r.oid),c.push(e.track.syncBarrier())),void 0==s||!1!==s.is_null||null!==e.transport_&&e.transport_.object_id()==s.oid||(e.transport_=new _(e,s.oid),c.push(e.transport_.syncBarrier())),void 0==a||!1!==a.is_null||null!==e.rtcpTransport_&&e.rtcpTransport_.object_id()==a.oid||(e.rtcpTransport_=new _(e,a.oid),c.push(e.rtcpTransport_.syncBarrier())),Promise.all(c).then(function(){i.logger.log(e.user_friendly_id()+".prop.syncBarrierBase success"),t(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".prop.syncBarrierBase failed!"),n(t)})}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrierBase() failed!"),n(t)})})},Object.defineProperty(t.prototype,"transport",{get:function(){return i.logger.log(this.user_friendly_id()+".get transport() called."),this.transport_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rtcpTransport",{get:function(){return i.logger.log(this.user_friendly_id()+".get rtcpTransport() called."),this.rtcpTransport_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"track",{get:function(){return this.track_},enumerable:!0,configurable:!0}),t.prototype.reinitTrack=function(e){this.track_=e},t.prototype.getStats=function(){i.logger.log(this.user_friendly_id()+".getStats() called.");var e=this;return new Promise(function(t,n){var o=this;e.isRedirected()?e.waitUntilConnected("RtpReceiver.getStats").then(function(){var n;o instanceof g?n=r.method_id_RTCRtpSender_t.getStats:o instanceof h&&(n=r.method_id_RTCRtpReceiver_t.getStats);var i=e.registerCallbacks(!0,!1,n);return i.then(function(e){void 0!==e.params&&0!==e.params.length&&t(a.StatsReport.fromJSON(JSON.parse(e.params[0])))}),e.remoteInvoke(!1,n,i.success)}).catch(function(e){e=o.logRemoteInvokeError(e,".getStats() failed!"),n(e)}):(i.logger.log(e.user_friendly_id()+".getStats(): not in active redirection!"),t())})},t}(n.ProxyObject),t.RtpSenderReceiver=e;var g=function(e){function t(t,n,o,a){return t=e.call(this,t,r.class_id_t.RTCRtpSender,n,o)||this,i.logger.log(t.user_friendly_id()+".constructor"),t.dtmf_=null,t.params_=null,t.unified_=a,t}return __extends(t,e),t.prototype.dumpInfo=function(){i.logger.log("RtpSender["+this.object_id()+"].dumpInfo():"),this.track&&this.track.dumpInfo()},t.prototype.syncBarrier=function(){var t=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(n,o){t.waitUntilConnected("RtpSender.syncBarrier").then(function(){return e.prototype.syncBarrierBase.call(t)}).then(function(){return i.logger.log(t.user_friendly_id()+".syncBarrierBase success."),s.RemoteSession.isFeaturePstnSupported()&&s.RemoteSession.isFeatureDtmfSupported()?Promise.all([t.remoteInvoke(!1,r.method_id_RTCRtpSender_t.dtmf,{oid:t.object_id()}),t.remoteInvoke(!1,r.method_id_RTCRtpSender_t.getParameters,{oid:t.object_id()})]):Promise.all([])}).then(function(e){i.logger.log(t.user_friendly_id()+".syncBarrier success.");var r;r=(e=e.map(function(e){return t.param0(e)}))[0],t.params_=e[1],void 0==r||!1!==r.is_null||null!==t.dtmf_&&t.dtmf_.object_id()==r.oid||(t.dtmf_=new d(t,r.oid)),n(t)}).catch(function(e){e=t.logRemoteInvokeError(e,".syncBarrier failed!"),o(e)})})},t.getCapabilities=function(e){return i.logger.log(this.constructor.name+".getCapabilities() called."),o.NavigatorUserMedia.getCapabilities(e)},Object.defineProperty(t.prototype,"dtmf",{get:function(){return i.logger.log(this.user_friendly_id()+".get dtmf() called."),this.dtmf_},enumerable:!0,configurable:!0}),t.prototype.setParameters=function(e){var t=this;return i.logger.log(this.user_friendly_id()+".setParameters() called."),new Promise(function(n,o){t.waitUntilConnected("RtpSender.setParameters").then(function(){return Promise.all([t.remoteInvoke(!1,r.method_id_RTCRtpSender_t.setParameters,e)])}).then(function(r){i.logger.log(t.user_friendly_id()+".setParameters(): success."),n(),t.params_=e}).catch(function(e){e=t.logRemoteInvokeError(e,".setParameters() failed!"),o(e)})})},t.prototype.getParameters=function(){var e=this;return i.logger.log(this.user_friendly_id()+".getParameters() called."),this.waitUntilConnected(this.user_friendly_id()+".getParameters").then(function(){return i.logger.log(e.user_friendly_id()+".getParameters() remote invoking"),e.remoteInvoke(!1,r.method_id_RTCRtpSender_t.getParameters,{oid:e.object_id()})}).then(function(t){i.logger.log(e.user_friendly_id()+".getParameters() success"),e.params_=e.param0(t)}).catch(function(t){e.logRemoteInvokeError(t,".getParameters() failed!")}),i.logger.log(this.user_friendly_id()+".getParameters() returning: "+this.params_),this.params_},t.prototype.replaceTrack=function(e){var t=this;return i.logger.log(this.user_friendly_id()+".replaceTrack() called. track_:"+this.track_+", withTrack:"+e),new Promise(function(n,o){t.waitUntilConnected("RtpSender.replaceTrack").then(function(){return e?Promise.all([t.remoteInvoke(!1,r.method_id_RTCRtpSender_t.replaceTrack,{oid:e.object_id()})]):t.unified_?Promise.all([t.remoteInvoke(!1,r.method_id_RTCRtpSender_t.replaceTrack,{oid:0})]):(i.logger.log(t.user_friendly_id()+".replaceTrack(): failed with null track!"),void o())}).then(function(r){i.logger.log(t.user_friendly_id()+".replaceTrack(): success."),n(),t.reinitTrack(e)}).catch(function(e){e=t.logRemoteInvokeError(e,".replaceTrack() failed!"),o(e)})})},t}(e);t.RtpSender=g;var h=function(e){function t(t,n,o,a,s){return t=e.call(this,t,r.class_id_t.RTCRtpReceiver,n,o)||this,i.logger.log(t.user_friendly_id()+".constructor"),t.contribsources_=[],t.syncsources_=[],t.params_=null,t.unified_=a,s&&(t.track_=s),t}return __extends(t,e),t.prototype.dumpInfo=function(){i.logger.log("RtpReceiver["+this.object_id()+"].dumpInfo():"),this.track&&this.track.dumpInfo(),this.transport&&this.transport.dumpInfo()},t.prototype.syncBarrier=function(){var t=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(n,o){t.waitUntilConnected("RtpReceiver.syncBarrier").then(function(){return e.prototype.syncBarrierBase.call(t)}).then(function(){return i.logger.log(t.user_friendly_id()+".syncBarrierBase success."),s.RemoteSession.isFeaturePstnSupported()&&s.RemoteSession.isFeatureDtmfSupported()?Promise.all([t.remoteInvoke(!1,r.method_id_RTCRtpReceiver_t.getContributingSources,[]),t.remoteInvoke(!1,r.method_id_RTCRtpReceiver_t.getSynchronizationSources,[]),t.remoteInvoke(!1,r.method_id_RTCRtpReceiver_t.getParameters,{oid:t.object_id()})]):Promise.all([t.remoteInvoke(!1,r.method_id_RTCRtpReceiver_t.getContributingSources,[])])}).then(function(e){i.logger.log(t.user_friendly_id()+".syncBarrier success."),e=e.map(function(e){return t.param0(e)}),t.contribsources_=e[0],t.syncsources_=e[1],t.params_=e[2],n(t)}).catch(function(e){e=t.logRemoteInvokeError(e,".syncBarrier() failed!"),o(e)})})},t.getCapabilities=function(e){return i.logger.log(this.constructor.name+".getCapabilities() called."),o.NavigatorUserMedia.getCapabilities(e)},t.prototype.getContributingSources=function(){var e=this;return i.logger.log(this.user_friendly_id()+".getContributingSources() called. "+JSON.stringify(this.contribsources_)),this.waitUntilConnected("RtpReceiver.getContributingSources").then(function(){return Promise.all([e.remoteInvoke(!1,r.method_id_RTCRtpReceiver_t.getContributingSources,[])])}).then(function(t){e.contribsources_=t.map(function(t){return e.param0(t)})[0],i.logger.log(e.user_friendly_id(),".getContributingSources() success: "+JSON.stringify(e.contribsources_))}).catch(function(t){e.logRemoteInvokeError(t,".getContributingSources() failed!"),e.contribsources_=[]}),this.contribsources_},t.prototype.getParameters=function(){return i.logger.log(this.user_friendly_id()+".getParameters() called."),this.params_},t.prototype.getSynchronizationSources=function(){return i.logger.log(this.user_friendly_id()+".getSynchronizationSources() called."),this.syncsources_},t}(e);t.RtpReceiver=h}),define("map",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("rtptransceiver","require exports proxyobject webrpcclassinfo logger rtpsender".split(" "),function(e,t,n,r,i,o){Object.defineProperty(t,"__esModule",{value:!0}),e=function(){function e(){this.direction="sendrecv",this.sendEncodings=[],this.streams=[],i.logger.log(this.user_friendly_id()+".constructor")}return e.prototype.user_friendly_id=function(){return this.constructor.name},e}(),t.RtpTransceiverInit=e;var a;!function(e){e[e.kSendRecv=0]="kSendRecv",e[e.kSendOnly=1]="kSendOnly",e[e.kRecvOnly=2]="kRecvOnly",e[e.kInactive=3]="kInactive"}(a||(a={})),e=function(e){function t(t,s,c,d,l,u){return t=e.call(this,t,r.class_id_t.RTCRtpTransceiver,s,c)||this,i.logger.log(t.user_friendly_id()+".constructor"),t.unified_=d,t.sender_=new o.RtpSender(t,0,n.ProxyMode.Pseudo,d),t.receiver_=u||new o.RtpReceiver(t,0,n.ProxyMode.Pseudo,d),l?(t.direction_=t.toRtpTransceiverDirection(l),t.currentDirection_=t.toRtpTransceiverDirection(l)):(t.direction_=a.kSendRecv,t.currentDirection_=a.kSendRecv),t}return __extends(t,e),t.prototype.dumpInfo=function(){i.logger.log(this.user_friendly_id()+".dumpInfo() [id="+this.mid+"] direction="+this.toRTCRtpTransceiverDirection(this.direction_)," currentDirection="+this.toRTCRtpTransceiverDirection(this.currentDirection_)),this.sender&&this.sender.dumpInfo(),this.receiver&&this.receiver.dumpInfo()},t.prototype.syncBarrier=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected("RtpTransceiver.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,r.method_id_RTCRtpTransceiver_t.mid,{oid:e.object_id()}),e.remoteInvoke(!1,r.method_id_RTCRtpTransceiver_t.direction,{oid:e.object_id()}),e.remoteInvoke(!1,r.method_id_RTCRtpTransceiver_t.currentDirection,{oid:e.object_id()}),e.remoteInvoke(!1,r.method_id_RTCRtpTransceiver_t.sender,{oid:e.object_id()}),e.remoteInvoke(!1,r.method_id_RTCRtpTransceiver_t.receiver,{oid:e.object_id()})])}).then(function(n){var r;i.logger.log(e.user_friendly_id()+".syncBarrier remote success."),r=n.map(function(t){return e.param0(t)}),e.mid_=r[0],e.direction_=r[1],e.currentDirection_=r[2],n=r[3],r=r[4];var o=[];if(void 0!=n&&!1===n.is_null&&(e.sender_.bind(e,n.oid),o.push(e.sender_.syncBarrier())),void 0!=r&&!1===r.is_null&&(e.receiver_.bind(e,r.oid),o.push(e.receiver_.syncBarrier())),0!=o.length)return i.logger.log(e.user_friendly_id()+".prop.syncBarrier start"),Promise.all(o);i.logger.log(e.user_friendly_id()+".syncBarrier success"),t(e)}).then(function(){i.logger.log(e.user_friendly_id()+".syncBarrier success"),t(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),n(t)})})},Object.defineProperty(t.prototype,"mid",{get:function(){return i.logger.log(this.user_friendly_id()+".get_mid() called: "+this.mid_),this.mid_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sender",{get:function(){return this.sender_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"receiver",{get:function(){return this.receiver_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return i.logger.log(this.user_friendly_id()+".get_direction() called. "+this.toRTCRtpTransceiverDirection(this.direction_)),this.toRTCRtpTransceiverDirection(this.direction_)},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_direction() called. "+e),this.direction_=this.toRtpTransceiverDirection(e),this.waitUntilConnected("RtpTransceiver.set_direction").then(function(){return t.remoteInvoke(!0,r.method_id_RTCRtpTransceiver_t.direction,t.toRtpTransceiverDirection(e))}).then(function(){i.logger.log(t.user_friendly_id()+".set_direction: success.")}).catch(function(e){t.logRemoteInvokeError(e,".set_direction() failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentDirection",{get:function(){return i.logger.log(this.user_friendly_id()+".get_currentDirection() called. "+this.toRTCRtpTransceiverDirection(this.direction_)),this.toRTCRtpTransceiverDirection(this.currentDirection_)},enumerable:!0,configurable:!0}),t.prototype.stop=function(){var e=this;i.logger.log(this.user_friendly_id()+".stop() called."),this.waitUntilConnected("RtpTransceiver.stop").then(function(){return e.remoteInvoke(!0,r.method_id_RTCRtpTransceiver_t.stop)}).then(function(){i.logger.log(e.user_friendly_id()+".stop: success.")}).catch(function(t){e.logRemoteInvokeError(t,".stop() failed!")})},t.prototype.setCodecPreferences=function(e){var t=this;i.logger.log(this.user_friendly_id()+".setCodecPreferences() called."),this.waitUntilConnected("RtpTransceiver.setCodecPreferences").then(function(){return t.remoteInvoke(!0,r.method_id_RTCRtpTransceiver_t.setCodecPreferences,e)}).then(function(){i.logger.log(t.user_friendly_id()+".setCodecPreferences: success.")}).catch(function(e){t.logRemoteInvokeError(e,".setCodecPreferences() failed!")})},t.prototype.toRtpTransceiverDirection=function(e){var t=a.kSendRecv;switch(e){case"inactive":t=a.kInactive;break;case"recvonly":t=a.kRecvOnly;break;case"sendonly":t=a.kSendOnly;break;case"sendrecv":t=a.kSendRecv;break;default:t=a.kInactive}return t},t.prototype.toRTCRtpTransceiverDirection=function(e){var t="sendrecv";switch(e){default:t="inactive";break;case a.kRecvOnly:t="recvonly";break;case a.kSendOnly:t="sendonly";break;case a.kSendRecv:t="sendrecv"}return t},t}(n.ProxyObject),t.RtpTransceiver=e}),define("rtcdatachannel","require exports proxyobject webrpcclassinfo logger rtpsender".split(" "),function(e,t,n,r,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a;!function(e){e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.closed=3]="closed",e[e.max=4]="max"}(a||(a={})),e=function(e){function t(t,o){var a=e.call(this,t,r.class_id_t.RTCSctpTransport,o,n.ProxyMode.Remote)||this;return i.logger.log(a.user_friendly_id()+".constructor"),a}return __extends(t,e),t.prototype.syncBarrier=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected("RTCSctpTransport.syncBarrier").then(function(){return i.logger.log(e.user_friendly_id()+".syncBarrierBase success."),Promise.all([e.remoteInvoke(!1,r.method_id_RTCSctpTransport_t.transport,{}),e.remoteInvoke(!1,r.method_id_RTCSctpTransport_t.state,""),e.remoteInvoke(!1,r.method_id_RTCSctpTransport_t.maxMessageSize,0),e.remoteInvoke(!1,r.method_id_RTCSctpTransport_t.maxChannels,0)])}).then(function(n){var r;n=(r=n.map(function(t){return e.param0(t)}))[0],e.sctpstate_=r[1],e.maxMessageSize_=r[2],e.maxChannels_=r[3],r=e.transport_,void 0==n||!1!==n.is_null||null!==e.transport_&&e.transport_.object_id()==n.oid||(r=new o.DtlsTransport(e,n.oid)),r.syncBarrier().then(function(n){i.logger.log(e.user_friendly_id()+"transport.syncBarrier(): success"),e.transport_=n,t(e)}).catch(function(){i.logger.log(e.user_friendly_id()+"transport.syncBarrier(): failed!"),e.transport_=null,t(e)})}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),n(t)})})},Object.defineProperty(t.prototype,"transport",{get:function(){return i.logger.log(this.user_friendly_id()+".get_transport() called: "+this.transport_),this.transport_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return i.logger.log(this.user_friendly_id()+".get_state() called: "+this.sctpstate_),this.sctpstate_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxMessageSize",{get:function(){return i.logger.log(this.user_friendly_id()+".get_maxMessageSize() called: "+this.maxMessageSize_),this.maxMessageSize_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxChannels",{get:function(){return i.logger.log(this.user_friendly_id()+".get_maxChannels() called: "+this.maxChannels_),this.maxChannels_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onstatechange",{get:function(){return i.logger.log(this.user_friendly_id()+".get_onstatechange() called: "+this.onstatechange_),this.onstatechange_},set:function(e){var n=this;i.logger.log(this.user_friendly_id()+".set_onstatechange() called."),this.onstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".onstatechange").then(function(){var o=n.registerCallbacks(!1,n.isNullCallback(e),r.method_id_RTCSctpTransport_t.onstatechange);return o.then(function(e){i.logger.log(n.user_friendly_id()+".onstatechange callback received!!!"),n.sctpstate_=t.convertState(n.param0(e)),i.logger.log(n.user_friendly_id()+"sctpstate_: "+n.sctpstate_),e=new Event("onstatechange"),n.onstatechange_(e)}),n.remoteInvoke(!0,r.method_id_RTCSctpTransport_t.onstatechange,o.success)}).catch(function(){i.logger.log(n.user_friendly_id()+".onstatechange() failed.")})},enumerable:!0,configurable:!0}),t.convertState=function(e){return e==a.new?"closed":e==a.connecting?"connecting":e==a.connected?"connected":"closed"},t}(n.ProxyObject),t.RTCSctpTransport=e;var s;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(s||(s={})),e=function(e){function t(t,n,o){return t=e.call(this,t,r.class_id_t.RTCDataChannel,n,o)||this,t.binaryType_="blob",i.logger.log(t.user_friendly_id()+".constructor"),t}return __extends(t,e),t.prototype.syncBarrier=function(){var e=this;return i.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected("RtcDataChannel.syncBarrier").then(function(){return i.logger.log(e.user_friendly_id()+".syncBarrier remote invoking."),Promise.all([e.remoteInvoke(!1,r.method_id_RTCDataChannel_t.label,""),e.remoteInvoke(!1,r.method_id_RTCDataChannel_t.ordered,!0),e.remoteInvoke(!1,r.method_id_RTCDataChannel_t.maxPacketLifeTime,0),e.remoteInvoke(!1,r.method_id_RTCDataChannel_t.maxRetransmits,0),e.remoteInvoke(!1,r.method_id_RTCDataChannel_t.protocol,""),e.remoteInvoke(!1,r.method_id_RTCDataChannel_t.negotiated,!1),e.remoteInvoke(!1,r.method_id_RTCDataChannel_t.id,0),e.remoteInvoke(!1,r.method_id_RTCDataChannel_t.readyState,""),e.remoteInvoke(!1,r.method_id_RTCDataChannel_t.bufferedAmount,0),e.remoteInvoke(!1,r.method_id_RTCDataChannel_t.bufferedAmountLowThreshold,0)])}).then(function(n){i.logger.log(e.user_friendly_id()+".syncBarrier success.");var r;n=n.map(function(t){return e.param0(t)}),e.label_=n[0],e.ordered_=n[1],e.maxPacketLifeTime_=n[2],e.maxRetransmits_=n[3],e.protocol_=n[4],e.negotiated_=n[5],e.id_=n[6],r=n[7],e.bufferedAmount_=n[8],e.bufferedAmountLowThreshold_=n[9],e.readyState_=e.toRTCDataChannelState(r),t(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),n(t)})})},Object.defineProperty(t.prototype,"label",{get:function(){return i.logger.log(this.user_friendly_id()+".get_label() called: "+this.label_),this.label_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ordered",{get:function(){return i.logger.log(this.user_friendly_id()+".get_ordered() called: "+this.ordered_),this.ordered_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPacketLifeTime",{get:function(){return i.logger.log(this.user_friendly_id()+".get_maxPacketLifeTime() called: "+this.maxPacketLifeTime_),this.maxPacketLifeTime_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxRetransmits",{get:function(){return i.logger.log(this.user_friendly_id()+".get_maxRetransmits() called: "+this.maxRetransmits_),this.maxRetransmits_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return i.logger.log(this.user_friendly_id()+".get_protocol() called: "+this.protocol_),this.protocol_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"negotiated",{get:function(){return i.logger.log(this.user_friendly_id()+".get_negotiated() called: "+this.negotiated_),this.negotiated_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return i.logger.log(this.user_friendly_id()+".get_id() called: "+this.id_),this.id_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return i.logger.log(this.user_friendly_id()+".get_readyState() called: "+this.readyState_),this.readyState_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){return i.logger.log(this.user_friendly_id()+".get_bufferedAmount() called: "+this.bufferedAmount_),this.bufferedAmount_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmountLowThreshold",{get:function(){return i.logger.log(this.user_friendly_id()+".get_bufferedAmountLowThreshold() called: "+this.bufferedAmountLowThreshold_),this.bufferedAmountLowThreshold_},set:function(e){i.logger.log(this.user_friendly_id()+".get_bufferedAmountLowThreshold() called: "+e),this.bufferedAmountLowThreshold_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binaryType",{get:function(){return i.logger.log(this.user_friendly_id()+".get_binaryType() called: "+this.binaryType_),this.binaryType_},set:function(e){i.logger.log(this.user_friendly_id()+".set_binaryType() called: "+e),this.binaryType_="blob"==e||"arraybuffer"==e?e:"blob"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onopen",{get:function(){return i.logger.log(this.user_friendly_id()+".get_onopen() called."),this.onopen_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_onopen() called."),this.onopen_=e,this.waitUntilConnected(this.user_friendly_id()+".onopen").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCDataChannel_t.onopen);return n.then(function(e){i.logger.log(t.user_friendly_id()+".onopen callback received!!!"),t.syncBarrier().then(function(){i.logger.log(t.user_friendly_id()+".onopen notifying...");var e=new Event("open",{});Object.defineProperty(e,"target",{writable:!1,value:t}),t.onopen_(e)}).catch(function(){i.logger.log(t.user_friendly_id()+".syncBarrier(): failed!")})}),t.remoteInvoke(!0,r.method_id_RTCDataChannel_t.onopen,n.success)}).catch(function(){i.logger.log(t.user_friendly_id()+".onopen() failed.")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onbufferedamountlow",{get:function(){return i.logger.log(this.user_friendly_id()+".get_onbufferedamountlow() called."),this.onbufferedamountlow_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_onbufferedamountlow() called."),this.onbufferedamountlow_=e,this.waitUntilConnected(this.user_friendly_id()+".onbufferedamountlow").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCDataChannel_t.onbufferedamountlow);return n.then(function(e){i.logger.log(t.user_friendly_id()+".onbufferedamountlow callback received!!!"),e=new Event("onbufferedamountlow"),Object.defineProperty(e,"target",{writable:!1,value:t}),t.onbufferedamountlow_(e)}),t.remoteInvoke(!0,r.method_id_RTCDataChannel_t.onbufferedamountlow,n.success)}).catch(function(){i.logger.log(t.user_friendly_id()+".onbufferedamountlows() failed.")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onerror",{get:function(){return i.logger.log(this.user_friendly_id()+".get_onerror() called."),this.onerror_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_onerror() called."),this.onerror_=e,this.waitUntilConnected(this.user_friendly_id()+".onerror").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCDataChannel_t.onerror);return n.then(function(e){i.logger.log(t.user_friendly_id()+".onerror callback received!"),e=t.param0(e),i.logger.log(t.user_friendly_id()+"error: "+e),e=new Event("onerror"),Object.defineProperty(e,"target",{writable:!1,value:t}),t.onerror_(e)}),t.remoteInvoke(!0,r.method_id_RTCDataChannel_t.onerror,n.success)}).catch(function(){i.logger.log(t.user_friendly_id()+".onerror() failed.")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onclosing",{get:function(){return i.logger.log(this.user_friendly_id()+".get_onclosing() called."),this.onclosing_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_onclosing() called."),this.onclosing_=e,this.waitUntilConnected(this.user_friendly_id()+".onclosing").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCDataChannel_t.onclosing);return n.then(function(e){i.logger.log(t.user_friendly_id()+".onclosing callback received!!!"),e=new Event("onclosing"),Object.defineProperty(e,"target",{writable:!1,value:t}),t.onclosing_(e)}),t.remoteInvoke(!0,r.method_id_RTCDataChannel_t.onclosing,n.success)}).catch(function(){i.logger.log(t.user_friendly_id()+".onclosing() failed.")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onclose",{get:function(){return i.logger.log(this.user_friendly_id()+".get_onclose() called."),this.onclose_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_onclose() called."),this.onclose_=e,this.waitUntilConnected(this.user_friendly_id()+".onclose").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCDataChannel_t.onclose);return n.then(function(e){i.logger.log(t.user_friendly_id()+".onclose callback received!!!"),e=new Event("onclose"),Object.defineProperty(e,"target",{writable:!1,value:t}),t.onclose_(e)}),t.remoteInvoke(!0,r.method_id_RTCDataChannel_t.onclose,n.success)}).catch(function(){i.logger.log(t.user_friendly_id()+".onclose() failed.")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onmessage",{get:function(){return i.logger.log(this.user_friendly_id()+".get_onmessage() called."),this.onmessage_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".set_onmessage() called."),this.onmessage_=e,this.waitUntilConnected(this.user_friendly_id()+".onmessage").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCDataChannel_t.onmessage);return n.then(function(e){i.logger.log(t.user_friendly_id()+".onmessage callback received!!!");var n=t.param0(e);e=new Event("onmessage"),n.binary?e.data=n.data_ab:(n=atob(n.data_sz),e.data=n),t.onmessage_(e)}),t.remoteInvoke(!0,r.method_id_RTCDataChannel_t.onmessage,n.success)}).catch(function(){i.logger.log(t.user_friendly_id()+".onmessage() failed.")})},enumerable:!0,configurable:!0}),t.prototype.close=function(){var e=this;i.logger.log(this.user_friendly_id()+".close() called."),this.waitUntilConnected("RTCDataChannel.close").then(function(){return e.remoteInvoke(!1,r.method_id_RTCDataChannel_t.close)}).then(function(){i.logger.log(e.user_friendly_id()+".close: success.")}).catch(function(){i.logger.log(e.user_friendly_id()+".close: failed.")})},t.prototype.toByteArray=function(e){var t=[];e=new Uint8Array(e instanceof ArrayBuffer?e:e.buffer);for(var n in e)t.push(e[n]);return t},t.prototype.send=function(e){var t=this;i.logger.log(this.user_friendly_id()+".send() called."),this.waitUntilConnected("RTCDataChannel.send").then(function(){if("string"==typeof e)return i.logger.log(t.user_friendly_id()+"data(string): "+e),t.remoteInvoke(!1,r.method_id_RTCDataChannel_t.send_text,e);if(!(e instanceof Blob)){var n=t.toByteArray(e);return t.remoteInvoke(!1,r.method_id_RTCDataChannel_t.send_binary,n)}e.arrayBuffer().then(function(e){return e=t.toByteArray(e),t.remoteInvoke(!1,r.method_id_RTCDataChannel_t.send_binary,e)}).catch(function(){i.logger.log(t.user_friendly_id()+".arrayBuffer(): failed.")})}).then(function(){i.logger.log(t.user_friendly_id()+".send: success.")}).catch(function(){i.logger.log(t.user_friendly_id()+".send: failed.")})},t.prototype.toRTCDataChannelState=function(e){var t="closed";return e==s.connecting?t="connecting":e==s.open?t="open":e==s.closing?t="closing":e==s.closed&&(t="closed"),t},t}(n.ProxyObject),t.RtcDataChannel=e}),define("peerconnection","require exports hdxms remotemedia rtpsender proxyobject icecandidate rtptransceiver remotesession rtcdatachannel webrpcclassinfo logger stats telemetry".split(" "),function(e,t,n,r,i,o,a,s,c,d,l,u,_,g){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(t,n,r){return t=e.call(this,t,l.class_id_t.RTCIceCandidateEvent,n,o.ProxyMode.Remote)||this,t.target=r,t.type="icecandidate",t}return __extends(t,e),Object.defineProperty(t.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return u.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected(e.user_friendly_id()+".syncBarrier").then(function(){return e.remoteInvoke(!1,l.method_id_RTCIceCandidateEvent_t.candidate,{oid:0})}).then(function(t){return!1===(t=e.param0(t)).is_null?new a.IceCandidate(e,t.oid,o.ProxyMode.Remote).syncBarrier():Promise.resolve(null)}).then(function(n){u.logger.log(e.user_friendly_id()+".onicecandidate: icecandidate available!"),e.candidate_=n,t(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".onicecandidate() failed!"),n(t)})})},t}(o.ProxyObject);t.IceCandidateEvent=h;var f=function(){function e(e){this.state_="new",this.candidates_=[],this.pc_=e}return e.prototype.pushState=function(e){u.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: new state is "+e),this.state_=e,"gathering"==this.state_?(this.candidates_=[],this.postUpdate()):this.processRemaining()},e.prototype.addIceCandidate=function(e){var t=this;this.candidates_.push(e),e.syncBarrier().then(function(e){return u.logger.log(t.pc_.user_friendly_id()+".onicecandidate: icecandidate available!"),Promise.all([t.pc_.updateSdpDescription(!0),Promise.resolve(e)])}).then(function(e){t.postIceCandidate(e[1])})},e.prototype.postIceCandidate=function(e){u.logger.log(this.pc_.user_friendly_id()+".onicecandidate: posting ice candidate now!"),null!=this.pc_.onicecandidate?this.pc_.onicecandidate(e):u.logger.log(this.pc_.user_friendly_id()+"onicecandidate is NULL!!!"),this.candidates_.shift(),this.processRemaining()},e.prototype.postUpdate=function(){u.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: posting event now!");var e=new v("onicegatheringstatechange",this.pc_);this.pc_.onicegatheringstatechange(e)},e.prototype.processRemaining=function(){0==this.candidates_.length&&"complete"==this.state_?(this.pc_.onicecandidate({candidate:null,target:this}),this.postUpdate()):u.logger.log(this.pc_.user_friendly_id()+".onicecandidate: candidates remaining=["+this.candidates_.map(function(e){return e.object_id()})+"], state="+this.state_)},e}(),p=function(e,t){this.sdp=t,this.type=e};t.SessionDescriptionInit=p;var m=function(e){function t(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return e.apply(this,[t,l.class_id_t.RTCSessionDescription,n,r,null].concat(i))||this}return __extends(t,e),t.prototype.toJSON=function(){return{type:this.type_,sdp:this.sdp_}},Object.defineProperty(t.prototype,"sdp",{get:function(){return this.sdp_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.type_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return u.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected(e.user_friendly_id()+".syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,l.method_id_RTCSessionDescription_t.type,0),e.remoteInvoke(!1,l.method_id_RTCSessionDescription_t.sdp,"")])}).then(function(n){e.type_=e.convertType(e.param0(n[0])),e.sdp_=e.param0(n[1]),t(e)}).catch(function(t){t=e.logRemoteInvokeError(t,".syncBarrier() failed!"),n(t)})})},t.prototype.convertType=function(e){return 0==e?"offer":1==e?"pranswer":2==e?"answer":"rollback"},t.convertC2H=function(e){return"offer"==e?0:"pranswer"==e?1:"answer"==e?2:3},t}(o.ProxyObject);t.SessionDescription=m;var v=function(e,t){this.type=e,this.target=t},y=function(){},C=function(){function e(e,t){this.local=e,this.remote=t}return Object.defineProperty(e.prototype,"active",{get:function(){var e=!1;return 1!=this.local&&1!=this.remote||(e=!0),e},enumerable:!0,configurable:!0}),e}();e=function(e){function t(t){var r=e.call(this,null,l.class_id_t.RTCPeerConnection,0,o.ProxyMode.Local,null,void 0!=t?t:{},{})||this;if(r.timeerstarted_=!1,r.firsttimeremoteoffer_=!1,r.firststable_=!1,r.firsttimelocaloffer_=!1,r.audiocall_=new C(!1,!1),r.videocall_=new C(!1,!1),r.screensharingcall_=new C(!1,!1),r.conferencecall_=!1,r.incomingcall_=!1,r.outgoingcall_=!1,t&&t.sdpSemantics&&(r.sdpSemantics_=t.sdpSemantics),u.logger.log(r.user_friendly_id()+".constructor sdpSemantics="+r.sdpSemantics_),r.isUnified()&&!n.getRedirector().getFeatureValue(l.FEATURE_ms_teams_webrtc_1dot0))throw new DOMException("CWA client does not support unified sdpSemantic","createPeerConnection");return r.pendingtransceiver_=!1,r.deferredOfferAnswers=[],r.localStreams=[],r.remoteStreams=[],r.onaddstream_=null,r.signalingState_="stable",r.iceConnectionState_="new",r.iceGatheringState_="new",r.iceQ_=new f(r),r.receivers_=[],r.senders_=[],r.transceivers_=[],r.registerStateChangeNotification(r.onStateChange),r.localdatachannel_=null,r.remotedatachannel_=null,r}return __extends(t,e),t.prototype.dumpSdp=function(e){u.logger.log(this.user_friendly_id()+".dumpSdp"),e&&(u.logger.log(this.user_friendly_id()+"  -- type: "+e.type),u.logger.log(this.user_friendly_id()+"  -- sdp: "+e.sdp))},Object.defineProperty(t.prototype,"localDescription",{get:function(){return u.logger.log(this.user_friendly_id()+".get_localDescription() called."),this.localDescription_},set:function(e){u.logger.log(this.user_friendly_id()+".set_localDescription() called."),this.localDescription_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteDescription",{get:function(){return u.logger.log(this.user_friendly_id()+".get_remoteDescription() called."),this.remoteDescription_},set:function(e){u.logger.log(this.user_friendly_id()+".get_remoteDescription() called."),this.remoteDescription_=e},enumerable:!0,configurable:!0}),t.prototype.isUnified=function(){return"unified"==this.sdpSemantics_||"unified-plan"==this.sdpSemantics_},t.prototype.onStateChange=function(){var e=new v("iceconnectionstatechange",this);this.oniceconnectionstatechange_&&this.oniceconnectionstatechange_(e)},t.prototype.addIceCandidate=function(e){var t=this;u.logger.log(this.user_friendly_id()+".addIceCandidate() called."),this.waitUntilConnected(this.user_friendly_id()+".addIceCandidate").then(function(){var n={candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex};return void 0!=n.candidate&&null!=n.candidate||(n.candidate=""),void 0==n.sdpMid&&(n.sdpMid=null),void 0==n.sdpMLineIndex&&(n.sdpMLineIndex=null),new a.IceCandidate(t,0,o.ProxyMode.Local,n).syncBarrier()}).then(function(e){return t.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.addIceCandidate,{oid:e.object_id()},{})}).then(function(){return u.logger.log(t.user_friendly_id()+".addIceCandidate() success."),t.updateSdpDescription(!1)}).then(function(){u.logger.log(t.user_friendly_id()+".addIceCandidate() - sync remote sdp success.")}).catch(function(e){t.logRemoteInvokeError(e,".addIceCandidate() failed!")})},Object.defineProperty(t.prototype,"onicecandidate",{get:function(){return this.onicecandidate_},set:function(e){var t=this;u.logger.log(this.user_friendly_id()+".set_onicecandidate() called."),this.onicecandidate_=e,this.waitUntilConnected(this.user_friendly_id()+".onicecandidate").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),l.method_id_RTCPeerConnection_t.onicecandidate);return n.then(function(e){u.logger.log(t.user_friendly_id()+".onicecandidate callback received!!!"),e=new h(t,t.param0(e).oid,t),null!=t.iceQ_&&t.iceQ_.addIceCandidate(e)}),t.remoteInvoke(!0,l.method_id_RTCPeerConnection_t.onicecandidate,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onicecandidate() failed!")})},enumerable:!0,configurable:!0}),t.prototype.convertIceConnectionState=function(e){return 0==e?"new":1==e?"checking":2==e?"connected":3==e?"completed":4==e?"failed":5==e?"disconnected":"closed"},t.prototype.convertConnectionState=function(e){if(0!=e){if(1==e)return"connecting";if(2==e)return"connected";if(3==e)return"disconnected";if(4==e)return"failed";if(5==e)return"closed"}return"new"},Object.defineProperty(t.prototype,"onconnectionstatechange",{get:function(){return this.onconnectionstatechange_},set:function(e){var t=this;u.logger.log(this.user_friendly_id()+".set_onconnectionstatechange() called."),this.onconnectionstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".onconnectionstatechange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),l.method_id_RTCPeerConnection_t.onconnectionstatechange);return n.then(function(e){u.logger.log(t.user_friendly_id()+".onconnectionstatechange(): success callback received!!!"),t.connectionState_=t.convertConnectionState(t.param0(e)),u.logger.log(t.user_friendly_id()+" connectionState=:"+t.connectionState_),e=new v("connectionstatechange",t),t.onconnectionstatechange_(e)}),t.remoteInvoke(!0,l.method_id_RTCPeerConnection_t.onconnectionstatechange,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onconnectionstatechange() failed!")})},enumerable:!0,configurable:!0}),t.prototype.get_connectionState=function(){return u.logger.log(this.user_friendly_id()+".get_connectionState() called, value = "+this.connectionState_),this.isRedirected()?this.connectionState_:"failed"},Object.defineProperty(t.prototype,"oniceconnectionstatechange",{get:function(){return this.oniceconnectionstatechange_},set:function(e){var t=this;u.logger.log(this.user_friendly_id()+".set_oniceconnectionstatechange() called."),this.oniceconnectionstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".oniceconnectionstatechange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),l.method_id_RTCPeerConnection_t.oniceconnectionstatechange);return n.then(function(e){u.logger.log(t.user_friendly_id()+".oniceconnectionstatechange(): success callback received!!!"),t.iceConnectionState_=t.convertIceConnectionState(t.param0(e)),e=new v("iceconnectionstatechange",t),t.oniceconnectionstatechange_(e)}),t.remoteInvoke(!0,l.method_id_RTCPeerConnection_t.oniceconnectionstatechange,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_oniceconnectionstatechange() failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iceConnectionState",{get:function(){return u.logger.log(this.user_friendly_id()+".get_iceConnectionState() called, value = "+this.iceConnectionState_),this.isRedirected()?this.iceConnectionState_:"failed"},enumerable:!0,configurable:!0}),t.prototype.convertIceGatheringState=function(e){return 0==e?"new":1==e?"gathering":"complete"},Object.defineProperty(t.prototype,"onicegatheringstatechange",{get:function(){return this.onicegatheringstatechange_},set:function(e){var t=this;u.logger.log(this.user_friendly_id()+".set_onicegatheringstatechange() called."),this.onicegatheringstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".onicegatheringstatechange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),l.method_id_RTCPeerConnection_t.onicegatheringstatechange);return n.then(function(e){u.logger.log(t.user_friendly_id()+".onicegatheringstatechange(): callback received!!!"),t.iceGatheringState_=t.convertIceGatheringState(t.param0(e)),null!=t.iceQ_&&t.iceQ_.pushState(t.iceGatheringState_)}),t.remoteInvoke(!0,l.method_id_RTCPeerConnection_t.onicegatheringstatechange,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onicegatheringstatechange() failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iceGatheringState",{get:function(){return u.logger.log(this.user_friendly_id()+".get_iceGatheringState() called, value = "+this.iceGatheringState_),this.iceGatheringState_},enumerable:!0,configurable:!0}),t.prototype.convertSignalState=function(e){return 0==e?"stable":1==e?"have-local-offer":2==e?"have-local-pranswer":3==e?"have-remote-offer":4==e?"have-remote-pranswer":"closed"},t.prototype.TelemtryReadings_=function(){if("have-local-offer"==this.signalingState_&&0==this.firsttimelocaloffer_&&0==this.firsttimeremoteoffer_&&(this.outgoingcallstart_=(new Date).getTime(),0==this.outgoingcall_&&(this.SendTelemetryData(g.tel_key_PerfCallState,g.tel_CallState.active,1),this.SendTelemetryData(g.tel_key_PerfCallDirection,g.tel_CallDirection.outgoing,1),this.outgoingcall_=!0),this.firsttimelocaloffer_=!0),"have-remote-offer"==this.signalingState_&&0==this.firsttimeremoteoffer_&&0==this.firsttimelocaloffer_&&(this.incomingcallstart_=(new Date).getTime(),0==this.incomingcall_&&(this.SendTelemetryData(g.tel_key_PerfCallState,g.tel_CallState.active,1),this.SendTelemetryData(g.tel_key_PerfCallDirection,g.tel_CallDirection.incoming,1),this.incomingcall_=!0),this.firsttimeremoteoffer_=!0),"stable"==this.signalingState_&&0==this.firststable_&&(this.callstartTime_=(new Date).getTime(),this.firststable_=this.timeerstarted_=!0),"stable"==this.signalingState_){for(var e=0,t=this.localStreams;e<t.length;e++){var n=t[e];if(1<=n.getAudioTracks().length&&0==this.audiocall_.local&&(this.SendTelemetryData(g.tel_key_PerfCallType,g.tel_CallType.audio,1),this.audiocall_.local=!0),1<=(n=n.getVideoTracks()).length)for(var r=0,i=n;r<i.length;r++)1==(n=i[r]).getSettings().deviceId.includes("display")?0==this.screensharingcall_.local&&(this.SendTelemetryData(g.tel_key_PerfCallType,g.tel_CallType.dshare,1),this.screensharingcall_.local=!0):0==this.videocall_.local&&(this.SendTelemetryData(g.tel_key_PerfCallType,g.tel_CallType.video,1),this.videocall_.local=!0)}for(e=0,t=this.remoteStreams;e<t.length;e++)if(1<=(n=t[e]).getAudioTracks().length&&0==this.audiocall_.remote&&(this.SendTelemetryData(g.tel_key_PerfCallType,g.tel_CallType.audio,1),this.audiocall_.remote=!0),1<=(r=n.getVideoTracks()).length)for(n=0;n<r.length;n++)1==r[n].id.includes("applicationsharingVideo")?0==this.screensharingcall_.remote&&(this.SendTelemetryData(g.tel_key_PerfCallType,g.tel_CallType.dshare,1),this.screensharingcall_.remote=!0):0==this.videocall_.remote&&(this.SendTelemetryData(g.tel_key_PerfCallType,g.tel_CallType.video,1),this.videocall_.remote=!0);2<this.getReceivers().length&&0==this.conferencecall_&&(this.SendTelemetryData(g.tel_key_PerfCallType,g.tel_CallType.multi,1),this.conferencecall_=!0)}},Object.defineProperty(t.prototype,"onsignalingstatechange",{set:function(e){var t=this;u.logger.log(this.user_friendly_id()+".set_onsignalingstatechange() called."),this.onsignalingstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".onsignalingstatechanged").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),l.method_id_RTCPeerConnection_t.onsignalingstatechange);return n.then(function(e){u.logger.log(t.user_friendly_id()+".onsignalingstatechange(): callback received!!!"),t.signalingState_=t.convertSignalState(t.param0(e)),e=new v("onsignalingstatechange",t),t.onsignalingstatechange_(e),t.TelemtryReadings_()}),t.remoteInvoke(!0,l.method_id_RTCPeerConnection_t.onsignalingstatechange,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onsignalingstatechange() failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onsignalingstatechanged",{get:function(){return this.onsignalingstatechange_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ontrack",{get:function(){return this.ontrack_},set:function(e){var t=this;u.logger.log(this.user_friendly_id()+".set_ontrack() called."),this.ontrack_=e,this.waitUntilConnected(this.user_friendly_id()+".ontrack").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),l.method_id_RTCPeerConnection_t.ontrack);return n.then(function(e){return __awaiter(t,void 0,void 0,function(){var t,n,a,d,l,_,g,h,f,p,m,v=this;return __generator(this,function(C){if(u.logger.log(this.user_friendly_id()+".ontrack(): callback received!!!"),t=new y,n=[],void 0!=(a=this.param0(e)).track&&!1===a.track.is_null&&(u.logger.log(this.user_friendly_id()+" adding a RemoteMediaTrack with oid:"+a.track.oid),d=new r.RemoteMediaTrack(this,a.track.oid),c.RemoteSession.isFeatureWebrtc1dot0Supported()?u.logger.log(this.user_friendly_id()+" skipping syncBarrier() for track:"+a.track.oid):n.push(d.syncBarrier())),t.track=d,void 0!=a.receiver&&!1===a.receiver.is_null&&(void 0===(l=this.receivers_.find(function(e){return e.object_id()===a.receiver.oid}))&&(u.logger.log(this.user_friendly_id()+" adding a RtpReceiver with oid:"+a.receiver.oid),l=new i.RtpReceiver(this,a.receiver.oid,o.ProxyMode.Remote,this.isUnified(),d)),c.RemoteSession.isFeatureWebrtc1dot0Supported()?u.logger.log(this.user_friendly_id()+" skipping syncBarrier() for reveiver:"+a.receiver.oid):n.push(l.syncBarrier())),t.receiver=l,c.RemoteSession.isFeatureWebrtc1dot0Supported()&&void 0!=a.transceiver&&!1===a.transceiver.is_null&&(void 0===(_=this.transceivers_.find(function(e){return e.object_id()===a.transceiver.oid}))&&(u.logger.log(this.user_friendly_id()+" adding a RtpTransceiver with oid:"+a.transceiver.oid),_=new s.RtpTransceiver(this,a.transceiver.oid,o.ProxyMode.Remote,this.isUnified(),"inactive",l),this.transceivers_.push(_)),n.push(_.syncBarrier())),t.transceiver=_,t.streams=[],void 0!=a.streams)for(g=function(e){var i=h.remoteStreams.find(function(t){return!1===e.is_null&&t.object_id()===e.oid});void 0===i&&(u.logger.log(h.user_friendly_id()+" adding a RemoteStream with oid:"+e.oid),i=new r.RemoteStream(h,e.oid,o.ProxyMode.Remote),h.remoteStreams.push(i)),n.push(i.syncBarrier()),t.streams.push(i)},h=this,f=0,p=a.streams;f<p.length;f++)m=p[f],g(m);return u.logger.log(this.user_friendly_id()+".ontrack(): .prop.syncBarrier start"),Promise.all(n).then(function(){u.logger.log(v.user_friendly_id()+".ontrack(): notified!!! with evt: "+t),v.ontrack_(t)}).catch(function(e){v.logRemoteInvokeError(e,".ontrack(): .prop.syncBarrier failed.")}),[2]})})}),t.remoteInvoke(!0,l.method_id_RTCPeerConnection_t.ontrack,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_ontrack(): failed.")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"signalingState",{get:function(){return u.logger.log(this.user_friendly_id()+".get_signalingState() called, value = "+this.signalingState_),this.signalingState_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onnegotiationneeded",{get:function(){return this.onnegotiationneeded_},set:function(e){var t=this;u.logger.log(this.user_friendly_id()+".set_onnegotiationneeded() called."),this.onnegotiationneeded_=e,this.waitUntilConnected(this.user_friendly_id()+".onnegotiationneeded").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),l.method_id_RTCPeerConnection_t.onnegotiationneeded);return n.then(function(){u.logger.log(t.user_friendly_id()+".onnegotiationneeded(): callback received!!!");var e=new v("negotiationneeded",t);t.onnegotiationneeded_(e)}),t.remoteInvoke(!0,l.method_id_RTCPeerConnection_t.onnegotiationneeded,n.success)}).catch(function(e){t.logRemoteInvokeError(e,".set_onnegotiationneeded(): failed.")})},enumerable:!0,configurable:!0}),t.prototype.dumpConstraints=function(e){u.logger.log(this.user_friendly_id()+"constraints: "+e),void 0!==e&&0!==Object.keys(e).length||u.logger.log(this.user_friendly_id()+"constraints either undefined or empty!"),e&&(u.logger.log(this.user_friendly_id()+"  -- video: "+e.offerToReceiveVideo),u.logger.log(this.user_friendly_id()+"  -- audio: "+e.offerToReceiveAudio),u.logger.log(this.user_friendly_id()+"  -- iceRestart: "+e.iceRestart),u.logger.log(this.user_friendly_id()+"  -- voiceActivityDetection: "+e.voiceActivityDetection))},t.prototype.fix_constraints=function(e){this.dumpConstraints(e);var t={};return this.isUnified()||(t={audio:!0,video:!0}),e&&(void 0!==e.video&&(t.video=e.offerToReceiveVideo),void 0!==e.audio&&(t.audio=e.offerToReceiveAudio),void 0!==e.iceRestart&&(t.iceRestart=e.iceRestart),void 0!==e.voiceActivityDetection&&(t.voiceActivityDetection=e.voiceActivityDetection)),t},t.prototype.createOffer=function(e,t,n){return u.logger.log(this.user_friendly_id()+".createOffer() called.",JSON.stringify(e)),this.isUnified()?void 0==e?this.createOffer_v2():e?this.createOffer_v2(e):this.createOffer_v1(e,t,n):this.createOffer_v1(e,t,n)},t.prototype.createOffer_v2=function(e){var t=this;return u.logger.log(this.user_friendly_id()+".createOffer_v2() called.",JSON.stringify(e)),new Promise(function(n,r){t.createOffer_v1(function(e){u.logger.log(t.user_friendly_id()+".createOffer_v2(): got sdp!!!"),e=new p(e.type,e.sdp),n(e)},function(e){void 0!=e&&(e=t.logRemoteInvokeError(e,".createOffer_v2() failed."),r(e))},e)})},t.prototype.createOffer_v1=function(e,t,n){var r=this;u.logger.log(this.user_friendly_id()+".createOffer_v1().",JSON.stringify(n));var i=[this.waitUntilConnected(this.user_friendly_id()+".createOffer_v1"),this.waitTransceiverReady(this.user_friendly_id()+".createOffer_v1")];Promise.all(i).then(function(){var e=r.registerCallbacks(!0,!1,l.method_id_RTCPeerConnection_t.createOffer);return r.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.createOffer,e.success,e.fail,r.fix_constraints(n)),e.prom()}).then(function(e){return u.logger.log(r.user_friendly_id()+".createOffer_v1(): success callback received!!!"),new m(r,r.param0(e).oid,o.ProxyMode.Remote).syncBarrier()}).then(function(t){e&&e(t)}).catch(function(e){void 0!=e&&(e=r.logRemoteInvokeError(e,".createOffer_v1() failed."),t&&t(e))})},t.prototype.createAnswer=function(e,t,n){return u.logger.log(this.user_friendly_id()+".createAnswer() called.",JSON.stringify(e)),this.isUnified()?void 0==e?this.createAnswer_v2():e?this.createAnswer_v2(e):this.createAnswer_v1(e,t,n):this.createAnswer_v1(e,t,n)},t.prototype.createAnswer_v2=function(e){var t=this;return u.logger.log(this.user_friendly_id()+".createAnswer_v2() called.",JSON.stringify(e)),new Promise(function(n,r){t.createAnswer_v1(function(e){u.logger.log(t.user_friendly_id()+".createAnswer_v2(): got sdp!!!"),e=new p(e.type,e.sdp),n(e)},function(e){void 0!=e&&(e=t.logRemoteInvokeError(e,".createAnswer_v2() failed."),r(e))},e)})},t.prototype.createAnswer_v1=function(e,t,n){var r=this;u.logger.log(this.user_friendly_id()+".createAnswer_v1() called.",JSON.stringify(n));var i=[this.waitUntilConnected(this.user_friendly_id()+".createAnswer_v1"),this.waitTransceiverReady(this.user_friendly_id()+".createAnswer_v1")];Promise.all(i).then(function(){var e=r.registerCallbacks(!0,!1,l.method_id_RTCPeerConnection_t.createAnswer);return r.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.createAnswer,e.success,e.fail,r.fix_constraints(n),{}),e.prom()}).then(function(e){return u.logger.log(r.user_friendly_id()+".createAnswer_v1(): success callback received!!!"),new m(r,r.param0(e).oid,o.ProxyMode.Remote).syncBarrier()}).then(function(t){e&&e(t)}).catch(function(e){e=r.logRemoteInvokeError(e,".createAnswer_v1() failed."),t&&t(e.message)})},t.prototype.updateSdpDescription=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(a){switch(a.label){case 0:return u.logger.log(this.user_friendly_id()+".updateSdpDescription() called."),1!=e?[3,2]:[4,this.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.localDescription,{oid:this.object_id()})];case 1:return t=a.sent(),[3,4];case 2:return[4,this.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.remoteDescription,{oid:this.object_id()})];case 3:t=a.sent(),a.label=4;case 4:return n=new m(this,this.param0(t).oid,o.ProxyMode.Remote),[4,n.syncBarrier().catch(function(e){return i.logRemoteInvokeError(e,"sdp.syncBarrier() failed!"),null})];case 5:return r=a.sent(),1==e?this.localDescription_=r:this.remoteDescription_=r,[2]}})})},t.prototype.setLocalDescription=function(e,t,n){return u.logger.log(this.user_friendly_id()+".setLocalDescription() called.",JSON.stringify(e)),e instanceof p?this.setLocalDescription_v2(e):e instanceof RTCSessionDescription&&t?this.setLocalDescription_v1(e,t,n):(t=void 0,e?t=new p(e.type,e.sdp):(u.logger.log(this.user_friendly_id()+".setLocalDescription() empty param1, setting sdp type to rollback"),e=void 0,e="have-remote-offer"==this.signalingState_?"answer":"have-local-pranswer"==this.signalingState_||"have-remote-pranswer"==this.signalingState_?"pranswer":"offer",t=new p(e,"")),this.setLocalDescription_v2(t))},t.prototype.setLocalDescription_v2=function(e){var t=this;return u.logger.log(this.user_friendly_id()+".setLocalDescription_v2() called.",JSON.stringify(e)),new Promise(function(n,r){t.waitUntilConnected(t.user_friendly_id()+".setLocalDescription_v2").then(function(){return new m(t,0,o.ProxyMode.Local,{type:m.convertC2H(e.type),sdp:e.sdp}).syncBarrier()}).then(function(i){var o=t.registerCallbacks(!0,!1,l.method_id_RTCPeerConnection_t.setLocalDescription_v2),a={type:m.convertC2H(e.type),sdp:e.sdp};t.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.setLocalDescription_v2,a,o.success,o.fail),o.prom().then(function(){u.logger.log(t.user_friendly_id()+".setLocalDescription_v2(): success callback received!!!"),t.localDescription_=i,u.logger.log(t.user_friendly_id()+".setLocalDescription_v2(): updated localDescription_"),t.isUnified(),Promise.all([]).then(function(){u.logger.log(t.user_friendly_id()+".setLocalDescription_v2() success."),n()}).catch(function(e){e=t.logRemoteInvokeError(e,".prop.setLocalDescription_v2() failed!"),r(e)})}).catch(function(e){e=t.logRemoteInvokeError(e,"setLocalDescription_v2() error callback received!"),r(e)})}).catch(function(e){e=t.logRemoteInvokeError(e,".setLocalDescription_v2() failed."),r(e)})})},t.prototype.setLocalDescription_v1=function(e,t,n){var r=this;u.logger.log(this.user_friendly_id()+".setLocalDescription_v1() called."),this.waitUntilConnected(this.user_friendly_id()+".setLocalDescription_v1").then(function(){return new m(r,0,o.ProxyMode.Local,{type:m.convertC2H(e.type),sdp:e.sdp}).syncBarrier()}).then(function(e){var i=r.registerCallbacks(!0,!1,l.method_id_RTCPeerConnection_t.setLocalDescription);r.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.setLocalDescription,{oid:e.object_id()},i.success,i.fail),i.prom().then(function(){u.logger.log(r.user_friendly_id()+".setLocalDescription_v1(): success callback received!!!"),r.localDescription_=e,u.logger.log(r.user_friendly_id()+".setLocalDescription_v1(): updated localDescription_"),r.isUnified(),Promise.all([]).then(function(){u.logger.log(r.user_friendly_id()+".setLocalDescription_v1() success."),t&&t()}).catch(function(e){e=r.logRemoteInvokeError(e,".prop.setLocalDescription_v1() failed."),n&&n(e.message)})}).catch(function(e){e=r.logRemoteInvokeError(e,".setLocalDescription_v1() error callback received."),n&&n(e.message)})}).catch(function(e){e=r.logRemoteInvokeError(e,".setLocalDescription_v1() failed."),n&&n(e.message)})},t.prototype.setRemoteDescription=function(e,t,n){return u.logger.log(this.user_friendly_id()+".setRemoteDescription() called.",JSON.stringify(e)),e instanceof p?this.setRemoteDescription_v2(e):e instanceof RTCSessionDescription&&t?this.setRemoteDescription_v1(e,t,n):(t=void 0,e?t=new p(e.type,e.sdp):(u.logger.log(this.user_friendly_id()+".setRemoteDescription() empty param1, setting sdp type to rollback"),e=void 0,e="have-remote-offer"==this.signalingState_?"answer":"have-local-pranswer"==this.signalingState_||"have-remote-pranswer"==this.signalingState_?"pranswer":"offer",t=new p(e,"")),this.setRemoteDescription_v2(t))},t.prototype.setRemoteDescription_v2=function(e){var t=this;return u.logger.log(this.user_friendly_id()+".setRemoteDescription_v2() called.",JSON.stringify(e)),new Promise(function(n,r){t.waitUntilConnected(t.user_friendly_id()+".setRemoteDescription_v2").then(function(){return new m(t,0,o.ProxyMode.Local,{type:m.convertC2H(e.type),sdp:e.sdp}).syncBarrier()}).then(function(i){var o=t.registerCallbacks(!0,!1,l.method_id_RTCPeerConnection_t.setRemoteDescription_v2),a={type:m.convertC2H(e.type),sdp:e.sdp};t.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.setRemoteDescription_v2,a,o.success,o.fail),o.prom().then(function(){u.logger.log(t.user_friendly_id()+".setRemoteDescription_v2(): success callback received!!!"),t.remoteDescription_=i,u.logger.log(t.user_friendly_id()+".setRemoteDescription_v2(): updated remoteDescription_");var e=[];t.isUnified()?e.push(t.getTransceiversAsync()):e.push(t.getSendersAsync()),Promise.all(e).then(function(){u.logger.log(t.user_friendly_id()+".setRemoteDescription_v2(): success."),n()}).catch(function(e){e=t.logRemoteInvokeError(e,".prop.setRemoteDescription_v2() failed."),r(e)})}).catch(function(e){e=t.logRemoteInvokeError(e,".setRemoteDescription_v2() error callback received."),r(e)})}).catch(function(e){e=t.logRemoteInvokeError(e,".setRemoteDescription_v2() failed."),r(e)})})},t.prototype.setRemoteDescription_v1=function(e,t,n){var r=this;u.logger.log(this.user_friendly_id()+".setRemoteDescription_v1() called."),this.waitUntilConnected(this.user_friendly_id()+".setRemoteDescription_v1").then(function(){return new m(r,0,o.ProxyMode.Local,{type:m.convertC2H(e.type),sdp:e.sdp}).syncBarrier()}).then(function(e){var i=r.registerCallbacks(!0,!1,l.method_id_RTCPeerConnection_t.setRemoteDescription);r.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.setRemoteDescription,{oid:e.object_id()},i.success,i.fail),i.prom().then(function(){u.logger.log(r.user_friendly_id()+".setRemoteDescription_v1(): success callback received!!!"),r.remoteDescription_=e,u.logger.log(r.user_friendly_id()+".setRemoteDescription_v1(): updated remoteDescription_");var i=[];r.isUnified()?i.push(r.getTransceiversAsync()):i.push(r.getSendersAsync()),Promise.all(i).then(function(){u.logger.log(r.user_friendly_id()+".setRemoteDescription_v1(): success."),t&&t()}).catch(function(e){e=r.logRemoteInvokeError(e,".prop.setRemoteDescription_v1() failed."),n&&n(e.message)})})}).catch(function(e){e=r.logRemoteInvokeError(e,".setRemoteDescription_v1() failed."),n&&n(e.message)})},t.prototype.getLocalStreams=function(){u.logger.log("PeerConnection.getLocalStreams() called. [oid="+this.object_id()+"]");for(var e=0,t=this.localStreams;e<t.length;e++)u.logger.log(JSON.stringify(t[e]));return this.localStreams},t.prototype.getRemoteStreams=function(){u.logger.log(this.user_friendly_id()+".getRemoteStreams() called.");for(var e=0,t=this.remoteStreams;e<t.length;e++)u.logger.log(JSON.stringify(t[e]));return this.remoteStreams},t.prototype.addTrack=function(e,t){var n=this;u.logger.log(this.user_friendly_id()+".addTrack() called: "+JSON.stringify(t));var a=[];if(t instanceof r.RemoteStream)a.push(t.id),this.localStreams.push(t);else for(var s=0;s<t.length;s++)a.push(t[s].id),this.localStreams.push(t[s]);var c=new i.RtpSender(this,0,o.ProxyMode.Pseudo,this.isUnified());return this.senders_.push(c),this.waitUntilConnected(this.user_friendly_id()+".addTrack").then(function(){return n.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.addTrack,{oid:e.object_id()},a)}).then(function(e){u.logger.log(n.user_friendly_id()+".addTrack() success with oid: "+n.param0(e).oid),c.bind(n,n.param0(e).oid),c.syncBarrier().then(function(){u.logger.log(n.user_friendly_id()+"sender.syncBarrier(): success"),n.isUnified()&&n.getTransceiversAsync()}).catch(function(e){n.logRemoteInvokeError(e,"sender.syncBarrier() failed!")})}).catch(function(e){n.logRemoteInvokeError(e,"addTrack() failed!")}),u.logger.log(this.user_friendly_id()+".addTrack() returning: "+c),c},t.prototype.removeTrack=function(e){var t=this;u.logger.log(this.user_friendly_id()+".removeTrack() called.");for(var n=0;n<this.senders_.length;n++)this.senders_[n]==e&&this.senders_.splice(n,1);this.waitUntilConnected(this.user_friendly_id()+".removeTrack").then(function(){return t.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.removeTrack,{oid:e.object_id()})}).then(function(){u.logger.log(t.user_friendly_id()+".removeTrack() success."),t.isUnified()&&t.getTransceiversAsync()}).catch(function(e){t.logRemoteInvokeError(e,"removeTrack() failed!")})},t.prototype.addStream=function(e){var t=this;u.logger.log(this.user_friendly_id()+".addStream() called: "+JSON.stringify(e)),this.localStreams.push(e),this.waitUntilConnected(this.user_friendly_id()+".addStream").then(function(){return t.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.addStream,{oid:e.object_id()},{})}).then(function(){u.logger.log(t.user_friendly_id()+".addStream() success.")}).catch(function(e){t.logRemoteInvokeError(e,"addStream() failed.")})},t.prototype.removeStream=function(e){var t=this;u.logger.log(this.user_friendly_id()+".removeStream() called: "+JSON.stringify(e));for(var n=0;n<this.localStreams.length;n++)this.localStreams[n]==e&&this.localStreams.splice(n,1);this.waitUntilConnected(this.user_friendly_id()+".removeStream").then(function(){return t.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.removeStream,{oid:e.object_id()})}).then(function(){u.logger.log(t.user_friendly_id()+".removeStream() success.")}).catch(function(e){t.logRemoteInvokeError(e,"removeStream() failed.")})},Object.defineProperty(t.prototype,"onaddstream",{get:function(){return this.onaddstream_},set:function(e){var t=this;u.logger.log(this.user_friendly_id()+".set_onaddstream() called."),this.onaddstream_=e,this.waitUntilConnected(this.user_friendly_id()+".onaddstream").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),l.method_id_RTCPeerConnection_t.onaddstream);return n.then(function(e){new r.RemoteStreamEvent(t,t.param0(e).oid).syncBarrier().then(function(e){u.logger.log(t.user_friendly_id()+".onaddstream callback received!"),void 0===t.remoteStreams.find(function(t){return void 0!=e.stream&&t.object_id()===e.stream.object_id()})&&t.remoteStreams.push(e.stream),void 0!=t.onaddstream_&&(u.logger.log(t.user_friendly_id()+".onaddstream notified!!! "+e.stream.id),t.onaddstream_(e))})}),t.remoteInvoke(!0,l.method_id_RTCPeerConnection_t.onaddstream,n.success)}).catch(function(e){t.logRemoteInvokeError(e,"set_onaddstream() failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onremovestream",{get:function(){return this.onremovestream_},set:function(e){var t=this;u.logger.log(this.user_friendly_id()+".set_onremovestream() called."),this.onremovestream_=e,this.waitUntilConnected(this.user_friendly_id()+".onremovestream").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),l.method_id_RTCPeerConnection_t.onremovestream);return n.then(function(e){new r.RemoteStreamEvent(t,t.param0(e).oid).syncBarrier().then(function(e){u.logger.log(t.user_friendly_id()+".onremovestream callback received! "+e.stream.id);var n=t.remoteStreams.findIndex(function(t){return t.id==e.stream.id});0<=n&&t.remoteStreams.splice(n,1),t.onremovestream_(e)})}),t.remoteInvoke(!0,l.method_id_RTCPeerConnection_t.onremovestream,n.success)}).catch(function(e){t.logRemoteInvokeError(e,"set_onremovestream() failed!")})},enumerable:!0,configurable:!0}),t.prototype.getStats=function(e){var t=this;return new Promise(function(n,r){var i=this;t.isRedirected()?t.waitUntilConnected(t.user_friendly_id()+".getStats").then(function(){var r=t.registerCallbacks(!0,!1,l.method_id_RTCPeerConnection_t.getStats);return r.then(function(t){void 0!==t.params&&0!==t.params.length&&(e?(e(_.StatsReport.fromJSON(JSON.parse(t.params[0]))),n()):n(_.StatsReport.toRTCStatsReport(JSON.parse(t.params[0]))))}),e?t.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.getStats,r.success):t.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.getStats_v2,r.success)}).catch(function(e){i&&(e=i.logRemoteInvokeError(e,".getStats() failed!"),r(e))}):(e({}),n())})},t.prototype.SendTelemetryData=function(e,t,r){n.getRedirector().telemetry.SendTelemetryData(g.tel_cmd.Data,e,t,r)},t.prototype.MillisecondstoDisplayformat_=function(e){var t,n;n=Math.floor(e/1e3),t=Math.floor(n/60),e=Math.floor(t/60),u.logger.log(Math.floor(e/24)+":"+e%24+":"+t%60+":"+n%60)},t.prototype.CalculateCallDurationandType_=function(){if(1==this.timeerstarted_){this.timeerstarted_=!1,this.callendTime_=(new Date).getTime();var e=this.callendTime_-this.callstartTime_;this.MillisecondstoDisplayformat_(e),e=Math.round(e/1e3),u.logger.log("Call Duration "+e),1==this.conferencecall_?this.SendTelemetryData(g.tel_key_ConferenceCallDuration,e,1):(1==this.audiocall_.active&&this.SendTelemetryData(g.tel_key_AudioCallDuration,e,1),1==this.videocall_.active&&this.SendTelemetryData(g.tel_key_VideoCallDuration,e,1),1==this.screensharingcall_.active&&this.SendTelemetryData(g.tel_key_ScreensharingCallDuration,e,1));var t;1==this.firsttimelocaloffer_&&(t=this.callstartTime_-this.outgoingcallstart_),1==this.firsttimeremoteoffer_&&(t=this.callstartTime_-this.incomingcallstart_),this.MillisecondstoDisplayformat_(t),t=Math.round(t/1e3),u.logger.log("Call Establish Time "+t),1==this.incomingcall_?this.SendTelemetryData(g.tel_key_CallEstIncoming,t,1):1==this.outgoingcall_&&this.SendTelemetryData(g.tel_key_CallEstOutgoing,t,1),this.SendTelemetryData(g.tel_key_PerfCallState,g.tel_CallState.idle,1)}},t.prototype.close=function(){var e=this;u.logger.log(this.user_friendly_id()+".close() called."),this.CalculateCallDurationandType_(),this.unregisterStateChangeNotification(this.onStateChange),this.onnegotiationneeded=this.onsignalingstatechange=this.onicegatheringstatechange=this.oniceconnectionstatechange=this.onicecandidate=this.onaddstream=null,this.waitUntilConnected(this.user_friendly_id()+".close").then(function(){return e.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.close)}).then(function(){e.iceQ_=null,e.release(),u.logger.log(e.user_friendly_id()+".close() success.")}).catch(function(t){e.logRemoteInvokeError(t,".close() failed."),e.iceQ_=null,e.release()})},t.prototype.createDTMFSender=function(e){u.logger.log(this.user_friendly_id()+".createDTMFSender() called.");var t,n=this.senders_;return void 0!==n&&0!==n.length||(n=this.getSenders()),void 0!=n&&void 0!=(n=n.find(function(t){return t.track.id===e.id}))&&(u.logger.log(this.user_friendly_id()+" returning RtpSender with oid:"+n.object_id()),t=n.dtmf),t},t.prototype.getSenders=function(){var e=this;if(u.logger.log(this.user_friendly_id()+".getSenders() called. "),this.isUnified()){for(var t=[],n=0,r=this.transceivers_;n<r.length;n++)t.push(r[n].sender);this.senders_=t}else this.getSendersAsync().then(function(){u.logger.log(e.user_friendly_id()+".getSenders() success.")}).catch(function(t){e.logRemoteInvokeError(t,".getSenders() failed!")});return u.logger.log(this.user_friendly_id()+".getSenders() returning:"+this.senders_.length+" items"),this.senders_},t.prototype.getSendersAsync=function(){var e=this;return u.logger.log(this.user_friendly_id()+".getSendersAsync() called. "+this.senders_),new Promise(function(t,n){e.waitUntilConnected(e.user_friendly_id()+".getSendersAsync").then(function(){return u.logger.log(e.user_friendly_id()+".getSendersAsync invoking remote"),e.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.getSenders,[])}).then(function(n){u.logger.log(e.user_friendly_id()+".getSendersAsync remote success");var r=[],a=[];n.params[0].forEach(function(t){var n=e.senders_.find(function(e){return e.object_id()===t.oid});void 0===n&&(u.logger.log(e.user_friendly_id()+" adding a RtpSender with oid:"+t.oid),n=new i.RtpSender(e,t.oid,o.ProxyMode.Remote,e.isUnified())),r.push(n),a.push(n.syncBarrier())}),Promise.all(a).then(function(){e.senders_=r,u.logger.log(e.user_friendly_id()+".getSendersAsync: returning senders with ids ["+e.senders_.map(function(e){return e.object_id()})+"]"),t(e.senders_)}).catch(function(n){e.logRemoteInvokeError(n,".prop.getSendersAsync() failed."),e.senders_=[],t(e.senders_)})}).catch(function(n){e.logRemoteInvokeError(n,".getSendersAsync() failed."),e.senders_=[],t(e.senders_)})})},t.prototype.getReceivers=function(){var e=this;if(u.logger.log(this.user_friendly_id()+".getReceivers() called. "),this.isUnified()){for(var t=[],n=0,r=this.transceivers_;n<r.length;n++)t.push(r[n].receiver);this.receivers_=t}else this.getReceiversAsync().then(function(){u.logger.log(e.user_friendly_id()+".getReceivers() success.")}).catch(function(t){e.logRemoteInvokeError(t,".getReceivers() failed!")});return u.logger.log(this.user_friendly_id()+".getReceivers() returning:"+this.receivers_.length+" items"),this.receivers_},t.prototype.getReceiversAsync=function(){var e=this;return u.logger.log(this.user_friendly_id()+".getReceiversAsync() called. "+this.receivers_),new Promise(function(t,n){e.waitUntilConnected(e.user_friendly_id()+".getReceiversAsync").then(function(){return e.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.getReceivers,[])}).then(function(n){u.logger.log(e.user_friendly_id()+".getReceiversAsync: remote success.");var r=[],a=[];n.params[0].forEach(function(t){var n=e.receivers_.find(function(e){return e.object_id()===t.oid});void 0===n&&(u.logger.log(e.user_friendly_id()+" adding a RtpReceiver with oid:"+t.oid),n=new i.RtpReceiver(e,t.oid,o.ProxyMode.Remote,e.isUnified())),r.push(n),a.push(n.syncBarrier())}),Promise.all(a).then(function(){e.receivers_=r,u.logger.log(e.user_friendly_id()+".getReceiversAsync: returning receiver with ids ["+e.receivers_.map(function(e){return e.object_id()})+"]"),t(e.receivers_)}).catch(function(n){e.logRemoteInvokeError(n,".prop.getReceiversAsync() failed!"),e.receivers_=[],t(e.receivers_)})}).catch(function(n){e.logRemoteInvokeError(n,".getReceiversAsync() failed!"),e.receivers_=[],t(e.receivers_)})})},t.prototype.addTransceiver=function(e,t){var n=this;u.logger.log(this.user_friendly_id()+".addTransceiver() called: "+JSON.stringify(e)+" init="+JSON.stringify(t)),this.pendingtransceiver_=!0;var r="sendrecv";t&&t.direction&&(r=t.direction);var i=new s.RtpTransceiver(this,0,o.ProxyMode.Pseudo,this.isUnified(),r);return this.transceivers_.push(i),this.waitUntilConnected(this.user_friendly_id()+".addTransceiver").then(function(){return"string"==typeof e?n.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.addTransceiverWithKind,e,t):n.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.addTransceiverWithTrack,{oid:e.object_id()},t)}).then(function(e){u.logger.log(n.user_friendly_id()+".addTransceiver() success with oid: "+n.param0(e).oid),i.bind(n,n.param0(e).oid),i.syncBarrier().then(function(){u.logger.log(n.user_friendly_id()+".addTransceiver(): success"),n.pendingtransceiver_=!1}).catch(function(e){n.logRemoteInvokeError(e,".prop.addTransceiver() failed!"),n.pendingtransceiver_=!1})}).catch(function(e){n.logRemoteInvokeError(e,"addTransceiver() failed!"),n.pendingtransceiver_=!1}),u.logger.log(this.user_friendly_id()+".addTransceiver() returning:"),i},t.prototype.waitTransceiverReady=function(e){var t=this;return new Promise(function(n,r){if(u.logger.trace(t.user_friendly_id()+".waitTransceiverReady(): pendingtransceiver_="+t.pendingtransceiver_),0==t.pendingtransceiver_){for(;t.deferredOfferAnswers&&0<t.deferredOfferAnswers.length;)t.deferredOfferAnswers.shift().post(!0);n()}else t.deferredOfferAnswers.push(new o.deferred_action(n,r,e)),t.checkTransceiver(15,1e3)})},t.prototype.checkTransceiver=function(e,t){var n=this;if(0>=e)for(u.logger.log(".checkTransceiver() timeout waiting for transceiver ready!");this.deferredOfferAnswers&&0<this.deferredOfferAnswers.length;)this.deferredOfferAnswers.shift().post(!1);else setTimeout(function(){if(0==n.pendingtransceiver_)for(;n.deferredOfferAnswers&&0<n.deferredOfferAnswers.length;)n.deferredOfferAnswers.shift().post(!0);else u.logger.log('.checkTransceiver(): count= "'+e),n.checkTransceiver(--e,t)},t)},t.prototype.getTransceivers=function(){return u.logger.log(this.user_friendly_id()+".getTransceivers() called. "),u.logger.log(this.user_friendly_id()+".getTransceivers() returning:"+this.transceivers_.length+" items"),this.transceivers_},t.prototype.getTransceiversAsync=function(){var e=this;return u.logger.log(this.user_friendly_id()+".getTransceiversAsync() called. "),new Promise(function(t,n){e.waitUntilConnected(e.user_friendly_id()+".getTransceiversAsync").then(function(){return e.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.getTransceivers,[])}).then(function(n){u.logger.log(e.user_friendly_id()+".getTransceiversAsync() remote success.");var r=[],i=[];n.params[0].forEach(function(t){var n=e.transceivers_.find(function(e){return e.object_id()===t.oid});void 0===n&&(u.logger.log(e.user_friendly_id()+" adding a RtpTransceiver with oid:"+t.oid),n=new s.RtpTransceiver(e,t.oid,o.ProxyMode.Remote,e.isUnified())),r.push(n),i.push(n.syncBarrier())}),Promise.all(i).then(function(){e.transceivers_=r,u.logger.log(e.user_friendly_id()+".prop.getTransceiversAsync: returning transceiver with ids ["+e.transceivers_.map(function(e){return e.object_id()})+"]"),t(e.transceivers_)}).catch(function(n){e.logRemoteInvokeError(n,".prop.getTransceiversAsync() failed!"),e.transceivers_=[],t(e.transceivers_)})}).catch(function(n){e.logRemoteInvokeError(n,".getTransceiversAsync() failed!"),e.transceivers_=[],t(e.transceivers_)})})},Object.defineProperty(t.prototype,"sctp",{get:function(){return this.sctp_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ondatachannel",{get:function(){return this.ondatachannel_},set:function(e){var t=this;u.logger.log(this.user_friendly_id()+".set_ondatachannel() called."),this.ondatachannel_=e,this.waitUntilConnected(this.user_friendly_id()+".ondatachannel").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),l.method_id_RTCPeerConnection_t.ondatachannel);return n.then(function(e){u.logger.log(t.user_friendly_id()+".ondatachannel callback received!!!"),null!==t.remotedatachannel_&&t.remotedatachannel_.object_id()==t.param0(e).oid||(t.remotedatachannel_=new d.RtcDataChannel(t,t.param0(e).oid,o.ProxyMode.Remote),t.remotedatachannel_.syncBarrier().then(function(){u.logger.log(t.user_friendly_id()+"remotedatachannel_.syncBarrier(): success");var e=new Event("ondatachannel");e.channel=t.remotedatachannel_,t.localdatachannel_&&!t.localdatachannel_.isdestroyed()?t.localdatachannel_.syncBarrier().then(function(){u.logger.log(t.user_friendly_id()+"ondatachannel(): notifying..."),t.ondatachannel_&&t.ondatachannel_(e)}).catch(function(){u.logger.log(t.user_friendly_id()+"localdatachannel_.syncBarrier(): failed!")}):(u.logger.log(t.user_friendly_id()+"ondatachannel(): notifying..."),t.ondatachannel_&&t.ondatachannel_(e))}).catch(function(){u.logger.log(t.user_friendly_id()+"remotedatachannel_.syncBarrier(): failed!")}))}),t.remoteInvoke(!0,l.method_id_RTCPeerConnection_t.ondatachannel,n.success)}).catch(function(){u.logger.log(t.user_friendly_id()+".ondatachannel() failed.")})},enumerable:!0,configurable:!0}),t.prototype.fixDataChannelConfig=function(e){return u.logger.log(this.user_friendly_id()+".fixDataChannelConfig() called: "+e),void 0==e&&(e={}),void 0==e.negotiated&&void 0==e.id&&(e.negotiated=!1,e.id=-1),e},t.prototype.createDataChannel=function(e,t){var n=this;return u.logger.log(this.user_friendly_id()+".createDataChannel() called. label:"+e),this.localdatachannel_=new d.RtcDataChannel(this,0,o.ProxyMode.Pseudo),this.waitUntilConnected(this.user_friendly_id()+".createDataChannel").then(function(){return n.remoteInvoke(!1,l.method_id_RTCPeerConnection_t.createDataChannel,e,n.fixDataChannelConfig(t))}).then(function(e){u.logger.log(n.user_friendly_id()+".createDataChannel() success with oid: "+n.param0(e).oid),n.localdatachannel_.bind(n,n.param0(e).oid),n.localdatachannel_.syncBarrier().then(function(){u.logger.log(n.user_friendly_id()+"channel.syncBarrier(): success")}).catch(function(){u.logger.log(n.user_friendly_id()+"channel.syncBarrier(): failed!")})}).catch(function(e){e=n.param0(e),u.logger.log(n.user_friendly_id()+".createDataChannel() failed with error: "+e)}),u.logger.log(this.user_friendly_id()+".createDataChannel() returning: "+this.localdatachannel_),this.localdatachannel_},t}(o.ProxyObject),t.PeerConnection=e}),define("audioelement","require exports proxyobject webrpcclassinfo logger hdxms".split(" "),function(e,t,n,r,i,o){Object.defineProperty(t,"__esModule",{value:!0}),e=function(e){function t(){var t=e.call(this,null,r.class_id_t.AudioElement,0,n.ProxyMode.Local)||this;return t.sinkId_="",t.srcObject_=null,t}return __extends(t,e),t.prototype.setSinkId=function(e){var t=this;return i.logger.log(this.user_friendly_id()+".setSinkId: set sinkId to "+e),new Promise(function(n,i){t.waitUntilConnected("AudioElement.sinkId").then(function(){var i=t.remoteInvoke(!0,r.method_id_AudioElement_t.sinkId,e);return o.getRedirector().getFeatureValue(r.FEATURE_ms_teams_pstn)||(t.sinkId_=e,n()),i}).then(function(){t.sinkId_=e,n()}).catch(function(e){e=t.logRemoteInvokeError(e,".sinkId setter: failed to connect!"),i(e)})})},t.prototype.sinkId=function(){return this.sinkId_},Object.defineProperty(t.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(e){var t=this;if(i.logger.log(this.user_friendly_id()+".srcObject: set srcObject to "+JSON.stringify(e)),e!==this.srcObject_){var n=null!==e&&void 0!==e?e.object_id():"null";this.waitUntilConnected("AudioElement.srcObject").then(function(){return t.remoteInvoke(!0,r.method_id_AudioElement_t.srcObject,n)}).then(function(){t.srcObject_=e,null===e&&t.release()}).catch(function(n){t.logRemoteInvokeError(n,".srcObject setter: failed to connect!"),null===e&&t.release()})}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this.src_},set:function(e){var t=this;i.logger.log(this.user_friendly_id()+".src: set src to "+e),this.src_=e,this.waitUntilConnected("AudioElement.src").then(function(){t.remoteInvoke(!0,r.method_id_AudioElement_t.src,e)}).catch(function(e){t.logRemoteInvokeError(e,".src setter: failed to connect!")})},enumerable:!0,configurable:!0}),t.prototype.play=function(){var e=this;i.logger.log(this.user_friendly_id()+".play() called."),this.waitUntilConnected("AudioElement.play").then(function(){e.remoteInvoke(!1,r.method_id_AudioElement_t.play,[])}).catch(function(t){e.logRemoteInvokeError(t,".play: failed to connect!")})},t.prototype.pause=function(){var e=this;i.logger.log(this.user_friendly_id()+".pause() called."),this.waitUntilConnected("AudioElement.pause").then(function(){e.remoteInvoke(!1,r.method_id_AudioElement_t.pause,[])}).catch(function(t){e.logRemoteInvokeError(t,".pause: failed to connect!")})},t}(n.ProxyObject),t.AudioElement=e}),define("videoelement","require exports proxyobject webrpcclassinfo logger hdxms webrpcclassinfo".split(" "),function(e,t,n,r,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){this.x=Math.round(e.x)*window.devicePixelRatio,this.y=Math.round(e.y)*window.devicePixelRatio,this.width=Math.round(e.width)*window.devicePixelRatio,this.height=Math.round(e.height)*window.devicePixelRatio};t.VideoRect=s;var c;!function(e){e[e.pixels=0]="pixels",e[e.percent=1]="percent"}(c||(c={}));var d,l=function(){function e(e){this.value=parseInt(e),this.units=this.detectUnits(e)}return e.prototype.detectUnits=function(e){return-1===e.toLowerCase().indexOf("px")?c.pixels:c.percent},e}();!function(e){e[e.fill=0]="fill",e[e.contain=1]="contain",e[e.cover=2]="cover"}(d||(d={}));var u,_=function(e,t){this.x=e,this.y=t},g=function(){function e(e,t,n){this.fit=this.convertFit(e),this.position=new _(t,n)}return e.prototype.convertFit=function(e){return"fill"==e?d.fill:"contain"==e?d.contain:"cover"==e?d.cover:d.fill},e}();!function(e){e[e.NotReady=0]="NotReady",e[e.Ready=1]="Ready"}(u||(u={})),e=function(e){function t(t){var o=e.call(this,null,r.class_id_t.VideoElement,0,n.ProxyMode.Local)||this;return o.srcObject_=null,o.sinkId_="",o.videoWidth=0,o.videoHeight=0,o.isLoaded=!1,o.connectionState="disconnected",o.styleObserver=null,o.readyState_=u.NotReady,o.deferredVideoActions=[],o.pendingRelease_=!1,o.activeConnectionEvent_=null,o.connectionEventQueue_=[],o.elementId=t,i.logger.log("VideoElement.constructor (elementid: "+t+")"),o}return __extends(t,e),t.prototype.dispose=function(){var e=this;i.logger.log("VideoElement.dispose (elementId: "+this.elementId+" oid: "+this.object_id()+")"),this.pendingRelease_=!0,this.srcObject=this.ontimeupdate=this.onloadedmetadata=null,this.waitUntilReady("VideoElement.dispose").then(function(){}).catch(function(){e.pendingRelease_=!1,e.setState("disconnected"),e.onconnectionstatechange=null,e.release()}),this.onReady()},t.prototype.setState=function(e){this.connectionState=e,this.onconnectionstatechange_&&this.onconnectionstatechange_()},Object.defineProperty(t.prototype,"Id",{get:function(){return this.elementId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sinkId",{get:function(){return this.sinkId_},set:function(e){var t=this;i.logger.log("VideoElement.sinkId: (id="+e+")"),this.waitUntilConnected("VideoElement.sinkId").then(function(){return void 0!=e?t.remoteInvoke(!0,r.method_id_VideoElement_t.sinkId,e):new Promise(function(e){return e(void 0)})}).then(function(){i.logger.log("videoElement: setting state to ready. (oid: "+t.object_id()+")"),t.sinkId_=e,t.readyState_=u.Ready,t.onReady()}).catch(function(e){t.logRemoteInvokeError(e,".set_sinkId() failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(e){if(i.logger.log(this.user_friendly_id()+".srcObject: set srcObject... this.srcObject:"+this.srcObject+" obj:"+e),this.srcObject_!==e){var t=o.getRedirector().getFeatureValue(a.FEATURE_ms_teams_1911);null!==this.srcObject_&&(null===e&&t&&this.disconnect(),t||this.disconnect(),this.isLoaded=!1),this.srcObject_=e,null!==this.srcObject_&&this.connectTo(this.srcObject_)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onconnectionstatechange",{get:function(){return this.onconnectionstatechange_},set:function(e){i.logger.log(this.user_friendly_id()+".set_onconnectionstatechange() called."),this.onconnectionstatechange_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onloadedmetadata",{set:function(e){i.logger.log(this.user_friendly_id()+".set_onloadedmetadata() called."),this.onloadedmetadata_=e},enumerable:!0,configurable:!0}),t.prototype.setupOnVideoFrameChanged=function(){var e=this,t=this.registerCallbacks(!1,!1,r.method_id_VideoElement_t.onvideoframechanged);t.then(function(t){i.logger.log(e.user_friendly_id()+".onvideoframechanged",t.params),e.videoWidth=t.params[0]||0,e.videoHeight=t.params[1]||0,e.isLoaded||(e.isLoaded=!0,e.onloadedmetadata_&&e.onloadedmetadata_())}),this.remoteInvoke(!0,r.method_id_VideoElement_t.onvideoframechanged,t.success)},t.prototype.processConnectionEvent=function(){var e=this;if(0!==this.connectionEventQueue_.length&&!this.activeConnectionEvent_){var t=this.connectionEventQueue_.pop();"connectTo"==t.operation?this.activeConnectionEvent_=this.connectToAsync(t.param):"disconnect"==t.operation&&(this.activeConnectionEvent_=this.disconnectAsync()),this.activeConnectionEvent_.then(function(){e.activeConnectionEvent_=void 0,e.processConnectionEvent()}).catch(function(){i.logger.log(e.user_friendly_id()+" : Failed to handle connection event! "),e.activeConnectionEvent_=void 0,e.processConnectionEvent()})}},t.prototype.connectTo=function(e){this.connectionEventQueue_.push({operation:"connectTo",param:e}),this.processConnectionEvent()},t.prototype.disconnect=function(){this.connectionEventQueue_.push({operation:"disconnect",param:null}),this.processConnectionEvent()},t.prototype.connectToAsync=function(e){var t=this;return new Promise(function(n,o){i.logger.log(t.user_friendly_id()+".connectTo: connect media stream with id = "+e.id+", clone_id = "+e.clone_state.clone_id),t.streamId_=e.id,t.waitUntilReady("VideoElement.connectTo").then(function(){return e.waitUntilConnected("MediaStream.connectTo")}).then(function(){return t.setupOnVideoFrameChanged(),e.clone_state.synchronize(e)}).then(function(e){i.logger.log(t.user_friendly_id()+".connectTo: remote invoking");var n=t.registerCallbacks(!0,!1,r.method_id_VideoElement_t.connectTo);return Promise.all([t.remoteInvoke(!1,r.method_id_VideoElement_t.connectTo,{oid:e.object_id()},n.success,n.fail),n.prom()])}).then(function(e){i.logger.log(t.user_friendly_id()+".connectTo: remote media stream is connected!"),t.setState("connected"),t.watch(),t.updateTimer=setInterval(function(){t.ontimeupdate&&t.ontimeupdate()},250),(e=window.document.getElementById(t.elementId))&&t.updateStyle(e),n()}).catch(function(e){t.logRemoteInvokeError(e,".connectTo: failed to connect!"),o()})})},t.prototype.disconnectAsync=function(){var e=this;return new Promise(function(t,n){i.logger.log(e.user_friendly_id()+".disconnect: disconnecting stream : "+e.streamId_),e.unwatch(),e.waitUntilReady("VideoElement.disconnect").then(function(){e.updateTimer&&clearInterval(e.updateTimer);var t=e.registerCallbacks(!1,!0,r.method_id_VideoElement_t.onvideoframechanged);return e.remoteInvoke(!0,r.method_id_VideoElement_t.onvideoframechanged,t.success),e.remoteInvoke(!1,r.method_id_VideoElement_t.disconnect)}).then(function(){i.logger.log(e.user_friendly_id()+".disconnect: remote media stream is disconnected!"),e.setState("disconnected"),1==e.pendingRelease_&&(e.pendingRelease_=!1,e.onconnectionstatechange=null,e.release()),t()}).catch(function(t){e.logRemoteInvokeError(t,".disconnect: failed to connect!"),n()})})},t.prototype.setFrame=function(e){var t=this;i.logger.log(this.user_friendly_id()+".setFrame: set video frame to",e.x,e.y,e.width,e.height),this.waitUntilReady("VideoElement.setFrame").then(function(){var n=new s(e);return t.remoteInvoke(!1,r.method_id_VideoElement_t.setFrame,n)}).then(function(){i.logger.log(t.user_friendly_id()+".setFrame: success!")}).catch(function(e){t.logRemoteInvokeError(e,".setFrame: failed to connect!")})},t.prototype.addClipRect=function(e){var t=this;i.logger.log(this.user_friendly_id()+".addClipRect: ",JSON.stringify(e)),this.waitUntilReady("VideoElement.addClipRect").then(function(){var n=new s(e);return t.remoteInvoke(!1,r.method_id_VideoElement_t.addClipRect,n)}).catch(function(e){t.logRemoteInvokeError(e,".addClipRect failed!")})},t.prototype.removeClipRect=function(e){var t=this;i.logger.log(this.user_friendly_id()+".removeClipRect: ",JSON.stringify(e)),this.waitUntilReady("VideoElement.removeClipRect").then(function(){var n=new s(e);return t.remoteInvoke(!1,r.method_id_VideoElement_t.removeClipRect,n)}).catch(function(e){t.logRemoteInvokeError(e,".removeClipRect failed!")})},t.prototype.watch=function(){var e=this;if(o.getRedirector().getFeatureValue(a.FEATURE_ms_teams_video_placement)){var t=window.document.getElementById(this.elementId);t&&(this.unwatch(),this.styleObserver=new MutationObserver(function(t){t.forEach(function(t){"style"==t.attributeName?e.updateStyle(t.target):e.elementId=t.target.id})}),this.styleObserver.observe(t,{attributes:!0,attributeOldValue:!0,attributeFilter:["style","id"]}))}},t.prototype.unwatch=function(){this.styleObserver&&(this.styleObserver.disconnect(),this.styleObserver=null)},t.prototype.updateStyle=function(e){if("connected"==this.connectionState){var t=window.getComputedStyle(e).getPropertyValue("object-fit"),n=window.getComputedStyle(e).getPropertyValue("object-position").split(" ");e=new l(n[0]),n=new l(n[1]),this.placement=new g(t,e,n)}else i.logger.log(this.user_friendly_id()+".updateStyle: video element is not connected")},Object.defineProperty(t.prototype,"placement",{get:function(){return this.placement_},set:function(e){var t=this;o.getRedirector().getFeatureValue(a.FEATURE_ms_teams_video_placement)?this.waitUntilReady("VideoElement.placement").then(function(){return t.remoteInvoke(!0,r.method_id_VideoElement_t.placement,e)}).then(function(){t.placement_=e}).catch(function(e){t.logRemoteInvokeError(e,".placement setter: failed to connect!")}):i.logger.log(this.user_friendly_id()+".placement: video placement feature is not supported on a client")},enumerable:!0,configurable:!0}),t.prototype.waitUntilReady=function(e){var t=this;return new Promise(function(r,o){i.logger.log("VideoElement.waitUntilReady(): readyState="+t.readyState_+". (oid: "+t.object_id()+")"),t.readyState_==u.Ready?r():(i.logger.log('videoElement.waitUntilReady(): deferring action "'+e+'". (oid: '+t.object_id()+")"),t.deferredVideoActions.push(new n.deferred_action(r,o,e)))})},t.prototype.onReady=function(){for(;this.deferredVideoActions&&0<this.deferredVideoActions.length;)this.deferredVideoActions.shift().post(this.readyState_==u.Ready)},t}(n.ProxyObject),t.VideoElement=e}),define("frametracker",["require","exports","logger","hdxms","videoelement"],function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t){this.resolve=e,this.reject=t},a=function(){function e(){this.name="overlay",this.reqs_=[],r.getRedirector().addProtocolHandler(this)}return e.prototype.init=function(e){},e.prototype.reset=function(){this.reqs_.forEach(function(e,t){e.reject()}),this.reqs_=[]},e.prototype.on_message=function(e){var t=this;if(n.logger.log("HDXMS: Overlay <<< "+JSON.stringify(e)),"capabilities"==e.command)new Promise(function(e,n){t.reqs_.push(new o(e,n)),r.getRedirector().WSSendObject({v:"overlay",command:"configure",caps:[]})});else{var i=this.reqs_.shift();void 0!=i?1==e.status&&("track_window"==e.command?i.resolve(e.windowId):"configure"==e.command?i.resolve({}):i.reject({})):n.logger.log("spurious response for message: "+e.command)}},e.prototype.registerWindowWithService=function(e){var t=this;return new Promise(function(i,a){var s=r.getRedirector();if(void 0==e){n.logger.log("FrameTrackerProtocol.registerWindowWithService: legacy case");var c=window.getWindowHandleAsHex.bind(window);void 0!==c&&null!==c||(n.logger.log("FrameTrackerProtocol.registerWindowWithService: getWindowHandle method is undefined or null"),a({})),Promise.all([c(),s.startRedirection(!1,"registerWindowWithService")]).then(function(e){n.logger.log("FrameTracker.registerWindowWithService: set window handle: "+e[0]),s.WSSendObject({v:"overlay",command:"window",windowHandle:e[0]}),i(void 0)})}else n.logger.log("FrameTrackerProtocol.registerWindowWithService: new MW case"),s.startRedirection(!1,"registerWindowWithService").then(function(){t.reqs_.push(new o(i,a)),s.WSSendObject({v:"overlay",command:"track_window",windowHandle:e})})})},e}(),s=function(){function e(e){var t=this;this.running_=!1,this.elements_=[],this.clipRects=new Set,this.videos_=[],this.connected_=!1,this.wheelEventHandler=function(e){setTimeout(function(){t.updateAll()},10)},this.keyupEventHandler=function(e){"Tab"!=e.code&&"ArrowUp"!=e.code&&"ArrowDown"!=e.code&&"ArrowLeft"!=e.code&&"ArrowRight"!=e.code&&"PageUp"!=e.code&&"PageDown"!=e.code&&"Home"!=e.code&&"End"!=e.code||t.updateAll()},n.logger.log("FrameTracker.constructor: (handle: "+e+")"),this.handle_=e,this.connectToService(),this.observer_=new MutationObserver(function(e){t.updateAll()})}return e.prototype.connectToService=function(){var t=this;e.Protocol.registerWindowWithService(this.handle_).then(function(e){n.logger.log("FrameTracker: connected to service. (windowId="+e+")"),t.connected_=!0,t.windowId_=e,t.videos_.forEach(function(e){e.sinkId=JSON.stringify(t.windowId_)}),t.videos_=[]})},Object.defineProperty(e.prototype,"handle",{get:function(){return this.handle_},enumerable:!0,configurable:!0}),e.prototype.getWindowFromElement=function(e){return e.ownerDocument.defaultView},e.prototype.rectanglesIntersect=function(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y},e.prototype.intersectingRect=function(e,t){var n=Math.max(e.left,t.left),r=Math.max(e.top,t.top);return new DOMRect(n,r,Math.min(e.right,t.right)-n,Math.min(e.bottom,t.bottom)-r)},e.prototype.pedigreeCount=function(e,t){for(var n=0,r=e.parentElement;null!=r&&r!=t;)n++,r=r.parentElement;return{isAncestor:null!=r,pedigree:n}},e.prototype.selectTopmost=function(e,t){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),n=this.intersectingRect(n,r);if((r=e.ownerDocument.elementFromPoint(n.left+n.width/2,n.top+n.height/2))==e)return e;if(r==t)return t;if(n=this.pedigreeCount(e,r),r=this.pedigreeCount(t,r),n.isAncestor&&r.isAncestor){if(n.pedigree<r.pedigree)return e;if(r.pedigree<n.pedigree)return t}else{if(n.isAncestor)return e;if(r.isAncestor)return t}},e.prototype.checkOverlappingVideos=function(e){var t=this,n=e.target.getBoundingClientRect();e.overlaps.forEach(function(t){e.target.remoteVideoElement.removeClipRect(t.rect)}),e.overlaps=[],this.elements_.forEach(function(r){if(r!=e){var i=r.overlaps.map(function(e){return e.element}).indexOf(e.target);if(-1!=i&&(i=r.overlaps.splice(i,1)[0],r.target.remoteVideoElement.removeClipRect(i.rect)),i=r.target.getBoundingClientRect(),t.rectanglesIntersect(n,i)){var o=t.selectTopmost(e.target,r.target);o==e.target?(r.overlaps.push({element:e.target,rect:n}),r.target.remoteVideoElement.addClipRect(n)):o==r.target&&(e.overlaps.push({element:r.target,rect:i}),e.target.remoteVideoElement.addClipRect(i))}}})},e.prototype.updateAll=function(){var e=this;this.elements_.forEach(function(t){var n=t.target.getBoundingClientRect();if(void 0!==n){var r=t.clientRect;void 0!==r&&r.x===n.x&&r.y===n.y&&r.width===n.width&&r.height===n.height||(t.clientRect=n,t.callback(n),e.checkOverlappingVideos(t)),void 0!==t.target.remoteVideoElement&&e.clipRects.forEach(function(e){t.target.remoteVideoElement.addClipRect(JSON.parse(e))})}})},e.prototype.track=function(e,t){var r=this,i=e.getBoundingClientRect();n.logger.log("Track element frame",e,JSON.stringify(i)),console.log(e),this.elements_.push({target:e,clientRect:void 0,callback:t,overlaps:[]});try{n.logger.log("[HdxWebRTC.js] Initializing occlusion for new videoElement"),this.clipRects.forEach(function(t){r.applyOcclusion(e,JSON.parse(t))})}catch(e){n.logger.log("[HdxWebRTC.js] addOcclusionInit failed! "+e)}this.running_||(n.logger.log("Start FrameTracker observer..."),this.observer_.observe(e.ownerDocument.body,{attributes:!0,childList:!0,subtree:!0}),(i=this.getWindowFromElement(e)).addEventListener("wheel",this.wheelEventHandler),i.addEventListener("keyup",this.keyupEventHandler),this.running_=!0),this.updateAll()},e.prototype.untrack=function(e){n.logger.log("Untrack element frame",e);var t=-1;if(this.elements_.forEach(function(n,r){n.target===e&&(t=r)}),0<=t&&(this.elements_.splice(t,1),0===this.elements_.length)){n.logger.log("Stop FrameTracker observer..."),this.observer_.disconnect();var r=this.getWindowFromElement(e);r.removeEventListener("wheel",this.wheelEventHandler),r.removeEventListener("keyup",this.keyupEventHandler),this.running_=!1}},e.prototype.applyOcclusion=function(e,t){var n=e.getBoundingClientRect();this.rectanglesIntersect(t,n)&&void 0!==e.remoteVideoElement&&e.remoteVideoElement.addClipRect(t)},e.prototype.addOcclusion=function(e){var t=this;n.logger.log("[HdxWebRTC.js] Adding occlusion "+JSON.stringify(e)),n.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements."),this.clipRects.add(JSON.stringify(e)),this.elements_.forEach(function(n){t.applyOcclusion(n.target,e)})},e.prototype.removeOcclusion=function(e){n.logger.log("[HdxWebRTC.js] Removing occlusion "+JSON.stringify(e)),n.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements."),this.clipRects.delete(JSON.stringify(e)),this.elements_.forEach(function(t){void 0!==t.target.remoteVideoElement&&t.target.remoteVideoElement.removeClipRect(e)})},e.prototype.newVideoElement=function(t){var r=this;if(n.logger.log("FrameTracker.newVideoElement: (id: "+t.id+")"),void 0!==t.remoteVideoElement)n.logger.log("Video element is already configured!!!");else{t.id||(t.id="ctx-vid-"+e.videoElementIDs++);var o=new i.VideoElement(t.id);this.connected_?(n.logger.log("FrameTracker.newVideoElement: initializing video element with sink id "+this.windowId_),o.sinkId=JSON.stringify(this.windowId_)):(n.logger.log("FrameTracker.newVideoElement: video element awaiting stable window state"),this.videos_.push(o)),o.onloadedmetadata=function(){t.dispatchEvent(new Event("loadedmetadata"))},o.ontimeupdate=function(){t.dispatchEvent(new Event("timeupdate"))},o.onconnectionstatechange=function(){"connected"==o.connectionState?r.track(t,function(e){o.setFrame(e)}):r.untrack(t)},Object.defineProperty(t,"remoteVideoElement",{writable:!0,value:null}),t.remoteVideoElement=o,Object.defineProperty(t,"srcObject",{get:function(){return o.srcObject},set:function(e){n.logger.log("VDI Shim set video element srcObject "+e),o.srcObject=e}}),Object.defineProperty(t,"videoWidth",{get:function(){return o.videoWidth}}),Object.defineProperty(t,"videoHeight",{get:function(){return o.videoHeight}})}},e.prototype.disposeVideoElement=function(e){n.logger.log("FrameTracker.disposeVideoElement: (id: "+e.id+")");var t=e.remoteVideoElement;if(void 0!=t){var r=this.videos_.findIndex(function(e){return e.Id==t.Id});-1<r&&this.videos_.splice(r,1),t.dispose(),e.remoteVideoElement=void 0}},e.videoElementIDs=0,e.Protocol=new a,e}();t.FrameTracker=s,e=function(){function e(){this.frames_=[]}return e.prototype.newFrame=function(e){n.logger.log("Frames.newFrame: (handle: "+e+")");var t=this.findFrame(e);return void 0==t&&(t=new s(e),this.frames_.push(t)),t},e.prototype.disposeFrame=function(e){n.logger.log("Frames.disposeFrame: (handle: "+e+")");var t=this.frames_.findIndex(function(t){return t.handle==e});-1<t&&this.frames_.splice(t,1)},e.prototype.findFrame=function(e){return n.logger.log("Frames.findFrame: (handle: "+e+")"),void 0!=e?this.frames_.find(function(t){return t.handle==e}):this.frames_[0]},e.prototype.reconnect=function(){n.logger.log("Frames.reconnect()"),this.frames_.forEach(function(e){e.connectToService()})},e}(),t.Frames=e}),define("e911service",["require","exports","webrpcclassinfo","proxyobject","logger"],function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),e=function(e){function t(){return e.call(this,null,n.class_id_t.E911Service,0,r.ProxyMode.Local)||this}return __extends(t,e),Object.defineProperty(t.prototype,"onupdate",{get:function(){return this.onupdate_},set:function(e){var t=this;this.onupdate_=e,this.waitUntilConnected(this.user_friendly_id()+".onupdate").then(function(){var e=t.registerCallbacks(!1,t.isNullCallback(t.onupdate_),n.method_id_E911Service_t.onupdate);return e.then(function(e){var n=(e=e.params)[0];e.slice(1),i.logger.log(t.user_friendly_id()+".onupdate",JSON.stringify(n)),t.onupdate_&&t.onupdate_(n)}),t.remoteInvoke(!0,n.method_id_E911Service_t.onupdate,e.success)}).catch(function(){return i.logger.log(t.user_friendly_id()+".onupdate, could not set listener")})},enumerable:!0,configurable:!0}),t.prototype.getE911Info=function(){var e=this;return new Promise(function(t,r){e.waitUntilConnected(e.user_friendly_id()+".getE911Info").then(function(){return e.remoteInvoke(!1,n.method_id_E911Service_t.getE911Info)}).then(function(n){i.logger.log(e.user_friendly_id()+".getE911Info",JSON.stringify(e.param0(n))),t(e.param0(n))}).catch(function(){i.logger.log(e.user_friendly_id()+".getE911Info promise rejected"),r()})})},t.prototype.updateE911Info=function(){var e=this;this.getE911Info().then(function(t){return e.onupdate&&e.onupdate(t)}).catch(function(){return i.logger.log("Fail to get e911 information!")})},t}(r.ProxyObject),t.E911Service=e}),define("givetakecontrol",["require","exports","logger","proxyobject","webrpcclassinfo"],function(e,t,n,r,i){Object.defineProperty(t,"__esModule",{value:!0}),e=function(e){function t(t){return e.call(this,null,i.class_id_t.GiveTakeControl,0,r.ProxyMode.Local,null,{oid:t?t.object_id():-1})||this}return __extends(t,e),t.prototype.createVirtualCursor=function(e){var t=this;this.waitUntilConnected(this.user_friendly_id()+".createVirtualCursor").then(function(){return t.remoteInvoke(!1,i.method_id_GiveTakeControl_t.createVirtualCursor,e)}).catch(function(){return n.logger.log(t.user_friendly_id()+".createVirtualCursor failed, id = "+e)})},t.prototype.destroyCursor=function(e){var t=this;this.waitUntilConnected(this.user_friendly_id()+".destroyCursor").then(function(){return t.remoteInvoke(!1,i.method_id_GiveTakeControl_t.destroyCursor,e)}).catch(function(){return n.logger.log(t.user_friendly_id()+".destroyCursor failed, id = "+e)})},t.prototype.showVirtualCursor=function(e,t){var r=this;this.waitUntilConnected(this.user_friendly_id()+".showVirtualCursor").then(function(){return r.remoteInvoke(!1,i.method_id_GiveTakeControl_t.showVirtualCursor,e,t)}).catch(function(){return n.logger.log(r.user_friendly_id()+".showVirtualCursor failed, id = "+e)})},t.prototype.setAvatar=function(e,t){var r=this;this.waitUntilConnected(this.user_friendly_id()+".setAvatar").then(function(){return r.remoteInvoke(!1,i.method_id_GiveTakeControl_t.setAvatar,e,{data:t,width:32,height:32})}).catch(function(){return n.logger.log(r.user_friendly_id()+".setAvatar failed, id = "+e)})},t.prototype.injectMouseEvent=function(e,t){var r=this;return new Promise(function(o,a){r.waitUntilConnected(r.user_friendly_id()+".injectMouseEvent").then(function(){return r.remoteInvoke(!1,i.method_id_GiveTakeControl_t.injectMouseEvent,e,t)}).then(function(e){o(r.param0(e))}).catch(function(){n.logger.log(r.user_friendly_id()+".injectMouseEvent failed, id = "+e),a(-7)})})},t.prototype.injectKeyboardEvent=function(e,t){var r=this;return new Promise(function(o,a){r.waitUntilConnected(r.user_friendly_id()+".injectKeyboardEvent").then(function(){return r.remoteInvoke(!1,i.method_id_GiveTakeControl_t.injectKeyboardEvent,e,t)}).then(function(e){o(r.param0(e))}).catch(function(){n.logger.log(r.user_friendly_id()+".injectKeyboardEvent failed, id = "+e),a(-8)})})},t.prototype.injectClipboardText=function(e,t){var r=this;return new Promise(function(o,a){r.waitUntilConnected(r.user_friendly_id()+".injectClipboardText").then(function(){return r.remoteInvoke(!1,i.method_id_GiveTakeControl_t.injectClipboardText,e,t)}).then(function(e){o(r.param0(e))}).catch(function(){n.logger.log(r.user_friendly_id()+".injectClipboardText failed, id = "+e),a(-9)})})},t.prototype.dispose=function(){var e=this;this.waitUntilConnected(this.user_friendly_id()+".dispose").then(function(){return e.remoteInvoke(!1,i.method_id_GiveTakeControl_t.dispose)}).then(function(){e.release()}).catch(function(){n.logger.log(e.user_friendly_id()+".dispose failed"),e.release()})},t}(r.ProxyObject),t.GiveTakeControl=e});var vdishim=require("./peerconnection"),rmshim=require("./remotemedia"),videoelem=require("./videoelement"),audioelem=require("./audioelement"),frametracker=require("./frametracker"),logger=require("./logger").logger,remotesession=require("./remotesession"),screensharing=require("./screensharing"),garbagecollector=require("./garbagecollector").gc,HdxMediaStream=require("./hdxms"),$jscomp$destructuring$var0=require("./e911service"),E911Service=$jscomp$destructuring$var0.E911Service,$jscomp$destructuring$var1=require("./givetakecontrol"),GiveTakeControl=$jscomp$destructuring$var1.GiveTakeControl;!function(e,t){"object"==typeof module&&module.exports?module.exports=t():e.vdiPeerConnection=t()}("undefined"!=typeof self?self:this,function(){function e(e,t,n){logger.log("VDI Shim disposeVideoElement: ")}function t(e){null==p&&(p=new frametracker.Frames),e(p)}function n(e,n){t(function(t){var r=t.findFrame(e);void 0==r&&(r=t.newFrame(e)),n(r)})}function r(e,n){t(function(t){null!=(t=t.findFrame(e))&&n(t)})}function e(e,t){r(t,function(t){t.disposeVideoElement(e)})}function i(e){HdxMediaStream.getRedirector().SendTelemetryData_Speaker(e)}function o(){window.getCitrixMSTeamsRedir().then(function(e){logger.log("sucesss on connect, CitrixMSTeamsRedir reg value:"+e),"1"===e&&null===b&&(logger.log("supported client"),b=new remotesession.RemoteSession)}).catch(function(){logger.log("Failure to Read MS Teams redir Reg Key"),s()})}function a(e){if("1"===e)logger.log("Supported client"),HdxMediaStream.getRedirector().pingConnectionBegin(!0);else if("0"===e){logger.log("VDI Event: Unsupported client reported");try{v({event:"vdiClientDisconnected",reason:"endpointUnsupported",msg:"Unsupported endpoint connected"})}catch(e){logger.log("onVMEvent(): exception: "+e.message)}}else logger.log("MS Teams Redir Reg Key value not correct")}function s(){!1===R&&(logger.log("starting MS Reg retry..."),R=!0,c(10))}function c(e){if(0>=e){R=!1,logger.log("VDI Event: Reg Key not Updated after timer reported, Fallback");try{v({event:"vdiClientDisconnected",reason:"failure",msg:"Citrix MS Teams Reg Key not Present"})}catch(e){logger.log("onVMEvent(): exception: "+e.message)}}else window.getCitrixMSTeamsRedir().then(function(t){logger.log("CitrixMSTeamsRedir reg value:"+t),"0"===t||"1"===t?(a(t),R=!1):(logger.log("MS Teams Redir Reg key not updated - Start timer"),setTimeout(function(){logger.log("Timer waiting for registry to be updated count :"+e),c(--e)},1e3))}).catch(function(){logger.log("Failure to Read MS Teams redir Reg Key - Start timer"),setTimeout(function(){logger.log("Timer waiting for registry to be updated count :"+e),c(--e)},1e3)})}function d(){logger.log("VDI: sendSessionInfo"),b&&b.getSessionInfo().then(function(e){logger.log("getSessionInfo success! info:"+JSON.stringify(e));try{v({event:"vdiClientConnected",version:e,endpointId:e.endpointId})}catch(e){logger.log("onVMEvent(): exception: "+e.message)}}).catch(function(){logger.log("getSessionInfo failure! session is not fully connected yet...")})}function l(){return T||(T=new screensharing.ScreenSharing,T.onscreentopologychanged=function(){if(v)try{v({event:"vdiScreenTopologyChanged"})}catch(e){logger.log("onVMEvent('vdiScreenTopologyChanged'): exception: "+e.message)}}),T}var u=vdishim.PeerConnection,_=new rmshim.NavigatorUserMedia,g=_.webkitGetUserMedia,h=rmshim.NavigatorUserMedia.getCapabilities,f=new rmshim.RemoteDevices,p=new frametracker.Frames,m=[],v=void 0,y=null,C=!1;window.onVdiClientDisconnected=function(e){if(logger.log("VDI Event: vdiClientDisconnected"),logger.log("VDI : cleanup"),HdxMediaStream.getRedirector().clearReqs(),rmshim.NavigatorUserMedia.resetcaps(),p=f=_=null,m=[],b&&b.release(),T=b=null,garbagecollector.reset(),logger.log("VDI : cleanup done"),y&&(y.release(),y=null),!0===e&&!1===C){logger.log("VDI Event: vdiClientDisconnected with failure reported"),C=!0;try{v({event:"vdiClientDisconnected",reason:"failure",msg:"Websocket Connection Failure"})}catch(e){logger.log("onVMEvent(): exception: "+e.message)}}else{C=!1;try{v({event:"vdiClientDisconnected",reason:"endpointDisconnected"})}catch(e){logger.log("onVMEvent(): exception: "+e.message)}}};var b=new remotesession.RemoteSession;window.onVdiClientDisconnectedTimer=function(){logger.log("VDI Event: onVdiClientDisconnectedTimer"),null===b&&(b=new remotesession.RemoteSession)},window.onVdiClientConnected=function(){logger.log("VDI Event: vdiClientConnected"),y||(y=new E911Service,y.onupdate=function(e){if(v)try{v(Object.assign({event:"vdiE911InfoChanged"},e))}catch(e){logger.log("Exception onVMEvent(), eventName:vdiE911InfoChanged message:"+e.message)}},y.updateE911Info()),t(function(e){e.reconnect()}),null!==f&&f.isValid()||(f=new rmshim.RemoteDevices),null!==_&&_.isValid()||(_=new rmshim.NavigatorUserMedia),_.getCapabilities().then(function(e){logger.log(".getCapabilities() success "+e)}).catch(function(){logger.log(".getCapabilities() failure")}),d()};var R=!1,T=null;return window.stopAppshare=function(){T&&T.stopAppshare()},{createPeerConnection:function(e,t){o();var n=new u(e,t),r=n.addIceCandidate;n.addIceCandidate=function(){return logger.log("VDI Shim addIceCandidate"),r.apply(n,arguments)};var i=n.createOffer;n.createOffer=function(){return logger.log("VDI Shim createOffer"),i.apply(n,arguments)};var a=n.createAnswer;n.createAnswer=function(){return logger.log("VDI Shim createAnswer"),a.apply(n,arguments)};var s=n.setRemoteDescription;n.setRemoteDescription=function(){return logger.log("VDI Shim setRemoteDescription"),s.apply(n,arguments)};var c=n.setLocalDescription;n.setLocalDescription=function(){return logger.log("VDI Shim setLocalDescription"),c.apply(n,arguments)};var d=n.getLocalStreams;n.getLocalStreams=function(){return logger.log("VDI Shim getLocalStreams"),d.apply(n,arguments)};var l=n.getRemoteStreams;n.getRemoteStreams=function(){return logger.log("VDI Shim getRemoteStreams"),l.apply(n,arguments)};var _=n.getStats;if(n.getStats=function(){return _.apply(n,arguments)},null!==b&&remotesession.RemoteSession.isFeaturePstnSupported()&&remotesession.RemoteSession.isFeatureDtmfSupported()){var g=n.addTrack;n.addTrack=function(){return logger.log("VDI Shim addTrack"),g.apply(n,arguments)};var h=n.removeTrack;n.removeTrack=function(){return logger.log("VDI Shim removeTrack"),h.apply(n,arguments)}}else n.addTrack=void 0,n.removeTrack=void 0;if(null!==b&&remotesession.RemoteSession.isFeatureWebrtc1dot0Supported()){Object.defineProperty(n,"connectionState",{get:function(){return n.get_connectionState()}});var f=n.addTransceiver;n.addTransceiver=function(){return logger.log("VDI Shim addTransceiver"),f.apply(n,arguments)};var p=n.getTransceivers;n.getTransceivers=function(){return logger.log("VDI Shim getTransceivers"),p.apply(n,arguments)}}else n.addTransceiver=void 0,n.getTransceivers=void 0;var m=n.addStream;n.addStream=function(){return logger.log("VDI Shim addStream"),m.apply(n,arguments)};var v=n.removeStream;n.removeStream=function(){return logger.log("VDI Shim removeStream"),v.apply(n,arguments)};var y=n.getReceivers;if(n.getReceivers=function(){return logger.log("VDI Shim getReceivers"),y.apply(n,arguments)},null!==b&&remotesession.RemoteSession.isFeaturePstnSupported()&&remotesession.RemoteSession.isFeatureDtmfSupported()){var C=n.getSenders;n.getSenders=function(){return logger.log("VDI Shim getSenders"),C.apply(n,arguments)}}else n.getSenders=void 0;if(null!==b&&remotesession.RemoteSession.isFeatureDataChannelSupported()){var R=n.createDataChannel;n.createDataChannel=function(){return logger.log("VDI Shim createDataChannel"),R.apply(n,arguments)}}else n.createDataChannel=void 0;var T=n.close;return n.close=function(){return logger.log("VDI Shim close"),T.apply(n,arguments)},n},getUserMediaShim:function(e,t,n){return o(),logger.log("VDI Shim getUserMedia"),null!==_&&_.isValid()||(_=new rmshim.NavigatorUserMedia,g=_.webkitGetUserMedia),g.apply(_,arguments)},getDisplayMediaShim:function(e){return o(),logger.log("VDI Shim getDisplayMedia"),null!==f&&f.isValid()||(f=new rmshim.RemoteDevices),f.getDisplayMedia.apply(f,arguments)},enumerateDevicesShim:function(){return o(),logger.log("VDI Shim enumerateDevices"),null!==f&&f.isValid()||(f=new rmshim.RemoteDevices),f.enumerateDevices.apply(f,arguments)},newAudioElement:function(e){logger.log("VDI New Audio Element Created, Creating Mapping to Thin Client DOM "),void 0!==e.remoteAudioElement?logger.log("Audio element is already configured!!!"):(o(),Object.defineProperty(e,"remoteAudioElement",{writable:!0,value:null}),e.remoteAudioElement=new audioelem.AudioElement,Object.defineProperty(e,"sinkId",{writable:!0}),e.setSinkId=function(t){logger.log("VDI Shim set audio element SinkId value = "+t);var n,r=e.remoteAudioElement.setSinkId(t);return rmshim.enumerateddecices.forEach(function(e){t==e.deviceId&&(n=e.label)}),i(n),r},Object.defineProperty(e,"srcObject",{get:function(){return e.remoteAudioElement.srcObject},set:function(t){if(logger.log("VDI Shim set audio element srcObject "+JSON.stringify(t)),null===t||void 0===t){if(null!==e.remoteAudioElement.srcObject){t=e.remoteAudioElement.srcObject.getTracks();var n=$jscomp.makeIterator(t);for(t=n.next();!t.done;t=n.next())t.value.enabled=!1}e.remoteAudioElement.release()}else for(e.remoteAudioElement.srcObject=t,t=t.getTracks(),n=$jscomp.makeIterator(t),t=n.next();!t.done;t=n.next())t.value.enabled=!0}}))},newVideoElement:function(e,t){logger.log("VDI New Video Element Created, Creating Mapping to Thin Client DOM"),o(),n(t,function(t){t.newVideoElement(e)})},disposeVideoElement:e,setVMEventCallback:function(e){v=e,logger.log("VDI Event Callback Set")},playNotifyAudio:function(e,t){if(0==t.lastIndexOf("file",0)){var n=t.search("/audio");t="https://teams.microsoft.com/assets"+t.slice(n)}logger.log("VDI Shim Audio Notification Playing, Remote to Thin Client "+t),void 0===(n=m.find(function(t){return t.Id===e}))?(n=new audioelem.AudioElement,n.Id=e,n.src=t,m.push(n)):n.src=t,n.play()},pauseNotifyAudio:function(e,t){if(""!==t){var n=m.find(function(t){return t.Id===e});void 0!==n&&(t=n.src,n.pause()),logger.log("VDI Shim Audio Notification Paused, Remote to Thin Client "+t)}},setSinkId:function(e,t){logger.log("VDI Shim Audio setSinkId audioId:"+e+" sinkId:"+t);var n=m.find(function(t){return t.Id==e});void 0===n?(n=new audioelem.AudioElement,n.Id=e,n.sinkId=t,m.push(n)):n.sinkId=t},setDefaultSinkId:function(e){logger.log("VDI Shim Audio setSinkId sinkId:"+e)},addClipRect:function(e,t){logger.log("VDI Adding Occlusion "+JSON.stringify(e)),n(t,function(t){t.addOcclusion(e)})},removeClipRect:function(e,t){logger.log("VDI Removing Occlusion "+JSON.stringify(e)),n(t,function(t){t.removeOcclusion(e)})},init:function(e){logger.setMSLogger(e),logger.log("VDI init logger")},isFeatureSupported:function(e){return null!==b&&b.isFeatureSupported(e)},connectedStateChanged:function(e){logger.log("VDI : connectedStateChanged to "+e),0==e?logger.log("Disconnecting from the VDA"):(logger.log("Connecting to the VDA"),window.getCitrixMSTeamsRedir().then(function(e){logger.log("Sucesss on connect, CitrixMSTeamsRedir reg value:"+e),"0"===e||"1"===e?a(e):(logger.log("MS Teams Redir Reg key not updated yet"),s())}).catch(function(){logger.log("Failure to Read MS Teams redir Reg Key"),s()}))},setLoop:function(e,t){logger.log("VDI : setloop")},getScreensAsync:function(){logger.log("VDI Shim getScreensAsync"),o();var e=l();return e.getScreensAsync.apply(e,arguments)},getWindowsAsync:function(){logger.log("VDI Shim getWindowsAsync"),o();var e=l();return e.getWindowsAsync.apply(e,arguments)},setScreenSharePanelId:function(e){logger.log("VDI: setScreenSharePanelId set to "+JSON.stringify(e)),o();var t=!1;null!==b&&remotesession.RemoteSession.isFeaturAppshareSupported()&&(t=!0),f.clearPanelId(),l().setScreenSharePanelId(e,t).then(function(e){null!==e&&void 0!==e&&(null!==f&&f.isValid()||(f=new rmshim.RemoteDevices),f.panelid=e)}).catch(function(){logger.log("VDI: setScreenSharePanelId: failed: "+e)})},setCodecCapabilities:function(e){return logger.log("VDI Shim setCodecCapabilities"),null!==_&&_.isValid()||(_=new rmshim.NavigatorUserMedia),_.setCodecCapabilities(e)},getE911Info:function(){return y?y.getE911Info():null},createControlInjector:function(e){var t=e;return logger.log("VDI createControlInjector, mediaStream id = "+(t&&t.id||"unknown")),"RemoteStream"!=typeof e&&(logger.log("VDI createControlInjector, mediaStream type is not RemoteStream"),t=null),new GiveTakeControl(t)},getRemotingType:function(){logger.log("VDI getRemotingType");var e={desktop:"Desktop",seamless:"App"},t=void 0,n=HdxMediaStream.getRedirector();return n&&n.clientViewportMode&&(t=e[n.clientViewportMode.toLowerCase()]),t||"Unknown"},createMediaStream:function(e){return logger.log("VDI Shim createMediaStream"),o(),new rmshim.RemoteStream(null,0,0,e)},getCapabilitiesShim:function(e){return o(),logger.log("VDI Shim getCapabilitiesShim"),null!==_&&_.isValid()||(_=new rmshim.NavigatorUserMedia,h=rmshim.NavigatorUserMedia.getCapabilities),h.apply(_,arguments)},disposeVideoElement:e,disposeAudioElement:function(e,t,n){logger.log("VDI Shim disposeAudioElement: ")},onWindowClose:function(e,t,n){logger.log("VDI Shim onWindowClose: ")}}});