!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("lodash"),require("@skype/rt-js-bindings")):"function"==typeof define&&define.amd?define("skype-calling-electron",["lodash","@skype/rt-js-bindings"],t):"object"==typeof exports?exports["skype-calling-electron"]=t(require("lodash"),require("@skype/rt-js-bindings")):e["skype-calling-electron"]=t(e.lodash,e["@skype/rt-js-bindings"])}(window,function(e,t){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(t){return e[t]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=76)}([function(e,t,n){"use strict";function r(e){return U.f.toString.call(e)}function i(e,t){return typeof e===t}function o(e){return void 0===e||typeof e===U.l}function a(e){return null===e||o(e)}function s(e){return!a(e)}function c(e,t){return e&&U.e.call(e,t)}function l(e){return typeof e===U.j}function u(e){return typeof e===U.h}function d(e,t,n,r){void 0===r&&(r=!1);var i=!1;if(!a(e))try{a(e[q])?a(e[W])||(e[W](G+t,n),i=!0):(e[q](t,n,r),i=!0)}catch(e){}return i}function p(e,t,n,r){if(void 0===r&&(r=!1),!a(e))try{a(e[z])?a(e[K])||e[K](G+t,n):e[z](t,n,r)}catch(e){}}function h(e){var t=e,n=/([^\w\d_$])/g;return n.test(e)&&(t=e.replace(n,"_")),t}function g(e,t){if(e)for(var n in e)U.e.call(e,n)&&t.call(e,n,e[n])}function f(e,t){if(e&&t){var n=t.length,r=e.length;if(e===t)return!0;if(r>=n){for(var i=r-1,o=n-1;o>=0;o--){if(e[i]!=t[o])return!1;i--}return!0}}return!1}function _(e,t){var n=!1;if(e&&t){var r=t.length;if(e===t)return!0;if(e.length>=r){for(var i=0;i<r;i++)if(e[i]!==t[i])return!1;n=!0}}return n}function m(e,t){return!(!e||!t)&&-1!==e.indexOf(t)}function v(e){return"[object Date]"===r(e)}function y(e){return"[object Array]"===r(e)}function C(e){return"[object Error]"===r(e)}function S(e){return"string"==typeof e}function I(e){return"number"==typeof e}function O(e){return"boolean"==typeof e}function T(e){if(v(e)){var t=function(e){var t=String(e);return 1===t.length&&(t="0"+t),t};return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}function E(e,t,n){for(var r=e.length,i=0;i<r&&!(i in e&&-1===t.call(n||e,e[i],i,e));i++);}function P(e,t,n){for(var r=e.length,i=n||0,o=Math.max(i>=0?i:r-Math.abs(i),0);o<r;o++)if(o in e&&e[o]===t)return o;return-1}function b(e,t,n){for(var r=e.length,i=n||e,o=new Array(r),a=0;a<r;a++)a in e&&(o[a]=t.call(i,e[a],e));return o}function A(e,t,n){var r,i=e.length,o=0;if(arguments.length>=3)r=arguments[2];else{for(;o<i&&!(o in e);)o++;r=e[o++]}for(;o<i;)o in e&&(r=t(r,e[o],o,e)),o++;return r}function R(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"")}function w(e){var t=typeof e;t===U.h||t===U.j&&null!==e||Object(B.c)("objKeys called on non-object");var n=[];for(var r in e)e&&U.e.call(e,r)&&n.push(r);if(Q)for(var i=Y.length,o=0;o<i;o++)e&&U.e.call(e,Y[o])&&n.push(Y[o]);return n}function L(e,t,n,r){if(J)try{var i={enumerable:!0,configurable:!0};return n&&(i.get=n),r&&(i.set=r),J(e,t,i),!0}catch(e){}return!1}function N(){var e=Date;return e.now?e.now():(new e).getTime()}function D(e){return C(e)?e.name:""}function M(e,t,n,r,i){var o=n;return e&&((o=e[t])===n||i&&!i(o)||r&&!r(n)||(o=n,e[t]=o)),o}function j(e,t,n){var r;return e?!(r=e[t])&&a(r)&&(r=o(n)?{}:n,e[t]=r):r=o(n)?{}:n,r}function k(e){return!e}function F(e){return!!e}function x(e){throw new Error(e)}function V(e,t,n){if(e&&t&&e!==t&&l(e)&&l(t)){for(var r in t)!function(r){if(S(r)){var i=t[r];u(i)?n&&!n(r,!0,t,e)||(e[r]=function(e){return function(){var n=arguments;return t[e].apply(t,n)}}(r)):n&&!n(r,!1,t,e)||(c(e,r)&&delete e[r],L(e,r,function(){return t[r]},function(e){t[r]=e})||(e[r]=i))}}(r)}return e}function H(e){return e&&(e=Object(U.b)(U.a?Object(U.a)({},e):e)),e}n.d(t,"w",function(){return i}),n.d(t,"x",function(){return o}),n.d(t,"r",function(){return a}),n.d(t,"p",function(){return s}),n.d(t,"j",function(){return c}),n.d(t,"t",function(){return l}),n.d(t,"o",function(){return u}),n.d(t,"e",function(){return d}),n.d(t,"g",function(){return p}),n.d(t,"y",function(){return h}),n.d(t,"A",function(){return g}),n.d(t,"G",function(){return f}),n.d(t,"H",function(){return _}),n.d(t,"F",function(){return m}),n.d(t,"m",function(){return v}),n.d(t,"k",function(){return y}),n.d(t,"n",function(){return C}),n.d(t,"u",function(){return S}),n.d(t,"s",function(){return I}),n.d(t,"l",function(){return O}),n.d(t,"K",function(){return T}),n.d(t,"a",function(){return E}),n.d(t,"b",function(){return P}),n.d(t,"c",function(){return b}),n.d(t,"d",function(){return A}),n.d(t,"I",function(){return R}),n.d(t,"B",function(){return w}),n.d(t,"z",function(){return L}),n.d(t,"f",function(){return N}),n.d(t,"h",function(){return D}),n.d(t,"E",function(){return M}),n.d(t,"i",function(){return j}),n.d(t,"q",function(){return k}),n.d(t,"v",function(){return F}),n.d(t,"J",function(){return x}),n.d(t,"D",function(){return V}),n.d(t,"C",function(){return H});var U=n(1),B=n(16),G="on",W="attachEvent",q="addEventListener",K="detachEvent",z="removeEventListener",J=U.d,Q=(U.b.freeze,U.b.seal,!{toString:null}.propertyIsEnumerable("toString")),Y=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]},function(e,t,n){"use strict";n.d(t,"h",function(){return r}),n.d(t,"j",function(){return i}),n.d(t,"l",function(){return o}),n.d(t,"k",function(){return a}),n.d(t,"i",function(){return s}),n.d(t,"g",function(){return c}),n.d(t,"b",function(){return l}),n.d(t,"f",function(){return u}),n.d(t,"a",function(){return d}),n.d(t,"c",function(){return p}),n.d(t,"d",function(){return h}),n.d(t,"e",function(){return g});var r="function",i="object",o="undefined",a="prototype",s="hasOwnProperty",c="default",l=Object,u=l[a],d=l.assign,p=l.create,h=l.defineProperty,g=u[s]},function(e,t,n){"use strict";function r(e,t){return e&&D[C].hasOwnProperty.call(e,t)}function i(e){return e&&(e===D[C]||e===Array[C])}function o(e){return i(e)||e===Function[C]}function a(e){if(e){if(M)return M(e);var t=e[w]||e[C]||(e[y]?e[y][C]:null);if(t)return t}return null}function s(e,t){var n=[],i=D.getOwnPropertyNames;if(i)n=i(e);else for(var o in e)"string"==typeof o&&r(e,o)&&n.push(o);if(n&&n.length>0)for(var a=0;a<n.length;a++)t(n[a])}function c(e,t,n){return t!==y&&typeof e[t]===S&&(n||r(e,t))}function l(e){throw new TypeError("DynamicProto: "+e)}function u(e){var t={};return s(e,function(n){!t[n]&&c(e,n,!1)&&(t[n]=e[n])}),t}function d(e,t){for(var n=e.length-1;n>=0;n--)if(e[n]===t)return!0;return!1}function p(e,t,n,r){function i(e,t,n){var i=t[n];if(i[O]&&r){var o=e[I]||{};!1!==o[b]&&(i=(o[t[T]]||{})[n]||i)}return function(){return i.apply(e,arguments)}}var l={};s(n,function(e){l[e]=i(t,n,e)});for(var u=a(e),p=[];u&&!o(u)&&!d(p,u);)s(u,function(e){!l[e]&&c(u,e,!M)&&(l[e]=i(t,u,e))}),p.push(u),u=a(u);return l}function h(e,t,n,i){var s=null;if(e&&r(n,T)){var c=e[I]||{};if((s=(c[n[T]]||{})[t])||l("Missing ["+t+"] "+S),!s[P]&&!1!==c[b]){for(var u=!r(e,t),p=a(e),h=[];u&&p&&!o(p)&&!d(h,p);){var g=p[t];if(g){u=g===i;break}h.push(p),p=a(p)}try{u&&(e[t]=s),s[P]=1}catch(e){c[b]=!1}}}return s}function g(e,t,n){var r=t[e];return r===n&&(r=a(t)[e]),typeof r!==S&&l("["+e+"] is not a "+S),r}function f(e,t,n,o,a){function l(e,t){var n=function(){return(h(this,t,e,n)||g(t,e,n)).apply(this,arguments)};return n[O]=1,n}if(!i(e)){var u=n[I]=n[I]||{},d=u[t]=u[t]||{};!1!==u[b]&&(u[b]=!!a),s(n,function(t){c(n,t,!1)&&n[t]!==o[t]&&(d[t]=n[t],delete n[t],(!r(e,t)||e[t]&&!e[t][O])&&(e[t]=l(e,t)))})}}function _(e,t){if(M)for(var n=[],r=a(t);r&&!o(r)&&!d(n,r);){if(r===e)return!0;n.push(r),r=a(r)}return!1}function m(e,t){return r(e,C)?e.name||t||R:((e||{})[y]||{}).name||t||R}function v(e,t,n,i){r(e,C)||l("theClass is an invalid class definition.");var o=e[C];_(o,t)||l("["+m(e)+"] is not in class hierarchy of ["+m(t)+"]");var a=null;r(o,T)?a=o[T]:(a=E+m(e,"_")+"$"+j,j++,o[T]=a);var s=v[A],c=!!s[L];c&&i&&void 0!==i[L]&&(c=!!i[L]);var d=u(t);n(t,p(o,t,d,c));var h=!!M&&!!s[N];h&&i&&(h=!!i[N]),f(o,a,t,d,!1!==h)}var y="constructor",C="prototype",S="function",I="_dynInstFuncs",O="_isDynProxy",T="_dynClass",E="_dynCls$",P="_dynInstChk",b=P,A="_dfOpts",R="_unknown_",w="__proto__",L="useBaseInst",N="setInstFuncs",D=Object,M=D.getPrototypeOf,j=0,k={setInstFuncs:!0,useBaseInst:!0};v[A]=k,t.a=v},function(e,t,n){"use strict";function r(e){return!(""===e||Object(L.r)(e))}function i(e){if(e){var t=e.indexOf("-");if(t>-1)return e.substring(0,t)}return""}function o(){return null===x&&(x=Object(w.q)()&&Boolean(Object(w.k)().sendBeacon)),x}function a(){return null===V&&(V=!Object(L.x)(Uint8Array)&&!C()&&!Object(w.t)()),V}function s(e){return!!(e&&Object(L.s)(e)&&e>=R.a.Normal&&e<=R.a.Immediate)}function c(e,t,n){if(!t&&!r(t)||"string"!=typeof e)return null;var i=typeof t;if("string"===i||"number"===i||"boolean"===i||Object(L.k)(t))t={value:t};else if("object"!==i||t.hasOwnProperty("value")){if(Object(L.r)(t.value)||""===t.value||!Object(L.u)(t.value)&&!Object(L.s)(t.value)&&!Object(L.l)(t.value)&&!Object(L.k)(t.value))return null}else t={value:n?JSON.stringify(t):t};if(Object(L.k)(t.value)&&!S(t.value))return null;if(!Object(L.r)(t.kind)){if(Object(L.k)(t.value)||!v(t.kind))return null;t.value=t.value.toString()}return t}function l(){if(void 0!==typeof XMLHttpRequest){var e=Object(w.e)("XMLHttpRequest");if(e){var t=new e;return Boolean(Object(L.x)(t.withCredentials)&&void 0!==typeof XDomainRequest)}}}function u(e,t,n){var r=-1;if(!Object(L.x)(e))if(t>0&&(32===t?r=8192:t<=13&&(r=t<<5)),y(n))-1===r&&(r=0),r|=n;else{var i=F[T(e)]||-1;-1!==r&&-1!==i?r|=i:i===R.c.Double&&(r=i)}return r}function d(){Object(N.d)(null).setEnabled(!1)}function p(e,t,n){Object(N.b)(null)&&Object(N.d)(null).set(e,t,86400*n,null,"/")}function h(e){Object(N.b)(null)&&Object(N.d)(null).del(e)}function g(e){return Object(N.b)(null)?f(Object(N.d)(null),e):""}function f(e,t,n){void 0===n&&(n=!0);var r;return e&&(r=e.get(t),n&&r&&decodeURIComponent&&(r=decodeURIComponent(r))),r||""}function _(e){void 0===e&&(e="D");var t=Object(D.d)();return"B"===e?t="{"+t+"}":"P"===e?t="("+t+")":"N"===e&&(t=t.replace(/-/g,"")),t}function m(e,t,n,r,i){var o={},a=!1,s=0,c=arguments.length,l=arguments;for("[object Boolean]"===Object[b.k].toString.call(l[0])&&(a=l[0],s++);s<c;s++){var e=l[s];Object(L.A)(e,function(e,t){a&&t&&Object(L.t)(t)?Object(L.k)(t)?(o[e]=o[e]||[],Object(L.a)(t,function(t,n){t&&Object(L.t)(t)?o[e][n]=m(!0,o[e][n],t):o[e][n]=t})):o[e]=m(!0,o[e],t):o[e]=t})}return o}function v(e){return e===R.e.NotSet||e>R.e.NotSet&&e<=R.e.Pii_IPV4AddressLegacy||e===R.e.CustomerContent_GenericContent}function y(e){return e>=0&&e<=9}function C(){var e=Object(w.k)();if(!Object(L.x)(e)&&e.userAgent){var t=e.userAgent.toLowerCase();if((t.indexOf("safari")>=0||t.indexOf("firefox")>=0)&&t.indexOf("chrome")<0)return!0}return!1}function S(e){return e.length>0}function I(e){var t=Object(D.b)("beforeunload",e);return t=Object(D.b)("unload",e)||t,t=Object(D.b)("pagehide",e)||t}function O(e,t){var n=e;n.timings=n.timings||{},n.timings.processTelemetryStart=n.timings.processTelemetryStart||{},n.timings.processTelemetryStart[t]=B()}function T(e){var t=0;if(null!==e&&void 0!==e){var n=typeof e;"string"===n?t=1:"number"===n?t=2:"boolean"===n?t=3:n===b.j&&(t=4,Object(L.k)(e)?(t=4096,e.length>0&&(t|=T(e[0]))):Object(L.j)(e,"value")&&(t=8192|T(e.value)))}return t}function E(){return!!Object(w.e)("chrome")}n.d(t,"d",function(){return j}),n.d(t,"b",function(){return k}),n.d(t,"s",function(){return H}),n.d(t,"x",function(){return U}),n.d(t,"v",function(){return r}),n.d(t,"n",function(){return i}),n.d(t,"q",function(){return o}),n.d(t,"u",function(){return a}),n.d(t,"t",function(){return s}),n.d(t,"y",function(){return c}),n.d(t,"B",function(){return l}),n.d(t,"j",function(){return u}),n.d(t,"h",function(){return d}),n.d(t,"z",function(){return p}),n.d(t,"g",function(){return h}),n.d(t,"k",function(){return g}),n.d(t,"l",function(){return f}),n.d(t,"f",function(){return _}),n.d(t,"i",function(){return m}),n.d(t,"o",function(){return B}),n.d(t,"w",function(){return v}),n.d(t,"p",function(){return S}),n.d(t,"e",function(){return I}),n.d(t,"A",function(){return O}),n.d(t,"m",function(){return T}),n.d(t,"c",function(){return G}),n.d(t,"a",function(){return W}),n.d(t,"r",function(){return E});var P,b=n(1),A=n(16),R=n(6),w=n(5),L=n(0),N=n(14),D=n(17),M=n(13),j="3.1.2",k="1DS-Web-JS-"+j,F=(P={},P[0]=R.c.Unspecified,P[2]=R.c.Double,P[1]=R.c.String,P[3]=R.c.Bool,P[4098]=R.c.Double,P[4097]=R.c.String,P[4099]=R.c.Bool,P),x=null,V=null,H=Boolean(Object(w.d)()),U=Boolean(Object(w.m)()),B=D.f,G={Version:j,FullVersionString:k,strUndefined:b.l,strObject:b.j,Undefined:b.l,arrForEach:L.a,arrIndexOf:L.b,arrMap:L.c,arrReduce:L.d,objKeys:L.B,toISOString:L.K,isReactNative:w.t,isString:L.u,isNumber:L.s,isBoolean:L.l,isFunction:L.o,isArray:L.k,isObject:L.t,strTrim:L.I,isDocumentObjectAvailable:H,isWindowObjectAvailable:U,isValueAssigned:r,getTenantId:i,isBeaconsSupported:o,isUint8ArrayAvailable:a,isLatency:s,sanitizeProperty:c,getISOString:L.K,useXDomainRequest:l,getCommonSchemaMetaData:u,cookieAvailable:N.b,disallowsSameSiteNone:N.e,setCookie:p,deleteCookie:h,getCookie:g,createGuid:_,extend:m,getTime:B,isValueKind:v,isArrayValid:S,objDefineAccessors:L.z,addPageUnloadEventListener:I,setProcessTelemetryTimings:O,addEventHandler:D.b,getFieldValueType:T,strEndsWith:L.G,objForEachKey:L.A},W={_canUseCookies:void 0,isTypeof:L.w,isUndefined:L.x,isNullOrUndefined:L.r,hasOwnProperty:L.j,isFunction:L.o,isObject:L.t,isDate:L.m,isArray:L.k,isError:L.n,isString:L.u,isNumber:L.s,isBoolean:L.l,toISOString:L.K,arrForEach:L.a,arrIndexOf:L.b,arrMap:L.c,arrReduce:L.d,strTrim:L.I,objCreate:A.b,objKeys:L.B,objDefineAccessors:L.z,addEventHandler:D.b,dateNow:L.f,isIE:w.s,disableCookies:d,newGuid:D.d,perfNow:D.f,newId:D.e,randomValue:M.d,random32:M.c,mwcRandomSeed:M.b,mwcRandom32:M.a,generateW3CId:D.c}},function(e,t,n){"use strict";n.r(t),n.d(t,"ValueKind",function(){return r.e}),n.d(t,"EventLatency",function(){return r.a}),n.d(t,"EventPersistence",function(){return r.b}),n.d(t,"TraceLevel",function(){return r.d}),n.d(t,"AppInsightsCore",function(){return i.a}),n.d(t,"BaseCore",function(){return u}),n.d(t,"_ExtendedInternalMessageId",function(){return r.f}),n.d(t,"EventPropertyType",function(){return r.c}),n.d(t,"ESPromise",function(){return d.a}),n.d(t,"ESPromiseScheduler",function(){return p.a}),n.d(t,"ValueSanitizer",function(){return g}),n.d(t,"NotificationManager",function(){return f.a}),n.d(t,"BaseTelemetryPlugin",function(){return _.a}),n.d(t,"ProcessTelemetryContext",function(){return m.a}),n.d(t,"MinChannelPriorty",function(){return v.a}),n.d(t,"EventsDiscardedReason",function(){return y.a}),n.d(t,"DiagnosticLogger",function(){return C.a}),n.d(t,"LoggingSeverity",function(){return a.a}),n.d(t,"PerfEvent",function(){return S.a}),n.d(t,"PerfManager",function(){return S.b}),n.d(t,"doPerf",function(){return S.c}),n.d(t,"EventHelper",function(){return I.a}),n.d(t,"isTypeof",function(){return h.w}),n.d(t,"isUndefined",function(){return h.x}),n.d(t,"isNullOrUndefined",function(){return h.r}),n.d(t,"hasOwnProperty",function(){return h.j}),n.d(t,"isObject",function(){return h.t}),n.d(t,"isFunction",function(){return h.o}),n.d(t,"attachEvent",function(){return h.e}),n.d(t,"detachEvent",function(){return h.g}),n.d(t,"normalizeJsName",function(){return h.y}),n.d(t,"objForEachKey",function(){return h.A}),n.d(t,"strStartsWith",function(){return h.H}),n.d(t,"strEndsWith",function(){return h.G}),n.d(t,"strContains",function(){return h.F}),n.d(t,"strTrim",function(){return h.I}),n.d(t,"isDate",function(){return h.m}),n.d(t,"isArray",function(){return h.k}),n.d(t,"isError",function(){return h.n}),n.d(t,"isString",function(){return h.u}),n.d(t,"isNumber",function(){return h.s}),n.d(t,"isBoolean",function(){return h.l}),n.d(t,"toISOString",function(){return h.K}),n.d(t,"arrForEach",function(){return h.a}),n.d(t,"arrIndexOf",function(){return h.b}),n.d(t,"arrMap",function(){return h.c}),n.d(t,"arrReduce",function(){return h.d}),n.d(t,"objKeys",function(){return h.B}),n.d(t,"objDefineAccessors",function(){return h.z}),n.d(t,"dateNow",function(){return h.f}),n.d(t,"getExceptionName",function(){return h.h}),n.d(t,"throwError",function(){return h.J}),n.d(t,"setValue",function(){return h.E}),n.d(t,"getSetValue",function(){return h.i}),n.d(t,"isNotTruthy",function(){return h.q}),n.d(t,"isTruthy",function(){return h.v}),n.d(t,"proxyAssign",function(){return h.D}),n.d(t,"optimizeObject",function(){return h.C}),n.d(t,"objCreate",function(){return O.b}),n.d(t,"addEventHandler",function(){return I.b}),n.d(t,"newGuid",function(){return I.d}),n.d(t,"perfNow",function(){return I.f}),n.d(t,"newId",function(){return I.e}),n.d(t,"generateW3CId",function(){return I.c}),n.d(t,"safeGetLogger",function(){return C.c}),n.d(t,"getGlobal",function(){return O.a}),n.d(t,"getGlobalInst",function(){return T.e}),n.d(t,"hasWindow",function(){return T.r}),n.d(t,"getWindow",function(){return T.m}),n.d(t,"hasDocument",function(){return T.n}),n.d(t,"getDocument",function(){return T.d}),n.d(t,"getCrypto",function(){return T.c}),n.d(t,"getMsCrypto",function(){return T.j}),n.d(t,"hasNavigator",function(){return T.q}),n.d(t,"getNavigator",function(){return T.k}),n.d(t,"hasHistory",function(){return T.o}),n.d(t,"getHistory",function(){return T.f}),n.d(t,"getLocation",function(){return T.i}),n.d(t,"getPerformance",function(){return T.l}),n.d(t,"hasJSON",function(){return T.p}),n.d(t,"getJSON",function(){return T.h}),n.d(t,"isReactNative",function(){return T.t}),n.d(t,"getConsole",function(){return T.b}),n.d(t,"dumpObj",function(){return T.a}),n.d(t,"isIE",function(){return T.s}),n.d(t,"getIEVersion",function(){return T.g}),n.d(t,"strUndefined",function(){return E.l}),n.d(t,"strObject",function(){return E.j}),n.d(t,"strPrototype",function(){return E.k}),n.d(t,"strFunction",function(){return E.h}),n.d(t,"setEnableEnvMocks",function(){return T.u}),n.d(t,"Undefined",function(){return E.l}),n.d(t,"randomValue",function(){return P.d}),n.d(t,"random32",function(){return P.c}),n.d(t,"disallowsSameSiteNone",function(){return b.e}),n.d(t,"areCookiesSupported",function(){return b.b}),n.d(t,"cookieAvailable",function(){return b.b}),n.d(t,"createCookieMgr",function(){return b.c}),n.d(t,"safeGetCookieMgr",function(){return b.d}),n.d(t,"strIKey",function(){return A.b}),n.d(t,"strExtensionConfig",function(){return A.a}),n.d(t,"getISOString",function(){return h.K}),n.d(t,"isValueAssigned",function(){return c.v}),n.d(t,"isBeaconsSupported",function(){return c.q}),n.d(t,"isLatency",function(){return c.t}),n.d(t,"isUint8ArrayAvailable",function(){return c.u}),n.d(t,"getTenantId",function(){return c.n}),n.d(t,"sanitizeProperty",function(){return c.y}),n.d(t,"Version",function(){return c.d}),n.d(t,"FullVersionString",function(){return c.b}),n.d(t,"getCommonSchemaMetaData",function(){return c.j}),n.d(t,"getCookie",function(){return c.k}),n.d(t,"setCookie",function(){return c.z}),n.d(t,"deleteCookie",function(){return c.g}),n.d(t,"getCookieValue",function(){return c.l}),n.d(t,"extend",function(){return c.i}),n.d(t,"createGuid",function(){return c.f}),n.d(t,"useXDomainRequest",function(){return c.B}),n.d(t,"isDocumentObjectAvailable",function(){return c.s}),n.d(t,"isWindowObjectAvailable",function(){return c.x}),n.d(t,"addPageUnloadEventListener",function(){return c.e}),n.d(t,"setProcessTelemetryTimings",function(){return c.A}),n.d(t,"getTime",function(){return c.o}),n.d(t,"isArrayValid",function(){return c.p}),n.d(t,"isValueKind",function(){return c.w}),n.d(t,"getFieldValueType",function(){return c.m}),n.d(t,"CoreUtils",function(){return c.a}),n.d(t,"disableCookies",function(){return c.h}),n.d(t,"Utils",function(){return c.c}),n.d(t,"isChromium",function(){return c.r});var r=n(6),i=n(69),o=n(74),a=n(15),s=n(73),c=n(3),l=n(2),u=function(e){function t(){var n=e.call(this)||this;return Object(l.a)(t,n,function(e,t){e.initialize=function(n,i,o,s){n&&(n.endpointUrl||(n.endpointUrl="https://browser.events.data.microsoft.com/OneCollector/1.0/")),e.getWParam=function(){return c.s?0:-1};try{t.initialize(n,i,o,s)}catch(t){e.logger.throwInternal(a.a.CRITICAL,r.f.ErrorProvidedChannels,"Channels must be provided through config.channels only")}},e.track=function(e){var n=e;if(n){var r=n.ext=n.ext||{};r.sdk=r.sdk||{},r.sdk.ver=c.b}t.track(n)}}),n}return Object(o.b)(t,e),t}(s.a),d=n(23),p=n(68),h=n(0),g=function(){function e(e){function t(e,t){var n,r=a[e];if(r&&(n=r[t]),!n&&null!==n){if(Object(h.u)(e)&&Object(h.u)(t))if(l.length>0){for(i=0;i<l.length;i++)if(l[i].handleField(e,t)){n={canHandle:!0,fieldHandler:l[i]};break}}else 0===s.length&&(n={canHandle:!0});if(!n&&null!==n){n=null;for(var i=0;i<s.length;i++)if(s[i].handleField(e,t)){n={canHandle:!0,handler:s[i],fieldHandler:null};break}}r||(r=a[e]={}),r[t]=n}return n}function n(e,t,n,r,o,a){if(e.handler)return e.handler.property(t,n,o,a);if(!Object(h.r)(o.kind)){if(4096==(4096&r)||!Object(c.w)(o.kind))return null;o.value=o.value.toString()}return i(e.fieldHandler,t,n,r,o)}function r(e,t,n){return Object(c.v)(n)?{value:n}:null}function i(e,t,n,a,s){if(s&&e){var l=e.getSanitizer(t,n,a,s.kind,s.propertyType);if(l)if(4===a){var u={},d=s.value;Object(h.A)(d,function(o,a){var s=t+"."+n;if(Object(c.v)(a)){var l=r(s,o,a);(l=i(e,s,o,Object(c.m)(a),l))&&(u[o]=l.value)}}),s.value=u}else{var p={path:t,name:n,type:a,prop:s,sanitizer:o};s=l.call(o,p)}}return s}var o=this,a={},s=[],l=[];e&&l.push(e),o.addSanitizer=function(e){e&&(s.push(e),a={})},o.addFieldSanitizer=function(e){e&&(l.push(e),a={})},o.handleField=function(e,n){var r=t(e,n);return!!r&&r.canHandle},o.value=function(e,i,o,a){var s=t(e,i);if(s&&s.canHandle){if(!s||!s.canHandle)return null;if(s.handler)return s.handler.value(e,i,o,a);if(!Object(h.u)(i)||Object(h.r)(o)||""===o)return null;var l=null,u=Object(c.m)(o);if(8192==(8192&u)){var d=-8193&u;if(l=o,!Object(c.v)(l.value)||1!==d&&2!==d&&3!==d&&4096!=(4096&d))return null}else 1===u||2===u||3===u||4096==(4096&u)?l=r(e,i,o):4===u&&(l=r(e,i,a?JSON.stringify(o):o));if(l)return n(s,e,i,u,l,a)}return null},o.property=function(e,r,i,o){var a=t(e,r);if(!a||!a.canHandle)return null;if(!Object(h.u)(r)||Object(h.r)(i)||!Object(c.v)(i.value))return null;var s=Object(c.m)(i.value);return 0===s?null:n(a,e,r,s,i,o)}}return e.getFieldType=c.m,e}(),f=n(70),_=n(72),m=n(21),v=n(114),y=n(71),C=n(31),S=n(28),I=n(17),O=n(16),T=n(5),E=n(1),P=n(13),b=n(14),A=n(32)},function(e,t,n){"use strict";function r(e){B=e}function i(e){var t=Object(T.a)();return t&&t[e]?t[e]:e===b&&o()?window:null}function o(){return Boolean(typeof window===E.j&&window)}function a(){return o()?window:i(b)}function s(){return Boolean(typeof document===E.j&&document)}function c(){return s()?document:i(A)}function l(){return Boolean(typeof navigator===E.j&&navigator)}function u(){return l()?navigator:i(R)}function d(){return Boolean(typeof history===E.j&&history)}function p(){return d()?history:i(w)}function h(e){if(e&&B){var t=i("__mockLocation");if(t)return t}return typeof location===E.j&&location?location:i(L)}function g(){return typeof console!==E.l?console:i(N)}function f(){return i(D)}function _(){return Boolean(typeof JSON===E.j&&JSON||null!==i(M))}function m(){return _()?JSON||i(M):null}function v(){return i(j)}function y(){return i(k)}function C(){var e=u();return!(!e||!e.product)&&e.product===F}function S(){var e=u();if(e&&(e.userAgent!==U||null===H)){var t=((U=e.userAgent)||"").toLowerCase();H=Object(P.F)(t,x)||Object(P.F)(t,V)}return H}function I(e){void 0===e&&(e=null);var t=e?e.toLowerCase():"";if(!e){var n=u()||{};t=n?(n.userAgent||"").toLowerCase():""}if(Object(P.F)(t,x))return parseInt(t.split(x)[1]);if(Object(P.F)(t,V)){var r=parseInt(t.split(V)[1]);if(r)return r+4}return null}function O(e){var t=Object[E.k].toString.call(e),n="";return"[object Error]"===t?n="{ stack: '"+e.stack+"', message: '"+e.message+"', name: '"+e.name+"'":_()&&(n=m().stringify(e)),t+n}n.d(t,"u",function(){return r}),n.d(t,"e",function(){return i}),n.d(t,"r",function(){return o}),n.d(t,"m",function(){return a}),n.d(t,"n",function(){return s}),n.d(t,"d",function(){return c}),n.d(t,"q",function(){return l}),n.d(t,"k",function(){return u}),n.d(t,"o",function(){return d}),n.d(t,"f",function(){return p}),n.d(t,"i",function(){return h}),n.d(t,"b",function(){return g}),n.d(t,"l",function(){return f}),n.d(t,"p",function(){return _}),n.d(t,"h",function(){return m}),n.d(t,"c",function(){return v}),n.d(t,"j",function(){return y}),n.d(t,"t",function(){return C}),n.d(t,"s",function(){return S}),n.d(t,"g",function(){return I}),n.d(t,"a",function(){return O});var T=n(16),E=n(1),P=n(0),b="window",A="document",R="navigator",w="history",L="location",N="console",D="performance",M="JSON",j="crypto",k="msCrypto",F="ReactNative",x="msie",V="trident/",H=null,U=null,B=!1},function(e,t,n){"use strict";n.d(t,"e",function(){return o}),n.d(t,"a",function(){return a}),n.d(t,"c",function(){return s}),n.d(t,"b",function(){return c}),n.d(t,"d",function(){return l}),n.d(t,"f",function(){return u});var r=n(74),i=n(15),o={NotSet:0,Pii_DistinguishedName:1,Pii_GenericData:2,Pii_IPV4Address:3,Pii_IPv6Address:4,Pii_MailSubject:5,Pii_PhoneNumber:6,Pii_QueryString:7,Pii_SipAddress:8,Pii_SmtpAddress:9,Pii_Identity:10,Pii_Uri:11,Pii_Fqdn:12,Pii_IPV4AddressLegacy:13,CustomerContent_GenericContent:32},a={Normal:1,CostDeferred:2,RealTime:3,Immediate:4},s={Unspecified:0,String:1,Int32:2,UInt32:3,Int64:4,UInt64:5,Double:6,Bool:7,Guid:8,DateTime:9},c={Normal:1,Critical:2},l={NONE:0,ERROR:1,WARNING:2,INFORMATION:3},u=Object(r.a)(Object(r.a)({},i.b),{AuthHandShakeError:501,AuthRedirectFail:502,BrowserCannotReadLocalStorage:503,BrowserCannotWriteLocalStorage:504,BrowserDoesNotSupportLocalStorage:505,CannotParseBiBlobValue:506,CannotParseDataAttribute:507,CVPluginNotAvailable:508,DroppedEvent:509,ErrorParsingAISessionCookie:510,ErrorProvidedChannels:511,FailedToGetCookies:512,FailedToInitializeCorrelationVector:513,FailedToInitializeSDK:514,InvalidContentBlob:515,InvalidCorrelationValue:516,SessionRenewalDateIsZero:517,SendPostOnCompleteFailure:518,PostResponseHandler:519,SDKNotInitialized:520})},function(t,n){t.exports=e},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateCauseId=t.generateCauseId=void 0;var r=8;t.generateCauseId=function(){for(var e="abcdef0123456789".length,t="",n=0;n<r;n++)t+="abcdef0123456789".charAt(Math.floor(Math.random()*e));return t},t.validateCauseId=function(e){return new RegExp("^[a-f0-9]{8}$").test(e)&&e.length===r}},function(e,t,n){"use strict";function r(){return!!(window.SlimCoreRT&&window.SlimCoreRT.SlimCore&&window.SlimCoreRT.SlimCore.Enums)}function i(e){return e[0].toUpperCase()+e.substr(1)}function o(e,t){var n=i(t);if(n!==t){var r=e[t];e[r]=n,delete e[t],e[n]=r}}function a(e){Object.keys(e).forEach(function(t){o(e,t)})}function s(e,t,n){n[e]={},Object.keys(t).forEach(function(r){n[e][r]=t[r]})}function c(e,t,n,r,i){try{return e.getIntProperty(n,r)}catch(e){return t.logFailure("getIntProperty failed: "+e),i}}function l(e){return new Promise(function(t,n){var r,i=!1,o=null,a=0,s=e.logger.createFnLogger("waitForVideoObjectState["+e.videoObjectId+"]",e.causeId),l=function(e){i=!0,o&&(o.dispose(),o=null),a&&(clearTimeout(a),a=0),r&&r.dispose(),e?n(e):t()},d=function(t,n){if(!i){var r=t;void 0===t&&(r=c(e.slimcoreObject,s,e.videoObjectId,v.Property.VideoStatus)),n?s.info("timeout. check state "+r+" ("+v.VideoStatus[r]+") again"):s.info("state changed -> "+r+" ("+v.VideoStatus[r]+")"),u(r,e.resolveStates)?l():e.rejectStates&&u(r,e.rejectStates)?l("rejecting state "+r+" ("+v.VideoStatus[r]+")"):n&&l("timeout, state "+r+" ("+v.VideoStatus[r]+") expectedStates "+JSON.stringify(e.resolveStates))}};e.timeout&&(a=window.setTimeout(function(){return d(void 0,!0)},e.timeout)),e.cancelEvent&&(r=e.cancelEvent.subscribe(function(){s.info("canceled, expectedStates "+JSON.stringify(e.resolveStates)),l("canceled")})),o=e.slimcoreInstance.handle("object-property-changed",{objectId:e.videoObjectId,propKey:v.Property.VideoStatus},function(e){return d(e.value)}),d()})}function u(e,t){return-1!==t.indexOf(e)}function d(e){var t=h(e,function(e){return e.isDuplicated}),n=h(e,function(e){return e.isPrimary});return 0===t&&1===n&&e.length>1}function p(e){var t=h(e,function(e){return e.isDuplicated}),n=h(e,function(e){return e.isPrimary});return 1===t&&1===n}function h(e,t){return _.reduce(e,function(e,n){return t(n)?e+1:e},0)}var g=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.selectMonitorForScreenSharing=t.returnStringifiedVersionOfMediaStateConfiguration=t.returnVideoDirection=t.convertEndpointScope=t.convertImageData=t.createDataSink=t.createDataSource=t.hasCreateDataSink=t.hasCreateDataSource=t.mapToEmptyStrIfFalsy=t.stringToBuffer=t.bufferToString=t.isVideoAvailable=t.isDisposed=t.waitForVideoObjectToBeStopped=t.waitForVideoObjectToBeRunning=t.waitForVideoObjectToBeAvailable=t.videoObjectTimeout=t.isVideoInState=t.waitForVideoObjectState=t.VideoStateCancelEvent=t.hasFeature=t.getIntProperty=t.getStrProperty=t.forgetAndLog=t.PlatformType=t.wrap=t.isSlimCoreRTModuleAvailable=void 0;var f=n(49),_=n(7),m=n(50);_.defaults(window,{SlimCore:{}}),_.defaults(SlimCore,{Enums:{}}),r()&&(function(e,t){Object.keys(e).forEach(function(n){s(n,e[n],t)})}(window.SlimCoreRT.SlimCore.Enums,SlimCore.Enums),function(e){Object.keys(e).forEach(function(t){a(e[t])})}(SlimCore.Enums)),Proxy&&(SlimCore.Enums=new Proxy(SlimCore.Enums,{get:function(e,t){return t in e?e[t]:{}}}));var v=SlimCore.Enums;t.isSlimCoreRTModuleAvailable=r;var y=[v.VideoStatus.Available,v.VideoStatus.Starting,v.VideoStatus.Running];t.wrap=function(e,t){return void 0===t&&(t={}),"handle"in e?e:_.assign(e,{handle:f.makeHandleForEventEmitter(e)})};!function(e){e[e.Electron=1]="Electron",e[e.Uwp=2]="Uwp"}(t.PlatformType||(t.PlatformType={})),t.forgetAndLog=function(e,t,n){return e?(t.info("Promise executing: "+n),e.catch(function(e){t.logFailure("Promise execution: "+n+" failed: "+e)})):(t.logFailure("Undefined promise @ "+(new Error).stack),Promise.resolve())},t.getStrProperty=function(e,t,n,r,i){try{return e.getStrProperty(n,r)}catch(e){return t.logFailure("getStrProperty failed for objectId="+n+", propertyKey="+r+": "+e),i}},t.getIntProperty=c,t.hasFeature=function(e){return e in v.Feature};var C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return g(t,e),t.prototype.fire=function(){this.raiseEvents(function(e){return e()})},t}(m.EventSourceImpl);t.VideoStateCancelEvent=C,t.waitForVideoObjectState=l,t.isVideoInState=u,t.videoObjectTimeout=function(e){return 5e3},t.waitForVideoObjectToBeAvailable=function(e,t,n,r,i,o,a){return l({slimcoreInstance:e,slimcoreObject:t,videoObjectId:n,logger:r,causeId:i,resolveStates:y,rejectStates:[],timeout:o,cancelEvent:a})},t.waitForVideoObjectToBeRunning=function(e,t,n,r,i,o,a){return l({slimcoreInstance:e,slimcoreObject:t,videoObjectId:n,logger:r,causeId:i,resolveStates:[v.VideoStatus.Running],rejectStates:[v.VideoStatus.Stopping],timeout:o,cancelEvent:a})},t.waitForVideoObjectToBeStopped=function(e,t,n,r,i,o,a){return l({slimcoreInstance:e,slimcoreObject:t,videoObjectId:n,logger:r,causeId:i,resolveStates:[v.VideoStatus.NotStarted,v.VideoStatus.Available,v.VideoStatus.NotAvailable],rejectStates:[],timeout:o,cancelEvent:a})},t.isDisposed=function(e){return e.isDisposed&&e.isDisposed()},t.isVideoAvailable=function(e){return u(e,y)},t.bufferToString=function(e){return String.fromCharCode.apply(null,e)},t.stringToBuffer=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},t.mapToEmptyStrIfFalsy=function(e){return e||""},t.hasCreateDataSource=function(e){return!(!e.createDataSource&&!SlimCore.createDataSource)},t.hasCreateDataSink=function(e){return!(!e.createDataSink&&!SlimCore.createDataSink)},t.createDataSource=function(e,t){return e.createDataSource?e.createDataSource(t):SlimCore.createDataSource(t)},t.createDataSink=function(e,t){return e.createDataSink?e.createDataSink(t):SlimCore.createDataSink(t)},t.convertImageData=function(e){if(e.isImage)return e;var t=e.data,n=new Uint8ClampedArray(t.buffer,t.byteOffset,t.byteLength);return new ImageData(n,e.width,e.height)},t.convertEndpointScope=function(e){switch(e){case 0:return v.RemoveEndpointScope.RemoveEndpointScopeSpecified;case 1:return v.RemoveEndpointScope.RemoveEndpointScopeOther;default:return}},t.returnVideoDirection=function(e){if(void 0!==e.videoDirection)return e.videoDirection;if(e.withVideo)return 4;if(e.sendMediaModalities&&e.sendMediaModalities.mediaStates){var t=_.find(e.sendMediaModalities.mediaStates,function(e){return 1===e.mediaType});if(t)return t.isDisabled?0:4}return 1},t.returnStringifiedVersionOfMediaStateConfiguration=function(e){return e?JSON.stringify(e,function(e,t){return t&&t.constructor===RegExp?t.toString():"mediaType"===e?0===t?"Audio":3===t?"Data":2===t?"ScreenShare":1===t?"Video":"Unknown":t}):""},t.selectMonitorForScreenSharing=function(e,t){return e?function(t){return e.isDuplicated&&d(t)?_.find(t,function(e){return!e.isInternal}):null}(t)||function(t){return!e.isDuplicated&&p(t)?_.find(t,function(e){return e.isPrimary}):null}(t)||function(t){return _.find(t,function(t){return t.monitorId===e.monitorId||_.isEqual(t.region,e.region)})}(t):null}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(25),a=n(10),s=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i._logger=t,i._settings=n,i._slimcoreInstance=r,i._disposables=[],i._objectPropertyChangedHandlers=new Map,i}return r(t,e),t.prototype.dispose=function(t){this._logger.info("dispose causeId: "+t),this._disposables.forEach(function(e){return e.dispose(t)}),this._disposables=[],this._objectPropertyChangedHandlers.clear(),e.prototype.dispose.call(this,t)},t.prototype._registerDisposable=function(e){e?this._disposables.push(e):this._logger.error("Attempt to register null disposable, ignoring")},t.prototype._getProperties=function(e,t,n,r){if(e.getProperties)return e.getProperties(t,n,r);for(var i={},o=0,s=Object.keys(n);o<s.length;o++){d=n[u=s[o]];i[u]=a.getStrProperty(e,this._logger,d.objectId||t,d.propKey,d.fallback)}for(var c=0,l=Object.keys(r);c<l.length;c++){var u=l[c],d=r[u];i[u]=a.getIntProperty(e,this._logger,d.objectId||t,d.propKey,d.fallback)}return i},t.prototype._getStrProperty=function(e,t,n,r){return a.getStrProperty(e,this._logger,t,n,r)},t.prototype._getIntProperty=function(e,t,n,r){return a.getIntProperty(e,this._logger,t,n,r)},t.prototype._onObjectPropertyChanged=function(e,t,n){var r=this;this._objectPropertyChangedHandlers.has(e)||(this._objectPropertyChangedHandlers.set(e,new Map),this._registerDisposable(this._slimcoreInstance.handle("object-property-changed",{objectId:e},function(e){return r._onObjectPropertyChangedCallback(e)}))),this._objectPropertyChangedHandlers.get(e).set(t,n)},t.prototype._onObjectPropertyChangedCallback=function(e){var t=this._objectPropertyChangedHandlers.get(e.objectId);if(t){var n=t.get(e.propKey);if(this._settings.enableSlimCoreEventsCounting){var r=SlimCore.Enums.Property[e.propKey]||e.propKey,i=SlimCore.Enums.ObjectType[e.objectType]||e.objectType;this._logger.debug("_onObjectPropertyChangedCallback - objectId: "+e.objectId+", objectType: "+i+", propKey: "+r+", value: "+e.value+", handler: "+!!n)}n&&n.call(this,e)}},t.prototype.raiseChanged=function(){try{e.prototype.raiseChanged.call(this)}catch(e){this._logger.error("Change handling error: "+e)}},t.prototype._raiseEventImpl=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];try{e.prototype._raiseEventImpl.apply(this,i([t],n))}catch(e){this._logger.error("Event '"+t+"' handling error: "+e)}},t}(o.default);t.default=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.delay=t.timedDefer=t.defer=t.Timer=t.TimeoutError=t.asap=void 0,t.asap=function(e){return new Promise(function(t){t(e())})};var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(Error);t.TimeoutError=i;var o=function(){function e(e){this.ontimeout=e}return e.prototype.start=function(e){this.timeoutId=window.setTimeout(this.ontimeout,e)},e.prototype.stop=function(){clearTimeout(this.timeoutId)},e}();t.Timer=o,t.defer=function(){var e,t;return{promise:new Promise(function(n,r){e=n,t=r}),resolve:e,reject:t}},t.timedDefer=function(e,t){void 0===t&&(t="deferred timed out after "+e+"ms");var n,r,a=new o(function(){return r(new i(t))}),s=new Promise(function(e,t){n=function(t){a.stop(),e(t)},r=function(e){a.stop(),t(e)}});return a.start(e),{promise:s,resolve:n,reject:r}},t.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})}},function(e,t,n){"use strict";function r(e){e<0&&(e>>>=0),g=123456789+e&p,f=987654321-e&p,h=!0}function i(){try{var e=2147483647&Object(u.f)();r((Math.random()*d^e)+e)}catch(e){}}function o(e){return e>0?Math.floor(a()/p*(e+1))>>>0:0}function a(e){var t,n=Object(l.c)()||Object(l.j)();return n&&n.getRandomValues?t=n.getRandomValues(new Uint32Array(1))[0]&p:Object(l.s)()?(h||i(),t=c()&p):t=Math.floor(d*Math.random()|0),e||(t>>>=0),t}function s(e){e?r(e):i()}function c(e){var t=((f=36969*(65535&f)+(f>>16)&p)<<16)+(65535&(g=18e3*(65535&g)+(g>>16)&p))>>>0&p|0;return e||(t>>>=0),t}n.d(t,"d",function(){return o}),n.d(t,"c",function(){return a}),n.d(t,"b",function(){return s}),n.d(t,"a",function(){return c});var l=n(5),u=n(0),d=4294967296,p=4294967295,h=!1,g=123456789,f=987654321},function(e,t,n){"use strict";function r(e,t){var n=s[E]||N[E];return n||(n=s[E]=s(e,t),N[E]=n),n}function i(e){return!e||e.isEnabled()}function o(e){var t=e.cookieCfg=e.cookieCfg||{};if(Object(m.E)(t,"domain",e.cookieDomain,m.p,m.r),Object(m.E)(t,"path",e.cookiePath||"/",null,m.r),Object(m.r)(t[I])){var n=void 0;Object(m.x)(e[O])||(n=!e[O]),Object(m.x)(e[T])||(n=!e[T]),t[I]=n}return t}function a(e,t){var n;if(e)n=e.getCookieMgr();else if(t){var i=(t||{}).cookieCfg;n=i[E]?i[E]:s(t)}return n||(n=r(t,(e||{}).logger)),n}function s(e,t){var n=o(e||N),r=n.path||"/",a=n.domain,s=!1!==n[I],f={isEnabled:function(){var e=s&&c(t),n=N[E];return e&&n&&f!==n&&(e=i(n)),e},setEnabled:function(e){s=!1!==e},set:function(e,t,o,s,c){if(i(f)){var p={},C=Object(m.I)(t||P),I=C.indexOf(";");if(-1!==I&&(C=Object(m.I)(t.substring(0,I)),p=l(t.substring(I+1))),Object(m.E)(p,"domain",s||a,m.v,m.x),!Object(m.r)(o)){var O=Object(_.s)();if(Object(m.x)(p[S])){var T=Object(m.f)()+1e3*o;if(T>0){var E=new Date;E.setTime(T),Object(m.E)(p,S,u(E,O?v:y)||u(E,O?v:y)||P,m.v)}}O||Object(m.E)(p,"max-age",P+o,null,m.x)}var b=Object(_.i)();b&&"https:"===b.protocol&&(Object(m.E)(p,"secure",null,null,m.x),null===A&&(A=!g((Object(_.k)()||{}).userAgent)),A&&Object(m.E)(p,"SameSite","None",null,m.x)),Object(m.E)(p,"path",c||r,null,m.x),(n.setCookie||h)(e,d(C,p))}},get:function(e){var t=P;return i(f)&&(t=(n.getCookie||p)(e)),t},del:function(e,t){i(f)&&f.purge(e,t)},purge:function(e,r){if(c(t)){var i=(o={},o.path=r||"/",o[S]="Thu, 01 Jan 1970 00:00:01 GMT",o);Object(_.s)()||(i["max-age"]="0"),(n.delCookie||h)(e,d(P,i))}var o}};return f[E]=f,f}function c(e){if(null===b){b=!1;try{b=void 0!==(w||{})[C]}catch(t){e&&e.throwInternal(f.a.WARNING,f.b.CannotAccessCookie,"Cannot access document.cookie - "+Object(m.h)(t),{exception:Object(_.a)(t)})}}return b}function l(e){var t={};if(e&&e.length){var n=Object(m.I)(e).split(";");Object(m.a)(n,function(e){if(e=Object(m.I)(e||P)){var n=e.indexOf("=");-1===n?t[e]=null:t[Object(m.I)(e.substring(0,n))]=Object(m.I)(e.substring(n+1))}})}return t}function u(e,t){return Object(m.o)(e[t])?e[t]():null}function d(e,t){var n=e||P;return Object(m.A)(t,function(e,t){n+="; "+e+(Object(m.r)(t)?P:"="+t)}),n}function p(e){var t=P;if(w){var n=w[C]||P;R!==n&&(L=l(n),R=n),t=Object(m.I)(L[e]||P)}return t}function h(e,t){w&&(w[C]=e+"="+t)}function g(e){return!!Object(m.u)(e)&&(!(!Object(m.F)(e,"CPU iPhone OS 12")&&!Object(m.F)(e,"iPad; CPU OS 12"))||(!!(Object(m.F)(e,"Macintosh; Intel Mac OS X 10_14")&&Object(m.F)(e,"Version/")&&Object(m.F)(e,"Safari"))||(!(!Object(m.F)(e,"Macintosh; Intel Mac OS X 10_14")||!Object(m.G)(e,"AppleWebKit/605.1.15 (KHTML, like Gecko)"))||(!(!Object(m.F)(e,"Chrome/5")&&!Object(m.F)(e,"Chrome/6"))||(!(!Object(m.F)(e,"UnrealEngine")||Object(m.F)(e,"Chrome"))||!(!Object(m.F)(e,"UCBrowser/12")&&!Object(m.F)(e,"UCBrowser/11")))))))}n.d(t,"a",function(){return r}),n.d(t,"d",function(){return a}),n.d(t,"c",function(){return s}),n.d(t,"b",function(){return c}),n.d(t,"e",function(){return g});var f=n(15),_=n(5),m=n(0),v="toGMTString",y="toUTCString",C="cookie",S="expires",I="enabled",O="isCookieUseDisabled",T="disableCookiesUsage",E="_ckMgr",P="",b=null,A=null,R=null,w=Object(_.d)(),L={},N={}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i});var r;!function(e){e[e.CRITICAL=1]="CRITICAL",e[e.WARNING=2]="WARNING"}(r||(r={}));var i={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70,FailedMonitorAjaxSetRequestHeader:71,SendBrowserInfoOnUserInit:72,PluginException:73,NotificationException:74,SnippetScriptLoadFailure:99,InvalidInstrumentationKey:100,CannotParseAiBlobValue:101,InvalidContentBlob:102,TrackPageActionEventFailed:103}},function(e,t,n){"use strict";(function(e){function r(){return typeof globalThis!==a.l&&globalThis?globalThis:typeof self!==a.l&&self?self:typeof window!==a.l&&window?window:typeof e!==a.l&&e?e:null}function i(e){throw new TypeError(e)}function o(e){function t(){}var n=a.c;if(n)return n(e);if(null==e)return{};var r=typeof e;return r!==a.j&&r!==a.h&&i("Object prototype may only be an Object:"+e),t[a.k]=e,new t}n.d(t,"a",function(){return r}),n.d(t,"c",function(){return i}),n.d(t,"b",function(){return o});var a=n(1)}).call(this,n(48))},function(e,t,n){"use strict";function r(e,t){var n=!1,r=Object(h.m)();r&&(n=Object(g.e)(r,e,t),n=Object(g.e)(r.body,e,t)||n);var i=Object(h.d)();return i&&(n=y.Attach(i,e,t)||n),n}function i(){function e(){return Object(f.d)(15)}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(v,function(t){var n=0|e();return("x"===t?n:3&n|8).toString(16)})}function o(){var e=Object(h.l)();return e&&e.now?e.now():Object(g.f)()}function a(e){void 0===e&&(e=22);for(var t=Object(f.c)()>>>0,n=0,r="";r.length<e;)n++,r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&t),t>>>=6,5===n&&(t=(Object(f.c)()<<2&4294967295|3&t)>>>0,n=0);return r}function s(){for(var e,t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n="",r=0;r<4;r++)n+=t[15&(e=Object(f.c)())]+t[e>>4&15]+t[e>>8&15]+t[e>>12&15]+t[e>>16&15]+t[e>>20&15]+t[e>>24&15]+t[e>>28&15];var i=t[8+(3&Object(f.c)())|0];return n.substr(0,8)+n.substr(9,4)+"4"+n.substr(13,3)+i+n.substr(16,3)+n.substr(19,12)}function c(e,t){var n=Object(p.a)(e,t),r=m._canUseCookies;return null===_&&(_=[],l=r,Object(g.z)(m,"_canUseCookies",function(){return l},function(e){l=e,Object(g.a)(_,function(t){t.setEnabled(e)})})),-1===Object(g.b)(_,n)&&_.push(n),Object(g.l)(r)&&n.setEnabled(r),Object(g.l)(l)&&n.setEnabled(l),n}n.d(t,"b",function(){return r}),n.d(t,"d",function(){return i}),n.d(t,"f",function(){return o}),n.d(t,"e",function(){return a}),n.d(t,"c",function(){return s}),n.d(t,"a",function(){return y});var l,u=n(1),d=n(16),p=n(14),h=n(5),g=n(0),f=n(13),_=null,m=(u.l,{_canUseCookies:void 0,isTypeof:g.w,isUndefined:g.x,isNullOrUndefined:g.r,hasOwnProperty:g.j,isFunction:g.o,isObject:g.t,isDate:g.m,isArray:g.k,isError:g.n,isString:g.u,isNumber:g.s,isBoolean:g.l,toISOString:g.K,arrForEach:g.a,arrIndexOf:g.b,arrMap:g.c,arrReduce:g.d,strTrim:g.I,objCreate:d.b,objKeys:g.B,objDefineAccessors:g.z,addEventHandler:r,dateNow:g.f,isIE:h.s,disableCookies:function(){c().setEnabled(!1)},newGuid:i,perfNow:o,newId:a,randomValue:f.d,random32:f.c,mwcRandomSeed:f.b,mwcRandom32:f.a,generateW3CId:s}),v=/[xy]/g,y={Attach:g.e,AttachEvent:g.e,Detach:g.g,DetachEvent:g.g}},function(e,t,n){"use strict";function r(e){return"string"==typeof e?o.pii.Mri(e):o.pii.Omit(e)}function i(e){return e&&"99:"===e.substr(0,3)?o.pii.Omit(e):e}Object.defineProperty(t,"__esModule",{value:!0}),t.getLoggableThreadId=t.mriOrId=t.scrubMriOrOmitList=t.scrubMriOrOmit=void 0;var o=n(27);t.scrubMriOrOmit=r,t.scrubMriOrOmitList=function(e){return e.forEach(r)},t.mriOrId=function(e){return e&&o.pii.Mri(e)},t.getLoggableThreadId=function(e){var t=i(e);return t&&t.substr(0,8)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.truncate=t.safeJsonStringify=t.getPrintableObject=t.getPIISafeObject=void 0;var r=["response","responseText","responseURL","status","state","statusText","timeout","withCredentials","stack","message","name","error","piiSafe","phase","code","participantId","phrase","subCode","reason"];t.getPIISafeObject=function(e){try{return JSON.parse(JSON.stringify(e,r,4))}catch(e){return{error:"failed to parse object"}}},t.getPrintableObject=function(e,t){void 0===t&&(t=!1);if(void 0===e)return"void";if(e instanceof Error)return e.toString();if(e instanceof String||e instanceof Number||e instanceof Boolean)return e.toString();try{return e.stack&&(e.stack=function(e){try{return e.split("\n")[0]}catch(e){return"invalid stack"}}(e.stack)),(t?JSON.stringify(e):JSON.stringify(e,r,4)).replace(/(\r\n\t|\n|\r\t|\s)/gm,"")}catch(t){return"failed to get error information:"+(e&&"function"==typeof e.toString&&e.toString())+" "+(e&&e.response&&JSON.stringify(e.response))}},t.safeJsonStringify=function(e){try{return JSON.stringify(e,null,2)}catch(t){return"failed to stringify obj "+e}},t.truncate=function(e,t){try{return e.substring(0,length)}catch(t){return e}}},,function(e,t,n){"use strict";function r(e,t){var n=[];if(e&&e.length>0)for(var r=null,i=0;i<e.length;i++){var o=e[i];if(o&&Object(l.o)(o.processTelemetry)){var a=new u(o,t);n.push(a),r&&r.setNext(a),r=a}}return n.length>0?n[0]:null}function i(e,t,n){var i=[],o=!n;if(e)for(;e;){var a=e.getPlugin();(o||a===n)&&(o=!0,i.push(a)),e=e.getNext()}return o||i.push(n),r(i,t)}function o(e,t,n){var i=e,o=!1;return n&&e&&(i=[],Object(l.a)(e,function(e){(o||e===n)&&(o=!0,i.push(e))})),n&&!o&&(i||(i=[]),i.push(n)),r(i,t)}n.d(t,"a",function(){return d});var a=n(31),s=n(28),c=n(15),l=n(0),u=function(){return function(e,t){var n=this,r=null,i=Object(l.o)(e.processTelemetry),o=Object(l.o)(e.setNextPlugin);n._hasRun=!1,n.getPlugin=function(){return e},n.getNext=function(){return r},n.setNext=function(e){r=e},n.processTelemetry=function(a,l){l||(l=t);var u=e?e.identifier:"TelemetryPluginChain";Object(s.c)(l?l.core():null,function(){return u+":processTelemetry"},function(){if(e&&i){n._hasRun=!0;try{l.setNext(r),o&&e.setNextPlugin(r),r&&(r._hasRun=!1),e.processTelemetry(a,l)}catch(n){var t=r&&r._hasRun;r&&t||l.diagLog().throwInternal(c.a.CRITICAL,c.b.PluginException,"Plugin ["+e.identifier+"] failed during processTelemetry - "+n),r&&!t&&r.processTelemetry(a,l)}}else r&&(n._hasRun=!0,r.processTelemetry(a,l))},function(){return{item:a}},!a.sync)}}}(),d=function(){function e(t,n,s,c){var u=this,d=null;null!==c&&(t&&Object(l.o)(t.getPlugin)?d=i(t,u,c||t.getPlugin()):c?d=o(t,u,c):Object(l.x)(c)&&(d=r(t,u))),u.core=function(){return s},u.diagLog=function(){return Object(a.c)(s,n)},u.getCfg=function(){return n},u.getExtCfg=function(e,t){void 0===t&&(t={});var r;if(n){var i=n.extensionConfig;i&&e&&(r=i[e])}return r||t},u.getConfig=function(e,t,r){void 0===r&&(r=!1);var i,o=u.getExtCfg(e,null);return o&&!Object(l.r)(o[t])?i=o[t]:n&&!Object(l.r)(n[t])&&(i=n[t]),Object(l.r)(i)?r:i},u.hasNext=function(){return null!=d},u.getNext=function(){return d},u.setNext=function(e){d=e},u.processNext=function(e){var t=d;t&&(d=t.getNext(),t.processTelemetry(e,u))},u.createNew=function(t,r){return void 0===t&&(t=null),new e(t||d,n,s,r)}}return e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EMPTY_COUNTS=t.TRANSACTION_END_PHRASE=t.TRANSACTION_END_SUBCODE=t.TRANSACTION_END_CODE=t.UNPARK_CODE=t.TELEMETRY_EVENT_NAMES=t.CALL_REGISTRY_OPERATIONS=t.CONTENT_SHARING_OPERATIONS_INTERNAL=t.CONTENT_SHARING_OPERATIONS=t.PARTICIPANT_OPERATIONS_INTERNAL=t.PARTICIPANT_OPERATIONS=t.MEDIA_EVENT=t.OPERATION_VARIANTS=t.CALL_OPERATIONS_INTERNAL=t.OPERATION_TAGS=t.CALL_OPERATIONS=void 0;!function(e){e.INITIALIZE="Initialize",e.START_CALL="StartCall",e.START_TRANSFER_TARGET_CALL="StartTransferTargetCall",e.STOP_CALL="StopCall",e.STOP_CALL_WITH_BEACON="StopCallWithBeacon",e.JOIN_CALL="JoinCall",e.JOIN_PREHEATED_CALL="JoinPreheatedCall",e.SUBSCRIBE="Subscribe",e.START_CALL_TO_VOICE_MAIL="StartCallToVoiceMail",e.ACKNOWLEDGE="Acknowledge",e.ACCEPT="Accept",e.REJECT="Reject",e.START_VIDEO="StartVideo",e.STOP_VIDEO="StopVideo",e.LOCAL_HOLD="LocalHold",e.LOCAL_UNHOLD="LocalUnhold",e.HOLD="Hold",e.UNHOLD="Unhold",e.UPDATE_ENDPOINT_METADATA="UpdateEndpointMetadata",e.SEND_DTMF_TONE="SendDtmfTone",e.SET_AUDIO_USAGE="SetAudioUsage",e.DUMP_VIDEO_SOURCE_IMAGES="DumpVideoSourceImages",e.BLIND_TRANSFER="BlindTransfer",e.SAFE_TRANSFER="SafeTransfer",e.TRANSFER_TO_VOICEMAIL="TransferToVoicemail",e.CALL_REDIRECT="CallRedirect",e.CONSULTATIVE_TRANSFER="ConsultativeTransfer",e.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE="ConsultativeTransferWithPickupCode",e.START_SCREEN_SHARING="StartScreenSharing",e.STOP_SCREEN_SHARING="StopScreenSharing",e.START_DATA_CHANNEL="StartDataChannel",e.STOP_DATA_CHANNEL="StopDataChannel",e.SHARE_SYSTEM_SOUNDS="ShareSystemSounds",e.START_MULTICHANNEL_AUDIO_DEVICE="StartMultichannelAudioDevice",e.STOP_MULTICHANNEL_AUDIO_DEVICE="StopMultichannelAudioDevice",e.START_FACESTREAM="StartFaceStream",e.STOP_FACESTREAM="StopfaceStream",e.MUTE="Mute",e.UNMUTE="Unmute",e.MUTE_SPEAKER="MuteSpeaker",e.UNMUTE_SPEAKER="UnmuteSpeaker",e.MUTE_PARTICIPANTS="MuteParticipants",e.UPDATE_MEETING_ROLE="UpdateMeetingRole",e.START_AUDIO="StartAudio",e.STOP_AUDIO="StopAudio",e.ASSIMILATE="Assimilate",e.SET_MAX_VIDEO_CHANNELS="SetMaxVideoChannels",e.CREATE_CONTENT_SHARING_SESSION="CreateContentSharingSession",e.START_CALL_WITH_NUDGE="StartCallWithNudge",e.START_CALL_AND_UNPARK="StartCallAndUnpark",e.PARK_CALL="ParkCall",e.UNPARK_CALL="UnparkCall",e.NUDGE_PARTICIPANTS="NudgeParticipants",e.LWJ_FALLBACK="LwjFallback",e.ELECTRON_SHOW_CQF_INFO="ElectronShowCQFInfo",e.ELECTRON_IS_CQF_RENDERED="ElectronIsCQFRendered",e.ELECTRON_PROVIDE_CQF="ElectronProvideCQF",e.MERGE_CALL="MergeCall",e.ADD_GROUP_MODALITY="AddGroupModality",e.MERGE_WITH_PICKUP_CODE="MergeWithPickupCode",e.PUBLISH_STATE="PublishState",e.REMOVE_STATE="RemoveState",e.UPDATE_MEETING_SETTINGS="UpdateMeetingSettings",e.MERGE_PARTICIPANT="MergeParticipant",e.MERGE_PARTICIPANTS="MergeParticipants",e.ADMIT="Admit",e.SEARCH_PARTICIPANTS="SearchParticipants",e.GET_ALL_PARTICIPANTS="GetAllParticipants",e.SET_AUDIO_MIDCALL_CONFIG="SetAudioMidcallConfig",e.START_WITH_MEETING_DATA="StartWithMeetingData",e.JOIN_WITH_MEETING_DATA="JoinWithMeetingData",e.SUBSCRIBE_WITH_MEETING_DATA="SubscribeWithMeetingData",e.SET_AUDIO_MIDCALL_CONFIG_JSON="SetAudioMidcallConfigJon",e.GET_TECHNICAL_INFORMATION_JSON="getTechnicalInformationJson",e.UPDATE_MEETING_GROUPS="UpdateMeetingGroups",e.ADD_BROADCAST_MODALITY="AddBroadcastModality",e.UPDATE_MEETING_LIVE_STATE="UpdateMeetingLiveState",e.SET_MEETING_LAYOUT="SetMeetingLayout",e.UPDATE_PARTICIPANT_INTERPRETATION_STATE="UpdateParticipantInterpretationState",e.JOIN_MEETING_GROUP="JoinMeetingGroup",e.LEAVE_MEETING_GROUP="LeaveMeetingGroup"}(t.CALL_OPERATIONS||(t.CALL_OPERATIONS={}));!function(e){e.NOT_SUPPORTED_IN_STREAMING_MODE="NOT_SUPPORTED_IN_STREAMING_MODE"}(t.OPERATION_TAGS||(t.OPERATION_TAGS={}));!function(e){e.CALL_START_OR_JOIN_INITIATED="_CallStartOrJoinInitiated",e.INCOMING_INITIALIZE="_IncomingInitialize",e.CALL_ENDED="_CallEnded",e.RECONNECT="_Reconnect",e.RENEGOTIATE="_Renegotiate",e.RENEGOTIATE_OUTGOING="_RenegotiateOutgoing",e.RENEGOTIATE_INCOMING="_RenegotiateIncoming",e.COMPLETE_NEGOTIATION_FAILED="_CompleteNegotiationFailed",e.UPDATE_LOCAL_MEDIA_STATUS="_UpdateLocalMediaStatus",e.START_PREVIEW_VIDEO="_StartPreviewVideo",e.START_LOCAL_VIDEO="_StartLocalVideo",e.SET_LOCAL_VIDEO="_SetLocalVideo",e.CALL_TRANSFER_IN_PROGRESS="_CallTransferInProgress",e.CALL_REDIRECT_IN_PROGRESS="_CallRedirectInProgress",e.ON_TRANSFER_REQUESTED="_OnTransferRequested",e.ON_TRANSFER_REQUESTED_INVALID="_OnTransferRequestedInvalid",e.ON_INCOMING_CALL_REPLACEMENT="_onIncomingCallReplacement",e.GET_CALL_REPLACEMENT_DETAILS="_GetCallReplacementDetails",e.SET_CALL_STATE="_SetCallState",e.SET_TRANSFER_STATE="_SetTransferState",e.SET_PARK_STATE="_SetParkState",e.SET_MUTED="_SetMuted",e.SET_MUTED_SPEAKER="_SetMutedSpeaker",e.SET_SCREEN_SHARING="_SetScreenSharing",e.SET_CALL_ORIGIN="_SetCallOrigin",e.CONNECT_CALL="_ConnectCall",e.WAIT_FOR_ANSWER="_WaitForAnswer",e.MEDIA_ACKNOWLEDGMENT="_MediaAcknowledgment",e.SIGNALING_STATE_CHANGED="_SignalingStateChanged",e.CALL_TERMINATION_INFO="_CallTerminationInfo",e.MEDIA_WHITELISTING_ISSUE_DETECTED="_MediaWhiteListingIssueDetected",e.CALL_ESCALATED_TO_CONFERENCE="_CallEscalatedToConference",e.WEB_ON_OFFER="_WebOnOffer",e.WEB_ON_ANSWER="_WebOnAnswer",e.WEB_ON_RETARGET_SUCCESS="_WebRetargetSuccess",e.WEB_ON_RETARGET_FAILURE="_WebRetargetFailure",e.WEB_ON_ESCALATION_SUCCESS="_WebOnEscalationSuccess",e.WEB_ON_ESCALATION_FAILURE="_WebOnEscalationFailure",e.CALL_USES_MIXER="_CallUsesMixer",e.ESCALATION_IN_PROGRESS="_EscalationInProgress",e.ESCALATION_COMPLETED="_EscalationCompleted",e.ELECTRON_WAIT_FOR_HANDLE_PUSH="_ElectronWaitForHandlePush",e.ELECTRON_WAIT_FOR_RINGING="_ElectronWaitForRinging",e.ELECTRON_START_SCREEN_SHARING="_ElectronStartScreenSharing",e.ELECTRON_STOP_SCREEN_SHARING="_ElectronStopScreenSharing",e.ELECTRON_SLIMCORE_READY="_ElectronSlimcoreReady",e.ELECTRON_DATA_CHANNEL_CREATED="_ElectronDataChannelCreated",e.ELECTRON_ATTACH_SLIMCORE_CALL="_ElectronAttachSlimcoreCall",e.ELECTRON_ATTACH_SLIMCORE_CALL_FAILED="_ElectronAttachSlimcoreCallFailed",e.ELECTRON_LEAVE_CALL="_ElectronLeaveCall",e.PROCESS_CALL_START_OPTIONS="_ProcessCallStartOptions",e.CALL_MODE_CHANGED="_CallModeChanged",e.UPDATE_MEETING_GROUPS_DETAILS="_UpdateMeetingGroupDetails"}(t.CALL_OPERATIONS_INTERNAL||(t.CALL_OPERATIONS_INTERNAL={}));!function(e){e.CCWM="CCWM",e.ENCRYPTED="Encrypted",e.LWJ="LWJ",e.PREHEAT="Preheat",e.MULTIPLEVIDEOS="MultipleVideos",e.SPECIFIED="Specified",e.ALL="All",e.NONE="None"}(t.OPERATION_VARIANTS||(t.OPERATION_VARIANTS={}));!function(e){e.AUDIO_QUALITY_CHANGED="AudioQualityChanged",e.SESSION_ERROR="SessionError",e.NEGOTIATION_REQUIRED="NegotiationRequired",e.OUTGOING_NEGOTIATION_FAILURE="OutgoingNegotiationFailure",e.INCOMING_NEGOTIATION_FAILURE="IncomingNegotiationFailure",e.NEGOTIATION_FATAL_ERROR="NegotiationFatalError",e.NEGOTIATION_COMPLETION="NegotiationCompletion",e.AUDIO_STATE_CHANGED="AudioStateChanged",e.INCOMPATIBLE_OFFER="IncompatibleOffer",e.NEW_OFFER_FAILED="NewOfferFailed"}(t.MEDIA_EVENT||(t.MEDIA_EVENT={}));!function(e){e.ADD_PARTICIPANT="AddParticipant",e.REMOVE_PARTICIPANT="RemoveParticipant",e.ADMIT_PARTICIPANT="AdmitParticipant",e.CALL_ME_BACK="CallMeBack",e.ADD_PARTICIPANTS="AddParticipants",e.SEARCH_PARTICIPANTS="SearchParticipants",e.GET_ALL_PARTICIPANTS="GetALLParticipants"}(t.PARTICIPANT_OPERATIONS||(t.PARTICIPANT_OPERATIONS={}));!function(e){e.SET_PARTICIPANT_STATE_INVALID="_SetParticipantStateInvalid",e.UPDATE_LOCAL_PARTICIPANT_STREAM="_UpdateLocalParticipantStream",e.PARTICIPANT_JOINED="_ParticipantJoined",e.SELF_PARTICIPANT_UPDATED="_SelfParticipantUpdated"}(t.PARTICIPANT_OPERATIONS_INTERNAL||(t.PARTICIPANT_OPERATIONS_INTERNAL={}));!function(e){e.START_CONTENT_SHARING="StartContentSharing",e.STOP_CONTENT_SHARING="StopContentSharing",e.JOIN_CONTENT_SHARING="JoinContentSharing",e.TAKE_CONTENT_SHARING_CONTROL="TakeContentSharingControl",e.UPDATE_CONTENT_SHARING_SESSION_STATE="UpdateContentSharingSessionState",e.UPDATE_PARTICIPANT_STATE="UpdateParticipantState"}(t.CONTENT_SHARING_OPERATIONS||(t.CONTENT_SHARING_OPERATIONS={}));!function(e){e.SET_CONTENT_SHARING_STATUS="_SetContentSharingStatus"}(t.CONTENT_SHARING_OPERATIONS_INTERNAL||(t.CONTENT_SHARING_OPERATIONS_INTERNAL={}));!function(e){e.INITIALIZE="Initialize",e.LOGOUT="Logout",e.GET_CALL_STATE="GetCallState"}(t.CALL_REGISTRY_OPERATIONS||(t.CALL_REGISTRY_OPERATIONS={})),t.TELEMETRY_EVENT_NAMES={CALL_SETUP_NATIVE:"skypecosi_concore_native_ts_calling_call_setup_session",CALL_IN_CALL_NATIVE:"skypecosi_concore_native_ts_calling_in_call_session",REGISTRY_WEB:"skypecosi_concore_web_ts_calling_registry",REGISTRY_NATIVE:"skypecosi_concore_native_ts_calling_registry"},t.UNPARK_CODE={PARK:"*11",SHARED_LINE:"*12",SERVER_HOLD:"*13"};!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.CLIENT_ERROR=499]="CLIENT_ERROR",e[e.SIGNALING_ERROR=599]="SIGNALING_ERROR"}(t.TRANSACTION_END_CODE||(t.TRANSACTION_END_CODE={}));!function(e){e[e.LOCAL_REJECT=0]="LOCAL_REJECT",e[e.UNMUTE_ERROR=3124]="UNMUTE_ERROR",e[e.TRANSACTION_NOT_ALLOWED=3548]="TRANSACTION_NOT_ALLOWED",e[e.INVALID_ARGUMENT=3549]="INVALID_ARGUMENT",e[e.CANNOT_PARSE_RESULT=3550]="CANNOT_PARSE_RESULT",e[e.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE=3551]="TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE"}(t.TRANSACTION_END_SUBCODE||(t.TRANSACTION_END_SUBCODE={}));!function(e){e.TRANSACTION_COMPLETE="TransactionComplete",e.TRANSACTION_ALLOWED="TransactionAllowed",e.TRANSACTION_DISALLOWED="TransactionDisallowed",e.UNKNOWN="Unknown",e.STACK_NOT_INTIALIZED="Stack not intialized yet",e.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE="TransactionNotAllowedForStreamMode"}(t.TRANSACTION_END_PHRASE||(t.TRANSACTION_END_PHRASE={})),t.EMPTY_COUNTS={totalParticipants:0,preheatedParticipants:0,lobbyParticipants:0,totalPresenters:0,requestingAttentionPresenters:0,totalAttendees:0,requestingAttentionAttendees:0,overflowAttendees:0}},function(e,t,n){"use strict";function r(e,t,n){return function(r){e[t]=r,n()}}var i=n(0),o=n(2),a=i.o,s=function(){function e(t){function n(t,n,i,o){u.push(function(){var r;try{(r=1===c?a(t)?t(l):l:a(n)?n(l):l)instanceof e?r.then(i,o):2!==c||a(n)?i(r):o(r)}catch(e){return void o(e)}}),0!==c&&r()}function r(){if(u.length>0){var e=u.slice();u=[],setTimeout(function(){for(var t=0,n=e.length;t<n;++t)try{e[t]()}catch(e){}},0)}}function i(e){0===c&&(l=e,c=1,r())}function s(e){0===c&&(l=e,c=2,r())}var c=0,l=null,u=[];Object(o.a)(e,this,function(t){t.then=function(t,r){return new e(function(e,i){n(t,r,e,i)})},t.catch=function(e){return t.then(null,e)}}),function(){if(!a(t))throw new TypeError("ESPromise: resolvedFunc argument is not a Function");try{t(i,s)}catch(e){s(e)}}()}return e.resolve=function(t){return t instanceof e?t:new e(t&&a(t.then)?function(e,n){try{t.then(e,n)}catch(e){n(e)}}:function(e){e(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},e.all=function(t){if(t&&t.length)return new e(function(e,n){try{for(var i=[],o=0,s=0;s<t.length;s++){var c=t[s];c&&a(c.then)?(o++,c.then(r(i,s,function(){0==--o&&e(i)}),n)):i[s]=c}0===o&&setTimeout(function(){e(i)},0)}catch(e){n(e)}})},e.race=function(t){return new e(function(e,n){if(t&&t.length)try{for(var r=0;r<t.length;r++)!function(r){var i=t[r];i&&a(i.then)?i.then(e,n):setTimeout(function(){e(i)},0)}(r)}catch(e){n(e)}})},e}();t.a=s},,function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype.changed=function(e){return this.subscribe({changed:e,on:void 0})},t.prototype.on=function(e,t){return this.subscribe({changed:void 0,on:{name:String(e),handler:this._toEventCallback(t)}})},t.prototype.once=function(e,t,n){var r,i=this;return r=this.on(e,this._fromEventCallback(function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];r.dispose(n),i._toEventCallback(t).apply(void 0,e)}))},t.prototype.raiseChanged=function(){this.raiseEvents(function(e){return e.changed&&e.changed()})},t.prototype.event=function(e){var t=this;return{raise:this._fromEventCallback(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t._raiseEventImpl.apply(t,i([String(e)],n))})}},t.prototype._raiseEventImpl=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.raiseEvents(function(n){var r;return n.on&&n.on.name===e&&(r=n.on).handler.apply(r,t)})},t.prototype._toEventCallback=function(e){return e},t.prototype._fromEventCallback=function(e){return e},t}(n(50).EventSourceImpl);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noop=void 0,t.noop=function(){}},function(e,n){e.exports=t},function(e,t,n){"use strict";function r(e,t,n,r,i){if(e){var a=e;if(a&&Object(o.o)(a.getPerfMgr)&&(a=a.getPerfMgr()),a){var c=void 0,u=a.getCtx(l);try{if(c=a.create(t(),r,i)){if(u&&c.setCtx&&(c.setCtx(s.ParentContextKey,u),u.getCtx&&u.setCtx)){var d=u.getCtx(s.ChildrenContextKey);d||(d=[],u.setCtx(s.ChildrenContextKey,d)),d.push(c)}return a.setCtx(l,c),n(c)}}catch(e){c&&c.setCtx&&c.setCtx("exception",e)}finally{c&&a.fire(c),a.setCtx(l,u)}}}return n()}n.d(t,"a",function(){return s}),n.d(t,"b",function(){return c}),n.d(t,"c",function(){return r});var i=n(2),o=n(0),a="ctx",s=function(){function e(t,n,r){var i=this,s=!1;if(i.start=Object(o.f)(),i.name=t,i.isAsync=r,i.isChildEvt=function(){return!1},Object(o.o)(n)){var c;s=Object(o.z)(i,"payload",function(){return!c&&Object(o.o)(n)&&(c=n(),n=null),c})}i.getCtx=function(t){return t?t===e.ParentContextKey||t===e.ChildrenContextKey?i[t]:(i[a]||{})[t]:null},i.setCtx=function(t,n){t&&(t===e.ParentContextKey?(i[t]||(i.isChildEvt=function(){return!0}),i[t]=n):t===e.ChildrenContextKey?i[t]=n:(i[a]=i[a]||{})[t]=n)},i.complete=function(){var t=0,r=i.getCtx(e.ChildrenContextKey);if(Object(o.k)(r))for(var a=0;a<r.length;a++){var c=r[a];c&&(t+=c.time)}i.time=Object(o.f)()-i.start,i.exTime=i.time-t,i.complete=function(){},!s&&Object(o.o)(n)&&(i.payload=n())}}return e.ParentContextKey="parent",e.ChildrenContextKey="childEvts",e}(),c=function(){function e(t){this.ctx={},Object(i.a)(e,this,function(e){e.create=function(e,t,n){return new s(e,t,n)},e.fire=function(e){e&&(e.complete(),t&&t.perfEvent(e))},e.setCtx=function(t,n){t&&((e[a]=e[a]||{})[t]=n)},e.getCtx=function(t){return(e[a]||{})[t]}})}return e}(),l="CoreUtils.doPerf"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOvb=t.getTsCallingVersion=void 0,t.getTsCallingVersion=function(){return"2021.42.01.1"},t.getOvb=function(){return"1c67ad38b440f3c30eadde98e59d505b1dd1c056"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(9),o=n(19),a=function(){function e(e){this._logger=e,this._promise=Promise.resolve(void 0),this._actionQueue=[]}return e.prototype.chainPromise=function(e,t,n,a){var s=this;void 0===n&&(n=i.generateCauseId()),void 0===a&&(a=!1);var c=Date.now(),l=(("function"==typeof t?t():t)||"").toString();this._actionQueue.push(l),this._logger.info("["+n+"]["+l+"]enqueueing, queue=["+this._actionQueue+"], reset="+a);var u=function(){s._actionQueue=s._actionQueue.filter(function(e){return e!==l})};return a&&this.reset(n),this._promise=this._promise.catch(r.noop).then(function(){var t=Date.now()-c;return s._logger.info("["+n+"]["+l+"]begin, delayMs="+t),e()}),this._promise.then(function(){u();var e=Date.now()-c;s._logger.info("["+n+"]["+l+"]success, durationMs="+e)},function(e){u();var t=Date.now()-c;s._logger.warn("["+n+"]["+l+"]failed="+o.safeJsonStringify(e)+", durationMs="+t)}),this._promise},e.prototype.reset=function(e){this._logger.info("["+e+"] resetting"),this._promise=Promise.resolve(void 0)},e}();t.default=a},function(e,t,n){"use strict";function r(e){return e?'"'+e.replace(/\"/g,"")+'"':""}function i(e,t){return(e||{}).logger||new h(t)}n.d(t,"b",function(){return p}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return h});var o=n(15),a=n(5),s=n(2),c=n(0),l="AI (Internal): ",u="AI: ",d="AITR_",p=function(){function e(e,t,n,i){void 0===n&&(n=!1);var o=this;o.messageId=e,o.message=(n?u:l)+e;var s="";Object(a.p)()&&(s=Object(a.h)().stringify(i));var c=(t?" message:"+r(t):"")+(i?" props:"+r(s):"");o.message+=c}return e.dataType="MessageData",e}(),h=function(){function e(t){this.identifier="DiagnosticLogger",this.queue=[];var n=0,r={};Object(s.a)(e,this,function(e){function i(e,n){var r=t[e];return Object(c.r)(r)?n:r}function s(){return n>=e.maxInternalMessageLimit()}Object(c.r)(t)&&(t={}),e.consoleLoggingLevel=function(){return i("loggingLevelConsole",0)},e.telemetryLoggingLevel=function(){return i("loggingLevelTelemetry",1)},e.maxInternalMessageLimit=function(){return i("maxMessageLimit",25)},e.enableDebugExceptions=function(){return i("enableDebugExceptions",!1)},e.throwInternal=function(t,n,i,a,s){void 0===s&&(s=!1);var l=new p(n,i,s,a);if(e.enableDebugExceptions())throw l;if(!Object(c.x)(l)&&l&&!Object(c.x)(l.message)){var u=e.consoleLoggingLevel();if(s){var d=+l.messageId;!r[d]&&u>=o.a.WARNING&&(e.warnToConsole(l.message),r[d]=!0)}else u>=o.a.WARNING&&e.warnToConsole(l.message);e.logInternalMessage(t,l)}},e.warnToConsole=function(e){var t=Object(a.b)();if(t){var n="log";t.warn&&(n="warn"),Object(c.o)(t[n])&&t[n](e)}},e.resetInternalMessageCount=function(){n=0,r={}},e.logInternalMessage=function(t,i){if(!s()){var a=!0,c=d+i.messageId;if(r[c]?a=!1:r[c]=!0,a&&(t<=e.telemetryLoggingLevel()&&(e.queue.push(i),n++),n===e.maxInternalMessageLimit())){var l="Internal events throttle limit per PageView reached for this app.",u=new p(o.b.MessageLimitPerPVExceeded,l,!1);e.queue.push(u),e.warnToConsole(l)}}}})}return e}()},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return i});var r="iKey",i="extensionConfig"},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.calculateJoinedFromForTelemetry=t.getEndpointInformationForTelemetry=t.CallTelemetry=t.CallRegistryTelemetry=t.TelemetryUtilities=t.SELF_PARTICIPANT_ROLE=t.DIRECTION=t.RESULT_VALUE=t.CALL_TERMINATING_END=void 0;var i,o=n(27),a=n(9),s=n(19),c=n(18),l=n(29),u=150;!function(e){e.Pending="Pending",e.Success="Success",e.Failure="Failure",e.Timeout="Timeout"}(i||(i={}));var d;!function(e){e[e.Event=0]="Event",e[e.Operation=1]="Operation"}(d||(d={}));var p=function(){function e(e,t,n,r,o){this.eventName=e,this.eventStartTime=t,this.type=n,this.causeId=r,this.status=i.Pending,this.eventStartTimestamp=(new Date).getTime(),this.data=[],this.type===d.Event&&delete this.status,o&&this.data.push(o)}return Object.defineProperty(e.prototype,"variant",{set:function(e){this.eventVariant=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"additionalData",{set:function(e){this.eventAdditionalData=e},enumerable:!1,configurable:!0}),e.prototype.recordSuccess=function(e,t){this.recordResult(i.Success,e,t)},e.prototype.recordFailure=function(e,t){this.recordResult(i.Failure,e,t)},e.prototype.recordTimeout=function(e,t){this.recordResult(i.Timeout,e,t)},e.prototype.addData=function(e){this.data.push(e)},e.prototype.isPending=function(){return this.status===i.Pending},e.prototype.getEvent=function(){var e,t=this,n={start:this.eventStartTime,duration:this.duration,status:this.status,result:this.result,causeId:this.causeId,resultCauseId:this.resultCauseId,variant:this.eventVariant,data:this.data.map(function(e){return t.prepareData(e,!0)}).filter(function(e){return!!e})};return this.type===d.Event&&delete n.status,n.data.length||delete n.data,n.causeId||delete n.causeId,n.resultCauseId||delete n.resultCauseId,n.result||delete n.result,n.variant||delete n.variant,this.eventAdditionalData&&Object.keys(this.eventAdditionalData).forEach(function(e){n[e]=t.eventAdditionalData[e]}),e={},e[this.eventName]=n,e},e.prototype.recordResult=function(e,t,n){this.status=e,this.result=this.prepareData(t),this.causeId!==n&&(this.resultCauseId=n),this.duration=(new Date).getTime()-this.eventStartTimestamp},e.prototype.prepareData=function(e,t){void 0===t&&(t=!1);var n=typeof e;if(void 0===e||null===e)return"";if("string"===n)return c.scrubMriOrOmit(e);if("number"===n||"boolean"===n)return String(e);if("function"===n)return"";if(e instanceof Error)return e.toString();try{return Object.keys(e).length?t?e:s.getPIISafeObject(e):""}catch(e){return"invalid"}},e}();!function(e){e.LOCAL="Local",e.REMOTE="Remote"}(t.CALL_TERMINATING_END||(t.CALL_TERMINATING_END={}));!function(e){e.SUCCESS="Success",e.FAILURE="Failure"}(t.RESULT_VALUE||(t.RESULT_VALUE={}));!function(e){e.INCOMING="Incoming",e.OUTGOING="Outgoing"}(t.DIRECTION||(t.DIRECTION={}));!function(e){e.CALLER="caller",e.CALLEE="callee",e.JOIN="join",e.SUBSCRIBE="SUBSCRIBE"}(t.SELF_PARTICIPANT_ROLE||(t.SELF_PARTICIPANT_ROLE={}));var h;!function(e){e.SUCCESS="Success",e.FAILURE="Failure",e.TIMEOUT="Timeout"}(h||(h={}));var g=function(){function e(e,t,n){this.logger=e,this.startTime=t,this.maxEventsExceeded=n,this.recordedEvents=[],this.ongoingOperations={}}return e.prototype.recordEvent=function(e,t,n){void 0===n&&(n=a.generateCauseId()),this.logger.debug("Event:",e,o.pii.Omit(t));var r=new p(e,this.getEventStartTime(),d.Event,n,t);return this.pushToRecordedEvents(r),r},e.prototype.recordOperationSuccess=function(e,t,n,r,i){void 0===t&&(t=null),this.logger.info("Event success:",r,e,o.pii.Omit(n),o.pii.Omit(t)),this.recordOperationResult(e,t,h.SUCCESS,n,r,i)},e.prototype.recordOperationFailure=function(e,t,n,r,i){this.logger.info("Event failure:",e,o.pii.Omit(n),t),this.recordOperationResult(e,t,h.FAILURE,n,r,i)},e.prototype.recordOperationTimeout=function(e,t,n,r,i){this.logger.info("Event timeout:",e,o.pii.Omit(n),t),this.recordOperationResult(e,t,h.TIMEOUT,n,r,i)},e.prototype.maybeRecordOperationSuccess=function(e,t,n,r,i){void 0===t&&(t=null),this.hasOngoingEvent(e,n)&&this.recordOperationSuccess(e,t,n,r,i)},e.prototype.maybeRecordOperationFailure=function(e,t,n,r,i){this.hasOngoingEvent(e,n)&&this.recordOperationFailure(e,t,n,r,i)},e.prototype.maybeRecordOperationTimeout=function(e,t,n,r,i){this.hasOngoingEvent(e,n)&&this.recordOperationTimeout(e,t,n,r,i)},e.prototype.recordOperationResult=function(e,t,n,r,i,o){this.hasOngoingEvent(e,r)||this.recordOperation(e,i,r);var a=this.ongoingOperations[e];switch(r&&(a=a[r]),o&&(a.additionalData=o),n){case h.SUCCESS:a.recordSuccess(t,i);break;case h.FAILURE:a.recordFailure(t,i);break;case h.TIMEOUT:a.recordTimeout(t,i);break;default:this.logger.error("Unknown operation record state in record operation result.")}r?delete this.ongoingOperations[e][r]:delete this.ongoingOperations[e]},e.prototype.recordOperation=function(e,t,n,r){this.logger.debug("Event create:",t,e,o.pii.Omit(n));var i=new p(e,this.getEventStartTime(),d.Operation,t,r);return this.ongoingOperations[e]||(this.ongoingOperations[e]={}),n?this.ongoingOperations[e][n]=i:this.ongoingOperations[e]=i,this.pushToRecordedEvents(i),i},e.prototype.setOperationVariant=function(e,t,n){var r;(r=n?this.ongoingOperations[e][n]:this.ongoingOperations[e])?r.variant=t:this.logger.error("Could not find operation "+e+" to set variant "+t)},e.prototype.updateOperationData=function(e,t,n,r){try{if(!this.ongoingOperations[e])return void this.recordEvent(e,t,n);r?this.ongoingOperations[e][r]&&this.ongoingOperations[e][r].addData(t):this.ongoingOperations[e].addData(t)}catch(t){return void this.logger.info("Unable to update operation: "+e+" data")}},e.prototype.pushToRecordedEvents=function(e){this.maxEventsExceeded&&this.maxEventsExceeded()&&this.recordedEvents.shift(),this.recordedEvents.push(e)},e.prototype.hasOngoingEvent=function(e,t){return this.ongoingOperations[e]?!(t&&!this.ongoingOperations[e][t])||(this.logger.warn("Unable to find event for name\\id "+e+"\\"+o.pii.Omit(t)),!1):(this.logger.warn("Unable to find event for name "+e),!1)},e.prototype.getEventStartTime=function(){return(new Date).getTime()-this.startTime},e.prototype.getEventTimestampBag=function(e,t){var n=t?[t.getEvent()]:this.recordedEvents.filter(function(t){return!e||!t.isPending()}).map(function(e){return e.getEvent()}),r=JSON.stringify({eventStart:this.startTime,events:n});return this.logger.info("Call eventTimestampBag "+o.pii.Omit(r)),r},e.prototype.removeRecordedEvent=function(e){var t=this.recordedEvents.indexOf(e);t>-1&&this.recordedEvents.splice(t,1)},e}();t.TelemetryUtilities=g;var f=function(e){function t(t,n){var r=e.call(this,t,n,function(){return r.recordedEvents.length>u})||this;return r.getHostName=function(){try{return"localhost"===location.hostname||"127.0.0.1"===location.hostname?"localhost":"<redacted>"}catch(e){return"unknown"}},r.tsCallingVersion=l.getTsCallingVersion(),r.logger=t.createChild("CallRegistryTelemetry"),r}return r(t,e),t.prototype.setEndpointId=function(e){this.endpointId=e},t.prototype.setSkypeId=function(e){this.skypeId=e},t.prototype.setApplicationType=function(e){this.applicationType=e},t.prototype.setRing=function(e){this.ring=e},t.prototype.setTenantId=function(e){this.tenantId=e},t.prototype.setAcsResourceId=function(e){this.acsResourceId=e},t.prototype.setRegion=function(e){this.region=e},t.prototype.setPartition=function(e){this.partition=e},t.prototype.getEvent=function(e,t){var n=function(e){return void 0===e?"":e};return{EndpointId:n(this.endpointId),SkypeId:n(this.skypeId),ApplicationType:n(this.applicationType),Ring:n(this.ring),TenantId:n(this.tenantId),AcsResourceId:n(this.acsResourceId),Region:n(this.region),Partition:n(this.partition),TsCallingVersion:n(this.tsCallingVersion),HostName:this.getHostName(),EventTimestampBag:this.getEventTimestampBag(e,t),DiagnosticInfo:this.callEndDiagnosticInfo}},t.prototype.removeNonPendingOperations=function(){this.recordedEvents=this.recordedEvents.filter(function(e){return e.isPending()})},t}(g);t.CallRegistryTelemetry=f;var _=function(e){function t(t,n){var r=e.call(this,t,n,function(){return r.inCallMode&&r.recordedEvents.length>u})||this;return r.inCallMode=!1,r.getHostName=function(){try{return location.host}catch(e){return"unknown"}},r.tsCallingVersion=l.getTsCallingVersion(),r.logger=t.createChild("CallTelemetry"),r}return r(t,e),t.prototype.setCallId=function(e){this.currentCallId&&(this.previousCallId=this.currentCallId),this.currentCallId=e},t.prototype.setConsultativeCallId=function(e){this.consultativeCallId=e},t.prototype.setEndpointId=function(e){this.endpointId=e},t.prototype.setParticipantId=function(e){this.participantId=e},t.prototype.setPreheatFlags=function(e){this.preheatFlags=e},t.prototype.setCallOrigin=function(e){this.origin=e},t.prototype.setGroupId=function(e){this.groupId=e},t.prototype.setThreadId=function(e){this.threadId=e},t.prototype.setMesageId=function(e){this.messageId=e},t.prototype.setSkypeId=function(e){this.skypeId=e},t.prototype.setApplicationType=function(e){this.applicationType=e},t.prototype.setRing=function(e){this.ring=e},t.prototype.setTenantId=function(e){this.tenantId=e},t.prototype.setAcsResourceId=function(e){this.acsResourceId=e},t.prototype.setRegion=function(e){this.region=e},t.prototype.setPartition=function(e){this.partition=e},t.prototype.setFailureType=function(e){this.failureType=e},t.prototype.setIsCast=function(e){this.isCast=e?"True":"False"},t.prototype.setIsEmergency=function(e){this.isEmergency=e?"True":"False"},t.prototype.setRole=function(e){this.isAnonymous="admin"===e?"False":"True"},t.prototype.setCallType=function(e){this.callType=e},t.prototype.setConversationType=function(e){this.conversationType=e},t.prototype.setDirection=function(e){this.direction=e},t.prototype.setSelfParticipantRole=function(e){this.selfParticipantRole=e},t.prototype.setTerminationState=function(e){this.terminationState=e},t.prototype.setTerminationReason=function(e){this.terminationReason=e},t.prototype.setCallEndDiagnosticInfo=function(e){this.callEndDiagnosticInfo=e},t.prototype.setStackConfig=function(e){this.stackConfig=e},t.prototype.setJoinedFrom=function(e){this.joinedFrom=e},t.prototype.getEvent=function(e,t){var n=function(e){return void 0===e?"":e};return{CorrelationId:n(this.currentCallId),PreviousCorrelationId:n(this.previousCallId),ConsultativeCallId:n(this.consultativeCallId),EndpointId:n(this.endpointId),SkypeId:n(this.skypeId),ParticipantId:n(this.participantId),PreheatFlags:n(this.preheatFlags),CallType:n(this.callType),ConversationType:n(this.conversationType),Direction:n(this.direction),Origin:n(this.origin),SelfParticipantRole:n(this.selfParticipantRole),IsAnonymous:n(this.isAnonymous),GroupId:c.scrubMriOrOmit(n(this.groupId)),ThreadId:c.getLoggableThreadId(n(this.threadId)),MessageId:n(this.messageId),ApplicationType:n(this.applicationType),Ring:n(this.ring),TenantId:n(this.tenantId),AcsResourceId:n(this.acsResourceId),Region:n(this.region),Partition:n(this.partition),FailureType:n(this.failureType),IsCast:n(this.isCast),IsEmergency:n(this.isEmergency),TsCallingVersion:n(this.tsCallingVersion),TerminationState:n(this.terminationState),TerminationReason:n(this.terminationReason),StackConfig:n(this.stackConfig),EventTimestampBag:this.getEventTimestampBag(e,t),HostName:this.getHostName(),DiagnosticInfo:this.callEndDiagnosticInfo,JoinedFrom:this.joinedFrom}},t.prototype.switchToInCallTelemetry=function(){this.recordedEvents=this.recordedEvents.filter(function(e){return e.isPending()}),this.inCallMode=!0},t}(g);t.CallTelemetry=_;t.getEndpointInformationForTelemetry=function(e){return Array.isArray(e)?e.map(function(e){return{endpointId:e.endpointId,participantId:e.participantId}}):null};t.calculateJoinedFromForTelemetry=function(e,t,n,r,i){if(e){if(e.meetingUrl)return"MeetingUrl";if(e.meetingCode)return"MeetingCode"}return t||n?"ThreadContext":r?"GroupId":i?"Awareness":""}},function(e,t,n){"use strict";function r(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}var i=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.reason=t.callStartOptions=t.causeId=t.operationId=t.participantOperation=t.callOperation=t.IDEMPOTENCY_LEVEL=t.OPERATION_TYPE=void 0;var o,a=n(22),s=n(9),c=n(26);!function(e){e.CHAINED="Chained",e.SYNC="Sync",e.ASYNC="Async"}(o=t.OPERATION_TYPE||(t.OPERATION_TYPE={}));var l;!function(e){e.NO_OP="NoOp",e.ERROR="Error"}(l=t.IDEMPOTENCY_LEVEL||(t.IDEMPOTENCY_LEVEL={}));var u;!function(e){e[e.CALL=0]="CALL",e[e.PARTICIPANT=1]="PARTICIPANT"}(u||(u={})),t.callOperation=function(e,t){return d(u.CALL,e,t)},t.participantOperation=function(e,t){return d(u.PARTICIPANT,e,t)};t.operationId=function(e,t,n){if(e[t]._operationIdValue_)throw new Error("can not specify more than one operation id");e[t]._operationIdValue_=n};t.causeId=function(e,t,n){if(e[t]._causeIdValue_)throw new Error("can not specify more than one cause id");e[t]._causeIdValue_=n};t.callStartOptions=function(e,t,n){if(e[t]._callStartOptionsValue_)throw new Error("can not specify options more than once");e[t]._callStartOptionsValue_=n};t.reason=function(e,t,n){if(e[t]._clientReasonValue_)throw new Error("can not specify reason more than once");e[t]._clientReasonValue_=n};var d=function(e,t,n){return function(u,d,h){var g=h.value,f=u[d]&&u[d]._operationIdValue_,_=u[d]&&u[d]._causeIdValue_,m=u[d]&&u[d]._callStartOptionsValue_,v=u[d]&&u[d]._clientReasonValue_,y=n&&n.type||o.ASYNC;return h.value=function(){for(var u=this,d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];var C=this,S=void 0!==f?d[f]:void 0;if(void 0!==S)if(Array.isArray(S))try{var I=S.map(function(e){return e.toString()}).sort().concat().toString();S=r(I).toString()}catch(e){return Promise.reject(32)}else if(S&&"object"==typeof S)try{var O=JSON.stringify(S);n&&n.operationIdKey&&S.hasOwnProperty(n.operationIdKey)&&(O=S[n.operationIdKey]),S=O}catch(e){return Promise.reject(32)}var T=s.generateCauseId();void 0!==_&&(d[_]&&s.validateCauseId(d[_])?T=d[_]:d[_]=T);var E;void 0!==v&&d[v]&&(E=d[v]);var P=p(C,e);if(P.logOperation(T,t),n&&n.singular&&P.hasPendingOperation(t))return P.logOperation(T,t,"Not allowed, pending operation exists"),Promise.reject(60);var b=P.getEcsConfig();if(b&&b.enableOperationIdempotency&&n&&n.idempotencyLevel&&P.getRecord(t)>0)switch(P.logOperation(T,t,"Called multiple times, handling operation according to specified policy: idempotency="+n.idempotencyLevel),n.idempotencyLevel){case l.NO_OP:return Promise.resolve();case l.ERROR:return Promise.reject(60)}try{void 0!==m&&d[m]&&C.processCallStartOptions(d[m],T)}catch(e){return Promise.reject(32)}var A=!(!n||!n.convertError),R=function(){return y===o.CHAINED?P.executeChained(g.bind.apply(g,i([u],d)),t,S,T,A,E,n):y===o.SYNC?P.executeSync(g.bind.apply(g,i([u],d)),t,S,T,A,E):P.execute(g.bind.apply(g,i([u],d)),t,S,T,A,E,n)};if(t!==a.CALL_OPERATIONS.START_CALL&&t!==a.CALL_OPERATIONS.JOIN_CALL||P.hasPendingOperation(a.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED)||P.createPendingOperation(a.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED).catch(c.noop),n&&n.triggerAttach&&(P.hasPendingOperation(a.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY)||P.createPendingOperation(a.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY).catch(c.noop)),n&&n.type!==o.SYNC){var w=n&&n.waitFor;if(Array.isArray(w))return Promise.all(w.map(function(e){return e&&P.hasPendingOperation(e)&&P.waitForOperation(e,void 0,T)})).then(R,R);if(w&&P.hasPendingOperation(w))return P.waitForOperation(w,void 0,T).then(R,R)}return R()},h}},p=function(e,t){if(t===u.CALL)return e._callOperationHandler;if(t===u.PARTICIPANT)return e._participantOperationHandler;throw new Error("Unsupported operation handler type!")}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var a=n(18),s=n(52),c=n(9),l=n(30),u=n(39),d=n(19),p=n(77),h=function(e){function t(t,n,r,i,o){var a=e.call(this,t)||this;return a.callTelemetry=n,a._ecsConfig=r,a._publishCallback=i,a._preconditionFunction=o,a._record={},a.logSuccess=function(e,t,n){a._logger.info(e+" execution succeeded, result="+(t?a.stringifyForLogging(t):"void")+", time="+n.duration())},a.logFailure=function(e,t,n){a._logger.info(e+" execution failed, reason="+a.stringifyForLogging(t)+", time="+n.duration())},a.logTimeout=function(e,t,n){a._logger.info(e+" execution timed out, reason="+a.stringifyForLogging(t)+", time="+n.duration())},a.stringifyForLogging=function(e){var t;if(e instanceof Error)t=e.toString()||"Unknown Error";else try{t=JSON.stringify(e)}catch(e){t="Unable to stringify data"}return t},a.convertToTransactionEndIfErrorOrString=function(e,t,n){if(a._logger.info("ecsEnableErrorConversion in operationHandler is: "+(a._ecsConfig&&a._ecsConfig.enableErrorConversion)),t&&a._ecsConfig&&a._ecsConfig.enableErrorConversion&&("string"==typeof e||e instanceof Error)){var r=u.getRejectTransactionEnd(e);return a._logger.info(n+" Error converted from "+e+" to "+d.getPrintableObject(r)),r}return e},a._logger=t.createChild("[Operation]"),a._chainedPromise=new l.default(a._logger.createChild("[Chained]")),a}return r(t,e),t.prototype.resetOperationChain=function(e){this._chainedPromise.reset(e)},t.prototype.executeSync=function(e,t,n,r,i,o){void 0===r&&(r=c.generateCauseId());var a=this.getOperationInfoForLogging(r,t,n),s=p.build();this._logger.info(a+"API calledSync");var l,u=this.callTelemetry.recordOperation(t,r,n,o);try{this._setRecord(t),l=e(),u.recordSuccess(l,r),this.logSuccess(a,l,s)}catch(e){var d=this.convertToTransactionEndIfErrorOrString(e,i,a);u.recordFailure(d,r),this.logFailure(a,d,s)}return l},t.prototype.executeChained=function(e,t,n,r,a,s,l){return void 0===r&&(r=c.generateCauseId()),i(this,void 0,void 0,function(){return o(this,function(i){return[2,this.checkPendingOperationAndExecute(e,!0,t,n,r,a,s,l)]})})},t.prototype.execute=function(e,t,n,r,a,s,l){return void 0===r&&(r=c.generateCauseId()),i(this,void 0,void 0,function(){return o(this,function(i){return[2,this.checkPendingOperationAndExecute(e,!1,t,n,r,a,s,l)]})})},t.prototype.logOperation=function(e,t){for(var n=this,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=r.length&&r.map(function(e){return n.stringifyForLogging(a.scrubMriOrOmit(e))});this._logger.info("["+e+"]["+t+"]API called, "+(o?"with args="+o:""))},t.prototype.rejectPendingOperations=function(t,n,r){if(void 0===n&&(n=c.generateCauseId()),r){for(var i=0,o=Object.keys(this._deferredOperations);i<o.length;i++){l=o[i];this.callTelemetry.maybeRecordOperationFailure(l,r,void 0,n)}for(var a=0,s=Object.keys(this._deferredOperationsWithOperationId);a<s.length;a++)for(var l=s[a],u=0,d=Object.keys(this._deferredOperationsWithOperationId[l]);u<d.length;u++){var p=d[u];this.callTelemetry.maybeRecordOperationFailure(l,r,p,n)}}e.prototype.rejectPendingOperations.call(this,t,n)},t.prototype.maybeRejectOperations=function(t,n,r,i,o){if(void 0===i&&(i=c.generateCauseId()),o)for(var a=0,s=t;a<s.length;a++){var l=s[a];this.callTelemetry.maybeRecordOperationFailure(l,o,void 0,i)}e.prototype.maybeRejectOperations.call(this,t,n,r,i)},t.prototype.checkPendingOperationAndExecute=function(e,t,n,r,i,o,a,s){var l=this;void 0===i&&(i=c.generateCauseId());var u=this.getOperationInfoForLogging(i,n,r),d=null,p=null;return this.hasPendingOperationWithOperationId(n,r)||this.hasPendingOperation(n)?(this._logger.info(u+"already pending, returning existing operation"),d=this.waitForOperation(n,r,i)):p=this.createPendingOperation(n,r,i,s),t?(this._logger.info(u+"chained"),this._chainedPromise.chainPromise(function(){return d||l.executeInternal(p,i,e,n,r,o,a,s)},n,i)):d||this.executeInternal(p,i,e,n,r,o,a,s)},t.prototype._setRecord=function(e){this._record.hasOwnProperty(e)||(this._record[e]=0),this._record[e]+=1},t.prototype.getRecord=function(e){return this._record[e]},t.prototype._recordTelemetryTimeoutAndPublish=function(e,t,n,r,i,o,a){var s=this,c=e||60;return window.setTimeout(function(){if(s._publishCallback){if(s.hasPendingOperationWithOperationId(r,a)||s.hasPendingOperation(r)){var e=new Error(i+" execution did not complete before telemetry timeout of "+c+"s.");s.logTimeout(i,e,o),s.callTelemetry.maybeRecordOperationTimeout(r,e,a,n),s._publishCallback(t),s.callTelemetry.removeRecordedEvent(t)}}else s._logger.warn(i+" is marked to publish telemetry but no publish callback is defined.")},1e3*c)},t.prototype._instantTelemetryPublish=function(e,t){this._publishCallback?(this._publishCallback(t),this.callTelemetry.removeRecordedEvent(t)):this._logger.warn(e+" is marked to publish telemetry but no publish callback is defined.")},t.prototype.parseInstantTelemetryParameters=function(e){var t,n=!1;return e&&(n=e.enableInstantTelemetry&&!this._ecsConfig.disableInstantTelemetry,t=e.telemetryTimeout),[n,t]},t.prototype.executeInternal=function(e,t,n,r,a,s,c,l){var u;return i(this,void 0,void 0,function(){var i,d,h,g,f,_,m,v,y,C;return o(this,function(o){switch(o.label){case 0:i=this.getOperationInfoForLogging(t,r,a),this._logger.info(i+" executing operation..."),d=p.build(),h=this.callTelemetry.recordOperation(r,t,a,c),g=this.parseInstantTelemetryParameters(l),f=g[0],_=g[1],o.label=1;case 1:return o.trys.push([1,5,,6]),this._setRecord(r),m=void 0,f&&(m=this._recordTelemetryTimeoutAndPublish(_,h,t,r,i,d,a)),(null===(u=null===l||void 0===l?void 0:l.preconditionTags)||void 0===u?void 0:u.length)&&this._preconditionFunction?[4,this._preconditionFunction(r,l.preconditionTags)]:[3,3];case 2:o.sent(),o.label=3;case 3:return[4,n()];case 4:return v=o.sent(),m&&clearTimeout(m),this.callTelemetry.maybeRecordOperationSuccess(r,v,a),this.logSuccess(i,v,d),this.maybeResolveOperation(r,v,a,t),[3,6];case 5:return y=o.sent(),C=this.convertToTransactionEndIfErrorOrString(y,s,i),this.callTelemetry.maybeRecordOperationFailure(r,C,a),this.logFailure(i,C,d),this.maybeRejectOperation(r,C,a,t),[3,6];case 6:return f&&this._instantTelemetryPublish(i,h),[2,e]}})})},t.prototype.getEcsConfig=function(){return this._ecsConfig},t}(s.default);t.default=h},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0}),t.SOURCE_NONE=t.SlimCoreElectronRemoteStreamContext=void 0;var s=n(7),c=n(9),l=n(30),u=n(10),d=n(11),p=n(56),h=n(43),g=SlimCore.Enums,f=n(19),_=function(){return function(e){this.nrRunningStreams=0,this.videoStoppedEvent=new u.VideoStateCancelEvent}}();t.SlimCoreElectronRemoteStreamContext=_;var m=0;t.SOURCE_NONE=-1>>>0;var v=function(e){function n(n,r,i,o,a,s,c,d,p,_){var v=e.call(this,r.createChild(function(){return"RemoteStream("+v._context.nrRunningStreams+")["+v._remoteVideoId+":"+v.rank+":"+v._mediaType+":"+v._videoStatus+"]"}),i,o)||this;v._participantId=a,v.id=s,v.type=c,v._callHandler=d,v._context=p,v._participantIdMapperFactory=_,v.mediaSourceId=t.SOURCE_NONE,v._remoteVideoId=0,v._videoStatus=g.VideoStatus.None,v._dynamicVirtualParticipantMsi=t.SOURCE_NONE,v._stateCancelEvent=new u.VideoStateCancelEvent,v._shouldRun=!1,v._isDisposed=!1,v._txNdiNotifier=new h.default(v._logger,v._slimcoreInstance),v._nrRenderers=0,v._nrOngoingStreamStarts=0,v._nrOngoingStreamStops=0,v._vdeoStreamConfiguration={},v._chainedApiPromise=new l.default(r.createChild(function(){return"RemoteStreamChain("+v._context.nrRunningStreams+")"})),v._remoteVideoId=s,v.rank=m++;var y=v._getProperties(v._callHandler,v._remoteVideoId,{endpointId:{propKey:g.Property.VideoEndpointId},participantId:{propKey:g.Property.VideoParticipantLegId},negotiationTag:{propKey:g.Property.VideoNegotiationTag},label:{propKey:g.Property.VideoLabel}},{mediaType:{propKey:g.Property.VideoType},videoStatus:{propKey:g.Property.VideoStatus},mediaSourceId:{propKey:g.Property.VideoRank},dynamicVirtualParticipantMsi:{propKey:g.Property.VideoVirtualParticipantMsi}});return v._mediaType=y.mediaType,v._videoStatus=y.videoStatus,v._onVideoObjectPropertyChanged(g.Property.VideoStatus,function(){return v._onVideoObjectStateChanged(n)}),v._onVideoObjectPropertyChanged(g.Property.VideoNegotiationTag,function(e){return v._onVideoNegotiationTagChanged(e.value)}),v._onVideoObjectPropertyChanged(g.Property.VideoVirtualParticipantMsi,function(e){return v._onVideoObjectVirtualParticipantChanged(e.value)}),v.endpointId=y.endpointId,v.participantId=y.participantId,v.mediaSourceId=y.mediaSourceId,v.negotiationTag=y.negotiationTag,v.label=y.label,v._dynamicVirtualParticipantMsi=y.dynamicVirtualParticipantMsi,v._logger.info("constructor: endpointId: "+f.truncate(v.endpointId,8)+", participantId: "+v.participantId+", negotiationTag: "+v.negotiationTag+", causeId: "+n+", label: "+v.label+", dynamicVirtualParticipantMsi: "+v._dynamicVirtualParticipantMsi),v}return r(n,e),Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),n.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,msi:this.mediaSourceId,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming,negotiationTag:this.negotiationTag,video_status:this._videoStatus,shouldRun:this._shouldRun,nrRenderers:this._nrRenderers,isDisposed:this._isDisposed})},Object.defineProperty(n.prototype,"isAvailable",{get:function(){return u.isVideoAvailable(this._videoStatus)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isStreaming",{get:function(){return this._videoStatus===g.VideoStatus.Running},enumerable:!1,configurable:!0}),n.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},n.prototype.start=function(e,t){return o(this,void 0,void 0,function(){var n,r,i,o,s,l,d,p,h,g=this;return a(this,function(a){switch(a.label){case 0:n=Date.now(),r=t&&t.timeout,i=n,o=n,s=c.generateCauseId(),this._shouldRun=!0,this._logger.info("start causeId: "+s+" timout: "+r),this._nrOngoingStreamStarts++,a.label=1;case 1:return a.trys.push([1,8,9,10]),[4,u.waitForVideoObjectToBeAvailable(this._slimcoreInstance,this._callHandler,this._remoteVideoId,this._logger,s,u.videoObjectTimeout(this._settings),this._stateCancelEvent)];case 2:return a.sent(),i=Date.now(),[4,this._chainedApiPromise.chainPromise(function(){return g._startVideo(s,e,t)},this._chainActionFn("start"),s)];case 3:l=a.sent(),o=Date.now(),a.label=4;case 4:return a.trys.push([4,6,,7]),this._throwIfDisposed(s,"disposed while in start"),[4,u.waitForVideoObjectToBeRunning(this._slimcoreInstance,this._callHandler,this._remoteVideoId,this._logger,s,r,this._stateCancelEvent)];case 5:return a.sent(),this._updateVideoStatus(s),h=Date.now(),this._logger.info("start causeId: "+s+" successful. duration: "+(h-n)+" ("+(i-n)+"+"+(o-i)+"+"+(h-o)+")"),[2,l];case 6:throw d=a.sent(),l.dispose(s),d;case 7:return[3,10];case 8:throw p=a.sent(),h=Date.now(),this._logger.warn("start causeId: "+s+" failed. duration: "+(h-n)+" ("+(i-n)+"+"+(o-i)+"+"+(h-o)+") error: "+p),p;case 9:return this._nrOngoingStreamStarts--,0===this._nrRenderers&&0===this._nrOngoingStreamStarts&&this._stopWithCauseId(this._chainActionFn("no renderers, cleanup"),s),[7];case 10:return[2]}})})},n.prototype.stop=function(){return o(this,void 0,void 0,function(){var e;return a(this,function(t){switch(t.label){case 0:return e=c.generateCauseId(),[4,this._stopWithCauseId(this._chainActionFn("stop"),e)];case 1:return t.sent(),[2]}})})},n.prototype.setVideoStreamConfig=function(e){var t=this,n=c.generateCauseId();this._chainedApiPromise.chainPromise(function(){return t._setVideoStreamConfig(e,n)},this._chainActionFn("setVideoStreamConfig"),n)},n.prototype._setVideoStreamConfig=function(e,t){return o(this,void 0,void 0,function(){return a(this,function(n){return this._vdeoStreamConfiguration=i(i({},this._vdeoStreamConfiguration),e),this._shouldRun&&this._isRunning()&&this._setCurrentVideoStreamConfig(this._videoBinding,t),[2]})})},n.prototype._setCurrentVideoStreamConfig=function(e,t){s.isEmpty(this._vdeoStreamConfiguration)||(e.setSinkDeviceConfig?(this._logger.info("setVideoStreamConfig causeId: "+t+" json: "+JSON.stringify(this._vdeoStreamConfiguration)),e.setSinkDeviceConfig(this._vdeoStreamConfiguration)):this._logger.warn("setVideoStreamConfig causeId: "+t+" (that old) slimcore does not support setSinkDeviceConfig"))},n.prototype.dispose=function(e){this._disposeWithCauseId(this._chainActionFn("dispose"),e)},n.prototype.disposeInternal=function(e){return o(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,this._disposeWithCauseId(this._chainActionFn("disposeInternal"),e)];case 1:return t.sent(),[2]}})})},n.prototype._stopWithCauseId=function(e,t){return o(this,void 0,void 0,function(){var n=this;return a(this,function(r){switch(r.label){case 0:return r.trys.push([0,,2,3]),this._nrOngoingStreamStops++,this._shouldRun=!1,this._stateCancelEvent.fire(),[4,this._chainedApiPromise.chainPromise(function(){return n._stopVideo(t,!1)},e,t)];case 1:return r.sent(),[3,3];case 2:return this._nrOngoingStreamStops--,[7];case 3:return[2]}})})},n.prototype.registerRenderer=function(e,t){this._nrRenderers++},n.prototype.unregisterRenderer=function(e,t){0==--this._nrRenderers&&0===this._nrOngoingStreamStarts&&this._stopWithCauseId(this._chainActionFn("renderers disposed"),e)},n.prototype._chainActionFn=function(e){var t=this;return function(){return e+" ["+t._participantId+":"+t._remoteVideoId+":"+t.rank+":"+t._mediaType+":"+t._videoStatus+"]"}},n.prototype._isVideoStatusInStopping=function(){return this._videoStatus===g.VideoStatus.Stopping},n.prototype._updateVideoStatus=function(e){var t=this._getIntProperty(this._callHandler,this._remoteVideoId,g.Property.VideoStatus);this._videoStatus!==t&&(this._logger.info("VideoStateChanged: causeId: "+e+" status: "+this._videoStatus+" -> "+t),this._videoStatus=t,this._isVideoStatusInStopping()&&this._videoWasStopped(e),this.raiseChanged())},n.prototype._disposeWithCauseId=function(e,t){return o(this,void 0,void 0,function(){var n=this;return a(this,function(r){switch(r.label){case 0:return this._isDisposed=!0,this._shouldRun=!1,this._stateCancelEvent.fire(),[4,this._chainedApiPromise.chainPromise(function(){return n._dispose(t)},e,t)];case 1:return r.sent(),[2]}})})},n.prototype._onVideoObjectPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.id,e,t)},n.prototype._onVideoObjectStateChanged=function(e){this._updateVideoStatus(e)},n.prototype._onVideoObjectVirtualParticipantChanged=function(e){var t=this;this._dynamicVirtualParticipantMsi!==e&&(this._dynamicVirtualParticipantMsi=e,this._logger.info("VideoObjectVirtualParticipantChanged: old msi: "+this._dynamicVirtualParticipantMsi+" new msi: "+e),this._mapper||(this._mapper=this._participantIdMapperFactory(function(e){t._logger.info("VideoObjectVirtualParticipantChanged: raising to UX: old participantId: "+t.dynamicVirtualParticipantId+" new participantId: "+e),t.dynamicVirtualParticipantId=e,t.raiseChanged()})),this._mapper.update(e))},n.prototype._onVideoNegotiationTagChanged=function(e){this.negotiationTag!==e&&(this.negotiationTag=e,this.raiseChanged())},n.prototype._videoWasStopped=function(e){0===this._nrOngoingStreamStops?this._stopWithCauseId(this._chainActionFn("discovered video stopped"),e):this._logger.info("_videoWasStopped causeId: "+e+" noop: because "+this._nrOngoingStreamStops+" pending stops")},n.prototype._isRunning=function(){return!!this._videoBinding},n.prototype._stopVideo=function(e,t){return o(this,void 0,void 0,function(){return a(this,function(n){switch(n.label){case 0:return this._shouldRun&&!t&&!this._isVideoStatusInStopping()||!this._isRunning()?[3,3]:(this._logger.info("_stopVideo causeId: "+e+" force: "+t+" will stop remote video now"),this._slimcoreInstance.videoStop(this._remoteVideoId),this._txNdiNotifier.notifyNdiVideoStopped(e),[4,u.forgetAndLog(this._slimcoreInstance.videoReleaseBinding(this._remoteVideoId,this._videoBinding),this._logger,"_stopVideo causeId: "+e+" videoReleaseBinding on remote video")]);case 1:return n.sent(),this._videoBinding=null,[4,u.waitForVideoObjectToBeStopped(this._slimcoreInstance,this._callHandler,this._remoteVideoId,this._logger,e)];case 2:return n.sent(),this._context.nrRunningStreams--,this._logger.info("_stopVideo causeId: "+e+" force: "+t+" remote video is stopped"),this._updateVideoStatus(e),this._context.videoStoppedEvent.fire(),[3,4];case 3:this._logger.info("_stopVideo causeId: "+e+" noop, force: "+t+" should run: "+this._shouldRun+" is running: "+this._isRunning()+" already disposed: "+this._isDisposed),n.label=4;case 4:return[2]}})})},n.prototype._startVideo=function(e,t,n){return o(this,void 0,void 0,function(){var r,i;return a(this,function(o){switch(o.label){case 0:return[4,this._getStartedVideo(e)];case 1:r=o.sent(),o.label=2;case 2:return o.trys.push([2,3,,6]),this._updateVideoStatus(e),this._logger.info("_startVideo causeId: "+e+" create renderer"),[2,new p.default(e,this._logger,this._settings,null,t,this._mediaType,this._videoBinding,n,this)];case 3:return i=o.sent(),r?[4,u.forgetAndLog(this._stopVideo(e,!0),this._logger,"_startVideo causeId: "+e+" stopping remote video while got error while starting video")]:[3,5];case 4:o.sent(),o.label=5;case 5:throw i;case 6:return[2]}})})},n.prototype._dispose=function(t){return o(this,void 0,void 0,function(){return a(this,function(n){switch(n.label){case 0:return n.trys.push([0,,2,3]),[4,this._stopVideo(t,!0)];case 1:return n.sent(),[3,3];case 2:return this._mapper&&this._mapper.dispose(),e.prototype.dispose.call(this,t),[7];case 3:return[2]}})})},n.prototype._getStartedVideo=function(e){return o(this,void 0,void 0,function(){var t,n;return a(this,function(r){switch(r.label){case 0:if(this._throwIfDisposed(e,"disposed while in _getStartedVideo"),!this._shouldRun)throw new Error("_getStartedVideo causeId: "+e+" failing, should not run any more");if(this._isRunning())return[3,5];this._logger.info("_getStartedVideo causeId: "+e+" will start remote video now"),t=this._createVideoBindingRenderer(e),this._setCurrentVideoStreamConfig(t,e),this._slimcoreInstance.videoStart(this._remoteVideoId),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._slimcoreInstance.videoCreateBinding(this._remoteVideoId,t)];case 2:return r.sent(),this._txNdiNotifier.notifyNdiVideoStarted(e,this._remoteVideoId,t),[3,4];case 3:throw n=r.sent(),this._slimcoreInstance.videoStop(this._remoteVideoId),n;case 4:return this._context.nrRunningStreams++,this._videoBinding=t,this._logger.info("_getStartedVideo causeId: "+e+" remote video is started"),[2,!0];case 5:return[2,!1]}})})},n.prototype._throwIfDisposed=function(e,t){if(this._isDisposed)throw new Error("_throwIfDisposed causeId: "+e+" reason: "+t)},n.prototype._createVideoBindingRenderer=function(e){return this._slimcoreInstance.createVideoBindingRenderer?(this._logger.info("_createVideoBindingRenderer causeId: "+e+" createVideoBindingRenderer"),this._slimcoreInstance.createVideoBindingRenderer({enableDXVA:this._settings.enableDXVA,isLocalPreview:!1})):(this._logger.info("_createVideoBindingRenderer causeId: "+e+" old createVideoBindingRenderer"),SlimCore.createVideoBindingRenderer())},n}(d.default);t.default=v},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}},c=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},l=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var u=n(38),d=n(7),p=n(12),h=n(22),g=n(33),f=n(39),_=n(53),m=n(34),v=n(35),y=n(18),C=n(40),S=n(54),I=n(78),O=n(10),T=n(11),E=n(55),P=n(79),b=n(81),A=n(44),R=n(58),w=n(60),L=n(82),N=n(36),D=n(42),M=n(83),j=n(85),k=SlimCore.Enums,F=n(9),x=n(26),V=n(19),H=function(e){function t(t,n,r,i,o,a,s,u,p,g,f,_,m,y,S){var I,O=e.call(this,t.createChild(function(){var e=(O.endpointId||"").substr(0,8),t=(O.participantId||"").substr(0,8);return"Electron["+O.slimcoreCallId+":"+O.callId+"]["+e+"]["+t+"]["+O.state+"]"}),n,r)||this;O._slimcoreCallHandler=i,O._deviceManager=o,O._appHooks=a,O.groupId=s,O.threadId=u,O.callId=p,O.currentUserSkypeIdentity=g,O.participantId=f,O._telemetryLoggers=_,O.accountConfiguration=S,O.participants=[],O.participantMap={},O.isMuted=!1,O.isSpeakerMuted=!1,O.isServerMuted=!1,O.isVideoOn=!1,O.isScreenSharingOn=!1,O.dominantSpeakerInfo={speakerList:[],timestamp:null},O.slowedDownActiveTalkerInfo={speakerList:[],timestamp:null},O.callStartedAt=null,O.callHeldAt=null,O.failureType=2,O.slimcoreCallId=0,O.isHostless=!0,O.callType=-1,O.isIncomingOneOnOneVideoCall=!1,O.contentSharingSessions=[],O.screenSharingControl=null,O.dataChannelAdapter=null,O.isPreheatEnabled=!1,O.localMediaStreams=[],O.ptzHandler=null,O.mediaStreams=(I={},I[0]=[],I[1]=[],I),O._streamContextMap={},O._isAudioStreamConnected=!1,O._wasAudioStreamConnected=!1,O._callGotConnected=!1,O._enableGroupCallMeetupGeneration=!1,O._mediaPeerType=0,O._dataChannel=null,O._dataChannelUsers=[],O._isRelayWhiteListingIssue=!1,O._isOptimizedSpeakerEventingEnabled=!1,O._isSetVideoChannelsRenegotiated=!1,O._callIsSetupComplete=!1,O._transferState=0,O._parkState=0,O._capabilityFlags=k.SelfCapability.None,O._capabilities={canMuteOthers:!1,canUnmuteSelf:!1},O._removeCallChangeOnParticipantChanges=!1,O.inCallTelemetryReported=!1,O.setupTelemetryReported=!1,O.connectCallPromise=Promise.resolve(),O._spamRiskLevel=null,O._spamStirAttestation=null,O._videoRequestedOnWhileConnecting=!1,O._videoRequestedOffWhileConnecting=!1,O._callStartTime=(new Date).getTime(),O._state=0,O._mode=0,O._mergeParticipantMriToParticipantIdMap={},O._isLocallyHeld=!1,O._isSharedLineAppearanceV2Activated=!1,O._enableLeavePerfImprovements=!1,O._admitRejectionAsTransactionEnd=!1,O._enableAddParticipantPromiseOptimization=!1,O.mapOfUnresolvedVirtualParticipantMSIs=new Map,O._enableVirtualParticipantMsiMapping=!1,O.isServerMuteUnmuteEnabled=function(){return!!O.endpoints&&d.some(O.endpoints.endpointDetails,function(e){return O.endpointId===e.endpointId&&(e.capabilities&&"enabled"===e.capabilities.serverMuteUnmute)})},O.isMuteDisabled=function(){return O.isMuted},O.isUnMuteDisabled=function(){return 1===O.callType?!O.isMuted:2===O.callType&&(O.isServerMuteUnmuteEnabled()?!O.isServerMuted&&!O.isMuted:!O.isMuted)},O.cleanUp=function(e){return c(O,void 0,void 0,function(){var t;return l(this,function(n){switch(n.label){case 0:return this._logger.info("["+e+"][cleanup]start"),[4,Promise.all([this._getCallEndOperation(),this._cleanCallResources(e)])];case 1:return n.sent(),t={code:C.CONSTANTS.CODE.CLIENT_ERROR_CODE,subCode:C.CONSTANTS.SUB_CODE.ABANDONED},this._callOperationHandler.rejectPendingOperations(61,e,t),this._participantOperationHandler.rejectPendingOperations(47,e,t),this._callTelemetry.setTerminationState(this.state),this._callTelemetry.setTerminationReason(this.terminatedReason),this._reportTsCallingTelemetry(!this._callIsSetupComplete),[2]}})})},O._getCallEndOperation=function(){return O._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.STOP_CALL)?O._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.STOP_CALL):O._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.REJECT)?O._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.REJECT):Promise.resolve()},O._getFirstParticipantFailureReason=function(e){try{if(O._enableLeavePerfImprovements)return O.getIntProperty(k.Property.CallFailureReason);if(O.participants.length){var t=d.head(O.participants).getIntProperty(k.Property.ParticipantFailureReason);return e.info("participantFailureReason="+t),t}return void e.logFailure("no participants , can't query for participantFailureReason")}catch(e){return void O._logger.logFailure("participantFailureReason="+V.getPrintableObject(e))}},O.createVirtualParticipantMSIToParticipantIdMapper=function(e){var t=!1,n=function(t){O._logger.info("notify: participantId="+t),i.unresolvedMsi=N.SOURCE_NONE,e(t)},r={update:function(e){if(O._enableVirtualParticipantMsiMapping){if(t)return;if(e===N.SOURCE_NONE)n();else{var r=O.mapVirtualParticipantMsisToParticipantId([e])[0];r?n(r):i.unresolvedMsi=e}}},dispose:function(){t||(O._logger.info("createVirtualParticipantMSIToParticipantIdMapper: dispose"),O.mapOfUnresolvedVirtualParticipantMSIs.delete(e),t=!0)}},i={unresolvedMsi:N.SOURCE_NONE,notify:n};return O.mapOfUnresolvedVirtualParticipantMSIs.set(e,i),r},O._setTransferState=function(e,t){O.transferState!==e&&(O._logger.info("Transfer: state set: "+e),O._transferState=e,O._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_TRANSFER_STATE,{state:e},t),O.raiseChanged())},O._setParkState=function(e,t){O.parkState!==e&&(O._logger.info("Park: state set: "+e),O._parkState=e,O._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_PARK_STATE,{state:e},t),O.raiseChanged())},O._logger.info("constructor"),O.terminatedReason=0,O.meetingData=y,O._setupCallTelemetry(),O._setParticipantId(O.participantId),O._setGroupId(O.groupId),O._setThreadId(O.threadId),O._setCallId(O.callId),O._setCallOrigin(0),O._setMessageId(m),O._setIsEmergency(!1),O.accountConfiguration&&O._setApplicationType(S.applicationType);try{O._setEndpointId(O._slimcoreInstance.getRegistrationId(O.currentUserSkypeIdentity.id))}catch(e){O._logger.warn("getRegistrationId is missing!")}O.screenSharingControl=new M.default(O._logger,O._settings,O._slimcoreInstance,O,O._appHooks.getControlInjector(),O._telemetryLoggers),O.raiseRenderedAtViewer=O.raiseRenderedAtViewer.bind(O),O.screenSharingControl.setRaiseRenderedAtViewer(O.raiseRenderedAtViewer),O.dataChannelAdapter=new b.default(O._logger,O._slimcoreInstance),O.ptzHandler=new L.default(O._logger,O._settings,O._slimcoreInstance,O,O._deviceManager),O._dataChannelUsers=[O.screenSharingControl,O.dataChannelAdapter,O.ptzHandler];var T=O.tryEcsGetSettingAsBool("enableErrorConversion",!1),E=O.tryEcsGetSettingAsBool("enableOperationIdempotency",!1);O._removeCallChangeOnParticipantChanges=O.tryEcsGetSettingAsBool("removeCallChangeOnParticipantChanges",!1),O._enableLeavePerfImprovements=O.tryEcsGetSettingAsBool("enableLeavePerfImprovements",!1),O._admitRejectionAsTransactionEnd=O.tryEcsGetSettingAsBool("nativeAdmitRejectionAsTransactionEnd",!1),O._enableVirtualParticipantMsiMapping=O.tryEcsGetSettingAsBool("enableVirtualParticipantMsiMapping",!1);var P={enableErrorConversion:T,enableOperationIdempotency:E};return O._callOperationHandler=new v.default(O._logger,O._callTelemetry,P,void 0,function(e,t){return O.preconditions(e,t)}),O._participantOperationHandler=new v.default(O._logger,O._callTelemetry,P),O._dataChannelCreatedPromise=O._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_DATA_CHANNEL_CREATED),O._dataChannelCreatedPromise.catch(x.noop),O._streamContextMap[0]=new N.SlimCoreElectronRemoteStreamContext(O._logger),O._streamContextMap[1]=new N.SlimCoreElectronRemoteStreamContext(O._logger),O}return r(t,e),Object.defineProperty(t.prototype,"callMode",{get:function(){return this._mode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transferState",{get:function(){return this._transferState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parkState",{get:function(){return this._parkState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"publishedStates",{get:function(){return this._publishedStates},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"participantCounts",{get:function(){return this._participantCounts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spamRiskLevel",{get:function(){return this._spamRiskLevel},set:function(e){e&&(this._spamRiskLevel=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spamStirAttestation",{get:function(){return this._spamStirAttestation},set:function(e){e&&(this._spamStirAttestation=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"meetingData",{get:function(){return this._meetingData},set:function(e){this._logger&&this._logger.info("Set meetingData: _meetingData="+this._meetingData+", value:"+e),this._meetingData=e},enumerable:!1,configurable:!0}),t.prototype.tryEcsGetSettingAsBool=function(e,t){var n=t;try{n=this._slimcoreInstance.ecsGetSettingAsBool("SkypeCalling",e,t),this._logger.info("tryEcsGetSettingAsBool: "+e+" is: "+n)}catch(t){this._logger.logFailure("tryEcsGetSettingAsBool "+e+" Error: "+t)}return n},t.prototype.init=function(e){this._setMessageId(e.messageId),e.threadId&&this._setThreadId(e.threadId),this.meetingInfo=e.meetingInfo,this._enableGroupCallMeetupGeneration=!!e.enableGroupCallMeetupGeneration,e.transferContext&&(this._transferContext=e.transferContext,1===e.transferContext.transferType?this._setCallOrigin(2):0===e.transferContext.transferType?this._setCallOrigin(1):2===e.transferContext.transferType&&this._setCallOrigin(3),e.transferContext.transferorMri&&this._updateTransferorMri(e.transferContext.transferorMri)),this._endpointMetadata=e.endpointMetadata,this.onBehalfOfMri=e.onBehalfOf,this._emergencyContent=e.emergencyContent,this._mediaPeerType=e.mediaPeerType,this.broadcastMeeting&&(this.broadcastMeeting.context=e.broadcastContext),this._setIsEmergency(!!e.isEmergency),this.raiseChanged()},t.prototype.setDeviceManager=function(e){},t.prototype.processCallStartOptions=function(e,t){var n=this._logger.createFnLogger(h.CALL_OPERATIONS_INTERNAL.PROCESS_CALL_START_OPTIONS,t);try{1&e.preheatFlags&&(this.isPreheatEnabled=!0)}catch(e){n.logFailure(e)}},t.prototype.containsMultipleVideos=function(e){return e&&e.sendMediaModalities&&e.sendMediaModalities.mediaStates&&d.filter(e.sendMediaModalities.mediaStates,function(e){return 1===e.mediaType&&!e.isDisabled}).length>1},t.prototype.join=function(e,t,n){return void 0===n&&(n=F.generateCauseId()),c(this,void 0,void 0,function(){var r;return l(this,function(o){return r={shouldResurrect:this._getResurrectPreferrence()},[2,this._join(h.CALL_OPERATIONS.JOIN_CALL,e,i(i({},t),r),n)]})})},t.prototype._join=function(e,t,n,r){return c(this,void 0,void 0,function(){var o;return l(this,function(a){return this._setCallerMri(_.stripMriAliases(t.groupCallInitiator),r),this._callTelemetry.setDirection(g.DIRECTION.INCOMING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.JOIN),this.containsMultipleVideos(n)&&this._callTelemetry.setOperationVariant(e,h.OPERATION_VARIANTS.MULTIPLEVIDEOS),1&n.preheatFlags&&this._callTelemetry.setOperationVariant(e,h.OPERATION_VARIANTS.PREHEAT),n.muteFlags&&(o={muteMicrophone:!!(1&n.muteFlags),muteSpeaker:!!(2&n.muteFlags)},this._callTelemetry.updateOperationData(e,o,r)),this._callTelemetry.setPreheatFlags(n.preheatFlags),this.connectCallPromise=this._callOperationHandler.waitForOperation(e),[2,this._joinOrStartCall(e,i(i(i({},t),n),{videoDirection:O.returnVideoDirection(n),scenario:O.mapToEmptyStrIfFalsy(n.scenario),sendMediaModalities:O.returnStringifiedVersionOfMediaStateConfiguration(n.sendMediaModalities)}),r)]})})},t.prototype._getResurrectPreferrence=function(){return this.meetingInfo?"resurrect":"doNotResurrect"},t.prototype.start=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var n;return l(this,function(r){return n={shouldResurrect:this._getResurrectPreferrence()},[2,this._start(h.CALL_OPERATIONS.START_CALL,i(i({},e),n),t)]})})},t.prototype._start=function(e,t,n){return c(this,void 0,void 0,function(){var r,o,a,s,c=this;return l(this,function(l){return r=this._logger.createFnLogger(e,n),this._setCallerMri(_.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,n),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLER),this.containsMultipleVideos(t)&&this._callTelemetry.setOperationVariant(e,h.OPERATION_VARIANTS.MULTIPLEVIDEOS),1&t.preheatFlags?this._callTelemetry.setOperationVariant(e,h.OPERATION_VARIANTS.PREHEAT):t.encryptedKey&&this._callTelemetry.setOperationVariant(e,h.OPERATION_VARIANTS.ENCRYPTED),this.connectCallPromise=this._callOperationHandler.waitForOperation(e),t.muteFlags&&(o={muteMicrophone:!!(1&t.muteFlags),muteSpeaker:!!(2&t.muteFlags)},this._callTelemetry.updateOperationData(e,o,n)),this._callTelemetry.setPreheatFlags(t.preheatFlags),this._transferContext?(r.info("Transfer: Starting transfered call."),(a=this._transferContext.context).newCallObjectId?(this._setCallType(1),s=4===O.returnVideoDirection(t),2===this._transferContext.transferType&&(s=!1),[2,this._callOperationHandler.execute(function(){return c._startTransferTargetCall(a.newCallObjectId,s,n,c._mediaPeerType)},h.CALL_OPERATIONS.START_TRANSFER_TARGET_CALL)]):[2,Promise.reject(new Error("Transfer: Transfered context is invalid. Missing callObjectId or newCallObjectId"))]):[2,this._joinOrStartCall(e,i(i({},t),{videoDirection:O.returnVideoDirection(t),conversationType:this.isEmergency?"emergencyGroupCall":t.isCast?"cast":"",scenario:O.mapToEmptyStrIfFalsy(t.scenario),sendMediaModalities:O.returnStringifiedVersionOfMediaStateConfiguration(t.sendMediaModalities)}),n)]})})},t.prototype.startCallToVoicemail=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(n){return this._setCallerMri(_.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,t),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLER),this.connectCallPromise=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL),[2,this._joinOrStartCall(h.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{callToVoicemail:!0,voicemailResourcePath:e.voicemailResourcePath,voicemailItemId:e.voicemailItemId},t)]})})},t.prototype.startWithMeetingData=function(e,t){return c(this,void 0,void 0,function(){return l(this,function(n){return[2,this._start(h.CALL_OPERATIONS.START_WITH_MEETING_DATA,t,e)]})})},t.prototype.joinWithMeetingData=function(e,t,n){return c(this,void 0,void 0,function(){return l(this,function(r){return[2,this._join(h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,t,n,e)]})})},t.prototype.subscribeWithMeetingData=function(e,t,n){return c(this,void 0,void 0,function(){return l(this,function(r){return[2,this._subscribe(h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,t,n,e)]})})},t.prototype.startCallWithNudge=function(e,t,n){return void 0===n&&(n=F.generateCauseId()),c(this,void 0,void 0,function(){var r;return l(this,function(o){return this._setCallerMri(_.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,n),r=this._logger.createFnLogger(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,n),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLER),this.containsMultipleVideos(t)&&this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,h.OPERATION_VARIANTS.MULTIPLEVIDEOS),t.encryptedKey&&this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,h.OPERATION_VARIANTS.ENCRYPTED),d.isEmpty(e)?(r.logFailure("No participants provided to nudge"),[2,Promise.reject(new Error("No participants provided to nudge"))]):(this.connectCallPromise=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE),[2,this._joinOrStartCall(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,i(i({},t),{videoDirection:O.returnVideoDirection(t),ringOthers:!1,conversationType:t.isCast?"cast":"",participantsToNudge:e,invitationType:k.InvitationType.Nudge,scenario:O.mapToEmptyStrIfFalsy(t.scenario),sendMediaModalities:O.returnStringifiedVersionOfMediaStateConfiguration(t.sendMediaModalities)}),n)])})})},t.prototype.startAndUnpark=function(e,t,n,r){return void 0===n&&(n={}),void 0===r&&(r=F.generateCauseId()),c(this,void 0,void 0,function(){var o,a;return l(this,function(s){return this._setCallerMri(_.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,r),o=this._logger.createFnLogger(h.CALL_OPERATIONS.START_CALL_AND_UNPARK,r),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLER),this.containsMultipleVideos(n)&&this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,h.OPERATION_VARIANTS.MULTIPLEVIDEOS),n.encryptedKey&&this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.START_CALL_AND_UNPARK,h.OPERATION_VARIANTS.ENCRYPTED),this._setCallType(1),this.connectCallPromise=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.START_CALL_AND_UNPARK),a=0===e?h.UNPARK_CODE.PARK:1===e?h.UNPARK_CODE.SHARED_LINE:h.UNPARK_CODE.SERVER_HOLD,this.addParticipant("4:"+a,void 0,r).catch(function(e){return o.logFailure("Failed to add participant to unparked call="+e)}),[2,this._joinOrStartCall(h.CALL_OPERATIONS.START_CALL_AND_UNPARK,i(i({},n),{videoDirection:O.returnVideoDirection(n),conversationType:n.isCast?"cast":"",parkContext:e,pickupCode:t,scenario:O.mapToEmptyStrIfFalsy(n.scenario),sendMediaModalities:O.returnStringifiedVersionOfMediaStateConfiguration(n.sendMediaModalities)}),r)]})})},t.prototype.joinCallWithoutCallModality=function(e,t,n){return void 0===n&&(n=F.generateCauseId()),c(this,void 0,void 0,function(){var r;return l(this,function(o){return r={shouldResurrect:this._getResurrectPreferrence()},[2,this._subscribe(h.CALL_OPERATIONS.SUBSCRIBE,e,i(i({},t),r),n)]})})},t.prototype._subscribe=function(e,n,r,i){return c(this,void 0,void 0,function(){var o,a,s,c,u;return l(this,function(l){switch(l.label){case 0:if(this._setCallerMri(_.stripMriAliases(n.groupCallInitiator),i),(o=this._logger.createFnLogger(e,i)).info(e+": "+n.conversationUrl),this._callTelemetry.setDirection(g.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.SUBSCRIBE),n.conversationUrl||this._callTelemetry.setOperationVariant(e,h.OPERATION_VARIANTS.CCWM),0!==this.state)return o.logFailure("Trying to start a call that has already been acted on"),[2,Promise.reject(new Error("Trying to start a call that has already been acted on"))];a=this._getSlimCoreCallProperties({audioDirection:k.MediaDirection.Disabled,videoDirection:k.MediaDirection.Disabled,screenshareDirection:k.MediaDirection.Disabled,datachannelDirection:k.MediaDirection.Disabled,mediaPeerType:t.convertToSlimCoreMediaPeerType(this._mediaPeerType),isVideoEnabled:!1,isGoLive:!r.ringOthers,isHostless:!0,participantLegId:this.participantId,enableGroupCallMeetupGeneration:this._enableGroupCallMeetupGeneration,groupId:O.mapToEmptyStrIfFalsy(this.groupId),threadId:O.mapToEmptyStrIfFalsy(this.threadId),messageId:O.mapToEmptyStrIfFalsy(this.messageId),subject:O.mapToEmptyStrIfFalsy(r.label),conversationType:O.mapToEmptyStrIfFalsy(n.conversationType),meetingInfo:O.mapToEmptyStrIfFalsy(JSON.stringify(this.meetingInfo)),endpointMetadata:O.mapToEmptyStrIfFalsy(this._endpointMetadata),onBehalfOf:O.mapToEmptyStrIfFalsy(this.onBehalfOfMri),emergencyContent:O.mapToEmptyStrIfFalsy(this._emergencyContent),broadcastContext:this.broadcastMeeting&&this.broadcastMeeting.context?JSON.stringify(this.broadcastMeeting.context):null,callKey:"",encryptedKey:"",invitationType:k.InvitationType.None,connectionType:k.ConnectionType.AllSupported,maxVideoChannels:void 0!==r.maxVideoChannels?r.maxVideoChannels:0,muteFlags:r.muteFlags,negotiationTag:O.mapToEmptyStrIfFalsy(r.negotiationTag),routingFlags:r.routingFlags,scenario:O.mapToEmptyStrIfFalsy(r.scenario),mediaConfigurationJson:O.mapToEmptyStrIfFalsy(JSON.stringify(r.mediaConfiguration)),mediaStateConfigurationJson:O.returnStringifiedVersionOfMediaStateConfiguration(r.sendMediaModalities),clientEndpointCapabilities:r.clientEndpointCapabilities,clientEndpointDebugContent:O.mapToEmptyStrIfFalsy(r.clientEndpointDebugContent),invitationDataJson:O.mapToEmptyStrIfFalsy(r.invitationDataJson),meetingRegistrationId:O.mapToEmptyStrIfFalsy(r.meetingRegistrationId)}),l.label=1;case 1:switch(l.trys.push([1,3,,4]),s=void 0,c=JSON.stringify({conversationUrl:n.conversationUrl,conversationId:this.callId,conversationType:n.conversationType}),e){case h.CALL_OPERATIONS.SUBSCRIBE:s=this._slimcoreCallHandler.subscribe(c,a);break;case h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA:s=this._slimcoreCallHandler.subscribeToSignalingSessionWithMeetingData(JSON.stringify(this.meetingData),r.shouldResurrect,c,a);break;default:throw new Error("[_subscribe] unsupported operation name: "+e)}return this._setCallState(8,i),[4,this.attachSlimCoreCallObject(s,i,!0,e)];case 2:return l.sent(),O.hasFeature(k.Feature.ObservingStateSupported)?[2,this._callOperationHandler.waitForOperation(e,void 0,i)]:[2,Promise.resolve()];case 3:throw u=l.sent(),o.logFailure("sync failure, cleaning up slimcore ready operation: error="+V.getPrintableObject(u)),this._callTelemetry.updateOperationData(e,{error:V.getPIISafeObject(u)},i),this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),u;case 4:return[2]}})})},t.prototype._assertSlimcoreObjectId=function(e,t){if(0===e)throw new Error(t+" Failed. Slimcore returned objectId of 0")},t.prototype.joinPreheatedCall=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var n;return l(this,function(r){if(n=this._logger.createFnLogger(h.CALL_OPERATIONS.JOIN_PREHEATED_CALL,t),11!==this.state&&12!==this.state)return n.logFailure("Trying to join a call that is not in preheating state"),[2,Promise.reject(new Error("Trying to join a call that is not in preheating state"))];1==(1&e.muteFlags)&&(n.info("isMuted set to true in joinPreheatedCall"),this.isMuted=!0),2==(2&e.muteFlags)&&(n.info("isSpeakerMuted set to true in joinPreheatedCall"),this.isSpeakerMuted=!0),this._setCallState(2,t),this.connectCallPromise=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.JOIN_PREHEATED_CALL);try{this._slimcoreCallHandler.joinPreheatedCall(this.slimcoreCallId,t,e.muteFlags)}catch(e){throw this.stopInternal({causeId:t,terminatedReason:7}),n.logFailure(e),e}return[2,this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.JOIN_PREHEATED_CALL,void 0,t)]})})},t.prototype.toggleVideoFlagsWhileConnecting=function(e){e?(this._videoRequestedOnWhileConnecting=!0,this._videoRequestedOffWhileConnecting=!1):(this._videoRequestedOnWhileConnecting=!1,this._videoRequestedOffWhileConnecting=!0)},t.prototype.startVideoSafe=function(e){var t=this;return this.startVideo(e).catch(function(n){t._logger.createFnLogger(h.CALL_OPERATIONS.START_VIDEO,e).logFailure(n)})},t.prototype.startVideo=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var n,r,i=this;return l(this,function(o){return n=this._logger.createFnLogger(h.CALL_OPERATIONS.START_VIDEO,t),this.callStateCanToggleVideo()?(r=Promise.resolve().then(function(){return i._startLocalVideo(e,t)}).then(function(){return i._setVideoOn(!0,t)}),[2,this._callOperationHandler.registerPromise(h.CALL_OPERATIONS.START_VIDEO,r).catch(function(n){throw i._callTelemetry.updateOperationData(h.CALL_OPERATIONS.START_VIDEO,{error:V.getPIISafeObject(n)},t),i._logger.logFailure(n),i.stopVideo(e,t).catch(x.noop),n})]):(n.info("startVideo called but call is not in togglable state - starting preview only, video will start once available"),this.toggleVideoFlagsWhileConnecting(!0),this._setVideoOn(!0,t),[2])})})},t.prototype.cleanupLocalVideo=function(e){var t=this._getLocalVideo();t&&(this._removeMediaStream(t),t.dispose(e)),this._setVideoOn(!1,e)},t.prototype.stopVideo=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var n,r,i=this;return l(this,function(o){return n=this._logger.createFnLogger(h.CALL_OPERATIONS.STOP_VIDEO,t),this.callStateCanToggleVideo()?(r=Promise.resolve().then(function(){return c(i,void 0,void 0,function(){var r;return l(this,function(i){switch(i.label){case 0:return(r=this._getLocalVideo())?[4,O.forgetAndLog(r.stop(t,e),n,"stopVideo: stopping localVideo")]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})}),[2,this._callOperationHandler.registerPromise(h.CALL_OPERATIONS.STOP_VIDEO,r).then(function(){return i.cleanupLocalVideo(t)},function(e){i._callTelemetry.updateOperationData(h.CALL_OPERATIONS.STOP_VIDEO,{error:V.getPIISafeObject(e)},t),n.logFailure(e),i.cleanupLocalVideo(t)})]):(this._videoRequestedOnWhileConnecting?(n.info("stopVideo called but call is not in togglable state - video will stop once available"),this.toggleVideoFlagsWhileConnecting(!1),this._setVideoOn(!1,t)):n.info("stopVideo called but call is not in togglable state - enabling video was not requested anyway, so ignoring"),[2,Promise.resolve()])})})},Object.defineProperty(t.prototype,"endpointId",{get:function(){return this._endpointId},enumerable:!1,configurable:!0}),t.prototype._setEndpointId=function(e){this._endpointId=e,this._callTelemetry.setEndpointId(e)},t.prototype._setFailureType=function(e){this._callTelemetry.setFailureType(e),this.failureType=e},t.prototype._setGroupId=function(e){this._logger.info("Set groupId:"+y.scrubMriOrOmit(e)),this.groupId=e,this._callTelemetry.setGroupId(e)},t.prototype._setThreadId=function(e){this._logger.info("Set threadId:"+y.getLoggableThreadId(e)),this.threadId=e,this._callTelemetry.setThreadId(e)},t.prototype._setMessageId=function(e){this._logger.info("Set messageId:"+e),this.messageId=e,this._callTelemetry.setMesageId(e)},t.prototype._setCallType=function(e){this._logger.info("Set callType:"+e),this.callType=e,this._callTelemetry.setCallType(e)},t.prototype._setCallerMri=function(e,t){this._logger.info("["+t+"]Set callerMri:"+y.scrubMriOrOmit(e)),this.callerMri=e},t.prototype._setCallOrigin=function(e){this._logger.info("Set origin:"+e),this._origin=e,this._callTelemetry.setCallOrigin(e)},t.prototype._setIsCast=function(e){this._logger.info("Set isCast:"+e),this.isCast=e,this._callTelemetry.setIsCast(e)},t.prototype._setIsEmergency=function(e){this._logger.info("Set isEmergency:"+e),this.isEmergency=e,this._callTelemetry.setIsEmergency(e)},t.prototype._setApplicationType=function(e){this._logger.info("Set applicationType:"+e),this.applicationType=e,this._callTelemetry.setApplicationType(e)},t.prototype._addToMediaStreams=function(e){this.localMediaStreams.push(e),this.raiseChanged()},t.prototype._removeMediaStream=function(e){d.remove(this.localMediaStreams,e),this.raiseChanged()},t.prototype._getLocalVideo=function(){return d.find(this.localMediaStreams,function(e){return 1===e.mediaType})},t.prototype._getlocalScreenShareStream=function(){return d.find(this.localMediaStreams,function(e){return 2===e.mediaType})},t.prototype._startLocalVideo=function(e,t){var n=this._getLocalVideo();return n||(n=new w.default(t,this._logger,this._settings,this._slimcoreInstance,this.slimcoreCallId,this._slimcoreCallHandler,this._deviceManager,{enableMultiVideo:2===this.callType}),this._addToMediaStreams(n)),n.start(t,e)},t.prototype.dumpVideoSourceImages=function(){return c(this,void 0,void 0,function(){var e;return l(this,function(t){return(e=this._getLocalVideo())?[2,e.dumpVideoSourceImages()]:[2,Promise.reject(new Error("Cannot dump video effects debug images when there is no local video"))]})})},t.prototype.startScreenSharing=function(e,t,n,r){return void 0===r&&(r=F.generateCauseId()),c(this,void 0,void 0,function(){var i=this;return l(this,function(o){return this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.shutdownControlForViewer(),[2,Promise.resolve().then(function(){var e=i._getlocalScreenShareStream();return e||(e=new R.default(r,i._logger,i._settings,i._slimcoreInstance,i.slimcoreCallId,i._slimcoreCallHandler,i._deviceManager,i._appHooks,i.screenSharingControl,i._callTelemetry),i._addToMediaStreams(e),e.changed(function(){return i._onLocalScreenShareStreamChanged(r)}),e.on("sharingSourceLost",function(){return i._onLocalScreenShareSourceLost()}),e.on("windowClosed",function(){return i.stopScreenSharing(!1,n,r)}),e.on("scraperEvent",function(e){return i._onScraperEvent(e)})),e}).then(function(i){return i.start(r,e,t,n)})]})})},t.prototype.changeCropRegion=function(e){var t=this._getlocalScreenShareStream();t&&t.changeCropRegion(e)},t.prototype._onLocalScreenShareSourceLost=function(){this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.shutdownControlForSharer();var e=this._getlocalScreenShareStream();e&&e.isStreaming&&this.event("sharingDropped").raise()},t.prototype._onScraperEvent=function(e){var t={event:e.event,data:e.data};this.event("scraperEvent").raise(t)},t.prototype.raiseRenderedAtViewer=function(e){this.event("sharingRenderedAtViewer").raise(e)},t.prototype._onLocalScreenShareStreamChanged=function(e){var t=this._getlocalScreenShareStream();t&&t.isStreaming?(!this.isScreenSharingOn&&this._dataChannel&&this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&(this.screenSharingControl.initControlForSharer(t.negotiationTag),this._dataChannel.start()),this._setScreenSharingOn(!0,e)):t&&!t.isAvailable&&(this.isScreenSharingOn&&this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.shutdownControlForSharer(),this._setScreenSharingOn(!1,e))},t.prototype.stopScreenSharing=function(e,t,n){return void 0===n&&(n=F.generateCauseId()),c(this,void 0,void 0,function(){var e,r,i,o=this;return l(this,function(a){return e=this._logger.createFnLogger(h.CALL_OPERATIONS.STOP_SCREEN_SHARING,n),r=function(){var e=o._getlocalScreenShareStream();e&&(o._removeMediaStream(e),e.dispose(n)),o._setScreenSharingOn(!1,n),o.screenSharingControl&&o.screenSharingControl.isScreenSharingControlEnabled()&&o.screenSharingControl.shutdownControlForSharer()},i=Promise.resolve().then(function(){return c(o,void 0,void 0,function(){var r;return l(this,function(i){switch(i.label){case 0:return(r=this._getlocalScreenShareStream())?[4,O.forgetAndLog(this.shareSystemSound(!1),e,"stopScreenSharing: set shareSystemSound to false.")]:[3,3];case 1:return i.sent(),[4,O.forgetAndLog(r.stop(n,t),e,"stopScreenSharing: stopping screen sharing")];case 2:i.sent(),i.label=3;case 3:return[2]}})})}),[2,this._callOperationHandler.registerPromise(h.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING,i).then(r,function(t){throw e.logFailure(t),r(),t})]})})},t.prototype.startDataChannel=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return[4,this._dataChannelCreatedPromise];case 1:return t.sent(),[2,this._dataChannel.start(e)]}})})},t.prototype.stopDataChannel=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return[4,this._dataChannelCreatedPromise];case 1:return t.sent(),[2,this._dataChannel.stop(e)]}})})},t.prototype.sendUserEvents=function(e,t){return c(this,void 0,void 0,function(){return l(this,function(n){switch(n.label){case 0:return[4,this._dataChannelCreatedPromise];case 1:return n.sent(),[2,this._dataChannel.sendUserEvents(e,t)]}})})},t.prototype.shareSystemSound=function(e){return c(this,void 0,void 0,function(){var t=this;return l(this,function(n){return this._logger.info("shareSystemSound: "+e),[2,Promise.resolve().then(function(){t._slimcoreCallHandler.callShareSystemSound(t.slimcoreCallId,e)})]})})},t.prototype.startFaceStream=function(e,t){return c(this,void 0,void 0,function(){return l(this,function(n){return this._logger.info("startFaceStream: deviceid = "+e+", recipientId = "+t),this._slimcoreCallHandler.startFaceStream(this.slimcoreCallId,e,t),[2]})})},t.prototype.stopFaceStream=function(){return c(this,void 0,void 0,function(){return l(this,function(e){return this._logger.info("stopFaceStream"),this._slimcoreCallHandler.stopFaceStream(this.slimcoreCallId),[2]})})},t.prototype.startMultichannelAudioDevice=function(e,t){return c(this,void 0,void 0,function(){return l(this,function(n){return this._logger.info("startMultichannelAudioDevice: "+e),this._slimcoreCallHandler.startMultichannelAudioDevice(this.slimcoreCallId,e,t),[2]})})},t.prototype.stopMultichannelAudioDevice=function(){return c(this,void 0,void 0,function(){return l(this,function(e){return this._logger.info("stopMultichannelAudioDevice"),this._slimcoreCallHandler.stopMultichannelAudioDevice(this.slimcoreCallId),[2]})})},t.prototype.transferCall=function(e){return this._logger.warn("transferCall is deprecated, please use callBlindTransfer instead"),this.callBlindTransfer(e)},t.prototype.callBlindTransfer=function(e,t,n){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var r;return l(this,function(i){return r={transferTarget:e,transferType:0,transferStatusSuccessList:[k.CallStatus.Transferring,k.CallStatus.Transferred]},[2,this._transferCall(r,n,t)]})})},t.prototype.callSafeTransfer=function(e,t,n){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var r;return l(this,function(i){return r={transferTarget:e,transferType:0,transferStatusSuccessList:[k.CallStatus.Transferred]},[2,this._transferCall(r,n,t)]})})},t.prototype.transferCallToVoicemail=function(e,t){void 0===t&&(t=F.generateCauseId());var n={transferTarget:e.transferTargetMri,transferType:2,transferStatusSuccessList:[k.CallStatus.Transferred]};return this._transferCall(n,null,t)},t.prototype.callConsultativeTransfer=function(e,t,n,r){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var i,o,a=this;return l(this,function(s){return i={targetCallId:e.slimcoreCallId,transferType:0,transferStatusSuccessList:[k.CallStatus.Transferred]},o=this._transferCall(i,r,t,n),[2,o.then(function(r){return a._callTelemetry.updateOperationData(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,{participantLegId:n,targetCallId:e.callId},t),a._logger.logSuccess("["+h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER+"]["+t+"] target call id: "+e.callId+" Transfer target participant_leg_id: "+n),Promise.resolve(r)}).catch(function(r){return a._callTelemetry.updateOperationData(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,{error:V.getPIISafeObject(r),participantLegId:n,targetCallId:e.callId},t),a._logger.logFailure("["+h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER+"]["+t+"] target call id: "+e.callId+" Transfer target participant_leg_id: "+n+" error: "+r),Promise.reject(f.getRejectTransactionEnd(r))})]})})},t.prototype.consultativeTransferWithPickupCode=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var n,r,i=this;return l(this,function(o){return(n=this._logger.createFnLogger(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,t)).info("pickup code: "+e),e?(r=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,"",t),[2,Promise.resolve().then(function(){return i._slimcoreCallHandler.consultativeTransferWithOptions(i.slimcoreCallId,e,0,t)}).catch(function(e){return i._callTelemetry.updateOperationData(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,{error:V.getPIISafeObject(e)},t),n.logFailure(e),Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return r})]):(n.info("pickup code cannot be empty"),[2,Promise.reject(f.getRejectTransactionEnd("pickup code cannot be empty"))])})})},t.prototype._transferCall=function(e,t,n,r){return c(this,void 0,void 0,function(){var i,o,a;return l(this,function(s){if((i=this._logger.createFnLogger("Transfer",n)).info("start"),this._setTransferState(1,n),o=this._waitForTransferSuccessOrFailure(e.transferStatusSuccessList,0,n),a=t&&t.clientTransferContext?JSON.stringify(t.clientTransferContext):void 0,e.transferTarget&&2===e.transferType)this._slimcoreCallHandler.startCallTransfer(this.slimcoreCallId,e.transferTarget,k.TransferType.TransferToVoicemail,!1);else if(e.transferTarget)this._slimcoreCallHandler.startCallTransfer(this.slimcoreCallId,e.transferTarget,k.TransferType.TransferStandard,!(!t||!t.disableForwardingAndUnanswered),a);else{if(!e.targetCallId)return[2,Promise.reject(new Error("Either transferTarget/transfereeCallId should be present"))];this._slimcoreCallHandler.startConsultativeCallTransfer(e.targetCallId,this.slimcoreCallId,r,n,!(!t||!t.disableForwardingAndUnanswered),a)}return[2,o]})})},t.prototype.callRedirect=function(e,t){return void 0===t&&(t=F.generateCauseId()),Promise.reject(new Error("API is not implemented yet."))},t.prototype.park=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var n,r,i,o,a=this;return l(this,function(s){return n={context:e,parkStatusSuccessList:[k.CallStatus.Parked]},(r=this.mapParkContext(n.context))===k.ParkContext.Invalid?[2,Promise.reject("invalid park context "+r)]:3===e||4===e?(i=this._logger.createFnLogger("Park",t),o=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.PARK_CALL,"",t),[2,Promise.resolve().then(function(){return a._slimcoreCallHandler.startCallPark(a.slimcoreCallId,r,t)}).then(function(){return o}).then(function(e){return i.info("operation succeeded: result: "+JSON.stringify(e)),""})]):(this._setParkState(1,t),this._parkCompletePromise=this._waitForTransferSuccessOrFailure(n.parkStatusSuccessList,1,t),this._slimcoreCallHandler.startCallPark(this.slimcoreCallId,r,t),[2,this._parkCompletePromise.then(function(){try{var e=a.getStrProperty(k.Property.CallParkPickupCode);return a._serverHoldLocation=a.getStrProperty(k.Property.CallServerHoldLocation),Promise.resolve(e)}catch(e){return Promise.reject(32)}})])})})},t.prototype.unpark=function(e,t){return c(this,void 0,void 0,function(){var n,r,i=this;return l(this,function(o){return(n=this.mapParkContext(e))===k.ParkContext.Invalid?[2,Promise.reject("invalid park context "+e)]:(r=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UNPARK_CALL,"",t),[2,Promise.resolve().then(function(){return i._slimcoreCallHandler.unpark(i.slimcoreCallId,n,t)}).then(function(){return r})])})})},t.prototype.getServerHoldLocation=function(){return c(this,void 0,void 0,function(){var e=this;return l(this,function(t){return[2,this._parkCompletePromise.then(function(){return e._logger.info("getServerHoldLocation="+e._serverHoldLocation),Promise.resolve(e._serverHoldLocation)})]})})},t.prototype.getJoinBlob=function(){return c(this,void 0,void 0,function(){var e=this;return l(this,function(t){return[2,Promise.resolve().then(function(){var t=e._slimcoreCallHandler.getJoinBlob(e.slimcoreCallId);return e._logger.info("getJoinBlob="+t),t})]})})},t.prototype.mapParkContext=function(e){switch(e){case 0:return k.ParkContext.Team;case 1:return k.ParkContext.Sharedline;case 4:return k.ParkContext.Sharedlinev2;case 2:return k.ParkContext.Serverhold;case 3:return k.ParkContext.Serverholdv2;default:return k.ParkContext.Invalid}},t.prototype._waitForTransferSuccessOrFailure=function(e,n,r){var i=this,o=this._logger.createFnLogger("WaitForTransfer",r);o.info("successStatusList="+e+", type="+n);var a=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,r),s=0===n?k.Property.CallTransferStatus:k.Property.CallParkStatus,c=0===n?k.Property.CallTransferFailureReason:k.Property.CallParkFailureReason,l=function(n){if(o.info("status changed: "+n+" ("+k.CallStatus[n]+")"),-1!==e.indexOf(n)||n===k.CallStatus.Failed)if(u&&(u.dispose(),u=null),-1!==e.indexOf(n))i._callOperationHandler.resolveOperation(h.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,1);else{var a=i.getIntProperty(c),s=t.convertParticipantReasonToTerminatedReason(A.convertFailureReasonToParticipantReason(a)),l={reason:a,code:i.transferDiagnosticsInfo&&i.transferDiagnosticsInfo.callControllerCode,subcode:i.transferDiagnosticsInfo&&i.transferDiagnosticsInfo.callControllerSubCode};i._callTelemetry.updateOperationData(h.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,l,r),o.logFailure("failureReason="+a+" => terminatedReason="+s+", diagnostic info: "+V.getPrintableObject(i.transferDiagnosticsInfo)),i._callOperationHandler.rejectOperation(h.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,s)}},u=this._slimcoreInstance.handle("object-property-changed",{objectId:this.slimcoreCallId,propKey:s},function(e){return l(e.value)});return a},t.prototype.mute=function(e){return void 0===e&&(e=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(t){return this.isMuteDisabled()?[2,Promise.reject(f.getRejectTransactionEnd(h.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))]:[2,this._muteUnmute(!0,e)]})})},t.prototype.unmute=function(e){return void 0===e&&(e=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(t){return this.isUnMuteDisabled()?[2,Promise.reject(new Error("Cannot unmute when already locally and server unmuted"))]:[2,this._muteUnmute(!1,e)]})})},t.prototype.muteSpeaker=function(e){return void 0===e&&(e=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(t){return this.isSpeakerMuted?[2,Promise.reject(new Error("Cannot mute speaker when already muted"))]:[2,this._muteUnmuteSpeaker(!0,e)]})})},t.prototype.unmuteSpeaker=function(e){return void 0===e&&(e=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(t){return this.isSpeakerMuted?[2,this._muteUnmuteSpeaker(!1,e)]:[2,Promise.reject(new Error("Cannot unmute speaker when already unmuted"))]})})},t.prototype.muteParticipants=function(e,t,n){return void 0===n&&(n=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(r){return[2,this._muteParticipants(e,t,n)]})})},t.prototype.hold=function(e,t,n){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(r){return[2,n&&n.isLocal?this._localHold(e,t,n):this._hold(e,t,n)]})})},t.prototype._localHold=function(e,t,n){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(r){return[2,this._holdUnhold(!0,t,e,n)]})})},t.prototype._hold=function(e,t,n){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(r){return[2,this._holdUnhold(!0,t,e,n)]})})},t.prototype.unhold=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(n){return[2,this._isLocallyHeld?this._localUnhold(e,t):this._unhold(e,t)]})})},t.prototype._localUnhold=function(e,t){return c(this,void 0,void 0,function(){return l(this,function(n){return[2,this._holdUnhold(!1,t,e)]})})},t.prototype._unhold=function(e,t){return c(this,void 0,void 0,function(){return l(this,function(n){return[2,this._holdUnhold(!1,t,e)]})})},t.prototype.updateEndpointMetadata=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(n){return 3!==this.state?(this._logger.warn("Trying to updateEndpointMetadata in a call which is not connected, callId = "+this.callId),[2,Promise.reject(new Error("cannot updateEndpointMetadata in a call which is not connected"))]):(this._endpointMetadata=e,[2,this._updateEndpointMetadata(this._endpointMetadata,t)])})})},t.prototype.preconditions=function(e,t){return this._logger.info("check call mode currentMode is "+this.callMode+" operationName is "+e),d.some(t,function(e){return e===h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE})?this.checkCallMode():Promise.resolve()},t.prototype.checkCallMode=function(){return 2===this.callMode?(this._logger.info("reject check callmode"),Promise.reject({code:h.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:h.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE,phrase:h.TRANSACTION_END_PHRASE.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE})):Promise.resolve()},t.prototype.sendDtmfTone=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(n){return this._logger.info("DTMF tone <omitted>"),[2,this._sendDtmfTone(e,t)]})})},t.prototype.setAudioUsageMode=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(n){return[2,this._setAudioUsageMode(e,t)]})})},t.prototype.setAudioMidcallConfig=function(e,t,n){return void 0===n&&(n=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(r){return[2,this._setAudioMidcallConfig(e,t,n)]})})},t.prototype.setAudioMidcallConfigJson=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){return l(this,function(n){return[2,this._setAudioMidcallConfigJson(e,t)]})})},t.prototype.getTechnicalInformationJson=function(){return c(this,void 0,void 0,function(){var e=this;return l(this,function(t){return[2,Promise.resolve().then(function(){try{return e._slimcoreCallHandler.callGetTechnicalInformationJson(e.slimcoreCallId)}catch(t){throw e._logger.error("Error in callGetTechnicalInformationJson callId: "+e.callId+", error: "+t),t}})]})})},t.prototype.startAudio=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var n,r;return l(this,function(i){return n=this._logger.createFnLogger(h.CALL_OPERATIONS.START_AUDIO,t),3!==this.state?(n.logFailure("cannot startAudio when call is not connected"),[2,Promise.reject(60)]):(r=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.START_AUDIO,void 0,t),this._slimcoreCallHandler.callStartAudio(this.slimcoreCallId,e),[2,r])})})},t.prototype.stopAudio=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var n,r;return l(this,function(i){return n=this._logger.createFnLogger(h.CALL_OPERATIONS.STOP_AUDIO,t),3!==this.state?(n.logFailure("cannot stopAudio when call is not connected"),[2,Promise.reject(60)]):(r=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.STOP_AUDIO,void 0,t),this._slimcoreCallHandler.callStopAudio(this.slimcoreCallId,e),[2,r])})})},t.prototype.assimilate=function(e,t,n,r){return void 0===r&&(r=F.generateCauseId()),c(this,void 0,void 0,function(){var i;return l(this,function(o){return(i=this._logger.createFnLogger(h.CALL_OPERATIONS.ASSIMILATE,r)).info("assimilate: "+e.callId+" threadId: "+y.getLoggableThreadId(t)+", messageId: "+n+", causeId: "+r),this._slimcoreCallHandler.callAssimilate(this.slimcoreCallId,e.slimcoreCallId,t,n),[2,Promise.resolve({code:0})]})})},t.prototype._onMediaNegotiationStatusChanged=function(e){this._logger.createFnLogger("onMediaNegotiationStatusChanged",e.causeId).info("_onMediaNegotiationStatusChanged modalityType: "+e.modalityType+"\n            mediaNegotiationStatusCode: "+e.mediaNegotiationStatusCode);var t;switch(e.modalityType){case k.ModalityType.Audio:t=this._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.START_AUDIO)?h.CALL_OPERATIONS.START_AUDIO:h.CALL_OPERATIONS.STOP_AUDIO;break;case k.ModalityType.Video:t=h.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS;break;default:return}this._callOperationHandler.hasPendingOperation(t)&&(e.mediaNegotiationStatusCode===k.MediaNegotiationStatusCode.Succeeded?this._callOperationHandler.maybeResolveOperation(t,e.mediaNegotiationStatusCode,void 0,e.causeId):this._callOperationHandler.maybeRejectOperation(t,e.mediaNegotiationStatusCode,void 0,e.causeId))},t.prototype.publishState=function(e,t){var n=this,r=e.level,i=this._logger.createFnLogger(h.CALL_OPERATIONS.PUBLISH_STATE,t),o=e.type;return this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.PUBLISH_STATE,e.participantIds&&e.participantIds.length>0?""+o+h.OPERATION_VARIANTS.SPECIFIED:""+o+h.OPERATION_VARIANTS.NONE),Promise.resolve().then(function(){var i=n.getSlimcoreEnumLevel(r);n._slimcoreCallHandler.publishState(n.slimcoreCallId,o,i,e.content,t,e.participantIds)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.PUBLISH_STATE,t,t)}).catch(function(e){return n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.PUBLISH_STATE,{type:o,error:V.getPIISafeObject(e)},t),i.logFailure(e),Promise.reject(e)})},t.prototype.publishStatesForEveryone=function(e,t){var n=this,r=e.level,i=this._logger.createFnLogger(h.CALL_OPERATIONS.PUBLISH_STATE,t),o=e.type;return this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.PUBLISH_STATE,""+e.type+h.OPERATION_VARIANTS.ALL),Promise.resolve().then(function(){var i=n.getSlimcoreEnumLevel(r);n._slimcoreCallHandler.publishStatesForEveryone(n.slimcoreCallId,o,i,e.content,t)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.PUBLISH_STATE,t,t)}).catch(function(e){return n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.PUBLISH_STATE,{type:o,error:V.getPIISafeObject(e)},t),i.logFailure(e),Promise.reject(e)})},t.prototype.removeState=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.REMOVE_STATE,t);return Promise.resolve().then(function(){n._slimcoreCallHandler.removeState(n.slimcoreCallId,e.stateIds,t)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.REMOVE_STATE,t)}).catch(function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.REMOVE_STATE,{error:V.getPIISafeObject(e)},t),r.logFailure(e),e})},t.prototype.removeStatesForEveryone=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.REMOVE_STATE,t);return Promise.resolve().then(function(){n._slimcoreCallHandler.removeStatesForEveryone(n.slimcoreCallId,e.type,t)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.REMOVE_STATE,t)}).catch(function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.REMOVE_STATE,{error:V.getPIISafeObject(e)},t),r.logFailure(e),e})},t.prototype.updateMeetingSettings=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS,t);return Promise.resolve().then(function(){n._slimcoreCallHandler.updateMeetingSettingsJson?n._slimcoreCallHandler.updateMeetingSettingsJson(n.slimcoreCallId,JSON.stringify(e),t):n._slimcoreCallHandler.updateMeetingSettings(n.slimcoreCallId,!!e.allowRaiseHands,t)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS,t)}).catch(function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS,{error:V.getPIISafeObject(e)},t),r.logFailure(e),e})},t.prototype.mapParticipantScope=function(e){switch(e){case 0:return k.ParticipantScope.ParticipantScopeAll;case 3:return k.ParticipantScope.ParticipantScopeAttendees;case 2:return k.ParticipantScope.ParticipantScopePresenters;case 1:return k.ParticipantScope.ParticipantScopeSpecified;default:return k.ParticipantScope.ParticipantScopeNone}},t.prototype.updateMeetingGroups=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,e),i={participantScope:this.mapParticipantScope(t.scope),participantsJson:JSON.stringify(t.participants),fromGroup:t.fromGroup,toGroup:t.toGroup};return Promise.resolve().then(function(){n._slimcoreCallHandler.updateMeetingGroups(n.slimcoreCallId,e,i)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,e)}).catch(function(t){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,{error:V.getPIISafeObject(t)},e),r.logFailure(t),t})},t.prototype.updateMeetingLiveState=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,e),o=i({},t);return Promise.resolve().then(function(){n._slimcoreCallHandler.updateMeetingLiveState(n.slimcoreCallId,e,o)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,e)}).catch(function(t){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,{error:V.getPIISafeObject(t)},e),r.logFailure(t),t})},t.prototype.updateParticipantInterpretationState=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,e),o=i({mris:t.mris,state:t.state},"interpreter"===t.state&&{sourceGroupId:t.sourceGroupId,targetGroupId:t.targetGroupId});return Promise.resolve().then(function(){n._slimcoreCallHandler.updateParticipantInterpretationState(n.slimcoreCallId,e,o)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,e)}).catch(function(t){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,{error:V.getPIISafeObject(t)},e),r.logFailure(t),t})},t.prototype.joinMeetingGroup=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.JOIN_MEETING_GROUP,e),o=i({meetingGroupId:t.meetingGroupId},t.groupPreferences&&{groupPreferences:JSON.stringify(t.groupPreferences)});return Promise.resolve().then(function(){n._slimcoreCallHandler.joinMeetingGroup(n.slimcoreCallId,e,o)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.JOIN_MEETING_GROUP,e)}).catch(function(t){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.JOIN_MEETING_GROUP,{error:V.getPIISafeObject(t)},e),r.logFailure(t),t})},t.prototype.leaveMeetingGroup=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.LEAVE_MEETING_GROUP,e),i={meetingGroupId:t.meetingGroupId};return Promise.resolve().then(function(){n._slimcoreCallHandler.leaveMeetingGroup(n.slimcoreCallId,e,i)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.LEAVE_MEETING_GROUP,e)}).catch(function(t){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.LEAVE_MEETING_GROUP,{error:V.getPIISafeObject(t)},e),r.logFailure(t),t})},t.prototype.stop=function(e,t,n,r){void 0===e&&(e=!1),void 0===t&&(t=F.generateCauseId());var o=this._logger.createFnLogger(h.CALL_OPERATIONS.STOP_CALL,t);if(6===this.state)return o.logFailure("Trying to stop a call which is already Disconnecting, callId = "+this.callId),Promise.reject(new Error("cannot stop call in Disconnecting state"));if(7===this.state)return o.logFailure("Trying to stop a call which is already Disconnected, callId = "+this.callId),Promise.reject(new Error("cannot stop call in Disconnected state"));var a=i(i({},n),{causeId:t,forEveryone:e,reason:r||{}});return this.stopInternal(a)},t.prototype.testHook=function(e,t){void 0===t&&(t=F.generateCauseId());var n=this._logger.createFnLogger("testHook","causeId");return n.info("test hook "+e),0===this.slimcoreCallId?(n.logFailure("slimcoreCallId == 0"),Promise.reject(32)):(this._slimcoreCallHandler.testHook(this.slimcoreCallId,e),Promise.resolve())},t.prototype.reject=function(e,t){return void 0===e&&(e=F.generateCauseId()),1!==this.state?Promise.reject(60):this.stopInternal({causeId:e,reason:t||{}})},t.prototype.stopInternal=function(e){var t=this,n=e.causeId,r=e.terminatedReason||0,i=this._logger.createFnLogger("stopInternal",n);return i.info("reason from client: "+V.getPrintableObject(e.reason)),6===this.state?(i.info("Trying to stop a call which is already Disconnecting"),this.disconnectingPromise):7===this.state?(i.info("Trying to stop a call which is already Disconnected"),this.disconnectingPromise):(this._setCallState(6,n,r),this.disconnectingPromise=Promise.resolve().then(function(){return i.info("Leaving from call"),t._leaveSlimCoreCall(e)}).catch(function(e){throw t._callTelemetry.updateOperationData(h.CALL_OPERATIONS.STOP_CALL,{error:V.getPIISafeObject(e)},n),i.logFailure(e),t._setCallState(7,n,e),e}),this.disconnectingPromise)},t.prototype.mapEndpointScope=function(e){switch(e){case 1:return k.EndpointScope.EndpointScopeAll;default:return k.EndpointScope.EndpointScopeNone}},t.prototype._leaveSlimCoreCall=function(e){var t=this,n=e.causeId,r=this._logger.createFnLogger(h.CALL_OPERATIONS_INTERNAL.ELECTRON_LEAVE_CALL,n);if(r.info("forEveryone: "+(e&&e.forEveryone)),0===this.slimcoreCallId)return r.logFailure("slimcoreCallId == 0"),Promise.reject(32);var i=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.CALL_ENDED);return Promise.resolve().then(function(){e&&e.forEveryone?t._slimcoreCallHandler.endCallForAll(t.slimcoreCallId,void 0,void 0,e.reason.clientSubCode,e.reason.clientPhrase):t._slimcoreCallHandler.leaveCall(t.slimcoreCallId,t.mapEndpointScope(e.scope),n,e.reason.clientSubCode,e.reason.clientPhrase)}).then(function(){return r.info("Waiting for SlimCore to end call")}).then(function(){return i}).then(function(){r.info("SlimCore ended the call")},function(e){return r.logFailure("Error in leaveSlimCoreCall().. ignoring, error = "+V.getPrintableObject(e)+", reason = 25"),Promise.reject(25)})},t.prototype.incomingCallInit=function(e,t){void 0===t&&(t=F.generateCauseId());var n=this._logger.createFnLogger(h.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,t);try{if(this.callerMri=_.stripMriAliases(this._getStrProperty(this._slimcoreCallHandler,e,k.Property.CallerMriIdentity)),!this.callerMri)return void n.logFailure("Unable to get callerMRI from call object. Ignoring incoming call");var r=this._getProperties(this._slimcoreCallHandler,e,{conversationType:{propKey:k.Property.CallConversationType},callQueueInfo:{propKey:k.Property.CallQueueInfo},transferorMri:{propKey:k.Property.CallTransferorMri},transferorDisplayName:{propKey:k.Property.CallTransferorDisplayName},transferorType:{propKey:k.Property.CallTransferorType},onBehalfOfMri:{propKey:k.Property.CallOnBehalfOfMri},incomingCallType:{propKey:k.Property.CallIncomingType},consultativeCallId:{propKey:k.Property.CallConsultativeTransferCallId},messageId:{propKey:k.Property.CallMessageId},spamRiskLevel:{propKey:k.Property.CallSpamRiskLevel},spamStirAttestation:{propKey:k.Property.CallSpamStirAttestation}},{status:{propKey:k.Property.CallStatus},isIncomingOneOnOneVideoCall:{propKey:k.Property.CallIsIncomingOneOnOneVideoCall}});this.transferorMri=_.stripMriAliases(r.transferorMri),this.transferorDisplayName=r.transferorDisplayName,this.transferorType=r.transferorType,this.onBehalfOfMri=_.stripMriAliases(r.onBehalfOfMri),this.callQueueInfo=r.callQueueInfo&&JSON.parse(r.callQueueInfo).callQueueInfo,this.incomingCallType=r.incomingCallType,this.consultativeCallId=r.consultativeCallId,this.isIncomingOneOnOneVideoCall=!!r.isIncomingOneOnOneVideoCall,this.messageId=r.messageId,this.spamRiskLevel=r.spamRiskLevel,this.spamStirAttestation=r.spamStirAttestation,this._updateConversationType(r.conversationType,t),this.attachSlimCoreCallObject(e,t),r.status===k.CallStatus.RingingIn&&(this._setCallState(1,t),this._callTelemetry.setDirection(g.DIRECTION.INCOMING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLEE))}catch(e){throw n.logFailure("sync failure, cleaning up slimcore ready operation: error="+V.getPrintableObject(e)),this._callTelemetry.updateOperationData(h.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,{error:V.getPIISafeObject(e)},t),this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),e}},t.prototype.acknowledge=function(e,n){var r=this;void 0===n&&(n=F.generateCauseId());var i=this._logger.createFnLogger(h.CALL_OPERATIONS.ACKNOWLEDGE,n);if(0!==this.state&&8!==this.state)return this._callTelemetry.maybeRecordOperationSuccess(h.CALL_OPERATIONS.ACKNOWLEDGE,{code:4}),Promise.reject(new Error("Trying to acknowledge a call that has already been acted on"));this._setCallerMri(_.stripMriAliases(e.callerId),n),this._callTelemetry.setDirection(g.DIRECTION.INCOMING),this._callTelemetry.setSelfParticipantRole(g.SELF_PARTICIPANT_ROLE.CALLEE);var o={callId:e.convoCallId,callerId:e.callerId,launchTime:e.launchTime.toString(),pushReceivedTime:e.pushReceivedTime.toString(),registrationId:e.registrationId,participantId:e.participantId},a=this._slimcoreInstance.handlePushNotification({eventType:e.body.evt,servicePayload:e.body.gp,correlationIdsJson:JSON.stringify(o),callKey:e.callKey,connectionType:t.convertConnectionType(e.connectionType),accountIdentity:this.currentUserSkypeIdentity.id,mediaConfigurationJson:O.mapToEmptyStrIfFalsy(JSON.stringify(e.mediaConfiguration))}),s=[],c=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_HANDLE_PUSH,void 0,n);s.push(this._slimcoreInstance.handle("push-handling-complete",{token:a},function(e){if(e.token===a)if(i.info("HandlePushNotification: Received event for token: "+e.token+" result: "+e.result),e.result===k.PushHandlingResult.CallSetupSucceeded)i.logSuccess("HandlePushNotification: Succeeded"),r._callOperationHandler.resolveOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_HANDLE_PUSH,{code:1,success:!0},void 0,n).catch(function(e){i.logFailure("HandlePushNotification: Failed "+e)});else if(e.result===k.PushHandlingResult.CallSetupProgress)i.info("HandlePushNotification: In progress, keep waiting...");else{var o="HandlePushNotification: Failed "+e.result;i.logFailure(o),r._callOperationHandler.resolveOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_HANDLE_PUSH,t.convertPushHandlingResult(e.result),void 0,n).catch(function(e){i.logFailure("HandlePushNotification: Failed "+e)})}else i.logFailure("HandlePushNotification: Received unexpected token "+e.token+" (expected "+a+")")}));var l=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_RINGING);l.catch(x.noop),s.push(this._slimcoreInstance.handle("object-property-changed",{objectType:k.ObjectType.Call},function(e){var t=r._getStrProperty(r._slimcoreCallHandler,e.objectId,k.Property.CallName),o=r._getIntProperty(r._slimcoreCallHandler,e.objectId,k.Property.CallStatus);t===r.callId?o===k.CallStatus.RingingIn&&(r.attachSlimCoreCallObject(e.objectId,n,!1,"acknowledge"),r._fillIncomingCallProperties(n),r._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_RINGING)&&r._callOperationHandler.resolveOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_RINGING,void 0,void 0,n).then(function(){i.logSuccess("Reached ringing/active state for call pending acknowledgement")},function(e){i.logFailure("Reached ringing/active state for call pending acknowledgement "+e)}),r.raiseChanged()):i.info("Ignoring SlimCore event for incorrect call "+e.objectId+"/"+t)}));var u=function(){return d.each(s,function(e){return e.dispose()})},p=function(e){r._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_RINGING,e,void 0,n),r._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_HANDLE_PUSH,e,void 0,n)};return c.then(function(e){return e.success?l.then(function(){return r._setCallState(1,n),e}):(p(e),e)}).then(function(e){return i.logSuccess("Acknowledge done"),u(),e}).catch(function(e){throw i.logFailure("sync failure, cleaning up slimcore ready operation: error="+V.getPrintableObject(e)),r._callTelemetry.updateOperationData(h.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,{error:V.getPIISafeObject(e)},n),r._callOperationHandler.rejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),u(),p(e),e})},t.prototype.accept=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var n,r,i,o,a;return l(this,function(s){switch(s.label){case 0:(n=this._logger.createFnLogger(h.CALL_OPERATIONS.ACCEPT,t)).info("accept, answerMediaType: "+e.answerMediaType+",\n                            withVideo: "+e.withVideo+",\n                            muted: "+e.muted+",\n                            clientEndpointCapabilities: "+e.clientEndpointCapabilities+",\n                            muteFlags: "+e.muteFlags),e.muted&&n.logFailure("Accepting call muted is not implemented"),this.containsMultipleVideos(e)&&this._callTelemetry.setOperationVariant(h.CALL_OPERATIONS.ACCEPT,h.OPERATION_VARIANTS.MULTIPLEVIDEOS),this._setCallState(2,t),this.connectCallPromise=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.ACCEPT),r=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,t),s.label=1;case 1:if(s.trys.push([1,5,,6]),e.sendMediaModalities&&this._slimcoreCallHandler.answer){if(i=O.returnStringifiedVersionOfMediaStateConfiguration(e.sendMediaModalities),this._logger.info("sendMediaModalitiesJson: "+i),""===i)throw new Error("Passed invalid JSON");o=e.endpointBehaviors?JSON.stringify(e.endpointBehaviors):"",this._slimcoreCallHandler.answer(this.slimcoreCallId,i,o,e.clientEndpointCapabilities||0,e.muteFlags||0)}else this._acceptCall(e,t);return 1&e.muteFlags&&(this.isMuted=!0),2&e.muteFlags&&(this.isSpeakerMuted=!0),this._updateCallType(this.getIntProperty(k.Property.CallIsConference),t),1===e.answerMediaType||e.sendMediaModalities&&e.sendMediaModalities.mediaStates&&d.find(e.sendMediaModalities.mediaStates,function(e){return 1===e.mediaType&&!0!==e.isDisabled})?(n.info("Call has been answered - turning on video"),[4,this.startVideoSafe(t)]):[3,3];case 2:s.sent(),s.label=3;case 3:return this._logger.info("The Speaker and Microphone mute state after accepting call is "+this.isSpeakerMuted+" and "+this.isMuted),[4,r];case 4:return s.sent(),this._logger.info("acceptCallPromise resolved"),[3,6];case 5:throw a=s.sent(),this._callTelemetry.updateOperationData(h.CALL_OPERATIONS.ACCEPT,{error:V.getPIISafeObject(a)},t),this.stopInternal({causeId:t,terminatedReason:7}),this._logger.error("Error in accept(), callId = "+this.callId+", error = "+a),a;case 6:return[2]}})})},t.prototype.mergeParticipants=function(e,t,n,r){return c(this,void 0,void 0,function(){var i,o,a,s,c,u,d=this;return l(this,function(l){if(i=[],0===t.length)return[2,Promise.reject(f.getRejectTransactionEnd("Invalid participantIds"))];for(o=0,a=t;o<a.length;o++)if(s=a[o],O.hasFeature(k.Feature.MergeWithEndpoints))u=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS.MERGE_PARTICIPANT,s,r),i.push(u),this._callTelemetry.recordOperation(h.CALL_OPERATIONS.MERGE_PARTICIPANT,r,s);else{if(!(c=S.findParticipantUsingParticipantLegId(e,s)))return[2,Promise.reject(f.getRejectTransactionEnd("ParticipantId "+s+" is invalid!"))];u=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS.MERGE_PARTICIPANT,c.id,r),i.push(u),this._mergeParticipantMriToParticipantIdMap.hasOwnProperty(c.id)?this._mergeParticipantMriToParticipantIdMap[c.id].push(s):this._mergeParticipantMriToParticipantIdMap[c.id]=[s],this._callTelemetry.recordOperation(h.CALL_OPERATIONS.MERGE_PARTICIPANT,r,c.id)}return[2,Promise.resolve().then(function(){if(!d.slimcoreCallId)throw f.getRejectTransactionEnd("Invalid self slimcore call id "+d.slimcoreCallId);if(!e)throw f.getRejectTransactionEnd("Invalid callToMerge slimcore call id "+d.slimcoreCallId);var i=n.additionalData?JSON.stringify(n.additionalData):"";return d._slimcoreCallHandler.mergeCallParticipants(d.slimcoreCallId,e.slimcoreCallId,t,n.threadId,n.messageId,r,i,n.groupId)}).catch(function(e){throw d._callTelemetry.updateOperationData(h.CALL_OPERATIONS.MERGE_PARTICIPANT,{error:V.getPIISafeObject(e)},r),d._logger.logFailure(e),f.getRejectTransactionEnd(e)}).then(function(){return i})]})})},t.prototype.mergeWithPickupCode=function(e,t,n){return void 0===n&&(n=F.generateCauseId()),c(this,void 0,void 0,function(){var r,i,o,a=this;return l(this,function(s){return(r=this._logger.createFnLogger(h.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,n)).info("mergeWithPickupCode: pickup code: "+e+", groupId: "+y.scrubMriOrOmit(t.groupId)+" threadId: "+y.getLoggableThreadId(t.threadId)+" messageId: "+t.messageId),e?(i=t.additionalData?JSON.stringify(t.additionalData):"",o=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,e,n),[2,Promise.resolve().then(function(){return a._mergeWithPickupCode(e,t.threadId,t.messageId,n,i,t.groupId)}).catch(function(e){return a._callTelemetry.updateOperationData(h.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,{error:V.getPIISafeObject(e)},n),r.logFailure(e),Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return o})]):(r.info("mergeWithPickupCode: pickup code cannot be empty"),[2,Promise.reject(f.getRejectTransactionEnd("pickup code cannot be empty"))])})})},t.prototype.merge=function(e,t,n){return void 0===n&&(n=F.generateCauseId()),c(this,void 0,void 0,function(){var r,i,o,a,s,c=this;return l(this,function(l){return(r=this._logger.createFnLogger(h.CALL_OPERATIONS.MERGE_CALL,n)).info("merge: "+e.callId+" threadId: "+y.getLoggableThreadId(t.threadId)+", messageId: "+t.messageId),e.participants&&1===e.participants.length?(i=e.participants[0].id,o=t.additionalData?JSON.stringify(t.additionalData):"",a=this._getOrCreateParticipant(i,n),this._addParticipantToCall(a,n),s=this._participantOperationHandler.createPendingOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,a.id,n),[2,Promise.resolve().then(function(){return c._slimcoreCallHandler.callMerge(c.slimcoreCallId,e.slimcoreCallId,t.threadId,t.messageId,n,o)}).catch(function(e){return c._callTelemetry.updateOperationData(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{error:V.getPIISafeObject(e)},n,i),r.logFailure(e),c._handleParticipantRemoved(i,n,e),Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return s}).then(function(){return Promise.resolve({code:h.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:h.TRANSACTION_END_PHRASE.TRANSACTION_COMPLETE})}).catch(function(e){r.logFailure(e),c._handleParticipantRemoved(i,n,e);var t=e;return f.isTransactionEnd(e)&&(t=e),Promise.reject(t)})]):(r.error("error invalid number of participants on call to be merged "+e.participants.length),[2,Promise.reject(f.getRejectTransactionEnd(h.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))])})})},t.prototype._acceptCall=function(e,n){var r=e.endpointBehaviors?JSON.stringify(e.endpointBehaviors):"";try{e.withVideo&&(e.answerMediaType=1),this._slimcoreCallHandler.acceptCall(this.slimcoreCallId,t.toAnswerMediaType(e.answerMediaType),r,e.clientEndpointCapabilities||0,e.muteFlags||0)}catch(t){this._logger.info("acceptCall is missing from the slimcore electron module: "+t),1===e.answerMediaType&&(e.withVideo=!0),this._slimcoreCallHandler.answerCall(this.slimcoreCallId,e.withVideo,r)}},t.prototype.reconnect=function(){return Promise.reject(new Error("Retargeting is not supported"))},t.prototype.provideCallQualityFeedback=function(e,t,n,r){return c(this,void 0,void 0,function(){return l(this,function(i){this._logger.info("provideCallQualityFeedback");try{this._slimcoreInstance.provideCallQualityFeedbackEx(this.callId,this.participantId,e,t,n,r,"","")}catch(e){throw this._logger.error("Error in provideCallQualityFeedback callId: "+this.callId+", error: "+e),e}return[2]})})},t.prototype.showCQFInfo=function(e,t){return c(this,void 0,void 0,function(){return l(this,function(n){this._logger.info("showCQFInfo");try{return this._slimcoreCallHandler.showCQFInfo?[2,this._slimcoreCallHandler.showCQFInfo(e,this.callId,t)]:(this._logger.warn("showCQFInfo not on SkyLib::CallHandler"),[2,null])}catch(e){throw this._logger.error("Error in showCQFInfo callId: "+this.callId+", error: "+e),e}return[2]})})},t.prototype.isCqfRendered=function(e){return c(this,void 0,void 0,function(){return l(this,function(t){this._logger.info("isCqfRendered");try{this._slimcoreCallHandler.isCqfRendered?this._slimcoreCallHandler.isCqfRendered(this.callId,this.participantId,e):this._logger.warn("isCqfRendered not on SkyLib::CallHandler")}catch(e){throw this._logger.error("Error in isCqfRendered callId: "+this.callId+", error: "+e),e}return[2]})})},t.prototype.provideCallQualityFeedbackEx=function(e,t,n,r,i,o){return c(this,void 0,void 0,function(){return l(this,function(a){this._logger.info("provideCallQualityFeedback");try{this._slimcoreCallHandler.provideCallQualityFeedbackEx?this._slimcoreCallHandler.provideCallQualityFeedbackEx(this.callId,this.participantId,e,t,n,r,i,o):this._logger.warn("provideCallQualityFeedbackEx not on SkyLib::CallHandler")}catch(e){throw this._logger.error("Error in provideCallQualityFeedbackEx callId: "+this.callId+", error: "+e),e}return[2]})})},t.prototype._mergeWithPickupCode=function(e,t,n,r,i,o){this._logger.info("_mergeWithPickupCode: pickupCode = "+e+" groupId = "+y.scrubMriOrOmit(o)+" threadId = "+y.getLoggableThreadId(t)+" messageId = "+n+" causeId = "+r),this._slimcoreCallHandler.mergeCallWithPickupCode(this.slimcoreCallId,e,O.mapToEmptyStrIfFalsy(t),O.mapToEmptyStrIfFalsy(n),O.mapToEmptyStrIfFalsy(r),O.mapToEmptyStrIfFalsy(i),O.mapToEmptyStrIfFalsy(o))},t.prototype._onCallOriginChanged=function(e){e===k.OriginType.Transfer?this._setCallOrigin(1):e===k.OriginType.Park?this._setCallOrigin(2):e===k.OriginType.Unspecified?this._setCallOrigin(0):e===k.OriginType.TransferToVoicemail?this._setCallOrigin(3):this._logger.info("Unknown origin")},t.prototype._onCallMutedUnmuted=function(e){var t=10===this.state;this._logger.info("onCallMutedUnmuted current: "+this.isMuted+" new: "+e),this._logger.info("onCallMutedUnmuted isServerMuted: "+this.isServerMuted+" inLobby: "+t),this.isServerMuted&&!t||e||(this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.MUTE),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.UNMUTE)),e&&(this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.MUTE),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.UNMUTE)),this.isMuted!==e&&(this._logger.info("isMuted set to "+e+" in _onCallMutedUnmuted"),this.isMuted=e,this._logger.info("onCallMutedUnmuted isMuted: "+this.isMuted),this._updateCapabilities(F.generateCauseId()),this.raiseChanged())},t.prototype._onCallMutedUnmutedSpeaker=function(e,t){void 0===t&&(t=F.generateCauseId()),this._logger.createFnLogger("onCallMutedUnmutedSpeaker",t).info("current: "+this.isSpeakerMuted+" new: "+e),e?this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.MUTE_SPEAKER,void 0,void 0,t):this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.UNMUTE_SPEAKER,void 0,void 0,t),this._setMutedSpeaker(e,t)},t.prototype._onCallIsServerMuted=function(e,t){void 0===t&&(t=F.generateCauseId()),this._logger.info("_onCallIsServerMuted "+e),e!==this.isServerMuted&&(this.isServerMuted=e,this._callTelemetry.recordEvent(h.PARTICIPANT_OPERATIONS_INTERNAL.SELF_PARTICIPANT_UPDATED,{isServerMuted:this.isServerMuted},t),this.event("serverMutedChanged").raise(e),this._updateCapabilities(t),this.raiseChanged())},t.prototype._onCallCapabilitiesChanged=function(e){e!==this._capabilityFlags&&(this._logger.info("_onCallCapabilitiesChanged: new value is "+e),this._capabilityFlags=e,this._updateCapabilities(F.generateCauseId(),!0))},t.prototype._updateCapabilities=function(e,t){void 0===t&&(t=!1);var n=!1,r=!1;I.callStateIsAnyOf(this.state,[11,12])||(n=!(this.isUnMuteDisabled()||this.isServerMuted&&!(this._capabilityFlags&k.SelfCapability.UnmuteSelf)),r=!!(this._capabilityFlags&k.SelfCapability.MuteOthers)),this._capabilities.canUnmuteSelf===n&&this._capabilities.canMuteOthers===r||(this._capabilities.canUnmuteSelf=n,this._capabilities.canMuteOthers=r,this._logger.info("["+e+"]_updateCapabilities Computed capabilities: "+JSON.stringify(this._capabilities)),t&&this.raiseChanged())},t.prototype._getCallParticipantMriMap=function(){for(var e={},t=this._slimcoreCallHandler.callGetParticipants(this.slimcoreCallId)||[],n={},r=0,i=t;r<i.length;r++){var o=i[r];n[o]={objectId:o,propKey:k.Property.ParticipantMriIdentity}}for(var a=this._getProperties(this._slimcoreCallHandler,0,n,{}),s=0,c=t;s<c.length;s++){var l=c[s],u=a[l];u&&(e[u]=l)}return e},t.prototype._getParticipantsData=function(e){for(var t={},n={},r={},i=function(e,t){return e+"_"+t},o=0,a=e;o<a.length;o++){for(var s=a[o],c=0,l=Object.keys(E.participantStrProps);c<l.length;c++){p=l[c];t[i(s.objectId,p)]={objectId:s.objectId,propKey:E.participantStrProps[p].propKey,fallback:E.participantStrProps[p].fallback}}for(var u=0,d=Object.keys(E.participantIntProps);u<d.length;u++){var p=d[u];n[i(s.objectId,p)]={objectId:s.objectId,propKey:E.participantIntProps[p].propKey,fallback:E.participantIntProps[p].fallback}}r[s.objectId]=s.mri}var h={};if(e.length)for(var g=this._getProperties(this._slimcoreCallHandler,0,t,n),f=0,_=Object.keys(g);f<_.length;f++){var m=_[f],v=m.split("_"),y=v[0],C=v[1];h[y]||(h[y]={objectId:Number(y),mri:r[y],props:{}}),h[y].props[C]=g[m]}for(var S=[],I=0,O=Object.keys(h);I<O.length;I++){y=O[I];S.push(h[y])}return S},t.prototype._callGetParticipantsData=function(e,t){var n=this,r=this._getCallParticipantMriMap(),i=[],o=[],a=function(e){return r.hasOwnProperty(e.mri)},s=function(e){return e.objectId},c=function(e){return e.objectId===r[e.mri]},l=Object.keys(r).length;e.forEach(function(e){a(e)?s(e)?c(e)?n._participantOperationHandler.hasPendingOperationWithOperationId(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,e.mri)||delete r[e.mri]:o.push(e):(i.push(e),delete r[e.objectId]):o.push(e)}),this._logger.info("["+t+"]onParticipantJoinedOrRemoved # of participants in roster="+l+"["+Object.keys(e).length+"]["+i.length+"]["+o.length+"]"),Object.keys(r).forEach(function(e){return i.push({mri:e,objectId:r[e]})});var u=[];return u=this._settings.enableParticipantsGetPropsAggregation?this._getParticipantsData(i):i,{newParticipantsData:u,participantsToRemove:o}},t.prototype._onParticipantJoinedOrRemoved=function(e){var t=this,n=this._callGetParticipantsData(this.participants.map(function(e){return{objectId:e.slimcoreObjectId,mri:e.id}}),e),r=n.newParticipantsData;n.participantsToRemove.forEach(function(n){return t._handleParticipantRemoved(n.mri,e,t.participantMap[n.mri].stateReason)}),Object.keys(r).forEach(function(n){return t._handleParticipantJoined(r[n],e)})},t.prototype._updateDominantSpeakerList=function(){var e=this;if(this._isOptimizedSpeakerEventingEnabled)return{fullOrderMatches:!0,topSpeakerMatches:!1};var t=[],n=!1,r=!1;return this._enableLeavePerfImprovements&&7===this.state||(t=d.map(d.sortBy(d.map(d.filter(this.participants,function(e){return 3===e.state}),function(t){return{mri:t.id,rank:t.dominantSpeakerRank?t.dominantSpeakerRank:e.participants.length+1}}),"rank"),function(e){return e.mri}),(r=n=d.isEqual(this.dominantSpeakerInfo.speakerList,t))||(r=!d.isEmpty(this.dominantSpeakerInfo.speakerList)&&!d.isEmpty(t)&&d.head(this.dominantSpeakerInfo.speakerList)===d.head(t))),this.dominantSpeakerInfo={speakerList:t,timestamp:new Date},n||this._logger.info("_updateDominantSpeakerList: "+this.dominantSpeakerInfo.speakerList.length),{fullOrderMatches:n,topSpeakerMatches:r}},t.prototype._handleParticipantRemoved=function(e,t,n){void 0===n&&(n=0);var r=this._logger.createFnLogger("handleParticipantRemoved",t);r.info("reason="+n),this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.handleParticipantRemoved(e),this.ptzHandler&&this.ptzHandler.isPTZFeatureEnabled()&&this.ptzHandler.handleParticipantRemoved(e);var i=this._removeParticipantEntry(e);i?(i.setState(4,t,n),this._participantOperationHandler.maybeRejectOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,n,e),this._participantOperationHandler.maybeResolveOperation(h.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,n,e),O.hasFeature(k.Feature.AsyncAdmitResponse)||i.rejectAdmitParticipantDeferred(0!==n?n:60),i.dispose(t),this._updateDominantSpeakerList(),this.event("participantRemoved").raise(i),this._removeCallChangeOnParticipantChanges||this.raiseChangedDeferred()):r.logFailure("unable to remove participant")},t.prototype._handleParticipantJoined=function(e,t){var n=this;this._logger.debug("["+t+"]handleParticipantJoined: "+y.scrubMriOrOmit(e.mri));var r=this._getOrCreateParticipant(e.mri,t,e.objectId,e);if(E.default.isParticipantActive(r.state)&&this._participantOperationHandler.hasPendingOperationWithOperationId(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,e.mri)){this._participantOperationHandler.resolveOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,r,e.mri),this._callTelemetry.recordOperationSuccess(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,null,e.mri);this._callTelemetry.recordOperationSuccess(h.PARTICIPANT_OPERATIONS_INTERNAL.PARTICIPANT_JOINED,g.getEndpointInformationForTelemetry(function(e){return e&&e.endpoints&&e.endpoints.endpointDetails||[]}(r)),e.mri,t)}this._handleParticipantJoinedDefer||(this._handleParticipantJoinedDefer=d.defer(function(){delete n._handleParticipantJoinedDefer,n._updateDominantSpeakerList().fullOrderMatches||n.raiseChangedDeferred()}))},t.prototype._admitParticipantToSlimCoreElectronCall=function(e){var t=[e];return this._slimcoreCallHandler.admitParticipants(this.slimcoreCallId,t),Promise.resolve()},t.prototype.admitParticipant=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var n,r,i,o,a=this;return l(this,function(s){return(n=this._logger.createFnLogger(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,t)).info("participantId = "+y.scrubMriOrOmit(e)),0===this.slimcoreCallId?[2,Promise.reject("call not started")]:(r=this._getParticipant(e))&&7!==r.state?[2,Promise.reject(43)]:(i=p.defer(),o=this._admitParticipantToSlimCoreElectronCall(e).then(function(){r&&r.addAdmitParticipantDeferred(i)}).then(function(){return r?i.promise:a._participantOperationHandler.waitForOperation(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,e,t)}).then(function(){n.logSuccess("admitted");var i=a._getParticipantLegId(r),o=i?{participantLegId:i}:{};a._callTelemetry.maybeRecordOperationSuccess(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,{},e,t,o)}).catch(function(i){n.logFailure(i);var o=a._handleParticipantOperationFailure(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,i,t,e,r);return a._admitRejectionAsTransactionEnd?Promise.reject(o):Promise.reject(i)}),this.raiseChanged(),[2,o])})})},t.prototype.admit=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.ADMIT,t);return e.scope&&"none"===e.scope?(r.logFailure("Can not admit if scope is None"),Promise.reject(f.getRejectTransactionEnd(h.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))):Promise.resolve().then(function(){n._slimcoreCallHandler.admit(n.slimcoreCallId,t,"none"===e.scope?k.AdmitScope.AdmitScopeNone:k.AdmitScope.AdmitScopeAll)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.ADMIT,t,t)}).catch(function(e){return n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.ADMIT,{error:V.getPIISafeObject(e)},t),r.logFailure(e),Promise.reject(e)})},t.prototype._addParticipantToSlimCoreElectronCall=function(e,t,n,r,i){this._logger.info("addParticipantToSlimCoreElectronCall: participantId = "+y.scrubMriOrOmit(e)+" groupId = "+y.scrubMriOrOmit(t)+" threadId = "+y.getLoggableThreadId(n)+" messageId = "+r+" participantInvitationData = "+y.scrubMriOrOmit(i));var o=this._slimcoreCallHandler.addParticipant(this.slimcoreCallId,e,O.mapToEmptyStrIfFalsy(n),O.mapToEmptyStrIfFalsy(r),O.mapToEmptyStrIfFalsy(i),O.mapToEmptyStrIfFalsy(t));return 0===o?Promise.reject(new Error("AddParticipant call to slimcore failed")):Promise.resolve(o)},t.prototype.callMeBack=function(e,t,n){return void 0===n&&(n=F.generateCauseId()),c(this,void 0,void 0,function(){var r,i,o,a=this;return l(this,function(s){return(r=this._logger.createFnLogger(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,n)).info("callMeBack: participantMri = "+y.scrubMriOrOmit(e)+" assertedMri = "+y.scrubMriOrOmit(t)),0===this.slimcoreCallId?(r.logFailure("call is not initialized yet"),[2,Promise.reject(new Error("call is not initialized yet"))]):(i=this._participantOperationHandler.waitForOperation(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,e),o=_.generateAliasedMri(""+_.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,this.currentUserSkypeIdentity.sipUri),[2,Promise.resolve().then(function(){return a._slimcoreCallHandler.callMeBack(a.slimcoreCallId,e,t||o,n),i}).catch(function(t){throw a._callTelemetry.updateOperationData(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,{error:V.getPIISafeObject(t)},n,e),a._participantOperationHandler.maybeRejectOperation(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,1,e,n),r.logFailure("Error in callMeBack(), callId = "+a.callId+", error = "+t),t})])})})},t.prototype.nudgeParticipants=function(e,t,n,r){return void 0===n&&(n={}),void 0===r&&(r=F.generateCauseId()),c(this,void 0,void 0,function(){var i,o,a,s=this;return l(this,function(c){return(i=this._logger.createFnLogger(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,r)).info("nudgeParticipants: context = "+e),2!==this.state&&3!==this.state?[2,Promise.reject(48)]:0===this.slimcoreCallId?[2,Promise.reject(new Error("call is not initialized yet"))]:n.sipUri?[2,Promise.reject(new Error("sipUri not supported yet"))]:(o=n.participantInvitationData?JSON.stringify(n.participantInvitationData):"",i.info("nudgeParticipants: context = "+e+" groupId = "+y.scrubMriOrOmit(n.groupId)+" threadId = "+y.getLoggableThreadId(n.threadId)+" messageId = "+n.messageId+" participantInvitationData = "+y.scrubMriOrOmit(o)),a=this._participantOperationHandler.waitForOperation(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,e),[2,Promise.resolve().then(function(){return s._slimcoreCallHandler.nudgeParticipants(s.slimcoreCallId,t,O.mapToEmptyStrIfFalsy(e),O.mapToEmptyStrIfFalsy(n.threadId),O.mapToEmptyStrIfFalsy(n.messageId),O.mapToEmptyStrIfFalsy(o),O.mapToEmptyStrIfFalsy(n.groupId)),a}).catch(function(t){throw s._callTelemetry.updateOperationData(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,{error:V.getPIISafeObject(t)},r,e),s._participantOperationHandler.rejectOperation(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,38,e,r),i.logFailure("Error in NudgeParticipants(), callId = "+s.callId+", context = "+e+", error = "+t),t})])})})},t.prototype._handleParticipantOperationFailure=function(e,t,n,r,i){this._callTelemetry.updateOperationData(e,{error:V.getPIISafeObject(t)},n,r);var o={callId:this.callId,reason:t},a=i||this._getParticipant(r);a&&a.callEndDiagnosticsInfo&&(o.code=a.callEndDiagnosticsInfo.callControllerCode,o.subCode=a.callEndDiagnosticsInfo.callControllerSubCode,o.phrase=a.callEndDiagnosticsInfo.phrase);var s=this._getParticipantLegId(a),c=s?{participantLegId:s}:{};return this._callTelemetry.maybeRecordOperationFailure(e,o,r,n,c),o},t.prototype._getParticipantLegId=function(e){return d.has(e,"endpoints.endpointDetails")&&e.endpoints.endpointDetails.length&&e.endpoints.endpointDetails[0].participantId?e.endpoints.endpointDetails[0].participantId:null},t.prototype.updateMeetingRoles=function(e,t,n){return void 0===n&&(n=F.generateCauseId()),c(this,void 0,void 0,function(){var r,i,o=this;return l(this,function(a){return(r=this._logger.createFnLogger(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,n)).info("updateMeetingRole: participants = "+y.scrubMriOrOmitList(e)+", role = "+t),i=this._participantOperationHandler.waitForOperation(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,n),[2,Promise.resolve().then(function(){return o._slimcoreCallHandler.updateMeetingRoles(o.slimcoreCallId,e,t,n),i}).catch(function(e){throw r.logFailure("Error in UpdateMeetingRoles(), callId = "+o.callId+", error = "+e),o._callTelemetry.updateOperationData(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,{error:V.getPIISafeObject(e)},n),o._participantOperationHandler.rejectOperation(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,38,n,n),e})]})})},t.prototype.addParticipant=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=F.generateCauseId()),c(this,void 0,void 0,function(){var r,i,o,a,s,c,u=this;return l(this,function(l){return r=this._logger.createFnLogger(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,n),this.isEmergency&&0===this.slimcoreCallId&&0!==this.participants.length?[2,Promise.reject(new Error("Only 1 participant (the emergency operator) may be added to unstarted emergency calls"))]:(t.sipUri&&r.logFailure("sipUri not supported yet"),i=t.participantInvitationData?JSON.stringify(t.participantInvitationData):"",r.info("participantId = "+y.scrubMriOrOmit(e)+" groupId = "+y.scrubMriOrOmit(t.groupId)+" threadId = "+y.getLoggableThreadId(t.threadId)+" messageId = "+t.messageId+" participantInvitationData = "+y.scrubMriOrOmit(i)),o=this._getOrCreateParticipant(e,n),0===this.slimcoreCallId?[2,Promise.resolve(o)]:-1===(a=[0,4]).indexOf(o.state)?[2,Promise.resolve(o)]:(s=this._participantOperationHandler.waitForOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,o.id),c=Promise.resolve().then(function(){return u._addParticipantToCall(o,n)}).then(function(){return u._addParticipantToSlimCoreElectronCall(o.id,t.groupId,t.threadId,t.messageId,i)}).then(function(e){return o.attachSlimcoreObjectId(e,n)}).catch(function(t){return u._callTelemetry.updateOperationData(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{error:V.getPIISafeObject(t)},n,e),r.logFailure(t),Promise.reject(1)}).then(function(){return s}).then(function(){return o}).catch(function(t){return r.logFailure(t),u._handleParticipantOperationFailure(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t,n,e,o),u._handleParticipantRemoved(e,n,t),Promise.reject(t)}),this.raiseChanged(),[2,c]))})})},t.prototype.addParticipants=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=F.generateCauseId()),c(this,void 0,void 0,function(){var r,i,o,a,s,c,u=this;return l(this,function(l){return r=this._logger.createFnLogger(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANTS,n),!this.isEmergency||0!==this.slimcoreCallId||0===this.participants.length&&1===e.length?(i=t.participantInvitationData?JSON.stringify(t.participantInvitationData):"",r.info("groupId = "+y.scrubMriOrOmit(t.groupId)+" threadId = "+y.getLoggableThreadId(t.threadId)+" messageId = "+t.messageId+" participantInvitationData = "+y.scrubMriOrOmit(i)),o=[],a=[],s=[],c=[0,4],e.forEach(function(e){var t=u._getOrCreateParticipant(e,n);0===u.slimcoreCallId?s.push(Promise.resolve(t)):-1!==c.indexOf(t.state)?(o.push(t),a.push(e),u._addParticipantToCall(t,n),s.push(u._participantOperationHandler.createPendingOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t.id,n))):u._participantOperationHandler.hasPendingOperationWithOperationId(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t.id)?s.push(u._participantOperationHandler.waitForOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t.id)):s.push(Promise.resolve(t))}),0===o.length?[2,Promise.resolve(s)]:[2,Promise.resolve().then(function(){return u._slimcoreCallHandler.addParticipantsToCall(u.slimcoreCallId,a,O.mapToEmptyStrIfFalsy(t.threadId),O.mapToEmptyStrIfFalsy(t.messageId),O.mapToEmptyStrIfFalsy(i),void 0!==t.disableUnmute&&t.disableUnmute,n,O.mapToEmptyStrIfFalsy(t.groupId))}).then(function(e){if(!e||0===e.length)throw new Error("addParticipants: participantObjectIds null or empty");for(var t=0;t<e.length;t++)o[t].attachSlimcoreObjectId(e[t],n);return s}).catch(function(e){return r.logFailure(e),a.forEach(function(t){u._handleParticipantRemoved(t,n,e)}),Promise.reject(1)})]):[2,Promise.reject(new Error("Only 1 participant (the emergency operator) may be added to unstarted emergency calls"))]})})},t.prototype.removeParticipant=function(e,t,n,r){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var i,o,a,s,c,u=this;return l(this,function(l){return(i=this._logger.createFnLogger(h.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,t)).info("removeParticipant: participantId = "+y.scrubMriOrOmit(e)+", endpointScope ="+r),(o=this._getParticipant(e))&&(i.info("removeParticipant: current participant state: "+o.state),0===o.state||4===o.state)?(i.logFailure("Participant in invalid state, None or Disconnected"),[2,Promise.reject(new Error("Participant already in disconnected state"))]):(a=O.convertEndpointScope(r),r&&!a?(this._logger.error("Slimcore mapping for endpointScope failed: "+r+" => "+a),[2,Promise.reject(60)]):(s=p.defer(),c=Promise.resolve().then(function(){o?(u._assertSlimcoreObjectId(o.slimcoreObjectId,"removeParticipant"),u._slimcoreCallHandler.removeParticipant(o.slimcoreObjectId,a),o.addRemoveParticipantDeferred(s)):(u._assertSlimcoreObjectId(u.slimcoreCallId,"removeParticipantByMri"),u._slimcoreCallHandler.removeParticipantByMri(u.slimcoreCallId,e,n,a),s.resolve())}).then(function(){return O.hasFeature(k.Feature.AttendeeBlackList)||s.resolve(),s.promise}).then(function(){return i.logSuccess("removed")}).catch(function(n){return i.logFailure(n),u._handleParticipantOperationFailure(h.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,n,t,e,o),Promise.reject(n)}),this.raiseChanged(),[2,c]))})})},t.prototype.searchParticipants=function(e,t){var n=this;void 0===t&&(t=F.generateCauseId());var r=this._logger.createFnLogger(h.CALL_OPERATIONS.SEARCH_PARTICIPANTS,t);return Promise.resolve().then(function(){return n._slimcoreCallHandler.searchParticipants(n.slimcoreCallId,JSON.stringify(e),t)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.SEARCH_PARTICIPANTS,t)}).catch(function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.SEARCH_PARTICIPANTS,{error:V.getPIISafeObject(e)},t),r.logFailure(e),e})},t.prototype.getAllParticipants=function(e,t){var n=this;void 0===t&&(t=F.generateCauseId());var r=this._logger.createFnLogger(h.CALL_OPERATIONS.GET_ALL_PARTICIPANTS,t);return"lobby"!==e.scope?(this._logger.error("Expected scope: lobby. Received scope: "+e.scope),Promise.reject(60)):Promise.resolve().then(function(){n._slimcoreCallHandler.getAllParticipants(n.slimcoreCallId,e.scope,t)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.GET_ALL_PARTICIPANTS,t)}).catch(function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.GET_ALL_PARTICIPANTS,{error:V.getPIISafeObject(e)},t),r.logFailure(e),e})},t.prototype._startTransferTargetCall=function(e,n,r,i){var o=this;this._logger.info("Transfer: _startTransferTargetCall",e);var a=t.convertToSlimCoreMediaPeerType(i);return this.attachSlimCoreCallObject(e,r,!1,"_startTransferTargetCall").then(function(){return o._slimcoreCallHandler.startTransferTargetCall(e,n,o.threadId,o.messageId,a)})},t.prototype._getSlimCoreCallProperties=function(e){if(this._logger.info("_getSlimCoreCallProperties"),!O.isSlimCoreRTModuleAvailable())return e;try{var t=new window.SlimCoreRT.SlimCore.CallProperties;return t.audioDirection=e.audioDirection,t.videoDirection=e.videoDirection,t.screenshareDirection=e.screenshareDirection,t.datachannelDirection=e.datachannelDirection,t.muteFlags=e.muteFlags,t.mediaPeerType=e.mediaPeerType,t.isVideoEnabled=e.isVideoEnabled,t.isGoLive=e.isGoLive,t.isHostless=e.isHostless,t.participantLegId=e.participantLegId,t.enableGroupCallMeetupGeneration=e.enableGroupCallMeetupGeneration,t.groupId=e.groupId,t.threadId=e.threadId,t.messageId=e.messageId,t.subject=e.subject,t.conversationType=e.conversationType,t.meetingInfo=e.meetingInfo,t.endpointMetadata=e.endpointMetadata,t.onBehalfOf=e.onBehalfOf,t.emergencyContent=e.emergencyContent,t.broadcastContext=e.broadcastContext,t.callKey=e.callKey,t.encryptedKey=e.encryptedKey,t.invitationType=e.invitationType,t.connectionType=e.connectionType,t.maxVideoChannels=e.maxVideoChannels,t.negotiationTag=e.negotiationTag,t.routingFlags=e.routingFlags,t.scenario=e.scenario,t.preheatFlags=e.preheatFlags,t.mediaConfigurationJson=e.mediaConfigurationJson,t.mediaStateConfigurationJson=e.mediaStateConfigurationJson,t.endpointBehaviors=e.endpointBehaviors,t.clientEndpointCapabilities=e.clientEndpointCapabilities,t.clientEndpointDebugContent=e.clientEndpointDebugContent,t.invitationDataJson=e.invitationDataJson,t.meetingRegistrationId=e.meetingRegistrationId,this._logger.info("_getSlimCoreCallProperties created RT CallProperties"),t}catch(e){this._logger.info("_getSlimCoreCallProperties failed, reverting back to property bag ",e)}return e},t.prototype._isEnterpriseMultiParty=function(e){return 5===e||10===e},t.prototype._joinOrStartSlimCoreCall=function(e,n,r){var o=this,a=this._logger.createFnLogger("[joinOrStartSlimCoreCall]["+e+"]",r),s=0,c=!n.ringOthers,l=JSON.stringify(n.endpointBehaviors),u=i(i({},n),{audioDirection:void 0!==n.audioDirection?t.toMediaDirection(n.audioDirection):k.MediaDirection.Bidirectional,videoDirection:void 0!==n.videoDirection?t.toMediaDirection(n.videoDirection):k.MediaDirection.ReceiveFromPeer,screenshareDirection:void 0!==n.screenshareDirection?t.toMediaDirection(n.screenshareDirection):this._isEnterpriseMultiParty(this._mediaPeerType)?k.MediaDirection.ReceiveFromPeer:k.MediaDirection.Disabled,datachannelDirection:void 0!==n.datachannelDirection?t.toMediaDirection(n.datachannelDirection):k.MediaDirection.Disabled,muteFlags:n.muteFlags,mediaPeerType:t.convertToSlimCoreMediaPeerType(this._mediaPeerType),isVideoEnabled:4===n.videoDirection,isGoLive:c,isHostless:!0,participantLegId:this.participantId,enableGroupCallMeetupGeneration:this._enableGroupCallMeetupGeneration,groupId:O.mapToEmptyStrIfFalsy(this.groupId),threadId:O.mapToEmptyStrIfFalsy(this.threadId),messageId:O.mapToEmptyStrIfFalsy(this.messageId),subject:O.mapToEmptyStrIfFalsy(n.label),conversationType:O.mapToEmptyStrIfFalsy(n.conversationType),meetingInfo:O.mapToEmptyStrIfFalsy(JSON.stringify(this.meetingInfo)),endpointMetadata:O.mapToEmptyStrIfFalsy(this._endpointMetadata),onBehalfOf:O.mapToEmptyStrIfFalsy(this.onBehalfOfMri),emergencyContent:O.mapToEmptyStrIfFalsy(this._emergencyContent),broadcastContext:this.broadcastMeeting&&this.broadcastMeeting.context?JSON.stringify(this.broadcastMeeting.context):null,connectionType:t.convertConnectionType(n.connectionType),maxVideoChannels:n.maxVideoChannels||0,negotiationTag:O.mapToEmptyStrIfFalsy(n.negotiationTag),scenario:O.mapToEmptyStrIfFalsy(n.scenario),mediaConfigurationJson:O.mapToEmptyStrIfFalsy(JSON.stringify(n.mediaConfiguration)),mediaStateConfigurationJson:O.mapToEmptyStrIfFalsy(n.sendMediaModalities),endpointBehaviors:l,clientEndpointCapabilities:n.clientEndpointCapabilities||0,clientEndpointDebugContent:O.mapToEmptyStrIfFalsy(n.clientEndpointDebugContent),invitationDataJson:O.mapToEmptyStrIfFalsy(n.invitationDataJson)}),d=!!n.conversationUrl||n.isExistingCallInObservingState,p=g.calculateJoinedFromForTelemetry(this.meetingData,this.threadId,this.messageId,this.groupId,d);if(this._callTelemetry.setJoinedFrom(p),d){a.info("options: "+V.getPrintableObject(n));var f=this._getSlimCoreCallProperties(i(i({},u),{invitationType:k.InvitationType.None,preheatFlags:n.preheatFlags,meetingRegistrationId:O.mapToEmptyStrIfFalsy(n.meetingRegistrationId)})),_=JSON.stringify({conversationUrl:n.conversationUrl,conversationId:this.callId,conversationType:n.conversationType});switch(e){case h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA:case h.CALL_OPERATIONS.START_WITH_MEETING_DATA:s=this._slimcoreCallHandler.joinSignalingSessionWithMeetingData(JSON.stringify(this.meetingData),n.shouldResurrect,_,f.mediaPeerType,f);break;default:s=this._slimcoreCallHandler.joinCall(_,f)}this._assertSlimcoreObjectId(s,"JoinCall"),a.logSuccess("slimcoreCallHandler.JoinCall()")}else if(n.callToVoicemail){if(a.info("Calling slimcoreCallHandler.PlaceCallToVoicemail"),1!==this.participants.length)throw new Error("PlaceCallToVoicemail Failed. Participant size should be one");this._addParticipantToCall(this.participants[0],r),s=this._slimcoreCallHandler.placeCallToVoicemail(this.callId,t.convertToSlimCoreMediaPeerType(this._mediaPeerType),this.participants[0].id,{threadId:this.threadId,voicemailResourcePath:n.voicemailResourcePath,voicemailItemId:n.voicemailItemId}),this._assertSlimcoreObjectId(s,"PlaceCallToVoicemail"),a.logSuccess("slimcoreCallHandler.PlaceCallToVoicemail()")}else if(void 0!==n.parkContext&&void 0!==n.pickupCode){var m=this.mapParkContext(n.parkContext);this._setCallType(1);f=this._getSlimCoreCallProperties(i(i({},u),{screenshareDirection:k.MediaDirection.Disabled}));s=this._slimcoreCallHandler.startCallUnpark(this.callId,f,m,n.pickupCode),this._assertSlimcoreObjectId(s,"StartCallUnpark"),a.logSuccess("slimcoreCallHandler.StartCallUnpark()")}else{a.info("Calling slimcoreCallHandler.PlaceCall");var v=[];n.invitationType===k.InvitationType.Nudge&&n.participantsToNudge?v=n.participantsToNudge:this.participants.forEach(function(e){o._addParticipantToCall(e,r),v.push(e.id)});var y=1!==v.length;this._setCallType(y?2:1);f=this._getSlimCoreCallProperties(i(i({},u),{preheatFlags:n.preheatFlags,screenshareDirection:void 0!==n.screenshareDirection?t.toMediaDirection(n.screenshareDirection):2===this.callType&&this._isEnterpriseMultiParty(this._mediaPeerType)?k.MediaDirection.ReceiveFromPeer:k.MediaDirection.Disabled,meetingRegistrationId:O.mapToEmptyStrIfFalsy(n.meetingRegistrationId)}));switch(e){case h.CALL_OPERATIONS.START_WITH_MEETING_DATA:case h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA:s=this._slimcoreCallHandler.startSignalingSessionWithMeetingData(this.callId,JSON.stringify(this.meetingData),f.shouldResurrect,f.mediaPeerType,f,v);break;default:s=this._slimcoreCallHandler.placeCall(this.callId,v,f)}this._assertSlimcoreObjectId(s,"PlaceCall"),a.logSuccess("slimcoreCallHandler.PlaceCall()")}this.attachSlimCoreCallObject(s,r,!1,"_joinOrStartSlimCoreCall"),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED,void 0,void 0,r)},t.prototype._fillIncomingCallProperties=function(e){var t=this._getProperties(this._slimcoreCallHandler,this.slimcoreCallId,{conversationType:{propKey:k.Property.CallConversationType},callQueueInfo:{propKey:k.Property.CallQueueInfo},callerMri:{propKey:k.Property.CallerMriIdentity},transferorMri:{propKey:k.Property.CallTransferorMri},transferorDisplayName:{propKey:k.Property.CallTransferorDisplayName},transferorType:{propKey:k.Property.CallTransferorType},onBehalfOfMri:{propKey:k.Property.CallOnBehalfOfMri},incomingCallType:{propKey:k.Property.CallIncomingType},consultativeTransferCallId:{propKey:k.Property.CallConsultativeTransferCallId},spamRiskLevel:{propKey:k.Property.CallSpamRiskLevel},spamStirAttestation:{propKey:k.Property.CallSpamStirAttestation}},{isIncomingOneOnOneVideoCall:{propKey:k.Property.CallIsIncomingOneOnOneVideoCall}});this._setCallerMri(_.stripMriAliases(t.callerMri),e),this._updateConversationType(t.conversationType,e),this.transferorMri=_.stripMriAliases(t.transferorMri),this.transferorDisplayName=t.transferorDisplayName,this.transferorType=t.transferorType,this.onBehalfOfMri=_.stripMriAliases(t.onBehalfOfMri),this.callQueueInfo=t.callQueueInfo&&JSON.parse(t.callQueueInfo),this.incomingCallType=t.incomingCallType,this._setConsultativeCallId(this.consultativeCallId),this.isIncomingOneOnOneVideoCall=!!t.isIncomingOneOnOneVideoCall,this.spamRiskLevel=t.spamRiskLevel,this.spamStirAttestation=t.spamStirAttestation},t.prototype._onCallPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.slimcoreCallId,e,t)},t.prototype._onPropertyChanged=function(e,t){this[e]!==t&&(this._logger.info("_onPropertyChanged: key="+e+" value="+t),this[e]=t,this.raiseChanged())},t.prototype.attachSlimCoreCallObject=function(e,t,n,r){var i=this;void 0===n&&(n=!1),void 0===r&&(r="attachSlimCoreCallObject");var o=this._logger.createFnLogger("attachSlimCoreCallObject",t),a=this._callOperationHandler.getPendingOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),s=this.slimcoreCallId;if(this.slimcoreCallId===e)return this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.ELECTRON_ATTACH_SLIMCORE_CALL_FAILED,{slimCoreCallObjectId:e,reason:"Call already attached to a SlimCore object"},t),o.logFailure("Call already attached to a SlimCore object"),a;0!==this.slimcoreCallId&&o.info("Call already attached to a different SlimCore object, attaching to new object"),o.info("new slimCoreCallObjectId="+e),this.slimcoreCallId=e,this._isOptimizedSpeakerEventingEnabled=this.tryEcsGetSettingAsBool("enableOptimizedSpeakerChangeEvents",!1),this._isSetVideoChannelsRenegotiated=this.tryEcsGetSettingAsBool("renegotiateVideoChannels",!1),this._enableAddParticipantPromiseOptimization=this.tryEcsGetSettingAsBool("enableAddParticipantPromiseOptimization",!1),o.info("enableAddParticipantPromiseOptimization is: "+this._enableAddParticipantPromiseOptimization),this._slimCoreElectronRemoteManager=new D.default(this._logger,this._settings,this._slimcoreInstance,this._slimcoreCallHandler,this.slimcoreCallId,this.mediaStreams,this._streamContextMap,this.createVirtualParticipantMSIToParticipantIdMapper,n),this._slimCoreElectronRemoteManager.changed(function(){return i.raiseChanged()});var c=j.default.isVideoLayoutSupported(this._slimcoreInstance);this.videoLayout=c?new j.default(this._logger,this._settings,this._slimcoreInstance,this.slimcoreCallId,this.createVirtualParticipantMSIToParticipantIdMapper):void 0,this._onCallPropertyChanged(k.Property.CallOrigin,function(e){return i._onCallOriginChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallStatus,function(e){return i._onCallStatusChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallMode,function(e){return i._onCallModeChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallTransferStatus,function(e){return i._onCallTransferStatusChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallParkStatus,function(e){return i._onCallParkStatusChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallIsMuted,function(e){return i._onCallMutedUnmuted(!!e.value)}),this._onCallPropertyChanged(k.Property.CallIsMutedSpeaker,function(e){return i._onCallMutedUnmutedSpeaker(!!e.value)}),this._onCallPropertyChanged(k.Property.CallIsServerMuted,function(e){return i._onCallIsServerMuted(!!e.value)}),this._onCallPropertyChanged(k.Property.CallActiveMembers,function(e){return i._onParticipantJoinedOrRemovedDeferred()}),this._onCallPropertyChanged(k.Property.CallGroupId,function(e){return i._onGroupIdChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallThreadId,function(e){return i._onThreadIdChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallMessageId,function(e){return i._onMessageIdChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallEndpointDetails,function(e){return i._updateEndpointDetails(e.value)}),this._onCallPropertyChanged(k.Property.SelfParticipantRole,function(e){return i._onSelfParticipantRoleChanged(e.value)}),this._onCallPropertyChanged(k.Property.SelfParticipantTenantId,function(e){return i._onSelfParticipantTenantIdChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallMeetingDetails,function(e){return i._updateMeetingDetails(e.value)}),this._onCallPropertyChanged(k.Property.CallMemberCountChanged,function(e){return i._onParticipantJoinedOrRemovedDeferred()}),this._onCallPropertyChanged(k.Property.CallIsConference,function(e){return i._updateCallType(e.value,t)}),this._onCallPropertyChanged(k.Property.CallIsHostless,function(e){return i._updateIsHostless(e.value)}),this._onCallPropertyChanged(k.Property.CallForwardingDestinationType,function(e){return i._updateForwardingDestinationType(e.value)}),this._onCallPropertyChanged(k.Property.CallOptimalRemoteVideoCount,function(e){return i._onCallOptimalVideoCountChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallName,function(e){return i._onCallIdChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallDataChannelObjectId,function(e){return i._updateDataChannel(t,e.value)}),this._onCallPropertyChanged(k.Property.CallBroadcastMetadata,function(e){return i._onBroadcastMetadataChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallProgressStatus,function(e){return i._onCallProgressStatusChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallEndDiagnosticsCode,function(e){return i._onDiagnosticsCodeChanged(e.value)}),this._onCallPropertyChanged(k.Property.TransferDiagnosticsCode,function(e){return i._onTransferDiagnosticsCodeChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallInvitationData,function(e){return i._updateCallInvitationData(e.value)}),this._onCallPropertyChanged(k.Property.SelfMeetingRole,function(e){return i._updateMeetingRole(e.value)}),this._onCallPropertyChanged(k.Property.CallTransferorMri,function(e){return i._updateTransferorMri(e.value)}),this._onCallPropertyChanged(k.Property.CallClientTransferContext,function(e){return i._updateClientTransferContext(e.value)}),this._onCallPropertyChanged(k.Property.CallCapabilities,function(e){return i._onCallCapabilitiesChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallActiveVideoChannelCount,function(e){return i._updateActiveVideoChannelCount(e.value)}),this._onCallPropertyChanged(k.Property.CallPublishedStates,function(e){return i._onPublishedStatesChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallConversationType,function(e){return i._updateConversationType(e.value,t)}),this._onCallPropertyChanged(k.Property.CallParticipantCounts,function(e){return i._onParticipantCountsUpdated(e.value)}),this._onCallPropertyChanged(k.Property.CallIsLocallyHeld,function(e){return i._updateIsLocallyHeld(e.value)}),this._onCallPropertyChanged(k.Property.CallMeetingData,function(e){return i._onMeetingDataChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallMeetingInfo,function(e){return i._onMeetingInfoChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallRegion,function(e){return i._onPropertyChanged("region",e.value)}),this._onCallPropertyChanged(k.Property.CallBreakoutDetails,function(e){return i._onBreakoutDetailsUpdated(e.value)}),this._onCallPropertyChanged(k.Property.CallMeetingGroupDetails,function(e){return i._onMeetingGroupDetailsChanged(e.value)}),this._onCallPropertyChanged(k.Property.CallLimits,function(e){return i._onCallLimitsUpdated(e.value)}),this._onCallPropertyChanged(k.Property.CallIsSharedLineAppearanceV2Activated,function(e){return i._updateIsSharedLineAppearanceV2Activated(e.value)}),this._registerDisposable(this._slimcoreInstance.handle("object-property-changed",{propKey:k.Property.ContentSharingStatus},function(e){return i._onContentSharingChanged()})),this._registerDisposable(this._slimcoreCallHandler.handle("audio-stream-state-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onAudioStreamStateChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("e-2-e-encryption-status-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onE2EEncryptionStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("transfer-requested",{callObjectId:this.slimcoreCallId},function(e){return i._onTransferRequested(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("callmeback-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onCallMeBackOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("unmuteself-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onUnmuteOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("muteself-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onMuteOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("media-negotiation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onMediaNegotiationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("nudge-participants-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onNudgeParticipantOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("update-meeting-roles-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onUpdateMeetingRoleOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("mute-participants-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onMuteParticipantOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("active-speaker-list-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onActiveSpeakerListChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("dominant-speaker-list-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onDominantSpeakerListChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("slowed-down-active-talker-list-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onSlowedDownActiveTalkerListChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("remote-user-events-received",{callObjectId:this.slimcoreCallId},function(e){return i._onRemoteUserEventsReceived(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("publish-state-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onPublishStateOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreCallHandler.handle("remove-state-operation-status-changed",{callObjectId:this.slimcoreCallId},function(e){return i._onRemoveStateOperationStatusChanged(e)})),this._registerDisposable(this._slimcoreInstance.handle("quality-changed",void 0,function(e){return i._onQualityChanged(e)}));var l=this._getProperties(this._slimcoreCallHandler,this.slimcoreCallId,{callId:{propKey:k.Property.CallName},groupId:{propKey:k.Property.CallGroupId},threadId:{propKey:k.Property.CallThreadId},messageId:{propKey:k.Property.CallMessageId},meetingDetails:{propKey:k.Property.CallMeetingDetails},meetingLayout:{propKey:k.Property.CallMeetingLayout},tenantId:{propKey:k.Property.SelfParticipantTenantId},role:{propKey:k.Property.SelfParticipantRole},broadcastMetadata:{propKey:k.Property.CallBroadcastMetadata},invitationData:{propKey:k.Property.CallInvitationData},clientTransferContext:{propKey:k.Property.CallClientTransferContext},meetingRole:{propKey:k.Property.SelfMeetingRole},publishedStates:{propKey:k.Property.CallPublishedStates},participantCounts:{propKey:k.Property.CallParticipantCounts},meetingData:{propKey:k.Property.CallMeetingData},meetingInfo:{propKey:k.Property.CallMeetingInfo},region:{propKey:k.Property.CallRegion},breakoutDetails:{propKey:k.Property.CallBreakoutDetails},meetingGroupDetails:{propKey:k.Property.CallMeetingGroupDetails},callLimits:{propKey:k.Property.CallLimits}},{status:{propKey:k.Property.CallStatus},mode:{propKey:k.Property.CallMode},isConference:{propKey:k.Property.CallIsConference},isServerMuted:{propKey:k.Property.CallIsServerMuted},capabilityFlags:{propKey:k.Property.CallCapabilities},activeVideoChannelCount:{propKey:k.Property.CallActiveVideoChannelCount}});return this._updateCallType(l.isConference,t),this._onCallIdChanged(l.callId),this._onGroupIdChanged(l.groupId),this._onThreadIdChanged(l.threadId),this._onMessageIdChanged(l.messageId),this._onCallStatusChanged(l.status,t),this._onCallModeChanged(l.mode,t),this._updateMeetingDetails(l.meetingDetails),this._onSelfParticipantTenantIdChanged(l.tenantId),this._onSelfParticipantRoleChanged(l.role),this._onCallIsServerMuted(!!l.isServerMuted),this._onBroadcastMetadataChanged(l.broadcastMetadata),this._updateCallInvitationData(l.invitationData),this._updateClientTransferContext(l.clientTransferContext),this._updateMeetingRole(l.meetingRole),this._onPublishedStatesChanged(l.publishedStates),this._onCallCapabilitiesChanged(l.capabilityFlags),this._updateActiveVideoChannelCount(l.activeVideoChannelCount),this._onParticipantCountsUpdated(l.participantCounts),this._onMeetingDataChanged(l.meetingData),this._onMeetingInfoChanged(l.meetingInfo),this._onPropertyChanged("region",l.region),this._onBreakoutDetailsUpdated(l.breakoutDetails),this._onMeetingGroupDetailsChanged(l.meetingGroupDetails),this._onCallLimitsUpdated(l.callLimits),this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.ELECTRON_ATTACH_SLIMCORE_CALL,{slimCoreCallObjectId:e,oldSlimcoreCallId:s,callId:l.callId,groupId:l.groupId,threadId:l.threadId,messageId:l.messageId,role:l.role},t),this._onParticipantJoinedOrRemoved(t),this._callOperationHandler.resolveOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,void 0,void 0,void 0,!0),this._assertSlimcoreObjectId(this.slimcoreCallId,r),a},t.prototype.getStrProperty=function(e,t){return this._getStrProperty(this._slimcoreCallHandler,this.slimcoreCallId,e,O.mapToEmptyStrIfFalsy(t))},t.prototype.getIntProperty=function(e,t,n){return this._getIntProperty(this._slimcoreCallHandler,n||this.slimcoreCallId,e,t)},t.prototype._updateCallInvitationData=function(e){try{e&&(this.invitationData=JSON.parse(e),this._logger.info("_updateCallInvitationData updated: invitationData.legnth = "+e.length),this.raiseChanged())}catch(t){this._logger.info("Failed to parse invitation data. Error: "+t+", diagnosticsCode: "+e)}},t.prototype._updateCallType=function(e,t){var n=this._logger.createFnLogger("updateCallType",t,"current="+this.callType),r=0===e?1:1===e?2:-1;2!==this.callType||1!==r?(n.info("newValue: "+r),r!==this.callType&&(2===r&&this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.CALL_ESCALATED_TO_CONFERENCE,void 0,t),this._setCallType(r),this._updateCapabilities(t),this.raiseChanged())):n.logFailure("De-escalating to P2P not allowed!")},t.prototype._updateConversationType=function(e,t){this._logger.createFnLogger("updateConversationType",t,"current="+this.conversationType).info("newValue: "+e),e!==this.conversationType&&(this.conversationType=e,this._callTelemetry.setConversationType(this.conversationType),this.raiseChanged())},t.prototype._updateForwardingDestinationType=function(e){e!==this.forwardingDestinationType&&(this.forwardingDestinationType=e,this.raiseChanged())},t.prototype._setupCallTelemetry=function(){this._callTelemetry=new g.CallTelemetry(this._logger,this._callStartTime);try{this._callTelemetry.setStackConfig({ConversationServiceUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/ConversationServiceUrl"),UdpTransportUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/UdpTransportUrl"),KeyDistributionUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/KeyDistributionUrl"),PotentialCallRequestUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/PotentialCallRequestUrl"),UploadLogUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/UploadLogUrl"),UdpEnabled:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/UdpEnabled"),SlimCoreVersion:SlimCore.getVersion()})}catch(e){this._logger.info("Failed to log stack config")}},t.prototype._updateDataChannel=function(e,t){if(this._logger.info("_updateDataChannel()"),t){this._dataChannel&&this._dataChannel.dispose(e);var n=void 0;try{n=this._slimcoreInstance.getDataChannel(t)}catch(e){return this._logger.error("failed to get data channel: "+e),void this._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_DATA_CHANNEL_CREATED)}this._dataChannel=new u.default(this._logger,this._settings,this._slimcoreInstance,this,this._slimcoreCallHandler,n,this._dataChannelUsers,t),this._dataChannel.setAdapterSourceSinkCallback(this.dataChannelAdapter.setInternalSourceSink),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_DATA_CHANNEL_CREATED),this._logger.info("Data channel set")}},t.prototype.mapDataChannelSourceIdToParticipant=function(e){var t=null;return(t=1===this.callType?this.participants[0]:d.find(this.participants,function(t){return t.hasSourceId(3,e)}))&&t.id?this._logger.info("ParticipantId: "+y.scrubMriOrOmit(t.id)+" to SourceId: "+e):this._logger.warn("No Participant found for SourceId: "+e),t},t.prototype._onAudioStreamStateChanged=function(e){this.event("mediaStreamStateChanged").raise(),e.direction===SlimCore.Enums.MediaDirection.ReceiveFromPeer&&(this.isAudioStreamConnected=e.streamState===SlimCore.Enums.MediaStreamState.StreamInactive||e.streamState===SlimCore.Enums.MediaStreamState.StreamActive),e.streamState===SlimCore.Enums.MediaStreamState.StreamFail&&this.event("mediaConnectionFailed").raise()},t.prototype._onE2EEncryptionStatusChanged=function(e){var t=i({},e);this.event("e2eEncryptionStatusChanged").raise(t)},t.prototype._onTransferRequested=function(e){var t=this;this._logger.info("Transfer: _onTransferRequested",e);var n,r=this.getIntProperty(k.Property.CallOrigin,k.OriginType.Unspecified,e.targetCallObjectId);r===k.OriginType.Park?n=1:r===k.OriginType.Transfer?n=0:r===k.OriginType.TransferToVoicemail?n=2:this._logger.info("Unkown transfer type based on new call origin"),this._logger.info("onTransferRequested newCallOrigin="+r+" transferType="+n);var i={transferorMri:e.transferorMri,targetMri:e.transferTargetMri,transferType:n,context:{newCallObjectId:e.targetCallObjectId}};this.event("transferRequested").raise({transferContext:i,onCompleted:function(e){t._logger.debug("Transfer: transferCompleted called: "+e),1!==e&&t._slimcoreCallHandler.leaveCall(i.context.newCallObjectId)}})},t.prototype._operationStatusChanged=function(e,t,n){this._logger.info("["+e+"][OperationStatusChanged]: "+n);var r=n.causeId||F.generateCauseId();if(e.hasPendingOperation(t)){var i={reason:A.convertFailureReasonToParticipantReason(n.failureReason)};i.code=n.code,i.subCode=n.subCode,i.phrase=n.phrase,this._callTelemetry.updateOperationData(t,i,r)}},t.prototype._onCallMeBackOperationStatusChanged=function(e){this._operationStatusChanged(this._participantOperationHandler,h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,e),this._logger.info("[onCallMeBackOperationStatusChanged]: code: "+e.code+" subCode: "+e.subCode);var t=A.convertFailureReasonToParticipantReason(e.failureReason),n={code:e.code,subCode:e.subCode,phrase:e.phrase};n.failureReason=t,e.failureReason===k.ParticipantFailureReason.NoFailure?this._participantOperationHandler.maybeResolveOperation(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,null,e.participantMri,e.causeId):this._participantOperationHandler.rejectOperation(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,n,e.participantMri,e.causeId)},t.prototype._onUnmuteOperationStatusChanged=function(e){this._operationStatusChanged(this._callOperationHandler,h.CALL_OPERATIONS.UNMUTE,e);var n,r=F.generateCauseId();try{n=JSON.parse(e.transactionEnd)}catch(e){this._logger.info("_onUnmuteOperationStatusChanged: exception when parsing transactionEnd "+e+", assuming terminated reasion")}if(n&&n.code)0===n.code&&0===n.subCode?this._callOperationHandler.resolveOperation(h.CALL_OPERATIONS.UNMUTE,n,r,r):this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS.UNMUTE,n,r,r);else{var i=t.convertParticipantReasonToTerminatedReason(A.convertFailureReasonToParticipantReason(e.failureReason));e.operationResult===k.OperationResultCode.Success?this._callOperationHandler.resolveOperation(h.CALL_OPERATIONS.UNMUTE,i,void 0,r):this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS.UNMUTE,i,void 0,r)}},t.prototype._onMuteOperationStatusChanged=function(e){this._logger.info("_onMuteOperationStatusChanged: eventData "+JSON.stringify(e,null,4));var t;try{t=JSON.parse(e.transactionEnd)}catch(e){return void this._logger.info("_onMuteOperationStatusChanged: exception when parsing transactionEnd "+e)}if(this._logger.info("_onMuteOperationStatusChanged: parsed transactionEnd "+JSON.stringify(t,null,4)),t){this._operationStatusChanged(this._callOperationHandler,h.CALL_OPERATIONS.MUTE,e);var n=F.generateCauseId();0===t.code&&0===t.subCode?this._callOperationHandler.resolveOperation(h.CALL_OPERATIONS.MUTE,t,n,n):this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS.MUTE,t,n,n)}},t.prototype._onNudgeParticipantOperationStatusChanged=function(e){this._operationStatusChanged(this._participantOperationHandler,h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,e);var t=F.generateCauseId(),n=A.convertFailureReasonToParticipantReason(e.failureReason);e.failureReason===k.ParticipantFailureReason.NoFailure?this._participantOperationHandler.resolveOperation(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,n,e.context,t):this._participantOperationHandler.rejectOperation(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS,n,e.context,t)},t.prototype._onUpdateMeetingRoleOperationStatusChanged=function(e){this._operationStatusChanged(this._participantOperationHandler,h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,e);var t={code:e.code,subCode:e.subCode,phrase:e.phrase};0===t.code&&0===t.subCode?this._participantOperationHandler.resolveOperation(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,t,e.causeId,e.causeId):this._participantOperationHandler.rejectOperation(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE,t,e.causeId,e.causeId)},t.prototype._onMuteParticipantOperationStatusChanged=function(e){this._operationStatusChanged(this._callOperationHandler,h.CALL_OPERATIONS.MUTE_PARTICIPANTS,e);var t={code:e.code,subCode:e.subCode,phrase:e.phrase};0===t.code&&0===t.subCode?this._callOperationHandler.resolveOperation(h.CALL_OPERATIONS.MUTE_PARTICIPANTS,t,e.causeId,e.causeId):this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS.MUTE_PARTICIPANTS,t,e.causeId,e.causeId)},t.prototype._onActiveSpeakerListChanged=function(e){for(var t={},n=0,r=e.activeSpeakers?Array.from(e.activeSpeakers):[];n<r.length;n++)t[r[n]]=1;for(var i=0,o=this.participants;i<o.length;i++){var a=o[i];a.setVoiceLevel(t[a.id]||0)}this._logger.debug("_onActiveSpeakerListChanged: number of active speakers "+Object.keys(t).length)},t.prototype._onDiagnosticsCodeChanged=function(e){var t=this;if(this._rawCallEndDiagnosticsInfo!==e&&e&&!d.isEmpty(e)){this._logger.info("_onDiagnosticsCodeChanged diagnosticsCode: "+e);try{this._rawCallEndDiagnosticsInfo=e,this.callEndDiagnosticsInfo=JSON.parse(e),this._enableLeavePerfImprovements&&this.participants.forEach(function(n){return c(t,void 0,void 0,function(){return l(this,function(t){return[2,n.onParticipantDiagnosticsCodeChanged(e)]})})});try{this.callEndDiagnosticsInfo.additionalDiagnostics&&(this.callEndDiagnosticsInfo.additionalDiagnostics=JSON.parse(this.callEndDiagnosticsInfo.additionalDiagnostics))}catch(e){this._logger.warn("_onDiagnosticsCodeChanged failed to parse, may be OK. Error: "+e+", additionalDiagnostics: "+this.callEndDiagnosticsInfo.additionalDiagnostics+".")}this.raiseChanged()}catch(t){this._logger.info("Failed to parse raw diagnostis details. Error: "+t+", diagnosticsCode: "+e)}}},t.prototype._onTransferDiagnosticsCodeChanged=function(e){if(this._rawTransferDiagnosticsInfo!==e&&e&&!d.isEmpty(e)){this._logger.info("_onTransferDiagnosticsCodeChanged: "+e);try{this._rawTransferDiagnosticsInfo=e,this.transferDiagnosticsInfo=JSON.parse(e),this.raiseChanged()}catch(t){this._logger.info("Failed to parse raw diagnostis details. Error: "+t+", diagnosticsCode: "+e)}}},t.prototype._onDominantSpeakerListChanged=function(e){this.dominantSpeakerInfo.speakerList=e.dominantSpeakers?Array.from(e.dominantSpeakers):[],this._logger.info("_onDominantSpeakerListChanged: number of dominant speakers "+this.dominantSpeakerInfo.speakerList.length),this.raiseChanged()},t.prototype._onSlowedDownActiveTalkerListChanged=function(e){this.slowedDownActiveTalkerInfo.speakerList=e.slowedDownActiveSpeakers?Array.from(e.slowedDownActiveSpeakers):[],this._logger.info("_onSlowedDownActiveTalkerListChanged: number of slowed down speakers "+this.slowedDownActiveTalkerInfo.speakerList.length),this.raiseChanged()},t.prototype._onRemoteUserEventsReceived=function(e){this.event("remoteUserEventsReceived").raise(e.participantId,e.events)},t.prototype._updateCallLegIdChanged=function(e){this.participantId!==e&&(this._logger.info("updateCallLegIdChanged: new value is "+e),this._setParticipantId(e),this.event("callLegIdChanged").raise(e),this.raiseChanged())},t.prototype._completeAdmitParticipantTransaction=function(e,t,n,r,i){void 0===i&&(i=!1),this._logger.info("_completeAdmitParticipantTransaction["+n+"]["+y.scrubMriOrOmit(r)+"]: operationName "+e+" transactionEnd "+JSON.stringify(t,null,4));var o=this._getParticipantLegId(this._getParticipant(r)),a=o?{participantLegId:o}:{};0===t.code?(this._callTelemetry.maybeRecordOperationSuccess(e,t,r,n,a),this._participantOperationHandler.maybeResolveOperation(e,t,r,n)):(this._callTelemetry.maybeRecordOperationFailure(e,t,r,n,a),this._participantOperationHandler.maybeRejectOperation(e,t,r,n))},t.prototype._completeAddParticipantTransaction=function(e,t,n,r){this._logger.info("_completeAddParticipantTransaction["+n+"]["+y.scrubMriOrOmit(r)+"]: operationName "+e+" transactionEnd "+JSON.stringify(t,null,4));var i=this._getParticipant(r);0===t.code&&(this._callTelemetry.maybeRecordOperationSuccess(e,t,r,n),this._participantOperationHandler.maybeResolveOperation(e,i,r,n))},t.prototype._completeTransaction=function(e,t,n,r){this._logger.info("_completeTransaction["+n+"]["+r+"]: operationName "+e+" transactionEnd "+JSON.stringify(t,null,4)),this._callTelemetry.updateOperationData(e,t,n,r),0===t.code||t.code>=200&&t.code<300?(this._callTelemetry.maybeRecordOperationSuccess(e,t,r,n),this._callOperationHandler.maybeResolveOperation(e,t,r,n)):(this._callTelemetry.maybeRecordOperationFailure(e,t,r,n),this._callOperationHandler.maybeRejectOperation(e,t,r,n))},t.prototype._completeWithTransactionResult=function(e,t,n,r,i){if(void 0===i&&(i=!1),this._logger.info("_completeWithTransactionResult["+n+"]["+r+"]: operationName "+e+" code: "+JSON.stringify(t.code)+" subcode: "+JSON.stringify(t.subCode)),this._callTelemetry.updateOperationData(e,t,n,r),0===t.code&&0===t.subCode||i&&t.code>=200&&t.code<300)try{this._callOperationHandler.maybeResolveOperation(e,t.result?JSON.parse(t.result):JSON.parse("{}"),r,n),this._callTelemetry.maybeRecordOperationSuccess(e,t.result||t,r,n)}catch(t){this._logger.error("["+n+"]Failed to parse transaction results. Error: "+t),this._callTelemetry.maybeRecordOperationSuccess(e,f.getRejectTransactionEnd(t,h.TRANSACTION_END_SUBCODE.CANNOT_PARSE_RESULT),r,n),this._callOperationHandler.maybeRejectOperation(e,f.getRejectTransactionEnd(t,h.TRANSACTION_END_SUBCODE.CANNOT_PARSE_RESULT),r,n)}else this._callTelemetry.maybeRecordOperationSuccess(e,t,r,n),this._callOperationHandler.maybeRejectOperation(e,t,r,n)},t.prototype._onOperationStatusChanged=function(e){var t=this;this._logger.info("_onOperationStatusChanged: eventData "+JSON.stringify(e,null,4));var n;try{n=JSON.parse(e.result)}catch(e){return void this._logger.info("_onOperationStatusChanged: exception when parsing result "+e)}if(this._logger.info("_onOperationStatusChanged: parsed response "+JSON.stringify(n,null,4)),n){var r=this;for(var i in n)!function(e){e&&n.hasOwnProperty(e)||r._logger.info("_onOperationStatusChanged: causeId empty or invalid "+n);for(var i in n[e])!function(i){n[e].hasOwnProperty(i)||r._logger.info("_onOperationStatusChanged: not a valid object "+n);var o=n[e][i];r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,i)?r._completeTransaction(h.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,o,e,i):r._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE)?r._completeTransaction(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,o,e,i):r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS,e)?r._completeTransaction(h.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS,o,e,e):r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.ADMIT,e)?r._completeTransaction(h.CALL_OPERATIONS.ADMIT,o,e,e):r._participantOperationHandler.hasPendingOperationWithOperationId(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,i)?r._completeAdmitParticipantTransaction(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,o,e,i):r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.MERGE_PARTICIPANT,i)?r._completeTransaction(h.CALL_OPERATIONS.MERGE_PARTICIPANT,o,e,i):r._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.PARK_CALL)?r._completeTransaction(h.CALL_OPERATIONS.PARK_CALL,o,e,i):r._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.UNPARK_CALL)?r._completeTransaction(h.CALL_OPERATIONS.UNPARK_CALL,o,e,i):r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.SEARCH_PARTICIPANTS,e)?r._completeWithTransactionResult(h.CALL_OPERATIONS.SEARCH_PARTICIPANTS,o,e,e,!0):r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.GET_ALL_PARTICIPANTS,e)?r._completeWithTransactionResult(h.CALL_OPERATIONS.GET_ALL_PARTICIPANTS,o,e,e,!0):r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,e)?r._completeTransaction(h.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,o,e,e):r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,e)?r._completeWithTransactionResult(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,o,e,e):r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,e)?r._completeTransaction(h.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,o,e,e):r._participantOperationHandler.hasPendingOperationWithOperationId(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,i)&&r._enableAddParticipantPromiseOptimization?r._completeAddParticipantTransaction(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,o,e,i):r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.SET_MEETING_LAYOUT,i)?r._completeWithTransactionResult(h.CALL_OPERATIONS.SET_MEETING_LAYOUT,o,e,i):r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,e)?r._completeTransaction(h.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,o,e,e):r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.JOIN_MEETING_GROUP,e)?r._completeTransaction(h.CALL_OPERATIONS.JOIN_MEETING_GROUP,o,e,e):r._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.LEAVE_MEETING_GROUP,e)?r._completeTransaction(h.CALL_OPERATIONS.LEAVE_MEETING_GROUP,o,e,e):r._mergeParticipantMriToParticipantIdMap&&Object.keys(r._mergeParticipantMriToParticipantIdMap).forEach(function(n){var r=t._mergeParticipantMriToParticipantIdMap[n].indexOf(i);r>=0&&t._callOperationHandler.hasPendingOperationWithOperationId(h.CALL_OPERATIONS.MERGE_PARTICIPANT,n)&&(t._mergeParticipantMriToParticipantIdMap[n].splice(r,1),delete t._mergeParticipantMriToParticipantIdMap[n],t._completeTransaction(h.CALL_OPERATIONS.MERGE_PARTICIPANT,o,e,n))})}(i)}(i)}},t.prototype._onPublishStateOperationStatusChanged=function(e){this._logger.info("_onPublishStateOperationStatusChanged: eventData "+JSON.stringify(e,null,4));var t={};t.code=e.code,t.subCode=e.subCode,t.phrase=e.phrase,t.result=e.result,t.code>=200&&t.code<300&&0===t.subCode?this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.PUBLISH_STATE,e.stateId?e.stateId:e.result,e.causeId,e.causeId):this._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS.PUBLISH_STATE,t,e.causeId,e.causeId)},t.prototype._onRemoveStateOperationStatusChanged=function(e){this._logger.info("_onRemoveStateOperationStatusChanged: eventData "+JSON.stringify(e,null,4));var t={};t.code=e.code,t.subCode=e.subCode,t.phrase=e.phrase,t.result=e.result,e.operationSuccess?this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.REMOVE_STATE,e.result,e.causeId,e.causeId):this._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS.REMOVE_STATE,t,e.causeId,e.causeId)},t.prototype._updateIsHostless=function(e){var t=1===e;this.isHostless!==t&&(this._logger.info("_updateIsHostless: new value is "+t),this.isHostless=t,this.raiseChanged())},t.prototype._updateIsLocallyHeld=function(e){var t=1===e;this._isLocallyHeld!==t&&(this._logger.info("_updateIsLocallyHeld: new value is "+t),this._isLocallyHeld=t)},t.prototype._updateIsSharedLineAppearanceV2Activated=function(e){var t=1===e;this._isSharedLineAppearanceV2Activated!==t&&(this._logger.info("_updateIsSharedLineAppearanceV2Activated: new value is "+t),this._isSharedLineAppearanceV2Activated=t,this.event("sharedLineAppearanceV2ActivatedChanged").raise(this._isSharedLineAppearanceV2Activated))},t.prototype._onCallOptimalVideoCountChanged=function(e){this._logger.info("_onCallOptimalVideoCountChanged "+e),e!==this.optimalVideoCount&&(this.optimalVideoCount=e,this.raiseChanged())},t.prototype._onCallIdChanged=function(e){this._logger.info("_onCallIdChanged "+e),e!==this.callId&&(this._setCallId(e),this.event("callIdChanged").raise(this.callId),this.raiseChanged())},t.prototype._onMeetingDataChanged=function(e){if(this._logger.info("_onMeetingDataChanged "+e),e&&this._rawMeetingData!==e)try{this.meetingData=JSON.parse(e),this._rawMeetingData=e,this.raiseChanged()}catch(t){this._logger.warn("Failed to parse the raw meeting data. Error: "+t+", MeetingData: "+e)}},t.prototype._onMeetingInfoChanged=function(e){if(this._logger.info("_onMeetingInfoChanged "+e),e&&this._rawMeetingInfo!==e)try{this.meetingInfo=JSON.parse(e),this._rawMeetingInfo=e,this.raiseChanged()}catch(t){this._logger.warn("Failed to parse the raw meeting info. Error: "+t+", MeetingInfo: "+e)}},t.prototype._onMeetingGroupDetailsChanged=function(e){if(this._logger.info("_onMeetingGroupDetailsChanged current="+this.meetingGroupDetails+" new="+e),this._rawMeetingGroupDetails!==e)try{this.meetingGroupDetails=e?JSON.parse(e):void 0,this._rawMeetingGroupDetails=e,this.raiseChanged()}catch(t){this._logger.warn("Failed to parse the raw meeting group details. Error: "+t+", MeetingGroupDetails: "+e)}},t.prototype._onPublishedStatesChanged=function(e){if(this._logger.info("_onPublishedStatesChanged"),e&&this._rawPublishedStatesJsonString!==e)try{this._publishedStates=JSON.parse(e),this._rawPublishedStatesJsonString=e,this.event("publishedStatesChanged").raise(this._publishedStates),this.raiseChanged()}catch(t){this._logger.info("["+m.causeId+"]Failed to parse published states. Error: "+t+", PublishedStates: "+e)}},t.prototype._onParticipantCountsUpdated=function(e){if(this._logger.info("_onParticipantCountsUpdated "+(e?e.length:"undefined")),this._rawParticipantCountsJsonString!==e)try{d.isEmpty(e)?this._participantCounts=h.EMPTY_COUNTS:this._participantCounts=i(i({},h.EMPTY_COUNTS),JSON.parse(e)),this._rawParticipantCountsJsonString=e,this.event("participantCountsUpdated").raise(this._participantCounts)}catch(t){this._logger.info("["+m.causeId+"]Failed to parse participant counts. Error: "+t+", ParticipantCounts: "+e)}},t.prototype._setCallId=function(e){this.callId=e,this._callTelemetry.setCallId(this.callId)},t.prototype._setParticipantId=function(e){this.participantId=e,this._callTelemetry.setParticipantId(this.participantId)},t.prototype._setConsultativeCallId=function(e){this.consultativeCallId=e,this._callTelemetry.setConsultativeCallId(this.consultativeCallId)},t.prototype._onCallTransferStatusChanged=function(e){var t=F.generateCauseId();this._logger.info("["+t+"]onCallTransferStatusChanged status: "+e+" ("+k.CallStatus[e]+")"),this._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&(e===k.CallStatus.Transferring?this._setTransferState(2,t):e===k.CallStatus.Transferred?this._setTransferState(3,t):e===k.CallStatus.Failed&&this._setTransferState(4,t))},t.prototype._onCallParkStatusChanged=function(e){var t=F.generateCauseId();this._logger.info("["+t+"]_onCallParkStatusChanged status: "+e+" ("+k.CallStatus[e]+")"),this._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&(e===k.CallStatus.Parking?this._setParkState(2,t):e===k.CallStatus.Parked?this._setParkState(3,t):e===k.CallStatus.Failed&&this._setParkState(4,t))},t.prototype._onCallModeChanged=function(e,t){return void 0===t&&(t=F.generateCauseId()),c(this,void 0,void 0,function(){var n,r;return l(this,function(i){switch(i.label){case 0:if(!e)return[2];switch(n=this._logger.createFnLogger("onCallModeChanged",t),r=0,e){case k.CallMode.Initial:r=0;break;case k.CallMode.RealTime:r=1;break;case k.CallMode.Stream:r=2;break;default:return n.info("unexpected mode found"),[2]}return n.info("slimcore new call mode="+e+", mapped slimcore mode to=("+k.CallMode[e]+")"),n.info("old call mode="+this._mode+", new call mode ="+r),this._mode===r?[3,3]:(this._mode=r,2!==this._mode?[3,2]:(this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.HOLD,h.CALL_OPERATIONS.LOCAL_HOLD,h.CALL_OPERATIONS.UNHOLD,h.CALL_OPERATIONS.LOCAL_UNHOLD]),[4,this._cleanRealTimeCallResources(t)]));case 1:i.sent(),i.label=2;case 2:this.raiseChanged(),i.label=3;case 3:return[2]}})})},t.prototype._onCallStatusChanged=function(e,n){var r=this;void 0===n&&(n=F.generateCauseId());var i=this._logger.createFnLogger("onCallStatusChanged",n);if(i.info("new status="+e+", mapped to=("+k.CallStatus[e]+")"),this._updateCallLegIdChanged(this.getStrProperty(k.Property.CallLegId)),this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SIGNALING_STATE_CHANGED,{status:e,statusToEnum:k.CallStatus[e]},n),t.isCallConnecting(e))this._setCallState(2,n);else if(t.isCallPreheating(e))i.info("status=Preheating"),this._setCallState(11,n);else if(t.isCallEarlyMedia(e))i.info("status=EarlyMedia"),this._setCallState(9,n);else if(t.isCallRinging(e))i.info("status=Ringing"),this.participants.forEach(function(e){return e.setState(2,n)}),this._updateCallType(this.getIntProperty(k.Property.CallIsConference),n),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS.SUBSCRIBE,void 0,void 0,n);else if(t.isCallInLobby(e))this._callIsSetupComplete=!0,i.info("status=InLobby"),this._setCallState(10,n),this._updateCallType(this.getIntProperty(k.Property.CallIsConference),n),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.HOLD,h.CALL_OPERATIONS.LOCAL_HOLD,h.CALL_OPERATIONS.UNHOLD,h.CALL_OPERATIONS.LOCAL_UNHOLD,h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,h.CALL_OPERATIONS.JOIN_PREHEATED_CALL],void 0,void 0,n),this._reportTsCallingTelemetry(!0);else if(t.isCallPreheated(e))i.info("status=Preheated"),this._setCallState(12,n),this._updateIsHostless(this.getIntProperty(k.Property.CallIsHostless)),this._updateCallType(this.getIntProperty(k.Property.CallIsConference),n),this._updateEndpointDetails(this.getStrProperty(k.Property.CallEndpointDetails)),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,void 0,n);else if(t.isCallStaging(e))this._callIsSetupComplete=!0,i.info("status=Staging"),this._setCallState(13,n),this._updateIsHostless(this.getIntProperty(k.Property.CallIsHostless)),this._updateCallType(this.getIntProperty(k.Property.CallIsConference),n),this._updateEndpointDetails(this.getStrProperty(k.Property.CallEndpointDetails)),this._onCallMutedUnmuted(!!this.getIntProperty(k.Property.CallIsMuted)),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.HOLD,h.CALL_OPERATIONS.LOCAL_HOLD,h.CALL_OPERATIONS.UNHOLD,h.CALL_OPERATIONS.LOCAL_UNHOLD,h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,h.CALL_OPERATIONS.JOIN_PREHEATED_CALL],void 0,void 0,n),this._reportTsCallingTelemetry(!0);else if(t.isCallConnected(e))this._callIsSetupComplete=!0,i.info("status=Connected"),this._setCallState(3,n),this._updateIsHostless(this.getIntProperty(k.Property.CallIsHostless)),this._updateCallType(this.getIntProperty(k.Property.CallIsConference),n),this._updateEndpointDetails(this.getStrProperty(k.Property.CallEndpointDetails)),this._onCallMutedUnmuted(!!this.getIntProperty(k.Property.CallIsMuted)),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.HOLD,h.CALL_OPERATIONS.LOCAL_HOLD,h.CALL_OPERATIONS.UNHOLD,h.CALL_OPERATIONS.LOCAL_UNHOLD,h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,h.CALL_OPERATIONS.JOIN_PREHEATED_CALL],void 0,void 0,n),this._reportTsCallingTelemetry(!0);else if(t.isObserving(e))this._updateEndpointDetails(this.getStrProperty(k.Property.CallEndpointDetails)),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.SUBSCRIBE,h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA],void 0,void 0,n);else if(e===k.CallStatus.LocalHold)i.info("status=LocalHold"),this._setCallState(4,n),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.HOLD,h.CALL_OPERATIONS.LOCAL_HOLD,h.CALL_OPERATIONS.UNHOLD,h.CALL_OPERATIONS.LOCAL_UNHOLD],void 0,void 0,n);else if(e===k.CallStatus.RemoteHold)i.info("status=RemoteHold"),this._setCallState(5,n),this._callOperationHandler.maybeResolveOperations([h.CALL_OPERATIONS.HOLD,h.CALL_OPERATIONS.LOCAL_HOLD,h.CALL_OPERATIONS.UNHOLD,h.CALL_OPERATIONS.LOCAL_UNHOLD],void 0,void 0,n);else if(t.isCallTerminated(e)){var o=t.convertStatusToTerminatedReason(e),a=o;i.info("status=Terminated, reason="+o);var s=this.getIntProperty(k.Property.CallFailureReason),c=this.getStrProperty(k.Property.CallEndDiagnosticsCode),l=this.getIntProperty(k.Property.CallIsConference),u=this._getFirstParticipantFailureReason(i);if(e!==k.CallStatus.Failed&&e!==k.CallStatus.Dropped&&s!==k.ParticipantFailureReason.CallNotFound||(a=this._getTerminatedReason(s,o)),8===this.state&&this._callOperationHandler.hasAtleastOneOfPendingOperation([h.CALL_OPERATIONS.START_CALL,h.CALL_OPERATIONS.JOIN_CALL,h.CALL_OPERATIONS.START_WITH_MEETING_DATA,h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA]))return this.slimcoreCallId=0,this._callOperationHandler.maybeRejectOperations([h.CALL_OPERATIONS.SUBSCRIBE,h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA],a,void 0,n),void i.info("Subscribe failed, there is pending start/join operation, ignore call end message");if((2===this.state||6===this.state||8===this.state)&&this._callOperationHandler.hasAtleastOneOfPendingOperation([h.CALL_OPERATIONS.START_CALL,h.CALL_OPERATIONS.JOIN_CALL,h.CALL_OPERATIONS.START_WITH_MEETING_DATA,h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,h.CALL_OPERATIONS.SUBSCRIBE,h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA])){var d=JSON.parse(c),p={code:d.callControllerCode,subCode:d.callControllerSubCode,phrase:d.phrase,reason:a};this._callOperationHandler.maybeRejectOperations([h.CALL_OPERATIONS.ACCEPT,h.CALL_OPERATIONS.JOIN_CALL,h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,h.CALL_OPERATIONS.JOIN_PREHEATED_CALL,h.CALL_OPERATIONS.START_CALL,h.CALL_OPERATIONS.START_CALL_AND_UNPARK,h.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,h.CALL_OPERATIONS.START_WITH_MEETING_DATA,h.CALL_OPERATIONS.SUBSCRIBE,h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA],a,void 0,n,p)}this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.CALL_TERMINATION_INFO,{terminatedReasonFromStatus:o,slimcoreCallFailureReason:s,firstParticipantFailureReason:u,finalReason:a,slimcoreCallType:l},n),i.info("status=Terminated, statusToReason="+o+", slimcoreCallFailureReason="+s+", finalReason="+a);var g=this._getProperties(this._slimcoreCallHandler,this.slimcoreCallId,{acceptedElsewherebyId:{propKey:k.Property.CallAcceptedElsewhereByMriIdentity},acceptedElsewherebyDisplayName:{propKey:k.Property.CallAcceptedElsewhereByDisplayName}},{});this.acceptedElsewhereBy={id:g.acceptedElsewherebyId,displayName:g.acceptedElsewherebyDisplayName},this._setCallState(7,n,a,c),this.participants.forEach(function(e){return e.setState(4,n,A.convertFailureReasonToParticipantReason(s))}),this._updateDominantSpeakerList(),this._callOperationHandler.maybeRejectOperation(h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,a,void 0,n),this._callOperationHandler.maybeResolveOperation(h.CALL_OPERATIONS_INTERNAL.CALL_ENDED,a,void 0,n),this.disconnectingPromise=this.cleanUp(n).catch(function(e){i.logFailure("Error when cleaning up the call, callId = "+r.callId+", error = "+e)})}this.raiseChanged()},t.prototype._reportTsCallingTelemetry=function(e){return c(this,void 0,void 0,function(){var t,n=this;return l(this,function(r){switch(r.label){case 0:return e&&this.setupTelemetryReported?[2]:!e&&this.inCallTelemetryReported?[2]:(this._logger.info("[_reportTsCallingTelemetry] connectCallPromise await started"),[4,this.connectCallPromise.catch(function(e){n._logger.info("[_reportTsCallingTelemetry] connectCallPromise error: "+e)})]);case 1:return r.sent(),this._logger.info("[_reportTsCallingTelemetry] connectCallPromise await ended"),t=e?h.TELEMETRY_EVENT_NAMES.CALL_SETUP_NATIVE:h.TELEMETRY_EVENT_NAMES.CALL_IN_CALL_NATIVE,this._callTelemetry.setCallEndDiagnosticInfo(this.callEndDiagnosticsInfo),this._telemetryLoggers&&this._telemetryLoggers.signaling&&this._telemetryLoggers.signaling.sendEvent({eventName:t,props:this._callTelemetry.getEvent(e)}),e?(this.setupTelemetryReported=!0,this._callTelemetry.switchToInCallTelemetry()):this.inCallTelemetryReported=!0,[2]}})})},t.prototype._getTerminatedReason=function(e,n){if(this._isRelayWhiteListingIssue)return 53;if(!d.isUndefined(e)&&e!==k.ParticipantFailureReason.NoFailure)return t.convertParticipantReasonToTerminatedReason(A.convertFailureReasonToParticipantReason(e));if(this.participants.length){var r=d.head(this.participants).getIntProperty(k.Property.ParticipantFailureReason);return t.convertParticipantReasonToTerminatedReason(A.convertFailureReasonToParticipantReason(r))}return n||0},t.prototype._addParticipantToCall=function(e,t){e.setState(1,t),this._logger.info("["+t+"]starting adding participant to call, participantId = "+y.scrubMriOrOmit(e.id))},t.prototype._joinOrStartCall=function(e,t,n){return c(this,void 0,void 0,function(){var r,i;return l(this,function(o){switch(o.label){case 0:if(r=this._logger.createFnLogger("joinOrStartCall",n),0!==this.state&&8!==this.state)throw new Error("Trying to start a call that has already been acted on");this._setIsCast("cast"===t.conversationType),this.label=t.label,this.raiseChanged(),1==(1&t.muteFlags)&&(r.info("isMuted set to true in _joinOrStartCall"),this.isMuted=!0),2==(2&t.muteFlags)&&(r.info("isSpeakerMuted set to true in _joinOrStartCall"),this.isSpeakerMuted=!0),t.isExistingCallInObservingState=8===this.state,1==(1&t.preheatFlags)?(r.info("Call set to preheating in _joinOrStartCall"),this._setCallState(11,n)):(r.info("Call set to connecting in _joinOrStartCall"),this._setCallState(2,n)),i=this._callOperationHandler.createPendingOperation(h.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,n);try{this._joinOrStartSlimCoreCall(e,t,n)}catch(e){throw r.logFailure("sync failure, cleaning up slimcore ready operation: error="+V.getPrintableObject(e)),this._callTelemetry.updateOperationData(h.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,{error:V.getPIISafeObject(e)},n),this._callOperationHandler.rejectOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),this.stopInternal({causeId:n,terminatedReason:7}),e}return 4!==t.videoDirection?[3,2]:(r.info("Call has been started; turning on video"),[4,this.startVideoSafe(n)]);case 1:o.sent(),o.label=2;case 2:return[2,i]}})})},t.prototype._muteUnmute=function(e,t){var n=this,r=this._logger.createFnLogger("muteUnmute",t);if(r.info("muteUnmute, value = "+e+" isMuted = "+this.isMuted+" isServerMuted = "+this.isServerMuted),I.callStateIsAnyOf(this.state,[11,12]))return r.logFailure("Can not mute/unmute during preheat call"),Promise.reject(f.getRejectTransactionEnd(h.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED));var i;return i=e?this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.MUTE):this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UNMUTE),Promise.resolve().then(function(){return n._slimcoreCallHandler.callMute(n.slimcoreCallId,e)}).then(function(){return i}).catch(function(e){throw r.logFailure(e),f.getRejectTransactionEnd(e)})},t.prototype._muteUnmuteSpeaker=function(e,t){var n=this,r=this._logger.createFnLogger("muteUnmuteSpeaker",t);r.info("muteUnmuteSpeaker, value = "+e+" isSpeakerMuted = "+this.isSpeakerMuted);var i;return i=e?this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.MUTE_SPEAKER):this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.UNMUTE_SPEAKER),Promise.resolve().then(function(){return n._slimcoreCallHandler.callMuteSpeaker(n.slimcoreCallId,e)}).then(function(){return i}).then(function(){return n._setMutedSpeaker(e,t)}).catch(function(e){throw r.logFailure(e),e})},t.prototype._muteParticipants=function(e,n,r){var i=this,o=t.convertMuteScope(e),a=this._logger.createFnLogger("muteParticipants",r);if(void 0===o)return a.logFailure("Unrecognized "+e),Promise.reject(new Error("Unrecognized muteScope"));if(I.callStateIsAnyOf(this.state,[11,12]))return a.logFailure("Can not mute/unmute during preheat call"),Promise.reject(60);var s=[];n.forEach(function(e){s.push(e.id)});var c=this._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.MUTE_PARTICIPANTS,"",r);return Promise.resolve().then(function(){return i._slimcoreCallHandler.callMuteParticipants(i.slimcoreCallId,o,s,r),O.hasFeature(k.Feature.AttendeeBlackList)?c:i._callOperationHandler.resolveOperation(h.CALL_OPERATIONS.MUTE_PARTICIPANTS,null,r,r).then()}).catch(function(e){throw a.logFailure("mute participants failed with "+e),e})},t.prototype._holdUnhold=function(e,t,n,r){return c(this,void 0,void 0,function(){var i,o,a,s;return l(this,function(c){switch(c.label){case 0:if(i=4===this.state,(o=this._logger.createFnLogger("holdUnhold",t)).info("_holdUnhold, value: "+e+" currentState: "+i),i===e)return[2,Promise.resolve()];a=!(!r||!r.isLocal),c.label=1;case 1:return c.trys.push([1,6,,7]),this._slimcoreCallHandler.callHold(this.slimcoreCallId,e,n,t,a),e?[4,this._callOperationHandler.waitForOperation(a?h.CALL_OPERATIONS.LOCAL_HOLD:h.CALL_OPERATIONS.HOLD)]:[3,3];case 2:return c.sent(),[3,5];case 3:return[4,this._callOperationHandler.waitForOperation(this._isLocallyHeld?h.CALL_OPERATIONS.LOCAL_UNHOLD:h.CALL_OPERATIONS.UNHOLD)];case 4:c.sent(),c.label=5;case 5:return[3,7];case 6:throw s=c.sent(),o.logFailure(s),s;case 7:return[2]}})})},t.prototype._updateEndpointMetadata=function(e,t){var n=this,r=this._logger.createFnLogger("updateEndpointMetadata",t);return Promise.resolve().then(function(){return n._slimcoreCallHandler.callUpdateEndpointMetadata(n.slimcoreCallId,n._endpointMetadata)}).catch(function(e){throw r.logFailure(e),e})},t.prototype._sendDtmfTone=function(e,n){var r=this,i=this._logger.createFnLogger("sendDtmfTone",n);return Promise.resolve().then(function(){var n=t.convertToSlimCoreDtmfTone(e);if(void 0===n)throw i.logFailure("Unrecognized dtmfTone"),new Error("Unrecognized dtmfTone");try{r._slimcoreCallHandler.callSendDtmf(r.slimcoreCallId,n)}catch(e){throw i.logFailure(e),e}})},t.prototype.setMaxVideoChannels=function(e,t,n){var r=this;void 0===n&&(n=F.generateCauseId());var i=this._logger.createFnLogger("setMaxVideoChannels",n);return i.info("setMaxVideoChannels: "+e),Promise.resolve().then(function(){return r._slimcoreCallHandler.callSetMaxVideoChannels(r.slimcoreCallId,e,t,n),r._isSetVideoChannelsRenegotiated?r._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS):Promise.resolve()}).catch(function(e){throw i.logFailure(e),e})},t.prototype.mapVirtualParticipantMsisToParticipantId=function(e){for(var t=[],n=0,r=e;n<r.length;n++){for(var i=r[n],o=!1,a=0,s=this.participants;a<s.length;a++)for(var c=0,l=s[a].endpoints.endpointDetails;c<l.length;c++){var u=l[c];if(u.mappedTo)for(var d=0,p=u.mediaStreams;d<p.length;d++)p[d].sourceId===i&&(this._logger.info("mapVirtualParticipantMsisToParticipantId: msi="+i+" -> participantId="+u.participantId),t.push(u.participantId),o=!0)}o||(this._logger.info("mapVirtualParticipantMsisToParticipantId: could not find virtual participant for msi="+i),t.push(void 0))}return t},t.prototype.tryResolveMsis=function(){this._logger.info("tryResolveMsis()");var e=d.filter(Array.from(this.mapOfUnresolvedVirtualParticipantMSIs.values()),function(e){return e.unresolvedMsi!==N.SOURCE_NONE}),t=e.map(function(e){return e.unresolvedMsi});this.mapVirtualParticipantMsisToParticipantId(t).forEach(function(t,n){t&&e[n].notify(t)})},t.prototype._setAudioUsageMode=function(e,n){var r=this,i=this._logger.createFnLogger("setAudioUsageMode",n);return Promise.resolve().then(function(){var n=t.convertToSlimCoreAudioUsageMode(e);if(void 0===n)throw new Error("Unrecognized audioUsageMode");r._slimcoreCallHandler.callSetAudioUsageMode(r.slimcoreCallId,n)}).catch(function(e){throw i.logFailure(e),e})},t.prototype._setAudioMidcallConfig=function(e,n,r){var i=this,o=this._logger.createFnLogger("setAudioMidcallConfig",r);return o.info("audioConfig: "+e+" mode: "+n),Promise.resolve().then(function(){var r=t.convertToSlimCoreAudioMidcallConfig(e);if(void 0===r)throw new Error("Unrecognized audioConfig");i._slimcoreCallHandler.callSetAudioMidcallConfig(i.slimcoreCallId,r,n)}).catch(function(e){throw o.logFailure(e),e})},t.prototype._setAudioMidcallConfigJson=function(e,t){var n=this,r=this._logger.createFnLogger("setAudioMidcallConfigJson",t);return r.info("audioConfigJson: "+e+" "+JSON.stringify(e)),Promise.resolve().then(function(){n._slimcoreCallHandler.callSetAudioMidcallConfigJson(n.slimcoreCallId,JSON.stringify(e))}).catch(function(e){throw r.logFailure(e),e})},t.prototype._getParticipant=function(e){return this.participantMap.hasOwnProperty(e)?this.participantMap[e]:void 0},t.prototype._getOrCreateParticipant=function(e,t,n,r){var i,o=this,a=8===this.state;if(this.participantMap.hasOwnProperty(e)){var s=this.participantMap[e];return n&&s.attachSlimcoreObjectId(n,t,a,r),s}return(i=new E.default(this._logger,this._settings,this._slimcoreInstance,e,this._slimcoreCallHandler,this._streamContextMap,n,this._callTelemetry,this.createVirtualParticipantMSIToParticipantIdMapper,a,r)).changed(function(){return o._participantChangedCallback(i)}),this._addParticipantEntry(i),this._monitorCallStart(),this.event("participantAdded").raise(i),this._removeCallChangeOnParticipantChanges||this.raiseChangedDeferred(),i},t.prototype._participantChangedCallback=function(e){var t=this;e.previousId&&(this._callOperationHandler.updateOperationId(e.previousId,e.id),this._participantOperationHandler.updateOperationId(e.previousId,e.id),e.previousId=null);var n=this._getlocalScreenShareStream();d.each(e.streams[1],function(r){n&&!t._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.START_SCREEN_SHARING)&&r.isAvailable&&(O.forgetAndLog(t.stopScreenSharing(!0),t._logger,"ParticipantChanged: Cleaning up local screenshare because remote screenshare is running"),t.event("sharingStolen").raise()),t.screenSharingControl&&t.screenSharingControl.isScreenSharingControlEnabled()&&(t.screenSharingControl.reportSharingSessionChangeForViewer(e,r.negotiationTag),r.isActive()&&t.localEndpointDetails&&"nonInteractive"!==t.localEndpointDetails.appliedInteractivityLevel?t.screenSharingControl.initControlForViewer(e,r.negotiationTag):t.screenSharingControl.shutdownControlForViewer(e))}),this._enableVirtualParticipantMsiMapping&&e.endpoints.endpointDetails.some(function(e){return!!e.mappedTo})&&this.tryResolveMsis(),this._updateDominantSpeakerListDeferred(),this.event("participantUpdated").raise(e),this._removeCallChangeOnParticipantChanges||this.raiseChangedDeferred()},t.prototype._setCallState=function(e,n,r,i){if(this.state!==e){var o=this._logger.createFnLogger("setCallState",n);if(o.info("currentState="+this.state+", newState="+e+", terminatedReason="+this.terminatedReason),I.validStateTransitions[this.state].indexOf(e)>=0){if(this.state=e,this._onDiagnosticsCodeChanged(i),this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_CALL_STATE,{state:e,reason:r},n),3===e)this._callGotConnected=!0,this.callHeldAt=null;else if(5!==e&&4!==e||this.callHeldAt){if(7===e){this.terminatedReason=r,this._setFailureType(t.convertTerminatedReasonToFailureType(r,this._callGotConnected,this._wasAudioStreamConnected));var a={};this.callEndDiagnosticsInfo&&(a.code=this.callEndDiagnosticsInfo.callControllerCode,a.subCode=this.callEndDiagnosticsInfo.callControllerSubCode,a.phrase=this.callEndDiagnosticsInfo.phrase,a.resultCategories=this.callEndDiagnosticsInfo.resultCategories),this._callTelemetry.updateOperationData(h.CALL_OPERATIONS_INTERNAL.SET_CALL_STATE,{transactionEnd:a},n)}}else this.callHeldAt=new Date;this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.callStateChanged(this.state),this.ptzHandler&&this.ptzHandler.callStateChanged(this.state),o.logSuccess("changed to "+e+", terminatedReason: "+this.terminatedReason+", failureType="+this.failureType),this._startInitialVideoIfReady(n),this._monitorCallStart(),this.event("callStateChanged").raise(),this._updateCapabilities(n),this.raiseChanged()}else this._logger.warn("invalid state transition")}},t.prototype._setVideoOn=function(e,t){this.isVideoOn!==e&&(this.isVideoOn=e,this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_LOCAL_VIDEO,{value:e},t),this.raiseChanged())},t.prototype._setScreenSharingOn=function(e,t){this.isScreenSharingOn!==e&&(this.isScreenSharingOn=e,this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_SCREEN_SHARING,{value:e},t),this.raiseChanged()),this.event("userActivityChanged").raise()},t.prototype._setMutedSpeaker=function(e,t){this.isSpeakerMuted!==e&&(this.isSpeakerMuted=e,this._callTelemetry.recordEvent(h.CALL_OPERATIONS_INTERNAL.SET_MUTED_SPEAKER,{value:e},t),this.raiseChanged())},t.prototype._monitorCallStart=function(){!this.callStartedAt&&3===this.state&&this.participants.length&&(this.callStartedAt=new Date)},t.prototype._addParticipantEntry=function(e){this.participantMap[e.id]=e,this.participants.push(e)},t.prototype._removeParticipantEntry=function(e){if(!this.participantMap.hasOwnProperty(e))return null;var t=this.participantMap[e];return delete this.participantMap[e],d.pull(this.participants,t),t&&this.raiseChanged(),t},t.prototype._onGroupIdChanged=function(e){e&&this.groupId!==e&&(this._logger.info("_onGroupIdChanged groupId: "+y.scrubMriOrOmit(e)+" this.groupId: "+y.scrubMriOrOmit(this.groupId)),this.groupId=e,this.event("groupIdChanged").raise(e))},t.prototype._onThreadIdChanged=function(e){e&&this.threadId!==e&&(this._logger.info("_onThreadIdChanged threadId: "+y.getLoggableThreadId(e)+" this.threadId: "+y.getLoggableThreadId(this.threadId)),this.threadId=e,this.raiseChanged())},t.prototype._onMessageIdChanged=function(e){e&&this.messageId!==e&&(this._logger.info("_onMessageIdChanged messageId: "+e+" this.messageId: "+this.messageId),this.messageId=e,this.raiseChanged())},t.prototype._onSelfParticipantRoleChanged=function(e){e!==this.role&&(this._logger.info("Role for self is set to "+e),this.role=e,this.raiseChanged())},t.prototype._updateMeetingRole=function(e){e!==this.meetingRole&&(this.meetingRole=e,this._logger.info("_updateMeetingRole: "+this.meetingRole),this.event("meetingRoleUpdated").raise(this.meetingRole),this.raiseChanged())},t.prototype._updateTransferorMri=function(e){var t=_.stripMriAliases(e);t!==this.transferorMri&&(this.transferorMri=t,this._logger.info("_transferorMri: "+this.transferorMri),this.raiseChanged())},t.prototype._updateClientTransferContext=function(e){try{e&&(this.clientTransferContext=JSON.parse(e),this._logger.info("_updateClientTransferContext updated:\n                    clientTransferContext = "+e),this.raiseChanged())}catch(t){this._logger.info("Failed to parse clientTransferContext. Error: "+t+",\n                clientTransferContext json string = "+e)}},t.prototype._updateActiveVideoChannelCount=function(e){e!==this.activeVideoChannelCount&&(this._logger.info("_updateActiveVideoChannelCount to "+e),this.activeVideoChannelCount=e,this.raiseChanged())},t.prototype._onSelfParticipantTenantIdChanged=function(e){e!==this.tenantId&&(this._logger.info("TenantId for self is set to "+e),this.tenantId=e,this.raiseChanged())},t.prototype._updateEndpointDetails=function(e){var t=this,n=F.generateCauseId();if(this._logger.info("["+n+"] [_updateEndpointDetails] rawEndpointDetails "+e),this._rawEndpoints!==e&&e){try{this.endpoints=JSON.parse(e),this._rawEndpoints=e,this.endpoints.endpointDetails.forEach(function(e){e.endpointId===t._endpointId&&t._updateLocalEndpointDetails(e),e.originalId&&t._participantOperationHandler.maybeResolveOperation(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK,null,e.originalId,n)})}catch(t){this._logger.info("["+n+"]Failed to parse raw endpoint details. Error: "+t+", EndpointDetails: "+e)}this._updateCapabilities(n),this.raiseChanged()}},t.prototype._updateLocalEndpointDetails=function(e){var t=this.localEndpointDetails;if(this.localEndpointDetails=e,e&&(!t||t.appliedInteractivityLevel!==e.appliedInteractivityLevel))for(var n=0,r=this.participants;n<r.length;n++){var i=r[n],o=i.streams[1];o&&o.length&&this._participantChangedCallback(i)}},t.prototype._updateMeetingDetails=function(e){if(this._rawMeetingDetails!==e)try{!e||d.isEmpty(e)?this.meetingDetails=null:this.meetingDetails=JSON.parse(e),this._rawMeetingDetails=e,this.raiseChanged()}catch(t){this._logger.warn("Failed to parse the raw meeting details. Error: "+t+", MeetingDetails: "+e)}},t.prototype._onBreakoutDetailsUpdated=function(e){this._logger.info("_onBreakoutDetailsUpdated: breakoutDetailsJsonString="+e);try{!e||d.isEmpty(e)?this.breakoutDetails=null:this.breakoutDetails=JSON.parse(e),this.raiseChanged()}catch(t){this._logger.warn("Failed to parse breakoutDetailsJsonString="+e)}},t.prototype._onBroadcastMetadataChanged=function(e){if(e)try{this.broadcastMetadata=JSON.parse(e),this._logger.info("broadcast metadata updated"),this.broadcastMeeting&&this.broadcastMeeting.metadataChanged(e),this.raiseChanged()}catch(e){this._logger.info("broadcast metadata invalid, failed to parse")}},t.prototype._onCallProgressStatusChanged=function(e){e!==this._callProgressStatus&&(this._callProgressStatus=e,this.callProgressStatus=e,this.event("callProgressStatusChanged").raise(e))},t.prototype._getParticipantByObjectId=function(e){return d.find(this.participants,function(t){return t.slimcoreObjectId===e})},t.prototype._onQualityChanged=function(e){if(this._logger.info("onQualityChanged: oid="+e.objectId+", mtype="+e.mediaType+", otype="+e.objectType+", type="+e.type+", value="+e.value),!(e.mediaType!==k.MediaType.Audio&&e.mediaType!==k.MediaType.Video&&e.mediaType!==k.MediaType.Data||e.objectType===k.ObjectType.Call&&e.objectId!==this.slimcoreCallId)){var n={type:t.convertQualityEventType(e.type),value:t.convertQualityLevel(e.value),mediaType:t.convertMediaType(e.mediaType),isLocalSource:e.objectType===k.ObjectType.Call};if(e.objectType===k.ObjectType.Participant){var r=this._getParticipantByObjectId(e.objectId);if(!r)return;n.id=r.id}n.type&&n.value&&(e.mediaType===k.MediaType.Audio&&e.type===k.QualityEventType.RelayWhiteListing?(this._isRelayWhiteListingIssue=!0,this.event("mediaConnectionWhitelistingWarning").raise(),this.event("mediaConnectionFailed").raise()):this.event("callQualityChanged").raise(n))}},t.prototype.getContentSharing=function(e){var t=this._slimcoreInstance.getContentSharing(e);return t?O.wrap(t,this._settings):null},t.prototype.createContentSharingSession=function(e,t,n,r){var i=this;return Promise.resolve().then(function(){var o=i._slimcoreCallHandler.createContentSharing(i.slimcoreCallId,e,t,n,r);if(!o)throw new Error("Failed to create ContentSharing SlimCore object");var a=i.getContentSharing(o);if(!a)throw new Error("Failed to create ContentSharing SlimCore native object");var s=new P.default(i._logger,i._settings,i._slimcoreInstance,i._slimcoreCallHandler,o,a,i._callTelemetry);return i.contentSharingSessions.push(s),i.event("contentSharingChanged").raise(),s})},t.prototype._onContentSharingChanged=function(e){var t=this;void 0===e&&(e=F.generateCauseId());var n=this._slimcoreCallHandler.getContentSharingSessions(this.slimcoreCallId),r=!1;d.remove(n,function(e){return t._getIntProperty(t._slimcoreCallHandler,e,SlimCore.Enums.Property.ContentSharingCallId)!==t.slimcoreCallId});var i=d.remove(this.contentSharingSessions,function(e){return-1===d.indexOf(n,e.slimCoreContentSharingObjectId)});d.forEach(n,function(e){if(!d.find(t.contentSharingSessions,function(t){return t.slimCoreContentSharingObjectId===e})){var n=t.getContentSharing(e);if(n){var i=new P.default(t._logger,t._settings,t._slimcoreInstance,t._slimcoreCallHandler,e,n,t._callTelemetry);t.contentSharingSessions.push(i),t._logger.info("Added new content sharing session with guid "+i.contentSharingGuid),r=!0}}}),i.forEach(function(n){t._logger.info("Removed content sharing session with guid "+n.contentSharingGuid),n.setContentSharingStatus(7),n.dispose(e)}),(r||i.length)&&this.event("contentSharingChanged").raise()},t.prototype.raiseChangedDeferred=function(){var e=this;this._raiseChangedDefer||(this._raiseChangedDefer=d.defer(function(){delete e._raiseChangedDefer,e.raiseChanged()}))},t.prototype._onParticipantJoinedOrRemovedDeferred=function(e){var t=this;void 0===e&&(e=F.generateCauseId()),this._onParticipantJoinedOrRemovedDefer||(this._onParticipantJoinedOrRemovedDefer=d.defer(function(){delete t._onParticipantJoinedOrRemovedDefer,t._onParticipantJoinedOrRemoved(e)}))},t.prototype._updateDominantSpeakerListDeferred=function(){var e=this;this._updateDominantSpeakerListDefer||(this._updateDominantSpeakerListDefer=d.defer(function(){delete e._updateDominantSpeakerListDefer,e._updateDominantSpeakerList()}))},t.prototype.callStateCanToggleVideo=function(){return 2!==this._mode&&(3===this.state||4===this.state||5===this.state||13===this.state||10===this.state)},t.prototype._startInitialVideoIfReady=function(e){return c(this,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return this.callStateCanToggleVideo()&&this._videoRequestedOnWhileConnecting?(this._logger.info("["+e+"]Call has been started; turning on video"),this._videoRequestedOnWhileConnecting=!1,[4,this.startVideoSafe(e)]):[3,2];case 1:return t.sent(),[3,4];case 2:return this.callStateCanToggleVideo()&&this._videoRequestedOffWhileConnecting?(this._logger.info("["+e+"]Call has been started and video turned on; turning off video"),this._videoRequestedOffWhileConnecting=!1,[4,this.stopVideo(e)]):[3,4];case 3:t.sent(),t.label=4;case 4:return[2]}})})},t.convertConnectionType=function(e){switch(e){case 0:return k.ConnectionType.AllSupported;case 1:return k.ConnectionType.NoDirectConnection;default:return k.ConnectionType.AllSupported}},t.convertStatusToTerminatedReason=function(e){switch(e){case k.CallStatus.Failed:return 7;case k.CallStatus.Finished:return 1;case k.CallStatus.Missed:return 9;case k.CallStatus.Refused:return 10;case k.CallStatus.Busy:return 11;case k.CallStatus.Cancelled:case k.CallStatus.Unplaced:return 12;case k.CallStatus.Dropped:return 4;case k.CallStatus.DeniedInLobby:return 55;case k.CallStatus.TimedOutInLobby:return 56;default:return 0}},t.convertParticipantReasonToTerminatedReason=function(e){switch(e){case 0:return 1;case 1:case 5:case 6:case 7:case 43:return 5;case 23:return 12;case 46:return 59;case 59:return 73;case 2:return 9;case 3:return 10;case 4:return 2;case 8:return 24;case 9:return 3;case 10:return 4;case 12:return 14;case 11:return 0;case 13:return 15;case 14:return 16;case 15:return 17;case 16:return 18;case 17:return 19;case 18:return 20;case 19:return 11;case 20:return 21;case 21:return 22;case 22:return 23;case 25:return 33;case 26:return 36;case 27:return 37;case 30:return 41;case 28:return 39;case 31:return 42;case 29:return 40;case 32:return 43;case 33:return 44;case 34:return 45;case 35:return 46;case 36:return 47;case 37:return 48;case 38:return 49;case 39:return 50;case 40:return 51;case 41:return 52;case 42:return 54;case 47:return 61;case 53:return 66;case 54:return 67;case 55:return 68;case 56:return 69;case 57:return 71;case 58:return 72;default:return 0}},t.convertTerminatedReasonToFailureType=function(e,t,n){switch(e){case 0:case 1:case 9:case 10:case 11:case 12:case 2:case 60:return 2;case 3:case 5:case 6:case 7:case 8:case 14:case 36:case 37:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 44:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 59:case 73:case 66:case 67:case 68:case 69:case 71:case 72:return 0;case 4:return t&&n?1:0;default:return 2}},t.convertToSlimCoreDtmfTone=function(e){switch(e){case 0:return k.DtmfTone.Num0;case 1:return k.DtmfTone.Num1;case 2:return k.DtmfTone.Num2;case 3:return k.DtmfTone.Num3;case 4:return k.DtmfTone.Num4;case 5:return k.DtmfTone.Num5;case 6:return k.DtmfTone.Num6;case 7:return k.DtmfTone.Num7;case 8:return k.DtmfTone.Num8;case 9:return k.DtmfTone.Num9;case 10:return k.DtmfTone.Star;case 11:return k.DtmfTone.Pound;case 12:return k.DtmfTone.A;case 13:return k.DtmfTone.B;case 14:return k.DtmfTone.C;case 15:return k.DtmfTone.D;case 16:return k.DtmfTone.Flash;default:return}},t.convertToSlimCoreAudioUsageMode=function(e){switch(e){case"Default":return k.AudioUsageMode.Default;case"LongrangeSpeaker":return k.AudioUsageMode.LongrangeSpeaker;case"Auditorium":return k.AudioUsageMode.Auditorium;default:return}},t.convertToSlimCoreAudioMidcallConfig=function(e){switch(e){case"Default":return k.AudioConfig.Default;case"NoiseSuppression":return k.AudioConfig.NoiseSuppression;case"SpeechRecognition":return k.AudioConfig.SpeechRecognition;case"Recording":return k.AudioConfig.Recording;default:return}},t.convertQualityEventType=function(e){switch(e){case k.QualityEventType.NetworkSendQuality:return 1;case k.QualityEventType.NetworkRecvQuality:return 2;case k.QualityEventType.NetworkDelay:return 3;case k.QualityEventType.NetworkBandwidthLow:return 4;case k.QualityEventType.NetworkReconnect:return 5;case k.QualityEventType.NetworkPacketLoss:return 6;case k.QualityEventType.NetworkJitter:return 7;case k.QualityEventType.NetworkRateMatching:return 8;case k.QualityEventType.DeviceCaptureNotFunctioning:return 9;case k.QualityEventType.DeviceRenderNotFunctioning:return 10;case k.QualityEventType.DeviceRenderGlitches:return 11;case k.QualityEventType.DeviceLowSNR:return 12;case k.QualityEventType.DeviceLowSpeechLevel:return 13;case k.QualityEventType.DeviceClipping:return 14;case k.QualityEventType.DeviceEcho:return 15;case k.QualityEventType.PresentationAudioQuality:return 16;case k.QualityEventType.DeviceHalfDuplexAec:return 17;case k.QualityEventType.DeviceMultipleEndpoints:return 18;case k.QualityEventType.DeviceHowling:return 19;case k.QualityEventType.DeviceRenderZeroVolume:return 20;case k.QualityEventType.DeviceRenderMute:return 21;case k.QualityEventType.NetworkSendCatastrophic:return 22;case k.QualityEventType.NetworkRecvCatastrophic:return 23;case k.QualityEventType.CpuInsufficient:return 24;case k.QualityEventType.DeviceCaptureMute:return 25;case k.QualityEventType.DeviceCaptureNotMuteButSilent:return 26;case k.QualityEventType.DeviceSpeakWhileMuted:return 27;case k.QualityEventType.VideoVbssRendered:return 28;case k.QualityEventType.NetworkEthernetInterfaceUsed:return 29;case k.QualityEventType.NetworkWlanInterfaceUsed:return 30;case k.QualityEventType.NetworkWwanInterfaceUsed:return 31;case k.QualityEventType.RelayWhiteListing:return 32;case k.QualityEventType.VideoCapturerDeviceStartFailed:return 33;case k.QualityEventType.VideoCapturerDeviceStartTimedOut:return 34;case k.QualityEventType.VideoCapturerDeviceStartFailureLackSystemRes:return 35;case k.QualityEventType.VideoCapturerDeviceStartFailureMFResConflict:return 36;case k.QualityEventType.ZeroCaptureDevicesEnumerated:return 43;case k.QualityEventType.ZeroRenderDevicesEnumerated:return 44;case k.QualityEventType.NoNetwork:return 37;case k.QualityEventType.NetworkNotWorking:return 38;case k.QualityEventType.DeviceCaptureNotFunctioningAudioSrvNotRunning:return 41;case k.QualityEventType.DeviceRenderNotFunctioningAudioSrvNotRunning:return 42;case k.QualityEventType.DeviceCaptureNotFunctioningDeviceInUse:return 39;case k.QualityEventType.DeviceRenderNotFunctioningDeviceInUse:return 40;case k.QualityEventType.VideoCaptureDeviceFreeze:return 45;case k.QualityEventType.AudioCapturePermissionDenied:return 46;case k.QualityEventType.VideoCapturePermissionDenied:return 47;case k.QualityEventType.VideoCaptureFreezeRecovered:return 48;case k.QualityEventType.DeviceRenderHowling:return 49;case k.QualityEventType.LowFarEndInput:return 50;case k.QualityEventType.RemoteNetworkConnectivityIssue:return 52;case k.QualityEventType.PresentationAudioLoopbackDeviceState:return 53;case k.QualityEventType.AudioCaptureUltrasoundDetected:return 54;case k.QualityEventType.MultichannelAudioBandwidth:return 56;case k.QualityEventType.MusicModeNotAvailable:return 57;case k.QualityEventType.MusicModeSupported:return 58;case k.QualityEventType.AudioCaptureMusicDetectedWithHighNS:return 59;case k.QualityEventType.AudioCaptureMusicDetectedWithLowNS:return 60;case k.QualityEventType.ImageRenderingQuality:return 51;case k.QualityEventType.CameraLighting:return 61;default:return}},t.convertQualityLevel=function(e){switch(e){case k.QualityLevel.Unknown:return 0;case k.QualityLevel.Good:return 1;case k.QualityLevel.Poor:return 2;case k.QualityLevel.Bad:return 3;default:return}},t.convertMediaType=function(e){switch(e){case k.MediaType.Audio:return 0;case k.MediaType.Video:return 1;case k.MediaType.AppSharing:return 2;case k.MediaType.Data:return 3;default:return}},t.toMediaDirection=function(e){switch(e){case 0:return k.MediaDirection.Disabled;case 3:return k.MediaDirection.Inactive;case 2:return k.MediaDirection.SendToPeer;case 1:return k.MediaDirection.ReceiveFromPeer;case 4:return k.MediaDirection.Bidirectional;default:return k.MediaDirection.Disabled}},t.toAnswerMediaType=function(e){switch(e){case 0:return k.AnswerMediaType.AnswerWithAudioOnly;case 1:return k.AnswerMediaType.AnswerWithAudioVideo;case 2:return k.AnswerMediaType.AnswerWithScreenshareOnly;default:return k.AnswerMediaType.AnswerWithAudioOnly}},t.convertMuteScope=function(e){switch(e){case 0:return k.MuteScope.All;case 1:return k.MuteScope.Specified;default:return}},t.convertToSlimCoreMediaPeerType=function(e){switch(e){case 0:return k.MediaPeerType.ConsumerTwoParty;case 1:return k.MediaPeerType.ConsumerPstn;case 2:return k.MediaPeerType.ConsumerMultiParty;case 3:return k.MediaPeerType.EnterpriseTwoPartyOnlineOnly;case 4:return k.MediaPeerType.EnterpriseTwoPartyHybrid;case 6:return k.MediaPeerType.EnterprisePstnOnlineOnly;case 7:return k.MediaPeerType.EnterprisePstnHybrid;case 5:return k.MediaPeerType.EnterpriseMultiParty;case 8:return k.MediaPeerType.EnterpriseFederated;case 9:return k.MediaPeerType.EnterpriseUnknown;case 10:return k.MediaPeerType.EnterpriseMultiPartyBroadcasting;default:return}},t.convertPushHandlingResult=function(e){switch(e){case k.PushHandlingResult.BadNotificationPayload:return{code:0,fatal:!0};case k.PushHandlingResult.CallSetupSucceeded:return{code:1,success:!0};case k.PushHandlingResult.BadNotificationEventType:return{code:3,fatal:!0};case k.PushHandlingResult.CallSetupSucceededCallAlreadyExists:return{code:4};case k.PushHandlingResult.CallSetupFailedCannotConnect:return{code:5,fatal:!0};case k.PushHandlingResult.CallSetupFailedNoSignaling:return{code:6,fatal:!0};case k.PushHandlingResult.CallSetupFailedConflict:return{code:7};case k.PushHandlingResult.CallSetupFailedPushIgnored:return{code:8};case k.PushHandlingResult.CallSetupFailedAnsweredElsewhere:return{code:9};case k.PushHandlingResult.CallSetupFailedAlreadyEnded:return{code:10};case k.PushHandlingResult.CallSetupProgress:return{code:11,success:!0};case k.PushHandlingResult.CallSetupFailed:case k.PushHandlingResult.CallSetupFailedNoPermission:case k.PushHandlingResult.CallSetupFailedNoCommonCodec:default:return{code:2,fatal:!0}}},Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAudioStreamConnected",{get:function(){return this._isAudioStreamConnected},set:function(e){this._isAudioStreamConnected!==e&&(this._isAudioStreamConnected=e,this._wasAudioStreamConnected=this._wasAudioStreamConnected||e,this.raiseChanged())},enumerable:!1,configurable:!0}),t.isCallConnected=function(e){return e===k.CallStatus.InProgress},t.isObserving=function(e){return e===k.CallStatus.Observing},t.isCallRinging=function(e){switch(e){case k.CallStatus.RingingOut:case k.CallStatus.RingingIn:return!0;default:return!1}},t.isCallConnecting=function(e){return e===k.CallStatus.Routing},t.isCallEarlyMedia=function(e){return e===k.CallStatus.EarlyMedia},t.isCallInLobby=function(e){return e===k.CallStatus.InLobby},t.isCallPreheating=function(e){return e===k.CallStatus.Preheating},t.isCallPreheated=function(e){return e===k.CallStatus.Preheated},t.isCallStaging=function(e){return e===k.CallStatus.Staging},t.isCallTerminated=function(e){switch(e){case k.CallStatus.Missed:case k.CallStatus.Refused:case k.CallStatus.Busy:case k.CallStatus.Cancelled:case k.CallStatus.Finished:case k.CallStatus.Failed:case k.CallStatus.Dropped:case k.CallStatus.DeniedInLobby:case k.CallStatus.TimedOutInLobby:case k.CallStatus.CallTimedOut:return!0;default:return!1}},t.prototype._cleanRealTimeCallResources=function(e){return c(this,void 0,void 0,function(){var t,n,r,i,o;return l(this,function(a){switch(a.label){case 0:t=this._logger.createFnLogger("cleanRealTimeCallResources",e),a.label=1;case 1:return a.trys.push([1,10,,11]),this.videoLayout?[4,this.videoLayout.dispose(e)]:[3,3];case 2:a.sent(),a.label=3;case 3:return n=d.map(this.participants,function(n){return O.forgetAndLog(n.stopVideos(e),t,"cleanRealTimeCallResources: stopping participant videos")}),[4,Promise.all(n)];case 4:return a.sent(),(r=this._getlocalScreenShareStream())?[4,O.forgetAndLog(this.stopScreenSharing(!1,e),t,"cleanRealTimeCallResources: LocalScreenShare stop")]:[3,6];case 5:a.sent(),a.label=6;case 6:return(i=this._getLocalVideo())?[4,O.forgetAndLog(i.stop(e),t,"cleanRealTimeCallResources: LocalVideo stop")]:[3,9];case 7:return a.sent(),[4,this.cleanupLocalVideo(e)];case 8:a.sent(),a.label=9;case 9:return[3,11];case 10:throw o=a.sent(),t.error(o),o;case 11:return[2]}})})},t.prototype._cleanCallResources=function(e){return c(this,void 0,void 0,function(){var t,n;return l(this,function(r){switch(r.label){case 0:t=this._logger.createFnLogger("cleanCallResources",e),r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this._cleanRealTimeCallResources(e)];case 2:return r.sent(),this.contentSharingSessions.forEach(function(t){t.setContentSharingStatus(7),t.dispose(e)}),this.contentSharingSessions=[],[3,5];case 3:return n=r.sent(),t.error(n),[3,5];case 4:return this.dispose(e),[7];case 5:return[2]}})})},t.prototype.dispose=function(t){var n=this._logger.createFnLogger("dispose",t);n.info("start"),this.subscriptions.length&&n.info(this.subscriptions.length+" subscriptions will be lost"),this.videoLayout&&this.videoLayout.dispose(t),this._slimCoreElectronRemoteManager&&this._slimCoreElectronRemoteManager.dispose(t),this.mediaStreams[0]=[],this.mediaStreams[1]=[];var r=this._getlocalScreenShareStream();r&&r.dispose(t);var i=this._getLocalVideo();i&&i.dispose(t),this.localMediaStreams=[],this.screenSharingControl&&(this.screenSharingControl.dispose(t),this.screenSharingControl=null),this.ptzHandler&&(this.ptzHandler.dispose(t),this.ptzHandler=null),this.dataChannelAdapter&&(this.dataChannelAdapter.dispose(),this.dataChannelAdapter=null),this._dataChannel&&(this._dataChannel.dispose(t),this._dataChannel=null),this._dataChannelUsers&&(this._dataChannelUsers=null),this.participants.forEach(function(e){return e.dispose(t)}),e.prototype.dispose.call(this,t)},t.prototype.testTriggerMediaRelayWhiteListingIssue=function(){throw new Error("testTriggerMediaRelayWhiteListingIssue not implemented in electron call")},t.prototype.testSetCallState=function(e){this._logger.info("Overwriting call state for test purposes: "+this.state+" -> "+e),this.state=e},t.prototype.addGroupModality=function(e,t){var n=this;void 0===t&&(t=F.generateCauseId());var r=this._logger.createFnLogger(h.CALL_OPERATIONS.ADD_GROUP_MODALITY,t);if(0===this.slimcoreCallId)return Promise.reject(new Error("call is not initialized yet"));var i=e.additionalData?JSON.stringify(e.additionalData):"";return r.info("groupId = "+y.scrubMriOrOmit(e.groupId)+" threadId = "+y.getLoggableThreadId(e.threadId)+" messageId = "+e.messageId+" additionalData = "+y.scrubMriOrOmit(i)),Promise.resolve().then(function(){return n._slimcoreCallHandler.addGroupModality(n.slimcoreCallId,e.threadId,e.messageId,i,t,e.groupId)}).catch(function(e){throw r.logFailure(e),e})},t.prototype.addBroadcastModality=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,t);return this._callOperationHandler.hasPendingOperation(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY)?this._callOperationHandler.getPendingOperation(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY):Promise.resolve().then(function(){n._slimcoreCallHandler.addBroadcastModality(n.slimcoreCallId,JSON.stringify(e),t)}).catch(function(e){return Promise.reject(f.getRejectTransactionEnd(e))}).then(function(){return n._callOperationHandler.waitForOperation(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,t)}).catch(function(e){throw n._callTelemetry.updateOperationData(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,{error:V.getPIISafeObject(e)},t),r.logFailure(e),e})},t.prototype.getMediaTelemetry=function(){return Promise.reject("Not supported")},t.prototype.getMediaLogs=function(){return Promise.reject("Not supported")},t.prototype.getVideoMediaStates=function(e){var t=this,n=[],r=function(e){n.push({mediaType:1,label:t._deviceManager.getLabelByCameraPosition(e)})},i=this._deviceManager.getChildCameras(e.id);return d.isEmpty(i)?r(e):i.forEach(r),n},t.prototype.getSlimcoreEnumLevel=function(e){switch(e){case"user":return k.PublishStateLevel.PublishStateUser;case"endpoint":return k.PublishStateLevel.PublishStateEndpoint;default:throw"Invalid level type."}},t.prototype._onCallLimitsUpdated=function(e){if(this._logger.info("_onCallLimitsUpdated: CallLimits="+e),e&&this._rawCallLimits!==e)try{this.callLimits=JSON.parse(e),this._rawCallLimits=e,this.raiseChanged()}catch(t){this._logger.warn("Failed to parse the raw call limits data. Error: "+t+", CallLimits: "+e)}},o([m.callOperation(h.CALL_OPERATIONS.INITIALIZE,{type:m.OPERATION_TYPE.SYNC,convertError:!0,idempotencyLevel:m.IDEMPOTENCY_LEVEL.NO_OP}),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],t.prototype,"init",null),o([m.callOperation(h.CALL_OPERATIONS.JOIN_CALL,{type:m.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:m.IDEMPOTENCY_LEVEL.ERROR}),s(1,m.callStartOptions),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object,Object]),a("design:returntype",Promise)],t.prototype,"join",null),o([m.callOperation(h.CALL_OPERATIONS.START_CALL,{type:m.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:m.IDEMPOTENCY_LEVEL.ERROR}),s(0,m.callStartOptions),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"start",null),o([m.callOperation(h.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{type:m.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:m.IDEMPOTENCY_LEVEL.ERROR}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"startCallToVoicemail",null),o([m.callOperation(h.CALL_OPERATIONS.START_WITH_MEETING_DATA,{type:m.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:m.IDEMPOTENCY_LEVEL.ERROR}),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"startWithMeetingData",null),o([m.callOperation(h.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,{type:m.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:m.IDEMPOTENCY_LEVEL.ERROR}),a("design:type",Function),a("design:paramtypes",[String,Object,Object]),a("design:returntype",Promise)],t.prototype,"joinWithMeetingData",null),o([m.callOperation(h.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,{type:m.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:m.IDEMPOTENCY_LEVEL.ERROR}),a("design:type",Function),a("design:paramtypes",[String,Object,Object]),a("design:returntype",Promise)],t.prototype,"subscribeWithMeetingData",null),o([m.callOperation(h.CALL_OPERATIONS.START_CALL_WITH_NUDGE,{type:m.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:m.IDEMPOTENCY_LEVEL.ERROR}),s(1,m.callStartOptions),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[Array,Object,Object]),a("design:returntype",Promise)],t.prototype,"startCallWithNudge",null),o([m.callOperation(h.CALL_OPERATIONS.START_CALL_AND_UNPARK,{type:m.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:m.IDEMPOTENCY_LEVEL.ERROR,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(2,m.callStartOptions),s(3,m.causeId),a("design:type",Function),a("design:paramtypes",[Number,String,Object,Object]),a("design:returntype",Promise)],t.prototype,"startAndUnpark",null),o([m.callOperation(h.CALL_OPERATIONS.SUBSCRIBE,{type:m.OPERATION_TYPE.CHAINED,triggerAttach:!0,idempotencyLevel:m.IDEMPOTENCY_LEVEL.ERROR}),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object,Object]),a("design:returntype",Promise)],t.prototype,"joinCallWithoutCallModality",null),o([m.callOperation(h.CALL_OPERATIONS.JOIN_PREHEATED_CALL,{waitFor:h.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"joinPreheatedCall",null),o([m.callOperation(h.CALL_OPERATIONS.START_VIDEO,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"startVideo",null),o([m.callOperation(h.CALL_OPERATIONS.STOP_VIDEO,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"stopVideo",null),o([m.callOperation(h.CALL_OPERATIONS_INTERNAL.START_LOCAL_VIDEO,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,String]),a("design:returntype",Promise)],t.prototype,"_startLocalVideo",null),o([m.callOperation(h.CALL_OPERATIONS.DUMP_VIDEO_SOURCE_IMAGES,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"dumpVideoSourceImages",null),o([m.callOperation(h.CALL_OPERATIONS.START_SCREEN_SHARING,{type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(3,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object,String,Object]),a("design:returntype",Promise)],t.prototype,"startScreenSharing",null),o([m.callOperation(h.CALL_OPERATIONS.STOP_SCREEN_SHARING,{type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[Boolean,String,Object]),a("design:returntype",Promise)],t.prototype,"stopScreenSharing",null),o([m.callOperation(h.CALL_OPERATIONS.START_DATA_CHANNEL,{type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"startDataChannel",null),o([m.callOperation(h.CALL_OPERATIONS.STOP_DATA_CHANNEL,{type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"stopDataChannel",null),o([m.callOperation(h.CALL_OPERATIONS.SHARE_SYSTEM_SOUNDS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),a("design:type",Function),a("design:paramtypes",[Boolean]),a("design:returntype",Promise)],t.prototype,"shareSystemSound",null),o([m.callOperation(h.CALL_OPERATIONS.START_FACESTREAM,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),a("design:type",Function),a("design:paramtypes",[String,Number]),a("design:returntype",Promise)],t.prototype,"startFaceStream",null),o([m.callOperation(h.CALL_OPERATIONS.STOP_FACESTREAM,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"stopFaceStream",null),o([m.callOperation(h.CALL_OPERATIONS.START_MULTICHANNEL_AUDIO_DEVICE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),a("design:type",Function),a("design:paramtypes",[String,Number]),a("design:returntype",Promise)],t.prototype,"startMultichannelAudioDevice",null),o([m.callOperation(h.CALL_OPERATIONS.STOP_MULTICHANNEL_AUDIO_DEVICE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"stopMultichannelAudioDevice",null),o([m.callOperation(h.CALL_OPERATIONS.BLIND_TRANSFER,{singular:!0,type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object,Object]),a("design:returntype",Promise)],t.prototype,"callBlindTransfer",null),o([m.callOperation(h.CALL_OPERATIONS.SAFE_TRANSFER,{singular:!0,type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object,Object]),a("design:returntype",Promise)],t.prototype,"callSafeTransfer",null),o([m.callOperation(h.CALL_OPERATIONS.TRANSFER_TO_VOICEMAIL,{singular:!0,type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"transferCallToVoicemail",null),o([m.callOperation(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,{singular:!0,type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object,String,Object]),a("design:returntype",Promise)],t.prototype,"callConsultativeTransfer",null),o([m.callOperation(h.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,{singular:!0,type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"consultativeTransferWithPickupCode",null),o([m.callOperation(h.CALL_OPERATIONS.CALL_REDIRECT,{singular:!0,type:m.OPERATION_TYPE.CHAINED}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"callRedirect",null),o([m.callOperation(h.CALL_OPERATIONS.PARK_CALL,{type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Number,Object]),a("design:returntype",Promise)],t.prototype,"park",null),o([m.callOperation(h.CALL_OPERATIONS.UNPARK_CALL,{preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Number,String]),a("design:returntype",Promise)],t.prototype,"unpark",null),o([m.callOperation(h.CALL_OPERATIONS.MUTE,{waitFor:h.CALL_OPERATIONS.UNMUTE,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(0,m.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"mute",null),o([m.callOperation(h.CALL_OPERATIONS.UNMUTE,{waitFor:h.CALL_OPERATIONS.MUTE,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(0,m.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"unmute",null),o([m.callOperation(h.CALL_OPERATIONS.MUTE_SPEAKER,{waitFor:h.CALL_OPERATIONS.UNMUTE_SPEAKER,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(0,m.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"muteSpeaker",null),o([m.callOperation(h.CALL_OPERATIONS.UNMUTE_SPEAKER,{waitFor:h.CALL_OPERATIONS.MUTE_SPEAKER,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(0,m.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"unmuteSpeaker",null),o([m.callOperation(h.CALL_OPERATIONS.MUTE_PARTICIPANTS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[Number,Array,Object]),a("design:returntype",Promise)],t.prototype,"muteParticipants",null),o([s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object,Object]),a("design:returntype",Promise)],t.prototype,"hold",null),o([m.callOperation(h.CALL_OPERATIONS.LOCAL_HOLD,{type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object,Object]),a("design:returntype",Promise)],t.prototype,"_localHold",null),o([m.callOperation(h.CALL_OPERATIONS.HOLD,{type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object,Object]),a("design:returntype",Promise)],t.prototype,"_hold",null),o([s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"unhold",null),o([m.callOperation(h.CALL_OPERATIONS.LOCAL_UNHOLD,{type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,String]),a("design:returntype",Promise)],t.prototype,"_localUnhold",null),o([m.callOperation(h.CALL_OPERATIONS.UNHOLD,{type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,String]),a("design:returntype",Promise)],t.prototype,"_unhold",null),o([m.callOperation(h.CALL_OPERATIONS.UPDATE_ENDPOINT_METADATA,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"updateEndpointMetadata",null),o([m.callOperation(h.CALL_OPERATIONS.SEND_DTMF_TONE,{preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Number,Object]),a("design:returntype",Promise)],t.prototype,"sendDtmfTone",null),o([m.callOperation(h.CALL_OPERATIONS.SET_AUDIO_USAGE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"setAudioUsageMode",null),o([m.callOperation(h.CALL_OPERATIONS.SET_AUDIO_MIDCALL_CONFIG,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Number,Object]),a("design:returntype",Promise)],t.prototype,"setAudioMidcallConfig",null),o([m.callOperation(h.CALL_OPERATIONS.SET_AUDIO_MIDCALL_CONFIG_JSON,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"setAudioMidcallConfigJson",null),o([m.callOperation(h.CALL_OPERATIONS.GET_TECHNICAL_INFORMATION_JSON,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"getTechnicalInformationJson",null),o([m.callOperation(h.CALL_OPERATIONS.START_AUDIO,{type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"startAudio",null),o([m.callOperation(h.CALL_OPERATIONS.STOP_AUDIO,{type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"stopAudio",null),o([m.callOperation(h.CALL_OPERATIONS.ASSIMILATE,{waitFor:h.CALL_OPERATIONS.ASSIMILATE}),s(3,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,String,String,Object]),a("design:returntype",Promise)],t.prototype,"assimilate",null),o([m.callOperation(h.CALL_OPERATIONS.PUBLISH_STATE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.operationId),a("design:type",Function),a("design:paramtypes",[Object,String]),a("design:returntype",Promise)],t.prototype,"publishState",null),o([m.callOperation(h.CALL_OPERATIONS.PUBLISH_STATE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.operationId),a("design:type",Function),a("design:paramtypes",[Object,String]),a("design:returntype",Promise)],t.prototype,"publishStatesForEveryone",null),o([m.callOperation(h.CALL_OPERATIONS.REMOVE_STATE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.operationId),a("design:type",Function),a("design:paramtypes",[Object,String]),a("design:returntype",Promise)],t.prototype,"removeState",null),o([m.callOperation(h.CALL_OPERATIONS.REMOVE_STATE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.operationId),a("design:type",Function),a("design:paramtypes",[Object,String]),a("design:returntype",Promise)],t.prototype,"removeStatesForEveryone",null),o([m.callOperation(h.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.operationId),a("design:type",Function),a("design:paramtypes",[Object,String]),a("design:returntype",Promise)],t.prototype,"updateMeetingSettings",null),o([m.callOperation(h.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(0,m.operationId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"updateMeetingGroups",null),o([m.callOperation(h.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(0,m.operationId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"updateMeetingLiveState",null),o([m.callOperation(h.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(0,m.operationId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"updateParticipantInterpretationState",null),o([m.callOperation(h.CALL_OPERATIONS.JOIN_MEETING_GROUP,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(0,m.operationId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"joinMeetingGroup",null),o([m.callOperation(h.CALL_OPERATIONS.LEAVE_MEETING_GROUP,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(0,m.operationId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"leaveMeetingGroup",null),o([m.callOperation(h.CALL_OPERATIONS.STOP_CALL,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.causeId),s(3,m.reason),a("design:type",Function),a("design:paramtypes",[Object,Object,Object,Object]),a("design:returntype",Promise)],t.prototype,"stop",null),o([m.callOperation(h.CALL_OPERATIONS.REJECT,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(0,m.causeId),s(1,m.reason),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"reject",null),o([m.callOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_LEAVE_CALL,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"_leaveSlimCoreCall",null),o([m.callOperation(h.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,{triggerAttach:!0,idempotencyLevel:m.IDEMPOTENCY_LEVEL.ERROR}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Number,Object]),a("design:returntype",void 0)],t.prototype,"incomingCallInit",null),o([m.callOperation(h.CALL_OPERATIONS.ACKNOWLEDGE,{type:m.OPERATION_TYPE.CHAINED,triggerAttach:!0,convertError:!0,idempotencyLevel:m.IDEMPOTENCY_LEVEL.ERROR}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"acknowledge",null),o([m.callOperation(h.CALL_OPERATIONS.ACCEPT,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"accept",null),o([m.callOperation(h.CALL_OPERATIONS.MERGE_PARTICIPANTS),s(1,m.operationId),s(3,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Array,Object,String]),a("design:returntype",Promise)],t.prototype,"mergeParticipants",null),o([m.callOperation(h.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE),s(0,m.operationId),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object,Object]),a("design:returntype",Promise)],t.prototype,"mergeWithPickupCode",null),o([m.callOperation(h.CALL_OPERATIONS.MERGE_CALL,{singular:!0,waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object,Object]),a("design:returntype",Promise)],t.prototype,"merge",null),o([m.callOperation(h.CALL_OPERATIONS_INTERNAL.RECONNECT),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"reconnect",null),o([m.callOperation(h.CALL_OPERATIONS.ELECTRON_PROVIDE_CQF,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),a("design:type",Function),a("design:paramtypes",[String,String,Number,String]),a("design:returntype",Promise)],t.prototype,"provideCallQualityFeedback",null),o([m.callOperation(h.CALL_OPERATIONS.ELECTRON_SHOW_CQF_INFO,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),a("design:type",Function),a("design:paramtypes",[String,Number]),a("design:returntype",Promise)],t.prototype,"showCQFInfo",null),o([m.callOperation(h.CALL_OPERATIONS.ELECTRON_IS_CQF_RENDERED,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),a("design:type",Function),a("design:paramtypes",[String]),a("design:returntype",Promise)],t.prototype,"isCqfRendered",null),o([m.callOperation(h.CALL_OPERATIONS.ELECTRON_PROVIDE_CQF,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),a("design:type",Function),a("design:paramtypes",[String,String,Number,String,String,String]),a("design:returntype",Promise)],t.prototype,"provideCallQualityFeedbackEx",null),o([m.participantOperation(h.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT),s(0,m.operationId),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"admitParticipant",null),o([m.callOperation(h.CALL_OPERATIONS.ADMIT,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.operationId),a("design:type",Function),a("design:paramtypes",[Object,String]),a("design:returntype",Promise)],t.prototype,"admit",null),o([m.participantOperation(h.PARTICIPANT_OPERATIONS.CALL_ME_BACK),s(0,m.operationId),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[String,String,Object]),a("design:returntype",Promise)],t.prototype,"callMeBack",null),o([m.participantOperation(h.CALL_OPERATIONS.NUDGE_PARTICIPANTS),s(0,m.operationId),s(3,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Array,Object,Object]),a("design:returntype",Promise)],t.prototype,"nudgeParticipants",null),o([m.participantOperation(h.CALL_OPERATIONS.UPDATE_MEETING_ROLE),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[Array,String,Object]),a("design:returntype",Promise)],t.prototype,"updateMeetingRoles",null),o([m.participantOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT),s(0,m.operationId),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object,Object]),a("design:returntype",Promise)],t.prototype,"addParticipant",null),o([m.participantOperation(h.PARTICIPANT_OPERATIONS.ADD_PARTICIPANTS),s(0,m.operationId),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[Array,Object,Object]),a("design:returntype",Promise)],t.prototype,"addParticipants",null),o([m.participantOperation(h.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT),s(0,m.operationId),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[String,Object,String,Number]),a("design:returntype",Promise)],t.prototype,"removeParticipant",null),o([m.callOperation(h.CALL_OPERATIONS.SEARCH_PARTICIPANTS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.operationId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"searchParticipants",null),o([m.callOperation(h.CALL_OPERATIONS.GET_ALL_PARTICIPANTS,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.operationId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"getAllParticipants",null),o([m.callOperation(h.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS,{type:m.OPERATION_TYPE.CHAINED,preconditionTags:[h.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),s(2,m.causeId),a("design:type",Function),a("design:paramtypes",[Number,String,Object]),a("design:returntype",Promise)],t.prototype,"setMaxVideoChannels",null),o([m.callOperation(h.CALL_OPERATIONS.CREATE_CONTENT_SHARING_SESSION,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),a("design:type",Function),a("design:paramtypes",[String,String,String,String]),a("design:returntype",Promise)],t.prototype,"createContentSharingSession",null),o([m.callOperation(h.CALL_OPERATIONS.ADD_GROUP_MODALITY,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"addGroupModality",null),o([m.callOperation(h.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,m.operationId),a("design:type",Function),a("design:paramtypes",[Object,String]),a("design:returntype",Promise)],t.prototype,"addBroadcastModality",null),t}(T.default);t.default=H},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(12),o=n(52),a=n(22),s=n(10),c=n(11),l=SlimCore.Enums,u=function(e){function t(t,n,r,i,a,s,c,u){var d=e.call(this,t.createChild(function(){return"SlimCoreElectronDataChannel"}),n,r)||this;d._call=i,d._slimcoreCallHandler=a,d._dataChannel=s,d._dataChannelUsers=c,d.id=u,d._dataChannelActive=!1,d._protocolDataSource=null,d._protocolDataSink=null,d._dataChannelAdapterSetInternalSourceSink=null,d._lastDataChannelState=l.DataChannelStatus.Unknown,d._asyncOperationHandler=new o.default(d._logger),d._logger.info("Setting DataChannel on all users");for(var p=0;p<d._dataChannelUsers.length;p++)if(d._dataChannelUsers[p])try{d._dataChannelUsers[p].setDataChannel(d)}catch(e){d._logger.error("Exception calling setDataChannel for i="+p+" error="+e)}return d._hookSlimCorePropertyChangedEvents(),d}return r(t,e),t.prototype.setAdapterSourceSinkCallback=function(e){this._dataChannelAdapterSetInternalSourceSink=e},t.prototype._hookSlimCorePropertyChangedEvents=function(){var e=this;this._onObjectPropertyChanged(this.id,l.Property.DataChannelStatus,function(t){return e._onDataChannelStatusChanged(t.value)});var t=this._getIntProperty(this._slimcoreCallHandler,this.id,l.Property.DataChannelStatus);this._onDataChannelStatusChanged(t)},t.prototype.start=function(e){var t=this;return this._dataChannelActive?(this._logger.info("start() called when channel already active"),Promise.resolve()):(this._asyncOperationHandler.hasPendingOperation(a.CALL_OPERATIONS.START_DATA_CHANNEL)?this._logger.info("start promise already exists, returning previous promise"):(this._asyncOperationHandler.createPendingOperation(a.CALL_OPERATIONS.START_DATA_CHANNEL),i.asap(function(){return t._startDataChannel(e)})),this._asyncOperationHandler.waitForOperation(a.CALL_OPERATIONS.START_DATA_CHANNEL))},t.prototype.stop=function(e){var t=this;return this._dataChannelActive?(this._asyncOperationHandler.hasPendingOperation(a.CALL_OPERATIONS.STOP_DATA_CHANNEL)?this._logger.info("stop promise already exists, returning previous promise"):(this._asyncOperationHandler.createPendingOperation(a.CALL_OPERATIONS.STOP_DATA_CHANNEL),i.asap(function(){return t._stopDataChannel(e)})),this._asyncOperationHandler.waitForOperation(a.CALL_OPERATIONS.STOP_DATA_CHANNEL)):(this._logger.info("stop() called when channel not active"),Promise.resolve())},t.prototype.registerDataSource=function(e){var t=this;return i.asap(function(){return t._dataChannel.registerDataSource(e)})},t.prototype.unregisterDataSource=function(e){var t=this;return i.asap(function(){return t._dataChannel.unregisterDataSource(e)})},t.prototype.registerDataSink=function(e){var t=this;return i.asap(function(){return t._dataChannel.registerDataSink(e)})},t.prototype.unregisterDataSink=function(e){var t=this;return i.asap(function(){return t._dataChannel.unregisterDataSink(e)})},t.prototype.sendUserEvents=function(e,t){var n=this;return i.asap(function(){return n._dataChannel.sendUserEvents(e,t)})},t.prototype._onDataChannelStatusChanged=function(e){if(this._logger.info("Data channel status = "+e),e===l.DataChannelStatus.Active){this._asyncOperationHandler.maybeResolveOperation(a.CALL_OPERATIONS.START_DATA_CHANNEL);try{this._dataChannel.setDataDevices()}catch(e){this._logger.error("setDataDevices threw exception: "+e)}this._dataChannel&&!this._dataChannelActive&&(this._dataChannelActive=!0,this._createAndAttachProtocolDevices(),this._dataChannelAdapterSetInternalSourceSink&&this._dataChannelAdapterSetInternalSourceSink(l.DataDeviceId.Protocol,this._protocolDataSource,this._protocolDataSink),this._logger.info("Data channel ready"))}else e===l.DataChannelStatus.Available&&(this._asyncOperationHandler.maybeResolveOperation(a.CALL_OPERATIONS.STOP_DATA_CHANNEL),this._dataChannel&&this._dataChannelActive&&(this._dataChannelActive=!1,this._detachAndDeleteProtocolDevices(),this._logger.info("Data channel disposed")));this._lastDataChannelState===l.DataChannelStatus.Starting&&e!==l.DataChannelStatus.Active?this._asyncOperationHandler.maybeRejectOperation(a.CALL_OPERATIONS.START_DATA_CHANNEL):this._lastDataChannelState===l.DataChannelStatus.Stopping&&e!==l.DataChannelStatus.Available&&this._asyncOperationHandler.maybeRejectOperation(a.CALL_OPERATIONS.STOP_DATA_CHANNEL);for(var n=0;n<this._dataChannelUsers.length;n++)try{this._dataChannelUsers[n].onDataChannelStatusChanged(e)}catch(e){this._logger.error("Exception calling onDataChannelStatusChanged for i="+n+" error="+e)}this._lastDataChannelState!==e&&(this.event("stateChange").raise(t._mapDataChannelStatus(e)),this._lastDataChannelState=e)},t.prototype._updateProtocolDataSource=function(e){this._logger.info("Setting Protocol DataSource on all users");for(var t=0;t<this._dataChannelUsers.length;t++)if(this._dataChannelUsers[t])try{this._dataChannelUsers[t].setProtocolDataSource(e)}catch(e){this._logger.error("Exception calling setProtocolDataSource for i="+t+" error="+e)}},t.prototype._createAndAttachProtocolDevices=function(){var e=this;if(this._logger.info("_createAndAttachProtocolDevices()"),s.hasCreateDataSource(this._slimcoreInstance)&&s.hasCreateDataSink(this._slimcoreInstance))if(this._dataChannel){if(!this._protocolDataSource){this._protocolDataSource=s.createDataSource(this._slimcoreInstance,l.DataDeviceId.Protocol);try{this._dataChannel.registerDataSource(this._protocolDataSource),this._logger.info("created Protocol data source")}catch(e){this._logger.error("registerDataSource threw exception: "+e)}}if(!this._protocolDataSink){this._protocolDataSink=s.createDataSink(this._slimcoreInstance,l.DataDeviceId.Protocol);try{this._dataChannel.registerDataSink(this._protocolDataSink),this._logger.info("created Protocol data sink")}catch(e){this._logger.error("registerDataSink threw exception: "+e)}}this._protocolDataSink.on("data",function(t){try{var n=JSON.parse(s.bufferToString(t.data));if(1!==n.type){n.type>=e._dataChannelUsers.length&&e._logger.error("Error calling processProtocolMessage i="+n.type+" error=Index out of bounds");try{var r=e._call.mapDataChannelSourceIdToParticipant(t.sourceID),i=void 0;r&&(i=r.getParticipantIdForSourceId(3,t.sourceID)),e._dataChannelUsers[n.type].processProtocolMessage(n.message,r,i,t.sourceID)}catch(t){e._logger.error("Error calling processProtocolMessage i="+n.type+" error="+t)}}}catch(t){e._logger.error("Error handling protocol message error="+t)}}),this._updateProtocolDataSource(this._protocolDataSource)}else this._logger.warn("_createAndAttachProtocolDevices() null dataChannel");else this._logger.warn("createDataSource or createDataSink not implemented")},t.prototype._detachAndDeleteProtocolDevices=function(){if(this._logger.info("_detachAndDeleteProtocolDevices()"),this._protocolDataSink&&this._protocolDataSink.removeAllListeners("data"),this._dataChannel){if(this._protocolDataSource){try{this._dataChannel.unregisterDataSource(this._protocolDataSource)}catch(e){this._logger.warn("unregisterDataSource threw exception for protocol, call probably ended: "+e)}this._protocolDataSource=null,this._updateProtocolDataSource(null),this._logger.info("deleted Protocol data source")}if(this._protocolDataSink){try{this._dataChannel.unregisterDataSink(this._protocolDataSink)}catch(e){this._logger.warn("unregisterDataSink threw exception for protocol, call probably ended: "+e)}this._protocolDataSink=null,this._logger.info("deleted Protocol data sink")}}else this._logger.warn("_detachAndDeleteProtocolDevices() null dataChannel")},t.prototype._startDataChannel=function(e){if(this._logger.info("_startDataChannel()"),this._dataChannel){try{this._dataChannel.start(e)}catch(e){this._logger.error("_dataChannel.start threw exception: "+e)}this._logger.info("Data channel started")}},t.prototype._stopDataChannel=function(e){if(this._logger.info("_stopDataChannel()"),this._dataChannel){try{this._dataChannel.stop(e)}catch(e){this._logger.error("_dataChannel.stop threw exception: "+e)}this._logger.info("Data channel stopping")}},t._mapDataChannelStatus=function(e){switch(e){case l.DataChannelStatus.Available:return 1;case l.DataChannelStatus.Starting:return 2;case l.DataChannelStatus.Active:return 3;case l.DataChannelStatus.Stopping:return 4;case l.DataChannelStatus.NotStarted:return 5;case l.DataChannelStatus.Unknown:default:return 0}},t.prototype.dispose=function(t){this._logger.info("dispose causeId: "+t),this._detachAndDeleteProtocolDevices(),this._call=null,this._dataChannel&&(this._dataChannel.dispose&&this._dataChannel.dispose(),this._dataChannel=null),e.prototype.dispose.call(this,t)},t}(c.default);t.default=u},function(e,t,n){"use strict";function r(e){return!(!e||!e.code)}Object.defineProperty(t,"__esModule",{value:!0}),t.getSuccessTransactionEnd=t.getRejectTransactionEnd=t.isTransactionEnd=void 0;var i=n(22),o=n(19);t.isTransactionEnd=r,t.getRejectTransactionEnd=function(e,t){return r(e)?e:{code:i.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:void 0!==t?t:i.TRANSACTION_END_SUBCODE.LOCAL_REJECT,phrase:"string"==typeof e?e:o.getPrintableObject(e)}},t.getSuccessTransactionEnd=function(){return{code:i.TRANSACTION_END_CODE.SUCCESS}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DATA_SOURCE_ID_ANY=t.CONSTANTS=void 0,t.CONSTANTS={CODE:{SUCCESS:0,CLIENT_ERROR_CODE:499},SUB_CODE:{ACTION_NOT_ALLOWED:3548,ABANDONED:4990,ENDED_BY_REMOTE_ENDPOINT:5028}},t.DATA_SOURCE_ID_ANY=4294967294},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapMediaTypeStringToMediaType=t.getMediaType=t.getMediaLabel=void 0,t.getMediaLabel=function(e){switch(e){case 0:return"main-audio";case 1:return"main-video";case 2:return"applicationsharing-video";case 3:return"data"}throw new Error("Invalid media type")},t.getMediaType=function(e){switch(e){case"main-audio":return 0;case"main-video":return 1;case"applicationsharing-video":return 2;case"data":return 3}throw new Error("Invalid media label")},t.mapMediaTypeStringToMediaType=function(e){switch(e){case"audio":return 0;case"video":return 1;case"applicationsharing-video":return 2;case"data":return 3;default:return}}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),o=n(10),a=n(11),s=n(36),c=SlimCore.Enums,l=n(9),u=n(26),d=function(e){function t(t,n,r,i,a,s,l,u,d){void 0===d&&(d=!1);var p=e.call(this,t.createChild(function(){return"SlimCoreElectronRemoteStreamManager["+p._slimcoreParticipantObjectId+"]"}),n,r)||this;return p._callHandler=i,p._slimcoreParticipantObjectId=a,p._streams=s,p._streamContextMap=l,p._participantIdMapperFactory=u,p._logger.log("constructor"),o.hasFeature(c.Feature.RemoteVideosCountChanged)||p._onObjectPropertyChanged(p._slimcoreParticipantObjectId,c.Property.ParticipantVideoCountChanged,function(){return p._onVideoCountChangedDeferred()}),p._registerDisposable(p._callHandler.handle("remote-videos-count-changed",{participantObjectId:p._slimcoreParticipantObjectId},function(){return p._onVideoCountChangedDeferred()})),d||p._onVideoCountChangedDeferred(),p}return r(t,e),t.prototype._onVideoCountChangedDeferred=function(){var e=this;this._onVideoCountChangedDefer||(this._onVideoCountChangedDefer=i.defer(function(){delete e._onVideoCountChangedDefer,e._onVideoCountChanged()}))},t.prototype._onVideoCountChanged=function(e){var t=this;void 0===e&&(e=l.generateCauseId());var n=this._callHandler.callGetParticipantVideos(this._slimcoreParticipantObjectId);if(n){var r={};r[c.VideoType.Video]=[],r[c.VideoType.ScreenShare]=[],n.forEach(function(e){var n=t._getIntProperty(t._callHandler,e,c.Property.VideoType),i=t._getIntProperty(t._callHandler,e,c.Property.VideoStatus);n!==c.VideoType.Augmented&&r[n].push({videoObjectId:e,videoType:n,videoStatus:i})}),this._handleVideoCountChanged(e,c.VideoType.Video,r[c.VideoType.Video]),this._handleVideoCountChanged(e,c.VideoType.ScreenShare,r[c.VideoType.ScreenShare]),this.raiseChanged()}},t.prototype._handleVideoCountChanged=function(e,n,r){var o=this,a=t.SlimcoreVideoTypeToStreamType(n),c=this._streams[a],l=i.filter(c,function(e){return!i.some(r,function(t){return t.videoObjectId===e.id})});i.each(l,function(t){o._logger.info("_handleVideoCountChanged: removing stream "+t.id+" (stream type: "+a+")"),i.remove(c,t),t.dispose(e)}),i.each(r,function(t){if(!i.some(c,function(e){return e.id===t.videoObjectId})){o._logger.info("_handleVideoCountChanged: adding stream "+t.videoObjectId+" (stream type: "+a+")");var n=new s.default(e,o._logger,o._settings,o._slimcoreInstance,o._slimcoreParticipantObjectId,t.videoObjectId,a,o._callHandler,o._streamContextMap[a],o._participantIdMapperFactory);o._streams[a].push(n),n.changed(function(){return o.raiseChanged()})}})},t.prototype.stopVideos=function(e){this._logger.info("stopVideos causeId: "+e);var t=function(t){return t.disposeInternal(e)};return Promise.all(i.flatMap(i.values(this._streams),function(e){return i.map(e,t)})).then(u.noop)},t.prototype.dispose=function(t){this._logger.info("dispose causeId: "+t),i.each(i.values(this._streams),function(e){return i.each(e,function(e){return e.dispose(t)})}),this._streams[0]=[],this._streams[1]=[],e.prototype.dispose.call(this,t)},t.SlimcoreVideoTypeToStreamType=function(e){switch(e){case c.VideoType.ScreenShare:return 1;case c.VideoType.Video:return 0;default:return}},t}(a.default);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){void 0===n&&(n=e.createChild(function(){return"TxNdiNotifier"})),this._slimcoreInstance=t,this._logger=n,this._videoObjectId=0,this._isNdiNotificationSupported=this._slimcoreInstance.notifyNdiVideoStarted&&this._slimcoreInstance.notifyNdiVideoStopped}return e.prototype.notifyNdiVideoStarted=function(e,t,n){if(this.notifyNdiVideoStopped(e),this._isNdiNotificationSupported&&t)try{this._slimcoreInstance.notifyNdiVideoStarted(t,n),this._videoObjectId=t}catch(n){this._logger.warn("notifyNdiVideoStarted for video object "+t+" causeId: "+e+" failed with error: "+n)}},e.prototype.notifyNdiVideoStopped=function(e){if(this._isNdiNotificationSupported&&this._videoObjectId)try{this._slimcoreInstance.notifyNdiVideoStopped(this._videoObjectId)}catch(t){this._logger.warn("notifyNdiVideoStopped for video object "+this._videoObjectId+" causeId: "+e+" failed with error: "+t)}finally{this._videoObjectId=0}},e}();t.default=r},function(e,t,n){"use strict";function r(e){switch(e){case i.ParticipantFailureReason.NoFailure:case i.ParticipantFailureReason.HostEndedConf:return 0;case i.ParticipantFailureReason.AnsweredElsewhere:return 23;case i.ParticipantFailureReason.RecipientUserNotFound:case i.ParticipantFailureReason.RecipientNotOnline:case i.ParticipantFailureReason.PstnCouldNotConnectToSkypeProxy:case i.ParticipantFailureReason.CallNotificationDeliveryFailure:return 4;case i.ParticipantFailureReason.RecipientBlocked:return 5;case i.ParticipantFailureReason.CallerNotFriend:case i.ParticipantFailureReason.CallerNotAuthorized:return 6;case i.ParticipantFailureReason.ConfParticipantCountLimitReached:return 46;case i.ParticipantFailureReason.ConfLobbyParticipantCountLimitReached:return 59;case i.ParticipantFailureReason.PstnNoSkypeoutSubscription:return 7;case i.ParticipantFailureReason.CallNotFound:return 8;case i.ParticipantFailureReason.PstnNetworkError:case i.ParticipantFailureReason.PstnInternetConnectionLost:case i.ParticipantFailureReason.TrouterError:case i.ParticipantFailureReason.GeneralNetworkError:return 9;case i.ParticipantFailureReason.MediaDroppedError:case i.ParticipantFailureReason.SoundRecordingError:case i.ParticipantFailureReason.SoundPlaybackError:return 10;case i.ParticipantFailureReason.PstnInsufficientFunds:return 12;case i.ParticipantFailureReason.PstnCreditExpired:return 26;case i.ParticipantFailureReason.PstnCreditExpiredButEnough:return 27;case i.ParticipantFailureReason.MiscError:case i.ParticipantFailureReason.PstnMiscError:return 11;case i.ParticipantFailureReason.PstnSkypeoutAccountBlocked:return 13;case i.ParticipantFailureReason.PstnBlockedByUs:return 15;case i.ParticipantFailureReason.PstnBlockedRegulatoryIndia:return 16;case i.ParticipantFailureReason.PstnInvalidNumber:return 17;case i.ParticipantFailureReason.PstnNumberForbidden:return 18;case i.ParticipantFailureReason.PstnCallTimedOut:return 2;case i.ParticipantFailureReason.PstnBusy:return 19;case i.ParticipantFailureReason.PstnCallTerminated:return 20;case i.ParticipantFailureReason.PstnNumberUnavailable:return 21;case i.ParticipantFailureReason.PstnCallRejected:return 3;case i.ParticipantFailureReason.PstnEmergencyCallDenied:return 22;case i.ParticipantFailureReason.PstnNoSubscriptionCover:return 25;case i.ParticipantFailureReason.EnterprisePstnForbidden:return 30;case i.ParticipantFailureReason.EnterprisePstnInternalError:return 28;case i.ParticipantFailureReason.EnterprisePstnUnavailable:return 29;case i.ParticipantFailureReason.EnterprisePstnInvalidNumber:return 31;case i.ParticipantFailureReason.EnterprisePstnMiscError:return 32;case i.ParticipantFailureReason.Kicked:return 33;case i.ParticipantFailureReason.NetworkRequestTimeoutError:return 34;case i.ParticipantFailureReason.CallDoesNotExist:return 35;case i.ParticipantFailureReason.MediaSetupFailure:return 36;case i.ParticipantFailureReason.ServiceUnavailable:return 37;case i.ParticipantFailureReason.SignalingError:return 38;case i.ParticipantFailureReason.ConversationEstablishmentFailed:return 39;case i.ParticipantFailureReason.TemporarilyUnavailable:return 40;case i.ParticipantFailureReason.NetworkCannotConnectError:return 41;case i.ParticipantFailureReason.NoSignalingFromPeer:return 42;case i.ParticipantFailureReason.AnonymousJoinDisabledByPolicy:return 53;case i.ParticipantFailureReason.NoLobbyForBroadcastJoin:return 54;case i.ParticipantFailureReason.NotAllowedDueToInformationBarrier:return 55;case i.ParticipantFailureReason.BroadcastLimitReached:return 56;case i.ParticipantFailureReason.B2bJoinDisabledByPolicy:return 57;case i.ParticipantFailureReason.LocationBasedRoutingError:return 58;case i.ParticipantFailureReason.Forbidden:return 52;default:return 11}}Object.defineProperty(t,"__esModule",{value:!0}),t.convertFailureReasonToParticipantReason=t.convertStatusAndFailureReasonToParticipantReason=t.convertVideoEffectType=void 0;var i=SlimCore.Enums;t.convertVideoEffectType=function(e){switch(e){case 0:return i.VideoEffectType.Off;case 1:return i.VideoEffectType.BackgroundBlurDefault;case 2:return i.VideoEffectType.BackgroundBlurLight;case 4:return i.VideoEffectType.BackgroundBlurExperimental_1;case 8:return i.VideoEffectType.BackgroundBlurExperimental_2;case 16:return i.VideoEffectType.BackgroundReplacement;case 32:return i.VideoEffectType.WhiteboardZoom;case 64:return i.VideoEffectType.WhiteboardCleanup;case 128:return i.VideoEffectType.WhiteboardMotionDetection;case 96:return i.VideoEffectType.WhiteboardZoomAndCleanup;case 192:return i.VideoEffectType.WhiteboardCleanupAndMotion;case 224:return i.VideoEffectType.WhiteboardZoomAndCleanupAndMotion;default:return i.VideoEffectType.Off}},t.convertStatusAndFailureReasonToParticipantReason=function(e,t){switch(e){case i.CallStatus.Busy:return 19;case i.CallStatus.CallTimedOut:return 9;case i.CallStatus.Cancelled:return 23;case i.CallStatus.Dropped:return 10;case i.CallStatus.Refused:return 3;case i.CallStatus.Missed:return 2;case i.CallStatus.Failed:return r(t);default:return 0}},t.convertFailureReasonToParticipantReason=r},function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(19),o=function(){function e(e){var t=this;this._callingLogger=e,this._maybeLog=function(e){for(var n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];try{(n=t._callingLogger)[e].apply(n,r)}catch(e){t._callingLogger.info("[failed to log]",i.getPrintableObject(e))}}}return e.prototype.getPrefix=function(e,t){var n="";return t&&(n+="["+t+"]"),e&&(n+="["+e+"]"),n},e.prototype.createChild=function(t,n){return new e(this._callingLogger.createChild(t,n))},e.prototype.createFnLogger=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new e(this._callingLogger.createChild(this.getPrefix(t,n)+r.join(""),!1))},e.prototype.logSuccess=function(e){this._maybeLog("info","success="+e+"}")},e.prototype.logFailure=function(e){var t=i.getPrintableObject(e);this._maybeLog("info","failed="+t+"}")},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["log"],e))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["debug"],e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["info"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["warn"],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,r(["error"],e))},e}();t.default=o},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=SlimCore.Enums,s=function(){function e(e){this._slimcoreInstance=e}return e.prototype.setEcsConfig=function(e){try{return this._slimcoreInstance.setEcsConfig(e.ecsBlob,e.userIdentity,e.etag,!0),Promise.resolve()}catch(e){return Promise.reject(e)}},e.prototype.shouldTriggerCQF=function(e,t,n){var r=this,i=function(n){var i=a.CallType.CallTypeS2s;return 0===n?i=a.CallType.CallTypeGroup:2===n?i=a.CallType.CallTypePstn:1===n&&(i=a.CallType.CallTypeS2s),r._slimcoreInstance.shouldTriggerCQF(e,t,i)};return o.asap(function(){return i(n)})},e.prototype.getEcsQueryParameters=function(){try{return Promise.resolve(this._slimcoreInstance.getEcsQueryParameters())}catch(e){return Promise.reject(e)}},e.prototype.getEcsSettingAsString=function(e,t){return r(this,void 0,void 0,function(){return i(this,function(n){return[2,this._slimcoreInstance.ecsGetSettingAsString(e,t||"")]})})},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=function(){function e(e,t){this._slimcoreInstance=e,this._accountIdentity=t}return e.prototype.getSetup=function(){var e=this;return new Promise(function(t,n){r.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)?(e._setup||(e._setup=e._slimcoreInstance.getSetup(e._accountIdentity)),t(e._setup)):n("No Multiuser support")})},e.prototype.setString=function(e,t){var n=this;return this.getSetup().then(function(){return n._setup.setStr(e,t)}).catch(function(){return n._slimcoreInstance.setupSetStr(e,t)})},e.prototype.setNumber=function(e,t){var n=this;return this.getSetup().then(function(){return n._setup.setInt(e,t)}).catch(function(){return n._slimcoreInstance.setupSetInt(e,t)})},e.prototype.getString=function(e){var t=this;return this.getSetup().then(function(){return t._setup.getStr(e)}).catch(function(){return t._slimcoreInstance.setupGetStr(e)})},e.prototype.getNumber=function(e){var t=this;return this.getSetup().then(function(){return t._setup.getInt(e)}).catch(function(){return t._slimcoreInstance.setupGetInt(e)})},e.prototype.delete=function(e){var t=this;return this.getSetup().then(function(){return t._setup.delete(e)}).catch(function(){return t._slimcoreInstance.setupDelete(e)})},e}();t.default=i},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(e,t){for(var n in t)if(t.hasOwnProperty(n)&&e[n]!==t[n])return!1;return!0}function i(e,t){if(t){var n=function(n){return r(n,t)&&e(n)};return n.listener=e,n}return e}function o(e){return function(t,n,r){var o=i(r,n);e.addListener(t,o);return{dispose:function(){e.removeListener(t,o)}}}}var a=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.SlimCoreEventEmitter=t.makeHandleForEventEmitter=void 0,t.makeHandleForEventEmitter=o;var s=function(){function e(){this.eventListenerArrays={},this.handle=o(this)}return e.prototype.on=function(e,t){return this.addListener(e,t)},e.prototype.once=function(e,t){var n=this,r=function(i){n.removeListener(e,r),t(i)};return r.listener=t,this.addListener(e,r)},e.prototype.addListener=function(e,t){var n=this.eventListenerArrays[e];return n||(n=this.eventListenerArrays[e]=[]),n.push(t),this},e.prototype.removeListener=function(e,t){var n=this.eventListenerArrays[e];if(n)for(var r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){n.splice(r,1);break}return this},e.prototype.removeAllListeners=function(e){var t=this;return e?(this.eventListenerArrays[e]&&(this.eventListenerArrays[e]=[]),this):(Object.keys(this.eventListenerArrays).forEach(function(e){t.eventListenerArrays[e]=[]}),this)},e.prototype.getMaxListeners=function(){return 0},e.prototype.setMaxListeners=function(e){},e.prototype.listeners=function(e){return this.eventListenerArrays[e]?a([],this.eventListenerArrays[e]):[]},e.prototype.emit=function(e,t){var n=this.eventListenerArrays[e];return!!n&&(a([],n).forEach(function(e){try{e(t)}catch(e){}}),!0)},e}();t.SlimCoreEventEmitter=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourceImpl=void 0;var r=n(7),i=n(51),o=function(){function e(e){this.subscriptions=[],this.eventLogger=e}return e.prototype.subscribe=function(e){return new a(this.subscriptions,e)},e.prototype.dispose=function(e){this.subscriptions=[]},e.prototype.raiseEvents=function(e){var t=this;this.subscriptions.slice().forEach(function(n){try{void 0!==n.eventHandler&&e(n.eventHandler)}catch(e){t.eventLogger&&t.eventLogger.warn&&t.eventLogger.warn("Event handler exception caught!",i.stringifyObject(e))}})},e}();t.EventSourceImpl=o;var a=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;r.remove(this.subscriptions,function(t){return t===e}),this.eventHandler=void 0},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringifyObject=t.isPromiseLike=t.isStringBase64=t.getRandomizedTimeout=void 0,t.getRandomizedTimeout=function(e){var t=Math.floor(11*Math.random())+10;return Math.floor(e*(1-t/100))},t.isStringBase64=function(e){if(!e)return!1;try{return atob(e),!0}catch(e){return!1}},t.isPromiseLike=function(e){return!!e&&"function"==typeof e.then},t.stringifyObject=function(e){return e?e.toString===Object.prototype.toString?JSON.stringify(e):e.toString():""+e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(26),i=n(18),o=n(12),a=n(9),s=n(19),c=function(){function e(e){var t=this;this._disposed=!1,this._logger=e.createChild("[ASYNC]"),this._endOperationDeferred=o.defer(),this._endOperationDeferred.promise.catch(function(e){t._logger.info("Rejected all operations")}),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._deferredOperationsWithCauseId={},this._logger=e}return e.prototype.registerPromise=function(e,t){var n=!1,r=function(){n=!0};t.then(r,r);var i=this._endOperationDeferred.promise.catch(function(t){if(!n)throw new Error("Operation "+e+" did not complete, reason:"+t)});return Promise.race([i,t])},e.prototype.updateOperationId=function(e,t){var n=this;this._logger.info("updateOperationId "+e+" "+t),Object.keys(this._deferredOperationsWithOperationId).forEach(function(r){r&&n._deferredOperationsWithOperationId[r]&&(n._logger.info("_deferredOperationsWithOperationId "+r),Object.keys(n._deferredOperationsWithOperationId[r]).forEach(function(i){i&&n._deferredOperationsWithOperationId[r][i]&&(n._logger.info("_deferredOperationsWithOperationId "+i+" "+t),i===e&&(n._deferredOperationsWithOperationId[r][t]=n._deferredOperationsWithOperationId[r][i],delete n._deferredOperationsWithOperationId[r][i]))}))}),Object.keys(this._deferredOperationsWithCauseId).forEach(function(r){r&&n._deferredOperationsWithCauseId[r]&&(n._logger.info("_deferredOperationsWithCauseId "+r),Object.keys(n._deferredOperationsWithCauseId[r]).forEach(function(i){i&&n._deferredOperationsWithCauseId[r][i]&&(n._logger.info("_deferredOperationsWithCauseId "+i+" "+t),i===e&&(n._deferredOperationsWithOperationId[r][t]=n._deferredOperationsWithOperationId[r][i],delete n._deferredOperationsWithOperationId[r][i]))}))})},e.prototype.createPendingOperation=function(e,t,n,s){var c=this;void 0===n&&(n=a.generateCauseId()),void 0===s&&(s={});var l=o.defer();l.promise.catch(r.noop);var u=this.getOperationInfoForLogging(n,e,t);this._logger.info(u+"[creating...]");var d;if(this._disposed)return this._logger.info(u+"[create failed, call is disposed]"),Promise.reject(60);if(t){if(this._deferredOperationsWithOperationId[e]||(this._deferredOperationsWithOperationId[e]={}),this._deferredOperationsWithOperationId[e][t])return this._logger.warn(u+" Deferred operation with given name and operation id is already defined"),Promise.reject(new Error("Deferred operation with given name is already defined:"+e+"/"+i.scrubMriOrOmit(t)));this._deferredOperationsWithOperationId[e][t]={deferred:l,causeId:n},this._deferredOperationsWithCauseId[n]||(this._deferredOperationsWithCauseId[n]={}),this._deferredOperationsWithCauseId[n][t]={deferred:l,options:s,operationName:e},d=this._endOperationDeferred.promise.catch(function(n){if(c.hasPendingOperationWithOperationId(e,t))throw new Error("Operation "+e+" "+t+" did not complete, reason:"+n)})}else{if(this._deferredOperations[e])return this._logger.warn(u+" Deferred operation with given name is already defined"),Promise.reject(new Error("Deferred operation with given name is already defined:"+e));this._deferredOperationsWithCauseId[n]||(this._deferredOperationsWithCauseId[n]={}),this._deferredOperationsWithCauseId[n][""]={deferred:l,options:s,operationName:e},this._deferredOperations[e]={deferred:l,causeId:n},d=this._endOperationDeferred.promise.catch(function(t){if(c.hasPendingOperation(e))throw new Error("Operation "+e+" did not complete, reason:"+t)})}return Promise.race([d,l.promise])},e.prototype.hasPendingOperation=function(e){return!!this._deferredOperations[e]},e.prototype.hasAtleastOneOfPendingOperation=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(this.hasPendingOperation(r))return!0}return!1},e.prototype.hasPendingOperationWithOperationId=function(e,t){return!(!t||!this._deferredOperationsWithOperationId[e])&&!!this._deferredOperationsWithOperationId[e][t]},e.prototype.hasPendingOperationWithCauseId=function(e,t){var n=t||"";return this._deferredOperationsWithCauseId[e]&&!!this._deferredOperationsWithCauseId[e][n]},e.prototype.getPendingOperationWithCauseId=function(e,t){return this.hasPendingOperationWithCauseId(e,t)?this._deferredOperationsWithCauseId[e][t].deferred.promise:Promise.reject("["+e+"]["+t+"]: getPendingOperationWithCauseId for given causeId, operationId")},e.prototype.resolveOperationWithCauseId=function(e,t,n){var r=t||"";if(this.hasPendingOperationWithCauseId(e,r)){var i=this._deferredOperationsWithCauseId[e][r],o=i.deferred.promise;return i.deferred.resolve(n),this._logger.info("["+e+"]["+r+"] resolved, result="+(s.getPrintableObject(n)||"void")),delete this._deferredOperationsWithCauseId[e][r],o}return Promise.reject("["+e+"]["+r+"] resolveOperationWithCauseId failed, operation not found")},e.prototype.rejectOperationWithCauseId=function(e,t,n){var i=t||"";if(this.hasPendingOperationWithCauseId(e,i)){var o=this._deferredOperationsWithCauseId[e][i],a=o.deferred.promise;return a.catch(r.noop),o.deferred.reject(n),this._logger.info("["+e+"]["+i+"] rejected, result="+(s.getPrintableObject(n)||"void")),delete this._deferredOperationsWithCauseId[e][i],a}return Promise.reject("["+e+"]["+i+"] rejectOperationWithCauseId failed, operation not found")},e.prototype.maybeResolveOperationWithCauseId=function(e,t,n){var r=this;this.hasPendingOperationWithCauseId(e,t)?this.resolveOperationWithCauseId(e,t,n).catch(function(t){r._logger.info(e+"maybeResolveOperationWithCauseId failed, reason="+s.getPrintableObject(t))}):this._logger.info(e+"maybeResolveOperationWithCauseId ignored, operation does not exist")},e.prototype.maybeRejectOperationWithCauseId=function(e,t,n){this.hasPendingOperationWithCauseId(e,t)?this.rejectOperationWithCauseId(e,t,n).catch(r.noop):this._logger.info(e+"maybeRejectOperationWithCauseId ignored, operation does not exist")},e.prototype.getPendingOperation=function(e,t,n){return void 0===n&&(n=a.generateCauseId()),!t&&this._deferredOperations[e]?this._deferredOperations[e].deferred.promise:t&&this._deferredOperationsWithOperationId[e]&&this._deferredOperationsWithOperationId[e][t]?this._deferredOperationsWithOperationId[e][t].deferred.promise:Promise.reject(this.getOperationInfoForLogging(n,e,t)+": Deferred operation with given name and operation does not exist")},e.prototype.waitForOperation=function(e,t,n){return void 0===n&&(n=a.generateCauseId()),t&&this.hasPendingOperationWithOperationId(e,t)?this._deferredOperationsWithOperationId[e][t].deferred.promise:this.hasPendingOperation(e)?this._deferredOperations[e].deferred.promise:Promise.reject(this.getOperationInfoForLogging(n,e,t)+"failed=wait failed, operation not found")},e.prototype.resolveOperation=function(e,t,n,r,i){if(void 0===r&&(r=a.generateCauseId()),void 0===i&&(i=!1),!e)return Promise.reject("Unable to resolve deferred operation with empty name");if(n&&this.hasPendingOperationWithOperationId(e,n)){c=(o=this._deferredOperationsWithOperationId[e][n]).deferred.promise;return o.deferred.resolve(t),this._logger.info(this.getOperationInfoForLogging(o.causeId,e,n)+"resolved, result="+(s.getPrintableObject(t)||"void")),i||delete this._deferredOperationsWithOperationId[e][n],c}if(this.hasPendingOperation(e)){var o=this._deferredOperations[e],c=this._deferredOperations[e].deferred.promise;return this._deferredOperations[e].deferred.resolve(t),this._logger.info(this.getOperationInfoForLogging(o.causeId,e,n)+"resolved, result="+(s.getPrintableObject(t)||"void")),i||delete this._deferredOperations[e],c}return Promise.reject(this.getOperationInfoForLogging(r,e,n)+"failed=resolve failed, operation not found")},e.prototype.rejectOperation=function(e,t,n,i){if(void 0===i&&(i=a.generateCauseId()),!e)return Promise.reject("Unable to reject deferred operation with empty name");if(n&&this.hasPendingOperationWithOperationId(e,n))return(c=(o=this._deferredOperationsWithOperationId[e][n]).deferred.promise).catch(r.noop),o.deferred.reject(t),this._logger.info(this.getOperationInfoForLogging(o.causeId,e,n)+"rejected, reason="+(s.getPrintableObject(t)||"void")),delete this._deferredOperationsWithOperationId[e][n],c;if(this.hasPendingOperation(e)){var o=this._deferredOperations[e],c=o.deferred.promise;return c.catch(r.noop),o.deferred.reject(t),this._logger.info(this.getOperationInfoForLogging(o.causeId,e,n)+"rejected, reason="+(s.getPrintableObject(t)||"void")),delete this._deferredOperations[e],c}return Promise.reject(this.getOperationInfoForLogging(i,e,n)+"failed=reject failed, operation not found")},e.prototype.maybeResolveOperation=function(e,t,n,r){var i=this;void 0===r&&(r=a.generateCauseId());var o=this.getOperationInfoForLogging(r,e,n);n&&this.hasPendingOperationWithOperationId(e,n)||this.hasPendingOperation(e)?this.resolveOperation(e,t,n,r).catch(function(e){i._logger.info(o+"maybeResolveOperation failed, reason="+s.getPrintableObject(e))}):this._logger.info(o+"maybeResolveOperation ignored, operation does not exist")},e.prototype.maybeResolveOperations=function(e,t,n,r){void 0===r&&(r=a.generateCauseId());for(var i=0,o=e;i<o.length;i++){var s=o[i];this.maybeResolveOperation(s,t,n,r)}},e.prototype.maybeRejectOperation=function(e,t,n,i){void 0===i&&(i=a.generateCauseId());var o=this.getOperationInfoForLogging(i,e,n);n&&this.hasPendingOperationWithOperationId(e,n)||this.hasPendingOperation(e)?this.rejectOperation(e,t,n,i).catch(r.noop):this._logger.info(o+"maybeRejectOperation ignored, operation does not exist")},e.prototype.maybeRejectOperations=function(e,t,n,r){void 0===r&&(r=a.generateCauseId());for(var i=0,o=e;i<o.length;i++){var s=o[i];this.maybeRejectOperation(s,t,n,r)}},e.prototype.rejectPendingOperations=function(e,t){var n=this;void 0===t&&(t=a.generateCauseId()),this._disposed=!0,this._logger.info("["+t+"]rejectPendingOperations="+e),Object.keys(this._deferredOperations).forEach(function(r){n.maybeRejectOperation(r,e,void 0,t),n._deferredOperationsWithOperationId[t]&&delete n._deferredOperationsWithOperationId[t][""]}),Object.keys(this._deferredOperationsWithOperationId).forEach(function(r){Object.keys(n._deferredOperationsWithOperationId[r]).forEach(function(i){n.maybeRejectOperation(r,e,i,t),n._deferredOperationsWithOperationId[t]&&delete n._deferredOperationsWithOperationId[t][i]})}),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._endOperationDeferred.reject(e)},e.prototype.maybeRejectPendingOperationsWithPredicate=function(e,t,n){var r=this;void 0===t&&(t=a.generateCauseId()),this._logger.info("["+t+"]rejectPendingOperationsWithPredicate"),Object.keys(this._deferredOperationsWithCauseId).forEach(function(t){Object.keys(r._deferredOperationsWithCauseId[t]).forEach(function(i){var o=r._deferredOperationsWithCauseId[t][i];o&&n(o.operationName,o.options)&&(r.maybeRejectOperation(o.operationName,e,i),r.maybeRejectOperationWithCauseId(t,i,e))})})},e.prototype.getOperationInfoForLogging=function(e,t,n){return void 0===n&&(n=""),"["+e+"]["+t+"]"+(n?"["+i.scrubMriOrOmit(n)+"]":"")},e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateAliasedMri=t.stripMriAliases=t.PSTN_MRI_PREFIX=t.MRI_SIP_PREFIX=t.MRI_ALIAS_PREFIX=t.MRI_SKYPE_PREFIX=void 0;var r=/;aliases=.*$/i;t.MRI_SKYPE_PREFIX="8:",t.MRI_ALIAS_PREFIX=";aliases=",t.MRI_SIP_PREFIX="2:",t.PSTN_MRI_PREFIX="4:",t.stripMriAliases=function(e){return e?e.replace(r,""):e},t.generateAliasedMri=function(e,n){var r=e;return n&&(r+=t.MRI_ALIAS_PREFIX+t.MRI_SIP_PREFIX+n),r}},function(e,t,n){"use strict";function r(e,t){var n=-1;try{if(e.endpoints)e:for(var r=0,i=e.endpoints.endpointDetails;r<i.length;r++){var s=i[r];if(null!==s&&void 0!==s.mediaStreams)for(var c=0,l=s.mediaStreams;c<l.length;c++){var u=l[c];if(a.mapMediaTypeStringToMediaType(u.type)===t){n=u.sourceId;break e}}else n=o.DATA_SOURCE_ID_ANY}}catch(e){return-1}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.getSharingParticipantLeg=t.getParticipantIdForSourceId=t.getSourceId=t.getSourceIdForMediaType=t.hasStagingGroup=t.findParticipantUsingParticipantLegId=void 0;var i=n(7),o=n(40),a=n(41);t.findParticipantUsingParticipantLegId=function(e,t){function n(e,t){if(e.endpoints&&e.endpoints.endpointDetails)for(var n=0,r=e.endpoints.endpointDetails;n<r.length;n++)if(r[n].participantId===t)return!0;return!1}return e.participants.find(function(e){return n(e,t)})},t.hasStagingGroup=function(e){return!!(e&&e.meetingGroupDetails&&e.meetingGroupDetails.groups)&&Object.keys(e.meetingGroupDetails.groups).findIndex(function(e){return"stagingGroup"===e})>-1},t.getSourceIdForMediaType=r,t.getSourceId=function(e,t,n){if(!e||!e.endpoints)return-1;var o=i.find(e.endpoints.endpointDetails,function(e){return null!=e&&e.participantId===t});if(!o)return r(e,n);if(!o.mediaStreams)return r(e,n);var s=i.find(o.mediaStreams,function(e){return a.mapMediaTypeStringToMediaType(e.type)===n});return s?s.sourceId:-1},t.getParticipantIdForSourceId=function(e,t,n){try{if(null!=e.endpoints)for(var r=0,i=e.endpoints.endpointDetails;r<i.length;r++){var o=i[r];if(null!=o&&null!=o.mediaStreams)for(var s=0,c=o.mediaStreams;s<c.length;s++){var l=c[s];if(n===l.sourceId&&a.mapMediaTypeStringToMediaType(l.type)===t)return null!=o.participantId?o.participantId:null}}return}catch(e){return}},t.getSharingParticipantLeg=function(e){function t(e){return"sendonly"===e.direction&&"applicationsharing-video"===e.label}if(e.endpoints&&e.endpoints.endpointDetails){if(1===e.endpoints.endpointDetails.length)return e.endpoints.endpointDetails[0].participantId;var n=i.find(e.endpoints.endpointDetails,function(e){return null!=e&&null!=e.mediaStreams&&i.some(e.mediaStreams,t)});if(n&&n.participantId)return n.participantId}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.participantIntProps=t.participantStrProps=void 0;var o=n(7),a=n(11),s=n(37),c=n(42),l=n(41),u=n(18),d=n(10),p=n(44),h=SlimCore.Enums,g=n(22),f=n(33),_=n(9),m=n(53),v=n(54),y=(r={},r[0]=[1,2,3,4,6,7,5,8],r[1]=[2,3,4,6,7,0,8],r[2]=[0,1,3,4,6,7,8],r[3]=[2,1,4,5,0,7,8],r[4]=[0],r[5]=[3,7,4,0,8],r[6]=[3,8,4,0],r[7]=[3,8,4,0],r[8]=[3,5,4],r);t.participantStrProps={displayName:{propKey:h.Property.ParticipantDisplayName},role:{propKey:h.Property.ParticipantRole},tenantId:{propKey:h.Property.ParticipantTenantId},acceptedBy:{propKey:h.Property.ParticipantAcceptedBy},endpointDetails:{propKey:h.Property.ParticipantEndpointDetails},meetingRole:{propKey:h.Property.ParticipantMeetingRole}},t.participantIntProps={isServerMuted:{propKey:h.Property.ParticipantIsServerMuted},capabilities:{propKey:h.Property.ParticipantCapabilities,fallback:SlimCore.Enums.Capability.All},contentRole:{propKey:h.Property.ParticipantContentRole,fallback:h.ContentSharingRole.None},status:{propKey:h.Property.ParticipantStatus},failure:{propKey:h.Property.ParticipantFailureReason}};var C=function(e){function n(t,r,i,o,a,s,c,l,d,p,h){var g;void 0===c&&(c=0),void 0===p&&(p=!1);var f=e.call(this,t.createChild(function(){return"ICallParticipant["+u.scrubMriOrOmit(f.id)+"]["+f.state+"]["+f.slimcoreObjectId+"]"}),r,i)||this;return f._callHandler=a,f._streamContextMap=s,f._callTelemetry=l,f._participantIdMapperFactory=d,f.streams=(g={},g[0]=[],g[1]=[],g),f.voiceLevel=0,f.isServerMuted=!1,f.dominantSpeakerRank=0,f.state=0,f.id=null,f.role=null,f.tenantId=null,f.balanceUpdates={},f.enableParticipantLegToSourceIdMapping=!0,f.id=m.stripMriAliases(o),f._logger.log("created"),f.participantCapabilities=n.convertCapabilities(SlimCore.Enums.Capability.All),c&&0!==c&&f.attachSlimcoreObjectId(c,"ctor",p,h),f._slimcoreInstance.ecsGetSettingAsBool&&(f.enableParticipantLegToSourceIdMapping=f._slimcoreInstance.ecsGetSettingAsBool("SkypeCalling","enableParticipantLegToSourceIdMapping",!0)),f._logger.log("created enableParticipantLegToSourceIdMapping: "+f.enableParticipantLegToSourceIdMapping),f}return i(n,e),n.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,slimcoreObjectId:this.slimcoreObjectId,state:this.state,isServerMuted:this.isServerMuted})},n.prototype.attachSlimcoreObjectId=function(e,r,i,o){var a=this;if(void 0===i&&(i=!1),this.slimcoreObjectId&&0!==this.slimcoreObjectId)this._logger.debug("Attach called on existing participant");else{this.slimcoreObjectId=e;var s=o&&o.props||this._getProperties(this._callHandler,this.slimcoreObjectId,t.participantStrProps,t.participantIntProps);this.displayName=s.displayName,this.role=s.role,this.tenantId=s.tenantId,this.participantCapabilities=n.convertCapabilities(s.capabilities),this.acceptedBy=s.acceptedBy,this.isServerMuted=!!s.isServerMuted,this.meetingRole=s.meetingRole,this._slimCoreElectronRemoteStreamManager=new c.default(this._logger,this._settings,this._slimcoreInstance,this._callHandler,this.slimcoreObjectId,this.streams,this._streamContextMap,this._participantIdMapperFactory,i),this._slimCoreElectronRemoteStreamManager.changed(function(){return a.raiseChanged()}),this._updateEndpointDetails(s.endpointDetails),this._onParticipantPropertyChanged(h.Property.ParticipantStatus,function(e){return a._onStatusChanged(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantIsServerMuted,function(e){return a._onIsServerMuted(!!e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantFailureReason,function(e){return a._onFailureReasonChange(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantAdmitFailureReason,function(e){return a._onAdmitFailureReasonChange(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantRemoveFailureReason,function(e){return a._onRemoveFailureReasonChange(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantIsActiveSpeaker,function(e){return a.setVoiceLevel(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantDominantSpeakerRank,function(e){return a._onDominantSpeakerRankChanged(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantEndpointDetails,function(e){return a._updateEndpointDetails(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantCapabilities,function(e){return a._onCapabilitiesChanged(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantAcceptedBy,function(e){return a._onAcceptedByChanged(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantRole,function(e){return a._onRoleChanged(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantTenantId,function(e){return a._onTenantIdChanged(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantContentRole,function(e){return a._onParticipantContentSharingRoleChanged(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantBalanceUpdate,function(e){return a._onBalanceUpdateChanged(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantDiagnosticsCode,function(e){return a.onParticipantDiagnosticsCodeChanged(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantMeetingRole,function(e){return a._onMeetingRoleChanged(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantMriIdentity,function(e){return a._onMriChanged(e.value)}),this._onParticipantPropertyChanged(h.Property.ParticipantDisplayName,function(e){return a._onDisplayNameChanged(e.value)}),this._onStatusChanged(s.status,!1,s.failure),this._onParticipantContentSharingRoleChanged(s.contentRole)}},n.prototype.getStrProperty=function(e,t){return this._getStrProperty(this._callHandler,this.slimcoreObjectId,e,t)},n.prototype.getIntProperty=function(e,t){return this._getIntProperty(this._callHandler,this.slimcoreObjectId,e,t)},n.prototype._onParticipantPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.slimcoreObjectId,e,t)},n.prototype._onCapabilitiesChanged=function(e){var t=n.convertCapabilities(e);t!==this.participantCapabilities&&(this._logger.info("Computed capabilities: "+JSON.stringify(t)),this.participantCapabilities=t,this.raiseChangedDeferred())},n.prototype._onAcceptedByChanged=function(e){e!==this.acceptedBy&&(this._logger.info("Accepted by is set to "+u.scrubMriOrOmit(e)),this.acceptedBy=e,this.raiseChanged())},n.prototype._onRoleChanged=function(e){e!==this.role&&(this._logger.info("Role is set to "+e),this.role=e,this.raiseChanged())},n.prototype._onTenantIdChanged=function(e){e!==this.tenantId&&(this._logger.info("TenantId is set to "+e),this.tenantId=e,this.raiseChanged())},n.prototype._onMeetingRoleChanged=function(e){e!==this.meetingRole&&(this._logger.info("_onMeetingRoleChanged meetingRole: "+e),this.meetingRole=e,this.raiseChanged())},n.prototype._onMriChanged=function(e){e!==this.id&&(this._logger.info("_onMriChanged from old mri "+u.scrubMriOrOmit(this.id)+" to new Mri: "+u.scrubMriOrOmit(e)),this.previousId=this.id,this.id=e,this.raiseChanged())},n.prototype._onDisplayNameChanged=function(e){e!==this.displayName&&(this._logger.info("_onDisplayNameChanged new displayName: "+u.scrubMriOrOmit(e)),this.displayName=e,this.raiseChanged())},n.prototype.raiseChangedDeferred=function(){var e=this;this._raiseChangedDefer||(this._raiseChangedDefer=o.defer(function(){delete e._raiseChangedDefer,e.raiseChanged()}))},n.prototype.getParticipantIdForSourceId=function(e,t){var n=v.getParticipantIdForSourceId(this,e,t);return n||this._logger.warn("participantId is "+n+" for mediaType: "+e+", sourceId: "+t),n},n.prototype.hasSourceId=function(e,t){return this.enableParticipantLegToSourceIdMapping?void 0!==v.getParticipantIdForSourceId(this,e,t):this.getSourceIdForMediaType(e)===t},n.prototype.getSourceIdForMediaType=function(e){var t=v.getSourceIdForMediaType(this,e);return-1===t&&this._logger.warn("getSourceIdForMediaType failed"),t},n.prototype.getSourceId=function(e,t){if(!this.enableParticipantLegToSourceIdMapping)return this.getSourceIdForMediaType(t);if(!this.endpoints)return this._logger.warn("endpoints is invalid"),-1;try{var n=o.find(this.endpoints.endpointDetails,function(t){return null!=t&&t.participantId===e});if(!n)return this._logger.warn("participantId not found: "+e),this.getSourceIdForMediaType(t);if(!n.mediaStreams)return this._logger.warn("participantLeg "+e+" does not have valid mediaStreams"),this.getSourceIdForMediaType(t);var r=o.find(n.mediaStreams,function(e){return l.mapMediaTypeStringToMediaType(e.type)===t});return r?r.sourceId:(this._logger.warn("participantLeg "+e+" has no channel of type "+t),-1)}catch(e){this._logger.error("getSourceId caught exception error="+e)}return-1},n.prototype.getSharingParticipantLeg=function(){var e=v.getSharingParticipantLeg(this);return e||this._logger.warn("getSharingParticipantLeg could not find sharer participantId"),e},n.getEndpointDetailsLogString=function(e){if(!e||!e.endpointDetails)return"";var t=[];return e.endpointDetails.forEach(function(e){t.push({participantId:e.participantId,endpointId:e.endpointId,clientVersion:e.clientVersion,mediaStreams:e.mediaStreams})}),JSON.stringify(t)},n.prototype._updateEndpointDetails=function(e){if(this._logger.log("[_updateEndpointDetails] rawEndpointDetails "+e),this._rawEndpoints!==e&&e){try{this.endpoints=JSON.parse(e),this._rawEndpoints=e,this._logger.info("Updating endpointDetails: "+n.getEndpointDetailsLogString(this.endpoints))}catch(t){return void this._logger.warn("Failed to parse call member endpointDetails - "+t+" -"+e)}this.raiseChanged()}},n.prototype._onStatusChanged=function(e,t,r){void 0===t&&(t=!0);var i=_.generateCauseId(),o=void 0!==r?r:this.getIntProperty(h.Property.ParticipantFailureReason),a=n.convertParticipantStatus(e);this._logger.info("["+i+"]Status changed "+e+" ("+h.CallStatus[e]+") participantState="+a),void 0!==a?(this.setState(a,i,p.convertStatusAndFailureReasonToParticipantReason(e,o),t),this._admitParticipantDeffered&&n.isParticipantActive(this.state)&&(this._admitParticipantDeffered.resolve(),this._admitParticipantDeffered=null),this._removeParticipantDeffered&&!n.isParticipantActive(this.state)&&(this._removeParticipantDeffered.resolve(),this._removeParticipantDeffered=null)):this._logger.warn("Unrecognized "+a)},n.prototype._onParticipantContentSharingRoleChanged=function(e){this._logger.log("Content sharing role changed "+e+" ("+h.ContentSharingRole[e]+")"),this.setContentSharingRole(n.convertContentSharingRole(e))},n.prototype._onFailureReasonChange=function(e){var t=_.generateCauseId();this._logger.info("["+t+"]Failure reason changed "+e+" ("+h.ParticipantFailureReason[e]+")");var r=this.getIntProperty(h.Property.ParticipantStatus);this.setState(n.convertParticipantStatus(r),t,p.convertFailureReasonToParticipantReason(e))},n.prototype._onAdmitFailureReasonChange=function(e){var t=d.hasFeature(h.Feature.AsyncAdmitResponse);this._logger.info("Admit failure reason changed "+e+" ("+h.ParticipantFailureReason[e]+") asyncAdmitResponse="+t);var n=p.convertFailureReasonToParticipantReason(e);t?e!==h.ParticipantFailureReason.NoFailure?this.rejectAdmitParticipantDeferred(n):this.resolveAdmitParticipantDeferred():e!==h.ParticipantFailureReason.NoFailure&&this.rejectAdmitParticipantDeferred(n)},n.prototype._onRemoveFailureReasonChange=function(e){if(this._logger.info("Remove failure reason changed "+e+" ("+h.ParticipantFailureReason[e]+")"),e!==h.ParticipantFailureReason.NoFailure){var t=p.convertFailureReasonToParticipantReason(e);this.rejectRemoveParticipantDeferred(t)}},n.prototype.setVoiceLevel=function(e){this.voiceLevel!==e&&(this.voiceLevel=e,this.raiseChanged())},n.prototype._onIsServerMuted=function(e){e!==this.isServerMuted&&(this.isServerMuted=e,this.raiseChanged())},n.prototype._onDominantSpeakerRankChanged=function(e){this.dominantSpeakerRank!==e&&(this._logger.info("DominantSpeakerRank changing from "+this.dominantSpeakerRank+" to "+e),this.dominantSpeakerRank=e,this.raiseChanged())},n.prototype._onBalanceUpdateChanged=function(e){if(o.isEmpty(e))o.isEmpty(this.balanceUpdates)||(this.balanceUpdates={},this.raiseChanged());else{try{var t=JSON.parse(e);if(o.isEqual(this.balanceUpdates[t.sender.endpointId],t))return;this.balanceUpdates[t.sender.endpointId]=t}catch(t){return void this._logger.warn("Failed to parse call member balanceUpdate - "+t+" -"+e)}this.raiseChanged()}},n.prototype.onParticipantDiagnosticsCodeChanged=function(e){this._logger.info("onParticipantDiagnosticsCodeChanged diagnosticsCode: "+e),this._updateDiagnosticsCode(e)},n.prototype._updateDiagnosticsCode=function(e){if(this._rawCallEndDiagnosticsInfo!==e&&e)try{this.callEndDiagnosticsInfo=JSON.parse(e),this._rawCallEndDiagnosticsInfo=e,this.raiseChanged()}catch(t){this._logger.info("Failed to parse raw diagnostis details. Error: "+t+", diagnosticsCode: "+e)}},n.prototype.setContentSharingRole=function(e){this.contentSharingRole!==e&&(this.contentSharingRole=e,this.raiseChanged())},n.prototype.setState=function(e,t,n,r){if(void 0===r&&(r=!0),this.state!==e){var i=y[this.state].indexOf(e)>=0,o={state:this.state,reason:this.stateReason,endpoints:[]};if(this.endpoints&&this.endpoints.endpointDetails&&this.endpoints.endpointDetails.length&&(o.endpoints=f.getEndpointInformationForTelemetry(this.endpoints.endpointDetails)),!i)return this._logger.logFailure("Invalid state transition "+this.state+"->"+e+" attempted"),void this._callTelemetry.recordEvent(g.PARTICIPANT_OPERATIONS_INTERNAL.SET_PARTICIPANT_STATE_INVALID,o,t);if(this._logger.log("state="+this.state+"->"+e+" reason="+this.stateReason+"->"+n),this.state=e,this.stateReason=n,3===this.state&&r){var a=this.getStrProperty(h.Property.ParticipantEndpointDetails);this._updateEndpointDetails(a)}else if(4===this.state){var s=this.getStrProperty(h.Property.ParticipantDiagnosticsCode);this._updateDiagnosticsCode(s)}this.raiseChangedDeferred()}},n.convertParticipantStatus=function(e){return s.default.isCallRinging(e)?2:s.default.isCallTerminated(e)?4:s.default.isCallConnected(e)?3:s.default.isCallConnecting(e)?1:s.default.isCallEarlyMedia(e)?6:s.default.isCallInLobby(e)?7:s.default.isCallStaging(e)?8:e===h.CallStatus.LocalHold||e===h.CallStatus.RemoteHold?5:void 0},n.isParticipantActive=function(e){switch(e){case 3:case 6:case 5:case 8:return!0;default:return!1}},n.convertContentSharingRole=function(e){switch(e){case h.ContentSharingRole.Attendee:return 1;case h.ContentSharingRole.Presenter:return 2;default:return 0}},n.convertCapabilities=function(e){return{canConference:!!(e&h.Capability.Conference),canShareScreen:!!(e&h.Capability.ShareScreen),canMerge:!!(e&h.Capability.Merge)}},n.prototype.addAdmitParticipantDeferred=function(e){this._admitParticipantDeffered=e},n.prototype.rejectAdmitParticipantDeferred=function(e){this._admitParticipantDeffered&&(this._admitParticipantDeffered.reject(e),this._admitParticipantDeffered=null)},n.prototype.resolveAdmitParticipantDeferred=function(){this._admitParticipantDeffered&&(this._admitParticipantDeffered.resolve(),this._admitParticipantDeffered=null)},n.prototype.addRemoveParticipantDeferred=function(e){this._removeParticipantDeffered=e},n.prototype.rejectRemoveParticipantDeferred=function(e){this._removeParticipantDeffered&&(this._removeParticipantDeffered.reject(e),this._removeParticipantDeffered=null)},n.prototype.stopVideos=function(e){return this._slimCoreElectronRemoteStreamManager?this._slimCoreElectronRemoteStreamManager.stopVideos(e):Promise.resolve()},n.prototype.dispose=function(t){void 0===t&&(t=_.generateCauseId()),this._slimCoreElectronRemoteStreamManager&&this._slimCoreElectronRemoteStreamManager.dispose(t),this.streams[0]=[],this.streams[1]=[],this.resolveAdmitParticipantDeferred(),this._removeParticipantDeffered&&(this._removeParticipantDeffered.resolve(),this._removeParticipantDeffered=null),this.slimcoreObjectId=0,e.prototype.dispose.call(this,t)},n}(a.default);t.default=C},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(57),o=SlimCore.Enums,a=n(9),s=0,c=function(e){function t(t,n,r,i,a,c,l,u,d){var p=e.call(this,n.createChild(function(){return"RemoteVideoRenderer["+p._id+"]"}),r,i)||this;p._renderTarget=a,p._videoType=c,p._options=u,p._rendererTracker=d,p._id=s++,p._logger.info("constructor causeId: "+t);var h=c===o.VideoType.ScreenShare;return p._videoBinding=l,p._options=u||{scalingMode:h?2:1,transparent:h,ignoreMirroring:!1},p._createVideoRenderer(t,p._renderTarget,p._options,!1),p._rendererTracker.registerRenderer(t,p),p}return r(t,e),Object.defineProperty(t.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!1,configurable:!0}),t.prototype.clone=function(e){var n=a.generateCauseId();return this._logger.info("clone causeId: "+n),new t(n,this._logger,this._settings,this._slimcoreInstance,e,this._videoType,this._videoBinding,this._options,this._rendererTracker)},t.prototype.dispose=function(t){void 0===t&&(t=a.generateCauseId()),this._logger.info("dispose causeId: "+t);try{e.prototype.dispose.call(this,t)}finally{this._renderTarget=null,this._rendererTracker&&(this._rendererTracker.unregisterRenderer(t,this),this._rendererTracker=null)}},t}(i.default);t.default=c},function(e,t,n){"use strict";function r(e){return void 0!==e.renderer}function i(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;default:return-1}}function o(e){switch(e.reason){case 1:return 2;case 2:return 3;default:return 1}}function a(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;default:return}}var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var c=n(7),l=n(12),u=n(11),d=n(9),p=n(10),h=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.isRendering=!1,o._paused=!1,o._isFrameSinkSet=!1,o._videoElementSizeChangeIntervalHandle=0,o._isStartedLogged=!1,o._frameTypeChanged=function(e){o._logger.info("frame-type-changed: "+e.type),o.event("frameTypeChanged").raise(i(e.type))},o._frameSizeChanged=function(e){o._logger.info("frame-size-changed: "+e.width+" x "+e.height)},o._firstFrameRendered=function(e){o._logger.info("first-frame-rendered"),o.event("firstFrameRendered").raise()},o._fullFrameRenderRequired=function(e){o._logger.info("full-frame-render-required: "+e.fullFrameRenderRequired),o.event("fullFrameRenderRequired").raise(e.fullFrameRenderRequired)},o._videoUriChangedUwp=function(e){o._videoElement&&(o._videoElement.src=e.uri||"")},o._videoResizedUwp=function(){o._videoSizeChanged(o._videoElement.videoWidth,o._videoElement.videoHeight)},o._videoPausedUwp=function(){o._videoElement&&(o._videoElement.src=o._videoBindingRT.uri||"",o._videoElement.play())},o}return s(t,e),t.prototype.dispose=function(t){this._logger.info("dispose causeId: "+t),this._disposeVideoRenderer(t),e.prototype.dispose.call(this,t)},Object.defineProperty(t.prototype,"rendererType",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frameType",{get:function(){return this._frameSink&&this._frameSink.getFrameType?i(this._frameSink.getFrameType()):-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(e){if(this._settings.platform!==p.PlatformType.Electron)throw new Error("Only implemented for Electron renderer");e!==this._paused&&(this._frameSink&&this._controlFrameSink(d.generateCauseId(),!e),this._paused=e)},enumerable:!1,configurable:!0}),t.prototype.captureFrame=function(e,t){return this._videoBinding?this._videoBinding.captureFrame({timeout:e,bufferName:t}).then(function(e){return new g(p.convertImageData(e.image),e.mirror)}):Promise.resolve(void 0)},t.prototype.getStats=function(){var e=this;return l.asap(function(){return e._getStats()})},t.prototype.setScalingMode=function(e){var t=this;return this._renderer?this._renderer.setScalingMode(a(e)):this._videoElement?l.asap(function(){t._videoElement.msZoom=1===e}):Promise.reject("No video renderer")},t.prototype.dumpVideoSourceImages=function(){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype.cameraAutoControl=function(e){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype.getCameraManualControlStates=function(e){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype.setCameraManualControlStates=function(e){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype.enumerateCameraManualControls=function(){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype._createVideoRenderer=function(e,t,n,r){switch(this._settings.platform){case p.PlatformType.Electron:return this._createVideoRendererElectron(e,t,n);case p.PlatformType.Uwp:return this._createVideoRendererUwp(e,t,n,r);default:throw new Error("Unsupported platform: "+this._settings.platform)}},t.prototype._createVideoRendererElectron=function(e,t,n){var i=this;if(this._frameSink)return this._logger.info("_createVideoRendererElectron causeId: "+e+" Reusing renderer"),void this._controlFrameSink(e,!0);r(t)?this._renderer=t.renderer:this._renderer=this._createVideoRendererImpl(e,t,n),this._renderer.on("video-size-changed",function(e){return i._videoSizeChanged(e.width,e.height)}),this._frameSink&&(this._frameSink.on("frame-type-changed",this._frameTypeChanged),this._frameSink.on("frame-size-changed",this._frameSizeChanged),this._frameSink.on("first-frame-rendered",this._firstFrameRendered),this._frameSink.on("full-frame-render-required",this._fullFrameRenderRequired),c.isBoolean(n.ignoreMirroring)&&this._frameSink.setIgnoreMirroring&&this._frameSink.setIgnoreMirroring(n.ignoreMirroring),this._controlFrameSink(e,!0))},t.prototype._createVideoRendererUwp=function(e,t,n,r){var i=this;this._logger.info("_createVideoRendererUwp causeId: "+e+" Creating uwp video renderer with uri "+this._videoBindingRT.uri),this._videoBindingRT.on("video-uri-changed",this._videoUriChangedUwp);var o=t;if(this._videoElement=o.ownerDocument.createElement("video"),o.appendChild(this._videoElement),this._videoElement.autoplay=!0,this._videoElement.msHorizontalMirror=!n.ignoreMirroring&&r,this._videoElement.msZoom=1===n.scalingMode,this._videoElement.style.backgroundColor=n.transparent?"":"black",this._videoElement.addEventListener("resize",this._videoResizedUwp),this._videoElement.src=this._videoBindingRT.uri||"",this._videoElement.addEventListener("pause",this._videoPausedUwp),!r&&this._videoBindingRT.setVideoPreference){var a={width:0,height:0};this._videoElementSizeChangeIntervalHandle=window.setInterval(function(){var e={width:i._videoElement.offsetWidth,height:i._videoElement.offsetHeight};c.isEqual(a,e)||(a=e,i._videoBindingRT.setVideoPreference(e.width,e.height))},2e3)}},t.prototype._disposeVideoRenderer=function(e,t){if(void 0===t&&(t=!1),this._frameSink){if(this._controlFrameSink(e,!1),t)return void this._logger.info("_disposeVideoRenderer causeId: "+e+" Keep renderer for reuse");this._frameSink.removeListener("frame-type-changed",this._frameTypeChanged),this._frameSink.removeListener("frame-size-changed",this._frameSizeChanged),this._frameSink.removeListener("first-frame-rendered",this._firstFrameRendered),this._frameSink.removeListener("full-frame-render-required",this._fullFrameRenderRequired)}this._renderer&&(this._renderer.removeAllListeners(),p.isDisposed(this._renderer)||this._renderer.dispose(),this._renderer=null),this._settings.platform===p.PlatformType.Uwp&&this._videoBindingRT&&this._videoBindingRT.removeListener("video-uri-changed",this._videoUriChangedUwp),this._videoElementSizeChangeIntervalHandle&&(clearInterval(this._videoElementSizeChangeIntervalHandle),this._videoElementSizeChangeIntervalHandle=0),this._videoElement&&(this._videoElement.removeEventListener("resize",this._videoResizedUwp),this._videoElement.removeEventListener("pause",this._videoPausedUwp),this._videoElement.remove(),this._videoElement=null)},Object.defineProperty(t.prototype,"_frameSink",{get:function(){return this._renderer?this._renderer.getFrameSink():null},enumerable:!1,configurable:!0}),t.prototype._videoSizeChanged=function(e,t){this._logger.info("video-size-changed: "+e+" x "+t),this.streamSize={width:e,height:t},this.isRendering=e>0&&t>0,!this._isStartedLogged&&this.isRendering&&(this._logger.info("renderStarted"),this.event("renderStarted").raise(),this._isStartedLogged=!0),this.event("videoSizeChanged").raise(e,t),this.raiseChanged()},t.prototype._getStats=function(){if(!this._frameSink)throw new Error("Renderer is not initialized");if(this._frameSink.getStats)return this._frameSink.getStats();throw new Error("Renderer does not support stats")},Object.defineProperty(t.prototype,"frameSinkMetadata",{get:function(){return this._frameSink&&this._frameSink.getMetadata?this._frameSink.getMetadata():null},enumerable:!1,configurable:!0}),t.prototype._createVideoRendererImpl=function(e,t,n){var r={container:t,transparent:n.transparent,scalingMode:a(n.scalingMode),useBufferSharing:!!this._settings.enableBufferSharing,logger:this._logger};try{var i=SlimCore.createChromiumFrameSink?SlimCore.createChromiumFrameSink({enableTextureSharing:!!this._settings.enableTextureSharing}):SlimCore.createPepperFrameSink();return VideoRenderer.createChromiumVideoRenderer(i,r)}catch(t){throw this._logger.error("createChromiumVideoRenderer causeId: "+e+" failed: "+t),new f(t,o(t))}},Object.defineProperty(t.prototype,"_videoBindingRT",{get:function(){return this._videoBinding},enumerable:!1,configurable:!0}),t.prototype._controlFrameSink=function(e,t){this._videoBinding&&this._isFrameSinkSet!==t&&(this._isFrameSinkSet=t,t?this._videoBinding.addFrameSink(this._frameSink):p.isDisposed(this._frameSink)?this._logger.warn("_controlFrameSink causeId: "+e+" frame sink already disposed"):this._videoBinding.removeFrameSink(this._frameSink))},t}(u.default);t.default=h;var g=function(){function e(e,t){this._imageData=e,this._mirrored=t}return e.prototype.getSize=function(){return{width:this._imageData.width,height:this._imageData.height}},e.prototype.isMirrored=function(){return this._mirrored},e.prototype.getImageData=function(){return this._imageData},e}(),f=function(){function e(e,t){void 0===t&&(t=-1),this.reason=e,this.errorType=t}return e.prototype.toString=function(){return"Reason="+this.reason+", errorType="+this.errorType},e}()},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var c=n(7),l=n(10),u=n(11),d=n(59),p=SlimCore.Enums,h=n(22),g=n(34),f=n(35),_=function(e){function t(t,n,r,i,o,a,s,c,l,u){var p=e.call(this,n.createChild(function(){return"LocalScreenShare["+p._localVideoObjectId+"]"}),r,i)||this;p._callObjectId=o,p._callHandler=a,p._deviceManager=s,p._appHooks=c,p._screenSharingControl=l,p._callTelemetry=u,p.isStreaming=!1,p.isAvailable=!0,p.mediaType=2,p._localVideoObjectId=0,p._previewVideoObjectId=0,p._editViewPPTWindowId=0,p._canHandleEvents=!1,p._logger.info("constructor"),p._callOperationHandler=new f.default(p._logger,p._callTelemetry);try{p._screenScraper=new d.default(p._slimcoreInstance)}catch(e){p._logger.warn(""+e)}return p._screenScraper&&p._registerDisposable(p._appHooks.onDisplaysChanged(function(){return p.handleDisplaysChanged(t)})),p}return r(t,e),t.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},t.prototype._showSharingIndicator=function(e){var t=this;this._appHooks.showSharingIndicator(e);var n=this._appHooks.getControlInjector();n&&n.setInjectionRect&&n.setInjectionRect(e).catch(function(n){var r=JSON.stringify({errorMsg:n,region:e});t._screenSharingControl.enableScreenSharingControl(!1,0,r),t._logger.error("Set control Injector failure, disable screen sharing control. Error: "+n)})},t.prototype._videoObjectChanged=function(e,t){this.isAvailable=l.isVideoAvailable(t),this.isStreaming=!1,l.isVideoInState(t,[p.VideoStatus.Starting,p.VideoStatus.Running])&&(this._selectedMonitor||this._selectedWindow||this._selectedCamera?(this.isStreaming=!0,this._selectedCamera||this._appHooks.showSharingIndicator(this._selectedRegion||this._selectedMonitor&&this._selectedMonitor.region||this._selectedWindow&&this._selectedWindow.windowId)):l.forgetAndLog(this.stop(e),this._logger,"stopping screen sharing due to no monitor/camera being selected")),l.isVideoInState(t,[p.VideoStatus.Paused])&&this._appHooks.hideSharingIndicator(),this.raiseChanged()},t.prototype._videoErrorChanged=function(e){e&&(this._logger.error("VideoError: "+e),this.event("videoError").raise(e))},t.prototype._setCaptureRegionAndWindow=function(e,t){if(!this._slimcoreInstance.setScreenCaptureRectangle){if(this._videoBindingScreenShare)return this._slimcoreInstance.updateShellSharingWindowId&&void 0!==t&&this._slimcoreInstance.updateShellSharingWindowId(t),void this._videoBindingScreenShare.setCaptureRegionAndWindow(e,t);throw new Error("Failed to set capture region / window")}this._slimcoreInstance.setScreenCaptureRectangle(this._localVideoObjectId,e,void 0,t)},t.prototype._handleScraperEvent=function(e){this._logger.info("Handle Scraper event, event = "+e.event+" data = "+e.data);var t=e.data;switch(e.event){case p.ScraperEvent.PPTPresenterView_Enter:this._editViewPPTWindowId=this._selectedWindow.windowId,this._selectedWindow.windowId=t,this._appHooks.showSharingIndicator(t),this._setCaptureRegionAndWindow(void 0,t),this._logger.info("shared PPT entered presenter mode");break;case p.ScraperEvent.PPTPresenterView_Exit:this._selectedWindow.windowId=this._editViewPPTWindowId,this._appHooks.showSharingIndicator(this._selectedWindow.windowId),this._setCaptureRegionAndWindow(void 0,this._selectedWindow.windowId),this._logger.info("shared PPT exited presenter mode");break;case p.ScraperEvent.WindowClosed:if(this._selectedWindow.windowId!==t)return;this._logger.info("Application window closed. Stopping the screenshare"),this.event("windowClosed").raise();break;default:this.event("scraperEvent").raise(e)}},t.prototype._startPreviewVideoObject=function(e){var t=this;return this._shouldUseVideoBindingScreenShare()?this._deviceManager.getPreviewVideo(e,p.VideoType.ScreenShare).then(function(n){return t._deviceManager.getScreenShareBindingManager().acquire(e,t,n).then(function(e){t._previewVideoObjectId=n,t._videoBindingScreenShare=e,t._videoBindingScreenShare.on("scraper-event",function(e){return t._handleScraperEvent(e)})})}):Promise.resolve()},t.prototype._stopPreviewVideoObject=function(e,t){if(this._shouldUseVideoBindingScreenShare()){if(this._previewVideoObjectId&&this._videoBindingScreenShare){t.info("calling slimcore video release binding"),this._videoBindingScreenShare.removeAllListeners("scraper-event");var n=this._deviceManager.getScreenShareBindingManager().release(e,this,this._previewVideoObjectId).catch(function(e){return t.error("Failed on releasing screen sharing binding. Error: "+e)});return this._previewVideoObjectId=0,this._videoBindingScreenShare=null,n}return Promise.resolve()}return Promise.resolve()},t.prototype._shouldUseVideoBindingScreenShare=function(){return!this._slimcoreInstance.setScreenCaptureRectangle&&this._deviceManager.hasVideoBindingScreenShare()},t.prototype.start=function(e,t,n,r){var i=this,o=this._logger.createFnLogger(h.CALL_OPERATIONS_INTERNAL.ELECTRON_START_SCREEN_SHARING,e);o.info("local screen share start");var c=Promise.resolve().then(function(){return a(i,void 0,void 0,function(){var i,a,c,u,d=this;return s(this,function(s){switch(s.label){case 0:if(!(i=this.sourceToInfo(t)))throw new Error("Unable to start sharing, source could not be found");return o.info("calling slimcore create local video"),(a=!!t&&3===t.getType())?(c=i,this._localVideoObjectId=this._slimcoreInstance.createLocalVideo(p.VideoType.ScreenShare,c.label,c.id)):this._localVideoObjectId=this._slimcoreInstance.createLocalVideo(p.VideoType.ScreenShare,"",""),this._videoStatusChangedHandler=this._slimcoreInstance.handle("object-property-changed",{objectId:this._localVideoObjectId,propKey:p.Property.VideoStatus},function(t){return d._videoObjectChanged(e,t.value)}),this._videoErrorChangedHandler=this._slimcoreInstance.handle("object-property-changed",{objectId:this._localVideoObjectId,propKey:p.Property.VideoError},function(e){return d._videoErrorChanged(e.value)}),u=this._getIntProperty(this._callHandler,this._localVideoObjectId,p.Property.VideoStatus),l.isVideoInState(u,[p.VideoStatus.Starting,p.VideoStatus.Running])?(o.info("Screenshare already starting/running, resolving early."),[2,Promise.resolve()]):(this._videoObjectChanged(e,u),this._callHandler.callAttachSendVideo(this._callObjectId,this._localVideoObjectId),o.info("waiting for video object to be available"),[4,l.waitForVideoObjectState({slimcoreInstance:this._slimcoreInstance,slimcoreObject:this._callHandler,videoObjectId:this._localVideoObjectId,logger:this._logger,causeId:e,resolveStates:[p.VideoStatus.Available],rejectStates:[],timeout:500})]);case 1:return s.sent(),a?[3,3]:(o.info("start preview video object"),[4,this._startPreviewVideoObject(e)]);case 2:s.sent(),s.label=3;case 3:return o.info("calling slimcore video start"),this._canHandleEvents=!0,this.selectSource(t,i,n),this.negotiationTag=r,this._slimcoreInstance.videoStart(this._localVideoObjectId,r),this.isStreaming=!0,this.raiseChanged(),[2]}})})});return this._callOperationHandler.registerPromise(h.CALL_OPERATIONS_INTERNAL.ELECTRON_START_SCREEN_SHARING,c).catch(function(t){o.logFailure("Failed to start LocalScreenShare. Error: "+t),i.stop(void 0,e),Promise.reject(t)})},t.prototype.changeCropRegion=function(e){var t=this.sourceToInfo(null);this.selectMonitorWithOptionalCrop(t,e)},t.prototype.stop=function(e,t){var n=this,r=this._logger.createFnLogger(h.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING,e),i=function(){n._localVideoObjectId=0,n.isStreaming=!1,n._selectedMonitor=null,n._selectedRegion=null,n._selectedWindow=null,n._selectedCamera=null,n._editViewPPTWindowId=0,n._appHooks.hideSharingIndicator(),n._videoStatusChangedHandler&&(n._videoStatusChangedHandler.dispose(),n._videoStatusChangedHandler=null),n._videoErrorChangedHandler&&(n._videoErrorChangedHandler.dispose(),n._videoErrorChangedHandler=null),n.raiseChanged()},o=Promise.resolve().then(function(){n._canHandleEvents=!1,n._stopPreviewVideoObject(e,r)}).then(function(){0!==n._localVideoObjectId&&(r.info("calling slimcore video stop"),n.negotiationTag=t,n._slimcoreInstance.videoStop(n._localVideoObjectId,n.negotiationTag),n._slimcoreInstance.updateShellSharingWindowId&&n._slimcoreInstance.updateShellSharingWindowId(0))}).then(i,function(e){throw r.logFailure("Failed to stop LocalScreenShare. Error: "+e),i(),e});return this._callOperationHandler.registerPromise(h.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING,o)},t.prototype.dispose=function(t){this._logger.info("dispose causeId: "+t),0===this._localVideoObjectId&&0===this._previewVideoObjectId||this.stop(t),this._videoStatusChangedHandler&&(this._videoStatusChangedHandler.dispose(),this._videoStatusChangedHandler=null),this._videoErrorChangedHandler&&(this._videoErrorChangedHandler.dispose(),this._videoErrorChangedHandler=null),e.prototype.dispose.call(this,t)},t.prototype.selectSource=function(e,t,n){e&&2===e.getType()?this.selectWindow(t):e&&3===e.getType()?this._selectedCamera=t:this.selectMonitorWithOptionalCrop(t,n)},t.prototype.selectMonitorWithOptionalCrop=function(e,t){var n=t||e.region;this._logger.info("Selected region with optional crop, x = "+n.x+", y = "+n.y+", width = "+n.width+" height = "+n.height),this._showSharingIndicator(n),this._setCaptureRegionAndWindow(n),this._selectedMonitor=e,this._selectedRegion=t},t.prototype.selectWindow=function(e){this._appHooks.showSharingIndicator(e.windowId),this._setCaptureRegionAndWindow(void 0,e.windowId),this._selectedWindow=e},t.prototype.handleDisplaysChanged=function(e){var t=this._logger.createFnLogger("HandleDisplaysChanged",e);if(this._canHandleEvents)if(this._selectedMonitor){var n=function(e){try{return JSON.stringify(e)}catch(e){return"unable to stringify"}};if(t.info("On display change, currenlty selected monitor: "+n(this._selectedMonitor)+" selected region:  "+n(this._selectedRegion)),!this._selectedRegion){for(var r=this._screenScraper.getMonitorList()||[],i=0,o=r;i<o.length;i++){var a=o[i];t.info("On display change, new listed monitor: "+n(a))}var s=l.selectMonitorForScreenSharing(this._selectedMonitor,r);if(s)return t.info("On display change, re-selected monitor: "+n(s)),void this.selectMonitorWithOptionalCrop(s)}t.info("stopping screen share because displays changed and could not resolve monitor info"),l.forgetAndLog(this.stop(e),t,"stopping screen share because sharing source lost"),this.event("sharingSourceLost").raise()}else t.logFailure("On display change, monitor not seleted yet");else t.logFailure("LocalScreenShare is not running, ingnoring events")},t.prototype.sourceToInfo=function(e){if(!e){if(this._screenScraper){t=this._screenScraper.getMonitorList()||[];return c.find(t,function(e){return e.isPrimary})}return this._logger.error("ScreenShare has no way to recover primary monitor"),null}switch(e.getType()){case 2:t=this._screenScraper.getWindowList()||[];return c.find(t,function(t){return t.windowId===e.getId()});case 1:if(!this._screenScraper)return{monitorId:0,name:e.getDescription(),region:e.getBounds(),isPrimary:!0,isInternal:!0,isDuplicated:!1};var t=this._screenScraper.getMonitorList()||[];return c.find(t,function(t){return t.monitorId===e.getId()||c.isEqual(t.region,e.getBounds())});case 3:return this._deviceManager.getCamera(e.getDeviceId());default:throw new Error("Invalid source type: "+e.getType())}},i([g.callOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_START_SCREEN_SHARING,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING}),o("design:type",Function),o("design:paramtypes",[String,Object,Object,String]),o("design:returntype",Promise)],t.prototype,"start",null),i([g.callOperation(h.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING,{waitFor:h.CALL_OPERATIONS_INTERNAL.ELECTRON_START_SCREEN_SHARING}),o("design:type",Function),o("design:paramtypes",[String,String]),o("design:returntype",Promise)],t.prototype,"stop",null),t}(u.default);t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=function(){function e(e){if(this._slimcoreInstance=e,!this._slimcoreInstance.getMonitorList||!this._slimcoreInstance.getWindowList){var t=r.isSlimCoreRTModuleAvailable()?SlimCoreRT.SlimCore:SlimCore;if(!t.ScreenScraper)throw new Error("ScreenScraper not supported");this._screenScraper=new t.ScreenScraper}}return e.prototype.getMonitorList=function(){if(this._slimcoreInstance.getMonitorList)return this._slimcoreInstance.getMonitorList();if(this._screenScraper)return this._screenScraper.getMonitorList();throw new Error("not supported")},e.prototype.getMonitorPreview=function(e,t,n,i,o){return this._slimcoreInstance.getMonitorSnapshot?this._slimcoreInstance.getMonitorSnapshot(e,{width:t,height:n,asImage:i},o).then(r.convertImageData):this._screenScraper?this._screenScraper.getMonitorPreview(e,t,n,i):Promise.reject(new Error("not supported"))},e.prototype.getWindowList=function(){if(this._slimcoreInstance.getWindowList)return this._slimcoreInstance.getWindowList();if(this._screenScraper)return this._screenScraper.getWindowList();throw new Error("not supported")},e.prototype.getWindowPreview=function(e,t,n,i){return this._slimcoreInstance.getWindowSnapshot?this._slimcoreInstance.getWindowSnapshot(e,{width:t,height:n,asImage:i}).then(r.convertImageData):this._screenScraper?this._screenScraper.getWindowPreview(e,t,n,i):Promise.reject(new Error("not supported"))},e.prototype.getWindowIcon=function(e,t,n,i){return this._slimcoreInstance.getWindowIcon?this._slimcoreInstance.getWindowIcon(e,{width:t,height:n,asImage:i}).then(r.convertImageData):this._screenScraper?this._screenScraper.getWindowIcon(e,t,n,i):Promise.reject(new Error("not supported"))},e}();t.default=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0}),t.VideoStream=void 0;var a=n(7),s=n(30),c=n(10),l=n(11),u=SlimCore.Enums,d=n(9),p=0,h=function(e){function t(t,n,r,i,o,a,s,c,l){var d=e.call(this,n.createChild(function(){return"VideoStream["+d.objectId+":"+d.label+"]"}),r,i)||this;d._callHandler=o,d.objectId=a,d.label=s,d._negotiationTag=c,d.isStreaming=!1,d._isActive=!1,d._isDisposed=!1,d._logger.info("constructor causeId: "+t),l&&d._registerDisposable(l);var p=function(e){var t=e===u.VideoStatus.Running;t!==d.isStreaming&&(d.isStreaming=t,d._logger.info("videoStatusChanged isRunning: "+d.isStreaming+" status: "+e),d.raiseChanged())},h=function(e){e&&(d._logger.error("VideoError: "+e),d.event("videoError").raise(e))},g=d._getIntProperty(d._callHandler,d.objectId,u.Property.VideoStatus);return p(g),d._onObjectPropertyChanged(d.objectId,u.Property.VideoStatus,function(e){return p(e.value)}),d._onObjectPropertyChanged(d.objectId,u.Property.VideoError,function(e){return h(e.value)}),d}return r(t,e),t.prototype.startVideo=function(e){return i(this,void 0,void 0,function(){var t;return o(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this._logger.info("startVideo causeId: "+e+" start local video and wait it to become STARTING|RUNNING"),this._slimcoreInstance.videoStart(this.objectId,this._negotiationTag),[4,c.waitForVideoObjectState({slimcoreInstance:this._slimcoreInstance,slimcoreObject:this._callHandler,videoObjectId:this.objectId,logger:this._logger,causeId:e,resolveStates:[u.VideoStatus.Starting,u.VideoStatus.Running],rejectStates:[u.VideoStatus.Stopping,u.VideoStatus.NotStarted],timeout:1e3})];case 1:return n.sent(),this._isActive=!0,this._logger.info("startVideo causeId: "+e+" start local video successful"),[3,3];case 2:throw t=n.sent(),this._slimcoreInstance.videoStop(this.objectId,this._negotiationTag),t;case 3:return[2]}})})},t.prototype.stopVideo=function(e,t){return i(this,void 0,void 0,function(){var n;return o(this,function(r){switch(r.label){case 0:if(!this._isActive)return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),this._isActive=!1,t&&(this._logger.info("stopVideo causeId: "+e+" stop local video and wait it to become STOPPING|NOT_STARTED|AVAILABLE"),this._slimcoreInstance.videoStop(this.objectId,this._negotiationTag)),[4,c.waitForVideoObjectState({slimcoreInstance:this._slimcoreInstance,slimcoreObject:this._callHandler,videoObjectId:this.objectId,logger:this._logger,causeId:e,resolveStates:[u.VideoStatus.Stopping,u.VideoStatus.NotStarted,u.VideoStatus.Available],rejectStates:[],timeout:1e3})];case 2:return r.sent(),this._logger.info("stopVideo causeId: "+e+" stop local video successful callVideoStop: "+t),[3,4];case 3:return n=r.sent(),this._logger.error("stopVideo causeId: "+e+" stop local video failed. error: "+n),[3,4];case 4:return[2]}})})},t.prototype._logControlSkip=function(e,t){var n=this._isDisposed?"stream disposed":"stream already "+(this._isActive?"active":"inactive");this._logger.info("control causeId: "+e+", activate: "+t+" skipped, reason: "+n)},t.prototype.control=function(e,t){return i(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return this._isDisposed||this._isActive===t?(this._logControlSkip(e,t),[2]):(this._logger.info("control causeId: "+e+", attempting to "+(t?"start":"stop")+" video"),t?[4,this.startVideo(e)]:[3,2]);case 1:return n.sent(),[3,4];case 2:return[4,this.stopVideo(e,!0)];case 3:n.sent(),n.label=4;case 4:return[2]}})})},t.prototype.dispose=function(t){this.isStreaming=!1,this._isDisposed=!0,e.prototype.dispose.call(this,t)},t}(l.default);t.VideoStream=h;var g=function(e){function t(t,n,r,i,o,a,c,l){var u=e.call(this,n.createChild(function(){return"LocalVideo["+u._id+"]"}),r,i)||this;u._callObjectId=o,u._callHandler=a,u._deviceManager=c,u._options=l,u._id=p++,u._state=null,u._shouldRun=!1,u._disableFastCameraSwap=!1,u.mediaType=1,u.isStreaming=!1;try{u._disableFastCameraSwap=u._slimcoreInstance.ecsGetSettingAsBool("MediaAgent","tsc_disableFastCameraSwap",!1)}catch(e){u._logger.logFailure(e)}return u._logger.info("constructor causeId: "+t+" disableFastCameraSwap "+u._disableFastCameraSwap),u._chainedApiPromise=new s.default(n.createChild(function(){return"LocalVideo["+u._id+"]"})),u._registerDisposable(u._deviceManager.on("videoDevicesChanged",function(){return u._videoDevicesChanged(t)})),u}return r(t,e),t.prototype.updateStreamingState=function(){var e=!!this._state&&a.some(this._state.videoStreams,function(e){return e.isStreaming});this.isStreaming!==e&&(this._logger.info("isStreaming changed to: "+e),this.isStreaming=e,this.raiseChanged())},t.prototype.setVideoState=function(e,t){var n=this;this._state&&a.forEach(this._state.videoStreams,function(t){return t.dispose(e)}),this._state=t,this._state&&a.forEach(this._state.videoStreams,function(e){return e.changed(function(){return n.updateStreamingState()})}),this.updateStreamingState()},t.prototype._videoDevicesChanged=function(e){var t=this;this._logger.info("_videoDevicesChanged causeId: "+e),this._chainedApiPromise.chainPromise(function(){return t._swapVideoDevice(e)},"swapVideoDevice",e)},t.prototype.start=function(e,t){var n=this;return this._logger.info("start causeId: "+e),this._shouldRun=!0,this._chainedApiPromise.chainPromise(function(){return n._startVideo(e,t)},"start",e)},t.prototype.stop=function(e,t){var n=this;return this._logger.info("stop causeId: "+e),this._shouldRun=!1,this._chainedApiPromise.chainPromise(function(){return n._stopVideo(e,!1,t)},"stop",e)},t.prototype.dumpVideoSourceImages=function(){return i(this,void 0,void 0,function(){return o(this,function(e){if(!this._isRunning())throw new Error("Cannot dump video fx debug images when there is no local video");return[2,this._slimcoreInstance.dumpVideoSourceImages(this._state.videoStreams[0].objectId)]})})},t.prototype.dispose=function(e){var t=this;this._logger.info("dispose causeId: "+e),this._shouldRun=!1,this._chainedApiPromise.chainPromise(function(){return t._dispose(e)},"dispose",e)},t.prototype._isRunning=function(){return!!this._state},t.prototype._dispose=function(t){return i(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return n.trys.push([0,,2,3]),[4,this._stopVideo(t,!0)];case 1:return n.sent(),[3,3];case 2:return e.prototype.dispose.call(this,t),[7];case 3:return[2]}})})},t.prototype._areAllStreamsStreaming=function(e){return!a.some(e.videoStreams,function(e){return!e.isStreaming})},t.prototype._canSuppressDeviceSwap=function(e){return!!this._ignoredVideoDeviceInVideoSwap&&this._ignoredVideoDeviceInVideoSwap.id===e.id&&this._ignoredVideoDeviceInVideoSwap.generation===e.generation},t.prototype._swapVideoDevice=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,a,s,c,l,u;return o(this,function(o){switch(o.label){case 0:return this._shouldRun?(t=this._deviceManager.getSelectedCamera())?this._canSuppressDeviceSwap(t)?[2]:(this._ignoredVideoDeviceInVideoSwap=t,this._isRunning()?(n=this._state,r=this._disableFastCameraSwap||!this._areAllStreamsStreaming(n),this._logger.info("_swapVideoDevice causeId: "+e+" full stopstart? "+r+" will change local video device: "+this._state.camera.id+" -> "+t.id),this.setVideoState(e,null),r?[4,this._stopVideoDevices(e,n,this._negotiationTag)]:[3,3]):[3,8]):(this._logger.info("_swapVideoDevice causeId: "+e+" noop, no selected device, should run: "+this._shouldRun+" is running: "+this._isRunning()),this._ignoredVideoDeviceInVideoSwap=void 0,[2]):(this._logger.info("_swapVideoDevice causeId: "+e+" noop, should run: "+this._shouldRun+" is running: "+this._isRunning()),[2]);case 1:return o.sent(),i=this.setVideoState,a=[e],[4,this._startVideoDevices(e,t,this._negotiationTag)];case 2:return i.apply(this,a.concat([o.sent()])),[3,7];case 3:return o.trys.push([3,,5,7]),s=this.setVideoState,c=[e],[4,this._startVideoDevices(e,t,this._negotiationTag)];case 4:return s.apply(this,c.concat([o.sent()])),[3,7];case 5:return[4,this._stopVideoDevices(e,n,this._negotiationTag)];case 6:return o.sent(),[7];case 7:return[3,10];case 8:return this._logger.info("_swapVideoDevice causeId: "+e+" will resurrect local video device: "+t.id),l=this.setVideoState,u=[e],[4,this._startVideoDevices(e,t,this._negotiationTag)];case 9:l.apply(this,u.concat([o.sent()])),o.label=10;case 10:return[2]}})})},t.prototype._startVideo=function(e,t){return i(this,void 0,void 0,function(){var n,r,i;return o(this,function(o){switch(o.label){case 0:return!this._shouldRun||this._isRunning()?[3,2]:(this._negotiationTag=t||this._negotiationTag,n=this._getSelectedCamera(e),this._ignoredVideoDeviceInVideoSwap=n,r=this.setVideoState,i=[e],[4,this._startVideoDevices(e,n,this._negotiationTag)]);case 1:return r.apply(this,i.concat([o.sent()])),[3,3];case 2:this._logger.info("_startVideo causeId: "+e+" noop, should run: "+this._shouldRun+" is running: "+this._isRunning()),o.label=3;case 3:return[2]}})})},t.prototype._getSelectedCamera=function(e){var t=this._deviceManager.getSelectedCamera();if(!t)throw new Error("_getSelectedCamera causeId: "+e+" no selected camera to start local video");return t},t.prototype._getCamerasToStart=function(e){var t=this,n=[],r=function(e){var r=t._deviceManager.getLabelByCameraPosition(e);n.push({camera:e,label:r})},i=this._deviceManager.getChildCameras(e.id);if(a.isEmpty(i))r(e);else if(this._options.enableMultiVideo)i.forEach(r);else{var o=a.find(i,function(e){return e.useForPreview});o&&r(o)}return n},t.prototype._startVideoDevices=function(e,t,n){return i(this,void 0,void 0,function(){var r,i,a,s=this;return o(this,function(o){switch(o.label){case 0:r={camera:t,videoStreams:[]},i=this._getCamerasToStart(t),o.label=1;case 1:return o.trys.push([1,3,,6]),[4,Promise.all(i.map(function(t){return s._startVideoStream(e,t.camera,t.label,n).then(function(e){return r.videoStreams.push(e)})}))];case 2:return o.sent(),[3,6];case 3:return a=o.sent(),this._logger.info("_startVideoDevices causeId: "+e+" failed for some cameras"),r.videoStreams.length>0?[4,this._stopVideoDevices(e,r,this._negotiationTag)]:[3,5];case 4:o.sent(),r.videoStreams.forEach(function(t){return t.dispose(e)}),o.label=5;case 5:throw a;case 6:return[2,r]}})})},t.prototype._shouldUseActivityMonitor=function(e){return 7===e.position},t.prototype._createVideoStream=function(e,t,n,r,i,o){var a,s=this;if(r){var c;try{c=function(){p&&p.dispose(),l&&l.dispose()};var l=this._slimcoreInstance.createVideoDeviceListener(),p=l.handle("video-device-state-changed",void 0,function(t){var r=d.generateCauseId(),i=t.state;if(s._logger.info("chaining stream.control id-"+n+" oldCauseId: "+e+", causeId "+r+", state "+i),i===u.CameraState.Active||i===u.CameraState.Inactive){var o=i===u.CameraState.Active;s._chainedApiPromise.chainPromise(function(){return f.control(r,o)},"stream.control",r)}});l.initialise(t.id);var g=this._logger.createChild(function(){return"VideoStreamActivityMonitor["+n+":"+i+"]"});a={dispose:function(e){g.info("dispose causeId: "+e),c()}}}catch(t){this._logger.error("failed to create VideoDeviceListener, causeId: "+e+", error: "+t),c()}}var f=new h(e,this._logger,this._settings,this._slimcoreInstance,this._callHandler,n,i,o,a);return f},t.prototype._startVideoStream=function(e,t,n,r){return i(this,void 0,void 0,function(){var i,a,s,c;return o(this,function(o){switch(o.label){case 0:if(this._logger.info("_startVideoStream causeId: "+e+" create local video "+n+" for device name: "+t.label+" path: "+t.id),0===(i=this._slimcoreInstance.createLocalVideo(u.VideoType.Video,t.label,t.id,n)))throw new Error("_startVideoStream id-"+i+" causeId: "+e+" local video is null?");if(this._logger.info("_startVideoStream id-"+i+" causeId: "+e+" attach local video"),this._callHandler.callAttachSendVideo(this._callObjectId,i),a=this._shouldUseActivityMonitor(t),s=this._createVideoStream(e,t,i,a,n,r),a)return[2,s];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,s.startVideo(e)];case 2:return o.sent(),[3,4];case 3:throw c=o.sent(),s.dispose(e),c;case 4:return[2,s]}})})},t.prototype._stopVideo=function(e,t,n){return i(this,void 0,void 0,function(){var r;return o(this,function(i){switch(i.label){case 0:return this._shouldRun&&!t||!this._isRunning()?[3,2]:(this._ignoredVideoDeviceInVideoSwap=void 0,this._negotiationTag=n||this._negotiationTag,r=this._state,this.setVideoState(e,null),[4,this._stopVideoDevices(e,r,this._negotiationTag)]);case 1:return i.sent(),[3,3];case 2:this._logger.info("_stopVideo causeId: "+e+" noop, force: "+t+" should run: "+this._shouldRun+" is running: "+this._isRunning()),i.label=3;case 3:return[2]}})})},t.prototype._doCallVideoStop=function(e){return!this._state||!this._state.videoStreams.find(function(t){return t.label===e})},t.prototype._stopVideoDevices=function(e,t,n){return i(this,void 0,void 0,function(){var n=this;return o(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.videoStreams.map(function(t){return t.stopVideo(e,n._doCallVideoStop(t.label))}))];case 1:return r.sent(),[2]}})})},t}(l.default);t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}},s=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var l=n(7),u=n(12),d=n(26),p=n(61),h=n(18),g=n(10),f=n(11),_=n(37),m=n(46),v=n(47),y=SlimCore.Enums,C=n(22),S=n(33),I=n(9),O=n(39),T=n(45),E=n(19),P=n(86),b=n(34),A=n(35),R=0,w=function(e){function t(t,n,r,i,o,a,s){var c=e.call(this,new T.default(t).createChild("CallRegistry/"+R++%10),n,r)||this;c._deviceManager=i,c._appHooks=o,c._telemetryLoggers=a,c._skypeIdentity=s,c.calls=[],c._loginPromiseDefered=u.defer(),c._logoutPromiseDefered=u.defer(),c._startSlimcorePromiseDefered=u.defer(),c.isDisposing=!1,c._disposedPromise=u.defer(),c.slimcoreInstanceStartCalled=!1,c._accountStatusCallback=null,c._accountConfig=null,c._logger.info("constructor"),c._slimcoreInstance.setMaxListeners(0),c._ecsProvider=new m.default(c._slimcoreInstance),s&&(c.identity=s.id,c._setup=new v.default(c._slimcoreInstance,c.identity)),c._setupRegistryTelemetry();var l=c._slimcoreInstance.ecsGetSettingAsBool("SkypeCalling","disableInstantTelemetry",!1);return c._callOperationHandler=new A.default(c._logger,c._registryTelemetry,{disableInstantTelemetry:l},function(e){c._publishTelemetry(e)}),c}return r(t,e),t.prototype._setupRegistryTelemetry=function(){this._registryTelemetry=new S.CallRegistryTelemetry(this._logger,(new Date).getTime())},t.prototype._publishTelemetry=function(e){if(this._telemetryLoggers&&this._telemetryLoggers.signaling){this._registryTelemetry.setSkypeId(this.identity);try{this._registryTelemetry.setEndpointId(this._slimcoreInstance.getRegistrationId(this.identity))}catch(e){this._logger.warn("Could not get end point ID from slimcore for call registry telemetry.")}this._accountConfig&&(this._registryTelemetry.setAcsResourceId(this._accountConfig.acsResourceId),this._registryTelemetry.setApplicationType(this._accountConfig.applicationType),this._registryTelemetry.setPartition(this._accountConfig.partition),this._registryTelemetry.setRegion(this._accountConfig.region),this._registryTelemetry.setRing(this._accountConfig.ring),this._registryTelemetry.setTenantId(this._accountConfig.tenantId));var t=C.TELEMETRY_EVENT_NAMES.REGISTRY_NATIVE;this._telemetryLoggers.signaling.sendEvent({eventName:t,props:this._registryTelemetry.getEvent(null,e)})}},t.prototype.dispose=function(t){return void 0===t&&(t=I.generateCauseId()),s(this,void 0,void 0,function(){var n,r,i,o,a=this;return c(this,function(s){return(n=this._logger.createFnLogger("dispose",t)).info("disposing call registry"),this.isDisposing?(n.warn("call registry is already in disposing stage!"),[2,this._disposedPromise.promise]):(this.isDisposing=!0,r=function(){a.calls=[],a._slimcoreCallHandler&&(a._slimcoreCallHandler.dispose(),a._slimcoreCallHandler=void 0),n.info("callhandler is disposed"),a._account&&(a._account.dispose(),a._account=void 0),n.info("account is disposed"),a.event("disposed").raise(),e.prototype.dispose.call(a,t),a._disposedPromise.resolve()},i=this.calls.map(function(e){return e.stop()}),o=function(){return a.logout(t)},Promise.all(i).then(o,o).then(r,r),[2,this._disposedPromise.promise])})})},Object.defineProperty(t.prototype,"loginPromise",{get:function(){return this._loginPromiseDefered.promise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposePromise",{get:function(){return this._disposedPromise.promise},enumerable:!1,configurable:!0}),t.prototype._initCall=function(e,t,n){this._logger.createFnLogger("initCall[callId="+e.callId+"][participantId="+e.participantId+"]",n).info("callObjectId="+t),e.incomingCallInit(t,n)},t.prototype._incomingCallMonitor=function(e,t){var n=this._logger.createFnLogger("incomingCallMonitor",t);n.info("_incomingCallMonitor for objectPropertyChange objectId="+e.objectId);var r=this._getStrProperty(this._slimcoreCallHandler,e.objectId,y.Property.CallName);if(g.hasFeature(y.Feature.MultiUserSupport)){var i=this._getStrProperty(this._slimcoreCallHandler,e.objectId,y.Property.CallAccountIdentity);if(i!==this.identity)return void n.info("incoming call("+r+") for user("+h.mriOrId(i)+") but current user is "+h.mriOrId(this.identity))}var o=this._getStrProperty(this._slimcoreCallHandler,e.objectId,y.Property.CallLegId);this._getCall(r,o,t)||n.logFailure("getCall failed to find the call(callId: "+r+", localParticipantId: "+o+")")},t.prototype.init=function(e,t,n){var r=this;void 0===t&&(t={block:!0}),void 0===n&&(n=I.generateCauseId());var i=this._logger.createFnLogger("init",n);return i.info("init"),t.block||g.hasFeature(y.Feature.AsyncStart)||(t.block=!0),this.slimcoreInstanceStartCalled?i.info("skipping slimcoreInstance start, because it was already started"):(t.block||this._registerDisposable(this._slimcoreInstance.handle("lib-status-changed",{libStatus:SlimCore.Enums.LibStatus.Running},function(e){return r._onLibStatusChanged(e)})),this._slimcoreInstance.setupSetStr("*Lib/SCT/Telemetry/DiagnosticLevel",t.telemetryDiagnosticLevel||""),this._slimcoreInstance.start(t.block),i.info("starting slimcoreInstance block="+t.block),this.slimcoreInstanceStartCalled=!0,t.block&&(this.libStatus=y.LibStatus.Running,this._startSlimcorePromiseDefered.resolve())),this._skypeIdentity=e,this.identity=e.id,this._skypeIdentity.tokenProvider().then(function(e){i.info("setting up stack callbacks");var t=r._slimcoreInstance.handle("object-property-changed",{propKey:y.Property.AccountStatus,value:y.AccountStatus.LoggedIn},function(){var e=r._slimcoreInstance.createCallInterface();r._slimcoreCallHandler=g.wrap(e,r._settings),i.info("createCallInterface returned"),r._loginPromiseDefered.resolve(r._slimcoreCallHandler),t&&(t.dispose(),t=null),r._hookCallRegistryEvents()});r._registerDisposable(r._slimcoreInstance.handle("object-property-changed",{propKey:y.Property.CallStatus,value:y.CallStatus.RingingIn},function(e){return r._incomingCallMonitor(e,n)})),r._initializeSlimCore(e),r._logger.info("initialize returned")}).catch(function(e){i.logFailure(e),r._loginPromiseDefered.reject(e)}),this.loginPromise.then(d.noop)},t.prototype.uninit=function(){var e=this;this.slimcoreInstanceStartCalled?this.libStatus!==y.LibStatus.Running&&(this._startSlimcorePromiseDefered.reject(new Error("Callregistry uninit called before slimcore reached Running state")),this._logoutPromiseDefered.reject(new Error("Callregistry uninit called before slimcore reached Running state"))):this._logoutPromiseDefered.reject(new Error("CallRegistry uninit called without slimcore::start()"));try{this._logger.info("uninit: setting up stack callbacks");var t=this._slimcoreInstance.handle("object-property-changed",{propKey:y.Property.AccountStatus,value:y.AccountStatus.LoggedOut},function(){e._logoutPromiseDefered.resolve(),t&&(t.dispose(),t=null)});this._logger.info("uninit(): calling slimcore.logout()"),this._slimcoreInstance.logout()}catch(e){this._logger.error("slimcore.logout() failed.",e),this._logoutPromiseDefered.reject(e)}return this.slimcoreInstanceStartCalled=!1,this._logoutPromiseDefered.promise.then(d.noop)},t.prototype.login=function(e,t){return void 0===t&&(t=I.generateCauseId()),this._logger.createFnLogger("login",t).info("login"),this._skypeIdentity=e,this.identity=e.id,this._setup=new v.default(this._slimcoreInstance,this.identity),this.initialize(t)},t.prototype.initialize=function(e,t){var n=this;void 0===e&&(e=I.generateCauseId());var r=this._logger.createFnLogger("initialize",e);return r.info("initialize"),this._accountConfig=t,this._skypeIdentity.tokenProvider().then(function(i){r.info("setting up stack callbacks"),n._accountStatusCallback=n._slimcoreInstance.handle("object-property-changed",{propKey:y.Property.AccountStatus,value:y.AccountStatus.LoggedIn},function(t){r.info("account status changes to logged in"),n._handleLoggedIn(t.objectId,e)}),n._registerDisposable(n._slimcoreInstance.handle("object-property-changed",{propKey:y.Property.CallStatus,value:y.CallStatus.RingingIn},function(t){return n._incomingCallMonitor(t,e)})),n._login(i,n._skypeIdentity.displayName,r,JSON.stringify(t))}).catch(function(e){r.logFailure(e),n._loginPromiseDefered.reject(e)}),this.loginPromise.then(function(){return n.setAdditionalIdentities()})},t.prototype._handleLoggedIn=function(e,t){var n=this._logger.createFnLogger("_handleLoggedIn",t);if(g.hasFeature(y.Feature.MultiUserSupport)&&this._account.getObjectId()!==e)n.error("accountObjectId: "+this._account.getObjectId()+" does not match with "+e);else{if(this._slimcoreCallHandler)n.info("call handler already exists");else{var r=this._createCallHandler();this._slimcoreCallHandler=g.wrap(r,this._settings),n.info("callhandler created successfully"),this._loginPromiseDefered.resolve(this._slimcoreCallHandler),n.info("user logged in successfully"),this._hookCallRegistryEvents()}this._accountStatusCallback&&(this._accountStatusCallback.dispose(),this._accountStatusCallback=null)}},t.prototype._login=function(e,t,n,r){if(g.hasFeature(y.Feature.MultiUserSupport)){if(this._account)return n.info("already logged in. updating displayname and skypetoken!"),this._account.updateDisplayName(t),void this._account.updateSkypeToken(e);var i=this._slimcoreInstance.getAccount(this.identity);this._account=g.wrap(i,this._settings),this._account.login(e,t,g.mapToEmptyStrIfFalsy(r))}else this._slimcoreInstance.login(this.identity,e,t);var o=this._account&&this._account.getObjectId();o&&this._getIntProperty(this._slimcoreInstance,o,y.Property.AccountStatus)===y.AccountStatus.LoggedIn&&(n.info("check the account status after login. user account status is already logged in"),this._handleLoggedIn(o,void 0))},t.prototype._createCallHandler=function(){return g.hasFeature(y.Feature.MultiUserSupport)?this._slimcoreInstance.getCallHandler(this._account.getObjectId()):this._slimcoreInstance.createCallInterface()},t.prototype.logout=function(e){var t=this;void 0===e&&(e=I.generateCauseId());var n=this._logger.createFnLogger("logout",e);n.info("logout");try{n.info("setting up stack callbacks");var r=this._slimcoreInstance.handle("object-property-changed",{propKey:y.Property.AccountStatus,value:y.AccountStatus.LoggedOut},function(e){g.hasFeature(y.Feature.MultiUserSupport)&&t._account.getObjectId()!==e.objectId||(t._logoutPromiseDefered.resolve(),r&&(r.dispose(),r=null))});n.info("calling slimcore.logout()"),this._logout()}catch(e){n.error("slimcore.logout() failed.",e),this._logoutPromiseDefered.reject(e)}return this._logoutPromiseDefered.promise.then(d.noop)},t.prototype._logout=function(){g.hasFeature(y.Feature.MultiUserSupport)?this._account.logout():this._slimcoreInstance.logout()},t.prototype.setConfiguration=function(e){var t=this;return Promise.resolve().then(function(){if(g.hasFeature(y.Feature.MultiUserSupport)&&t._account&&t._account.setConfiguration){var n=JSON.stringify(e);t._logger.info("setConfiguration:"+n),t._account.setConfiguration(n),t._accountConfig=e}})},t.prototype.updateDisplayName=function(e){var t=this;return Promise.resolve().then(function(){return g.hasFeature(y.Feature.MultiUserSupport)&&t._account?t._account.updateDisplayName(e):t._skypeIdentity.tokenProvider().then(function(n){return t._login(n,e,t._logger)})})},t.prototype.updateSkypeToken=function(e){g.hasFeature(y.Feature.MultiUserSupport)&&this._account?this._account.updateSkypeToken(e):this._slimcoreInstance.updateSkypeToken(e)},t.prototype.updateToken=function(e,t,n,r,i){var o=this;return Promise.resolve().then(function(){return g.hasFeature(y.Feature.MultiUserSupport)&&o._account?(o._account.updateToken(e,JSON.stringify(t),n||"",r,i||0),O.getSuccessTransactionEnd()):Promise.reject("Invalid, update token require MTMA, and account should be logged in")})},t.prototype.fireIntent=function(e,t){var n=this;return Promise.resolve().then(function(){g.hasFeature(y.Feature.MultiUserSupport)&&n._slimcoreInstance.fireIntent(y.Intent.CallPush,t,void 0,n.identity)})},t.prototype.getCallState=function(e,t){var n=this,r=this._logger.createFnLogger("getCallState",t);if(null===this._slimcoreCallHandler||void 0===this._slimcoreCallHandler){r.logFailure("Stack not initialized yet");i={code:C.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:C.TRANSACTION_END_SUBCODE.LOCAL_REJECT,phrase:C.TRANSACTION_END_PHRASE.STACK_NOT_INTIALIZED};return Promise.reject(i)}if(!e.context||!e.context.conversationUrl){var i={code:C.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:C.TRANSACTION_END_SUBCODE.INVALID_ARGUMENT,phrase:"ConversationId and conversationUrl are needed"};return Promise.reject(i)}var o=this._callOperationHandler.waitForOperation(C.CALL_REGISTRY_OPERATIONS.GET_CALL_STATE,t,t);return Promise.resolve().then(function(){n._slimcoreCallHandler.getCallState(t,JSON.stringify(e.context))}).catch(function(e){return Promise.reject(O.getRejectTransactionEnd(e))}).then(function(){return o}).catch(function(e){return n._registryTelemetry.updateOperationData(C.CALL_REGISTRY_OPERATIONS.GET_CALL_STATE,{error:E.getPIISafeObject(e)},t),r.logFailure(e),Promise.reject(e)})},t.prototype._onCallHandlerOperationStatusChanged=function(e){if(this._logger.info("_onCallHandlerOperationStatusChanged args="+E.getPIISafeObject(e)),e.callHandlerOperationType===SlimCore.Enums.CallHandlerOperationType.GetCallState&&this._callOperationHandler.hasPendingOperationWithOperationId(C.CALL_REGISTRY_OPERATIONS.GET_CALL_STATE,e.causeId)){var t={code:e.code,subCode:e.subCode,phrase:e.phrase,result:e.result};this._completeGetCallStateTransaction(C.CALL_REGISTRY_OPERATIONS.GET_CALL_STATE,t,e.causeId,e.causeId,!0)}},t.prototype._completeGetCallStateTransaction=function(e,t,n,r,i){if(void 0===i&&(i=!1),this._logger.info("_completeGetCallStateTransaction["+n+"]["+r+"]: operationName "+e+" transactionEnd "+JSON.stringify(t,null,4)),this._registryTelemetry.updateOperationData(e,t,n,r),0===t.code&&0===t.subCode||i&&t.code>=200&&t.code<300)try{var o=t.result?JSON.parse(t.result):JSON.parse("{}");this._callOperationHandler.maybeResolveOperation(e,o,r,n)}catch(t){this._logger.error("_completeGetCallStateTransaction error parsing transaction result"),this._callOperationHandler.maybeRejectOperation(e,O.getRejectTransactionEnd(t,C.TRANSACTION_END_SUBCODE.CANNOT_PARSE_RESULT),r,n)}else this._callOperationHandler.maybeRejectOperation(e,t,r,n)},t.prototype.getSetup=function(){return this._setup},t.prototype.getEcsProvider=function(){return this._ecsProvider},t.prototype.createCallWithMeetingData=function(e,t,n,r){return this._createCall(r,t,n,null,null,null,e)},t.prototype.createCallWithGroupId=function(e,t,n,r){return this._createCall(r,t,n,e)},t.prototype.createCall=function(e,t,n,r,i){return void 0===i&&(i=I.generateCauseId()),this._createCall(i,t,n,void 0,e,r)},t.prototype._createCall=function(e,t,n,r,i,o,a){var s=this,c=this._logger.createFnLogger("_createCall",e);if(c.info("threadId:"+h.getLoggableThreadId(i)+", callId:"+t+", localParticipantId: "+n+", messageId:"+o+", meetingUrl:"+!(!a||!a.meetingUrl)+" meetingCode:"+!(!a||!a.meetingUrl)),null===this._slimcoreCallHandler||void 0===this._slimcoreCallHandler)throw c.logFailure("Stack not initialized yet"),new Error("Stack not initialized yet");this._skypeIdentity.tokenProvider().then(function(e){e&&(c.info("Updating Skype Token..."),s.updateSkypeToken(e),c.info("Token update complete"))});var u=null;return i&&(u=l.find(this.calls,function(e){return e.threadId===i&&(t&&e.callId===t||o&&e.messageId===o)}))?(c.logFailure("Call Registry already has an entry for threadId: "+h.getLoggableThreadId(u.threadId)+", callId: "+u.callId+", messageId: "+u.messageId),u):r&&(u=l.find(this.calls,function(e){return e.groupId===r}))?(c.logFailure("Call Registry already has an entry for groupId: "+h.scrubMriOrOmit(u.groupId)+", callId: "+u.callId),u):(u=this._getCall(t,n,e,a))?u:(u=new _.default(this._logger,this._settings,this._slimcoreInstance,this._slimcoreCallHandler,this._deviceManager,this._appHooks,r,i,t||p.default(),this._skypeIdentity,n,this._telemetryLoggers,o,a,this._accountConfig),this.calls.push(u),this.event("callAdded").raise(u),this.raiseChanged(),u)},t.prototype.getCall=function(e,t,n){return void 0===n&&(n=I.generateCauseId()),this._getCall(e,t,n)},t.prototype._getCall=function(e,t,n,r){var i=this,o=this._logger.createFnLogger("getCall[callId="+e+"][participantId="+t+"]",n);if(!e&&!t)return o.logFailure("callId & participantId is undefined"),null;if(null===this._slimcoreCallHandler||void 0===this._slimcoreCallHandler)throw o.logFailure("Stack not initialized yet"),new Error("Stack not initialized yet");var a=l.find(this.calls,function(t){return t.callId===e||P.compareMeetingData(t.meetingData,r,n,o)});if(o.log("call "+(a?"exists":"does not exist")+", call.slimcoreCallId:"+(a?a.slimcoreCallId:0)),a&&a.slimcoreCallId)return 8===a.state?(this._initCall(a,a.slimcoreCallId,n),a):(o.info("Call Registry already has an entry for this call"),a);var s=l.find(this._slimcoreCallHandler.getActiveCalls(),function(n){return i._getStrProperty(i._slimcoreCallHandler,n,y.Property.CallName)===e&&i._getStrProperty(i._slimcoreCallHandler,n,y.Property.CallLegId)===t});if(!s)return o.logFailure("slimCoreCallObjectId not found"),null;if(a)return this._initCall(a,s,n),a;var c=this._getStrProperty(this._slimcoreCallHandler,s,y.Property.CallGroupId),u=this._getStrProperty(this._slimcoreCallHandler,s,y.Property.CallThreadId),d=this._getStrProperty(this._slimcoreCallHandler,s,y.Property.CallMessageId);return a=new _.default(this._logger,this._settings,this._slimcoreInstance,this._slimcoreCallHandler,this._deviceManager,this._appHooks,c,u,e,this._skypeIdentity,t,this._telemetryLoggers,d,r,this._accountConfig),this._initCall(a,s,n),this.calls.push(a),this.event("callAdded").raise(a),this.raiseChanged(),a},t.prototype.deleteCall=function(e,t,n){var r=this;void 0===t&&(t=!0),void 0===n&&(n=I.generateCauseId()),this._logger.info("deleteCall "+e.callId);var i=!1;return l.each(l.remove(this.calls,function(t){return t===e}),function(o){i=!0,t&&(r.event("callRemoved").raise(e),7!==o.state&&o.dispose(n))}),!!i&&(this.raiseChanged(),!0)},t.prototype.debugInformation=function(e){var t=this._slimcoreCallHandler.getDebugInformation("/callinfo");return!e||t&&!l.isEmpty(t)||(t="CallInformation\n * CallId="+e.callId),Promise.resolve(t)},t.prototype.setLocationInfo=function(e,t,n){var r=this;void 0===n&&(n=I.generateCauseId());var i=this._logger.createFnLogger("setLocationInfo",n);if(i.info("infoType:"+e+", contentJson:(redacted)"),!this._slimcoreCallHandler)throw i.logFailure("Stack not initialized yet"),new Error("Stack not initialized yet");return this.loginPromise.then(function(){return r._slimcoreCallHandler.setLocationInfo(r.mapLocationInfoType(e),t)}).catch(function(e){throw i.logFailure(e),e})},t.prototype.mapLocationInfoType=function(e){switch(e){case 0:return y.LocationInfoType.NoLocationInfo;case 1:return y.LocationInfoType.LocationContent;case 2:return y.LocationInfoType.NetworkContent;case 3:return y.LocationInfoType.AreaContent;default:return y.LocationInfoType.NetworkContent}},t.prototype.setAdditionalIdentities=function(){var e=this;return Promise.resolve().then(function(){if(e._skypeIdentity.sipUri){var t="2:"+e._skypeIdentity.sipUri;g.hasFeature(y.Feature.MultiUserSupport)&&e._account?e._account.setAdditionalIdentities(t):e._slimcoreInstance.setAdditionalIdentities(t)}})},t.prototype._initializeSlimCore=function(e){var t=this;try{this._startSlimcorePromiseDefered.promise.then(function(){t._logger.info("logging in to slimcore libStatus="+t.libStatus),t._slimcoreInstance.login(t._skypeIdentity.id,e,t._skypeIdentity.displayName)})}catch(e){this._logger.error("initialization failed.",e)}},t.prototype._onSkypeTokenRequired=function(e){this.event("skypeTokenRequired").raise(e.invalidToken)},t.prototype._onTokenRequired=function(e){this._logger.info("_onTokenRequired factors="+e.factorsJson+" metadata="+e.requestMetadataJson+" tokenType="+e.tokenTypeAsBitmask);try{var t=JSON.parse(e.requestMetadataJson);this.event("tokenRequired").raise(e.factorsJson,e.tokenTypeAsBitmask,t,e.invalidToken)}catch(e){this._logger.warn("_onTokenRequired failed to parse requestMetadataJson")}},t.prototype._onLibStatusChanged=function(e){this._logger.info("_onLibStatusChanged from "+this.libStatus+" => "+e.libStatus),e.libStatus===y.LibStatus.Running?this._startSlimcorePromiseDefered.resolve():e.libStatus===y.LibStatus.FatalError&&this.libStatus===y.LibStatus.Constructed&&this._startSlimcorePromiseDefered.reject(new Error("Slimcore FatalError during start")),this.libStatus=e.libStatus},t.prototype._onProxiedPushNotification=function(e){var t={eventId:e.eventId,payload:e.payload};this.event("proxiedPushNotification").raise(t)},t.prototype._hookCallRegistryEvents=function(){var e=this;g.hasFeature(y.Feature.MultiUserSupport)&&this._account?(this._registerDisposable(this._account.handle("skype-token-required",void 0,function(t){return e._onSkypeTokenRequired(t)})),this._registerDisposable(this._account.handle("token-required",void 0,function(t){return e._onTokenRequired(t)})),this._registerDisposable(this._slimcoreCallHandler.handle("proxied-push-notification",void 0,function(t){return e._onProxiedPushNotification(t)})),this._registerDisposable(this._slimcoreCallHandler.handle("call-handler-operation-status-changed",void 0,function(t){return e._onCallHandlerOperationStatusChanged(t)}))):(this._registerDisposable(this._slimcoreInstance.handle("skype-token-required",void 0,function(t){return e._onSkypeTokenRequired(t)})),this._registerDisposable(this._slimcoreInstance.handle("proxied-push-notification",void 0,function(t){return e._onProxiedPushNotification(t)})))},i([b.callOperation(C.CALL_REGISTRY_OPERATIONS.INITIALIZE,{enableInstantTelemetry:!0}),o("design:type",Function),o("design:paramtypes",[Object,Object]),o("design:returntype",Promise)],t.prototype,"initialize",null),i([b.callOperation(C.CALL_REGISTRY_OPERATIONS.LOGOUT,{enableInstantTelemetry:!0}),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],t.prototype,"logout",null),i([b.callOperation(C.CALL_REGISTRY_OPERATIONS.GET_CALL_STATE),a(1,b.operationId),o("design:type",Function),o("design:paramtypes",[Object,String]),o("design:returntype",Promise)],t.prototype,"getCallState",null),t}(f.default);t.default=w},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},s=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0});var c=n(7),l=n(10),u=n(11),d=n(87),p=n(44),h=n(64),g=n(43),f=SlimCore.Enums,_=n(12),m=n(9),v=function(){function e(e){this._logger=e,this._devices=[],this._slimcoreDevices=[],this._logger.info("constructor")}return e.prototype._getDeviceId=function(e){return e?e.id:null},e.prototype.getList=function(){return this._devices},e.prototype.update=function(e){var t=!c.isEqual(c.sortBy(this._slimcoreDevices),c.sortBy(e));return t&&(this._slimcoreDevices=e,this._logger.info("update: "+JSON.stringify(e)),this._devices=this._enumerate(e)),t},e}(),y=function(e){function t(t,n){var r=e.call(this,t)||this;return r._disableAutoDeviceSelection=n,r}return r(t,e),t.prototype._getBestDevice=function(){return this._getDeviceId(c.first(this._devices))},t.prototype._isAvailable=function(e){return!(!e||!c.find(this._devices,function(t){return t.id===e}))},t.prototype.getBestDevice=function(){return this._getBestDevice()},t.prototype.getSelectedDevice=function(){if(this._isAvailable(this._selectedDevice))return this._logger.debug("getSelectedDevice: "+this._selectedDevice),this._selectedDevice;if(this._disableAutoDeviceSelection)return this._logger.debug("getSelectedDevice - "+this._selectedDevice+" not currently present, returning null"),null;var e=this._getBestDevice();return this._logger.debug("getSelectedDevice - unknown device selected, returning preferred device: "+e),e},t.prototype.selectDevice=function(e){if(this._disableAutoDeviceSelection)return this._logger.info("selectDevice: "+e),void(this._selectedDevice=e);this._isAvailable(e)?(this._logger.info("selectDevice: "+e),this._selectedDevice=e):(this._logger.info("selectDevice - unknown device selected, selecting preferred device"),this._selectedDevice=null)},t}(v),C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._getBestDevice=function(){var t=this._findCamera(3),n=this._findCamera(6),r=this._findCamera(1),i=this._findCamera(4),o=this._findCamera(5),a=this._findCamera(),s=e.prototype._getBestDevice.call(this);return t||n||r||i||o||a||s},t.prototype._enumerate=function(e){var t=this,n=this._enumerateComposites(e),r=function(e){return-1!==c.findIndex(n,function(t){return t.id===e.id})||e.compositeCount>1||e.cameraFacing===f.CameraFacing.Panoramic||e.cameraFacing===f.CameraFacing.Participant},i=c.filter(e,function(e){return!r(e)}),o=c.map(i,function(e){return t._convert(e,1)});return s(s([],o),n)},t.prototype._isVirtual=function(e){return e.deviceType===f.DeviceType.Virtual},t.prototype._convert=function(e,t){return{id:e.id,browserId:e.browserId,label:e.label,kind:t,position:this._getCameraPosition(e.cameraFacing),isVirtual:this._isVirtual(e),generation:e.generation,participantCameraId:e.participantCameraId}},t.prototype._enumerateComposites=function(e){var t=this,n=[],r=c.filter(e,function(e){return!!e.compositeId}),o=c.groupBy(r,"compositeId");return Object.keys(o).forEach(function(e){var r=o[e],a=r.length;if(a>1){var s=r.find(function(e){return e.cameraFacing===f.CameraFacing.Panoramic})||r[0];if(!s.compositeCount||s.compositeCount===a){var c=t._convert(s,1),l=i(i({},c),{id:"composite_video_"+c.id,isComposite:!0});n.push(l),r.forEach(function(e,r){var o=i(i({},t._convert(e,5)),{parentId:l.id,useForPreview:0===r});n.push(o)})}}}),n},t.prototype._findCamera=function(e){var t=c.find(this._devices,function(t){return!(O.isChildVideoDeviceDescr(t)||t.isVirtual||e&&t.position!==e)});return this._getDeviceId(t)},t.prototype._getCameraPosition=function(e){switch(e){case f.CameraFacing.Front:return 1;case f.CameraFacing.LeftFront:return 4;case f.CameraFacing.RightFront:return 5;case f.CameraFacing.Back:return 2;case f.CameraFacing.External:return 3;case f.CameraFacing.Panoramic:return 6;case f.CameraFacing.Participant:return 7;default:return 0}},t}(y),S=function(e){function t(t,n,r){var i=e.call(this,n,r)||this;return i._kind=t,i}return r(t,e),t.prototype._enumerate=function(e){var t=this,n=c.find(e,function(e){return e.isSystemDefault})||c.first(e);return c.map(e,function(e){return{id:e.id,browserId:e.browserId,label:e.label,kind:t._kind,isSystemDefault:e===n,productId:""+(e.productId||""),vendorId:""+(e.vendorId||""),generation:e.generation,connectionType:t._getConnectionType(e.connectionType)}})},t.prototype._getConnectionType=function(e){switch(e){case f.AudioDeviceConnectionType.BLUETOOTH:return 4;case f.AudioDeviceConnectionType.EXTERNAL:return 8;case f.AudioDeviceConnectionType.HDAUDIO:return 3;case f.AudioDeviceConnectionType.INTERNAL:return 7;case f.AudioDeviceConnectionType.PCI:return 2;case f.AudioDeviceConnectionType.USB:return 1;case f.AudioDeviceConnectionType.VIRTUAL:return 6;case f.AudioDeviceConnectionType.XBOX_KINECT:return 5;default:return 0}},t}(y),I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._enumerate=function(e){var t=this;return c.map(e,function(e){return{id:null,label:e.label,kind:4,microphoneId:e.microphoneId,speakerId:e.speakerId,formFactor:t._getCompositeDeviceFormFactor(e.deviceType),isPcInternalDevice:e.isPcInternalDevice,connectionType:t._getConnectionType(e.connectionType)}})},t.prototype._getCompositeDeviceFormFactor=function(e){switch(e){case f.CompositeAudioDeviceType.Speakers:return 1;case f.CompositeAudioDeviceType.Headphones:return 2;case f.CompositeAudioDeviceType.Headset:return 3;case f.CompositeAudioDeviceType.Handset:return 4;case f.CompositeAudioDeviceType.Speakerphone:return 5;default:return 0}},t.prototype._getConnectionType=function(e){switch(e){case f.AudioDeviceConnectionType.BLUETOOTH:return 4;case f.AudioDeviceConnectionType.EXTERNAL:return 8;case f.AudioDeviceConnectionType.HDAUDIO:return 3;case f.AudioDeviceConnectionType.INTERNAL:return 7;case f.AudioDeviceConnectionType.PCI:return 2;case f.AudioDeviceConnectionType.USB:return 1;case f.AudioDeviceConnectionType.VIRTUAL:return 6;case f.AudioDeviceConnectionType.XBOX_KINECT:return 5;default:return 0}},t}(v),O=function(e){function t(t,n,r,i,o){var a=e.call(this,t.createChild("DeviceManager"),n,r)||this;a._mediaReadyPromise=i,a._appHooks=o,a._browserDevices=[],a._haveStartedMedia=!1,a._previewRenderers=[],a._txNdiNotifiers=new Map,a._startPreviewVideo=function(e,t){return a._mediaReadyPromise.then(function(n){return a._logger.info("Wait AVAILABLE for preview video "+t+" causeId: "+e),l.waitForVideoObjectState({slimcoreInstance:a._slimcoreInstance,slimcoreObject:n,videoObjectId:t,logger:a._logger,causeId:e,resolveStates:[f.VideoStatus.Available],rejectStates:[f.VideoStatus.NotAvailable],timeout:l.videoObjectTimeout(a._settings)}).then(function(){return a._logger.info("Starting preview video "+t+" causeId: "+e),a._slimcoreInstance.videoStart(t),l.waitForVideoObjectState({slimcoreInstance:a._slimcoreInstance,slimcoreObject:n,videoObjectId:t,logger:a._logger,causeId:e,resolveStates:[f.VideoStatus.Starting,f.VideoStatus.Running],rejectStates:[f.VideoStatus.NotAvailable],timeout:l.videoObjectTimeout(a._settings)})}).then(function(){return a._logger.info("Now can use preview video "+t+" causeId: "+e)})})},a._stopPreviewVideo=function(e,t){return _.asap(function(){a._logger.info("Stopping preview video "+t+" causeId: "+e),a._slimcoreInstance.videoStop(t)})},a._createRendererBinding=function(e,t){var n;return a._previewVideoManager.acquire(e,a._rendererBindingManager,t).then(function(){return n=a._slimcoreInstance.createVideoBindingRenderer?a._slimcoreInstance.createVideoBindingRenderer({enableDXVA:a._settings.enableDXVA,isLocalPreview:!0}):SlimCore.createVideoBindingRenderer(),a._logger.info("Create rendering binding for preview video "+t+" causeId: "+e),a._slimcoreInstance.videoCreateBinding(t,n)}).then(function(){return a._logger.info("Created rendering binding for preview video "+t+" causeId: "+e),a._txNdiNotifiers.set(t,new g.default(a._logger,a._slimcoreInstance)),a._txNdiNotifiers.get(t).notifyNdiVideoStarted(e,t,n),n})},a._releaseRendererBinding=function(e,t,n){return _.asap(function(){return a._logger.info("Release rendering binding for preview video "+t+" causeId: "+e),a._txNdiNotifiers.get(t).notifyNdiVideoStopped(e),a._txNdiNotifiers.delete(t),a._slimcoreInstance.videoReleaseBinding(t,n)}).then(function(){return a._logger.info("Released rendering binding for preview video "+t+" causeId: "+e),a._previewVideoManager.release(e,a._rendererBindingManager,t)})},a._createScreenShareBinding=function(e,t){var n;return a._previewVideoManager.acquire(e,a._screenShareBindingManager,t).then(function(){return n=a._createVideoBindingScreenShare(),a._logger.info("Create screenshare binding for preview video "+t+" causeId: "+e),a._slimcoreInstance.videoCreateBinding(t,n)}).then(function(){return a._logger.info("Created screenshare binding for preview video "+t+" causeId: "+e),n})},a._releaseScreenShareBinding=function(e,t,n){return _.asap(function(){return a._logger.info("Release screenshare binding for preview video "+t+" causeId: "+e),a._slimcoreInstance.videoReleaseBinding(t,n)}).then(function(){return a._logger.info("Released screenshare binding for preview video "+t+" causeId: "+e),a._previewVideoManager.release(e,a._screenShareBindingManager,t)})};var s=!!n.disableAutoDeviceSelection,c=!!n.disableAutoCameraSelection||s;return a._logger.info("constructor disableAutoDeviceSelection: "+s+" disableAutoCameraSelection: "+c),a._cameras=new C(a._logger.createChild("cameras"),c),a._microphones=new S(2,a._logger.createChild("microphones"),s),a._speakers=new S(3,a._logger.createChild("speakers"),s),a._compositeDevices=new I(a._logger.createChild("compositeaudiodevices")),a._devicesEnumeratedPromise=a._mediaReadyPromise.then(function(){return a._updateBrowserDevices()}).then(function(){a._updateAudioDevices(),a._updateVideoDevices(),a._handleDisplaysChanged()}),a._previewVideoManager=new d.SlimCoreElectronBindingManager(a._startPreviewVideo,a._stopPreviewVideo,a._logger.createChild("PreviewBindingManager/Video")),a._rendererBindingManager=new d.SlimCoreElectronBindingManager(a._createRendererBinding,a._releaseRendererBinding,a._logger.createChild("PreviewBindingManager/RendererBinding")),a._screenShareBindingManager=new d.SlimCoreElectronBindingManager(a._createScreenShareBinding,a._releaseScreenShareBinding,a._logger.createChild("PreviewBindingManager/ScreenShareBinding")),a._registerDisposable(a._slimcoreInstance.handle("device-list-changed",void 0,function(e){return a._slimCoreDevicesChangedHander(e)})),a._registerDisposable(a._appHooks.onDisplaysChanged(function(){return a._handleDisplaysChanged()})),a._registerDisposable(a._slimcoreInstance.handle("video-effects-event",void 0,function(e){return a._slimCoreVideoEffectsEventHandler(e)})),a._registerDisposable(a._slimcoreInstance.handle("shell-sharing-event",void 0,function(e){return a._onShellSharingEvent(e)})),a._registerDisposable(a._slimcoreInstance.handle("video-extensibility-ipc-changed-event",void 0,function(e){return a._slimCoreVideoExtensibilityIpcChangedEventHandler(e)})),a._registerDisposable(a._slimcoreInstance.handle("video-extensibility-error",void 0,function(e){return a._slimCoreVideoExtensibilityErrorHandler(e)})),a}return r(t,e),t.prototype.dispose=function(t){return o(this,void 0,void 0,function(){var n;return a(this,function(r){switch(r.label){case 0:return this._logger.info("dispose causeId: "+t),n=c.map(this._previewRenderers,function(e){return e.dispose(t).catch(c.noop)}),this._logger.info("dispose causeId: "+t+" sync pending previews: "+n.length),[4,Promise.all(n)];case 1:return r.sent(),e.prototype.dispose.call(this,t),this._logger.info("dispose causeId: "+t+" done"),[2]}})})},t.prototype.getRendererBindingManager=function(){return this._rendererBindingManager},t.prototype.getScreenShareBindingManager=function(){return this._screenShareBindingManager},t.prototype.getPreviewVideo=function(e,t,n,r){var i=this,o=0;return this._mediaReadyPromise.then(function(a){if(0===(o=i._slimcoreInstance.createPreviewVideo(t,n,r)))throw new Error("SlimCore returned invalid video object ID 0");return i._logger.info("Got preview video causeId: "+e+". Waiting for video to become AVAILABLE|STARTING|RUNNING"),l.waitForVideoObjectState({slimcoreInstance:i._slimcoreInstance,slimcoreObject:a,videoObjectId:o,logger:i._logger,causeId:e,resolveStates:[f.VideoStatus.Available,f.VideoStatus.Starting,f.VideoStatus.Running],rejectStates:[f.VideoStatus.NotAvailable],timeout:l.videoObjectTimeout(i._settings)})}).then(function(){return o})},Object.defineProperty(t.prototype,"isAudioOutputSelectionSupported",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype._handleDisplaysChanged=function(){try{this._slimcoreInstance.setDeviceRotation(SlimCore.queryDeviceRotation())}catch(e){this._logger.warn("Displays Changed handling error: "+e)}},t.prototype._updateVideoDevices=function(){return this._cameras.update(this._fillBrowserDeviceIds(this._slimcoreInstance.getCameraList(),"videoinput"))},t.prototype._updateAudioDevices=function(){var e=this._microphones.update(this._fillBrowserDeviceIds(this._slimcoreInstance.getMicrophoneList(),"audioinput")),t=this._speakers.update(this._fillBrowserDeviceIds(this._slimcoreInstance.getSpeakerList(),"audiooutput")),n=this._slimcoreInstance.getCompositeAudioDevices&&this._compositeDevices.update(this._slimcoreInstance.getCompositeAudioDevices());return(e||t)&&this._selectAudioDevices(),e||t||n},t.prototype._updateBrowserDevices=function(){var e=this;return"object"!=typeof navigator?(this._logger.warn("Browser-backed device list won't be fetched as navigator is not available"),Promise.resolve()):this._browserDevicesPromise?this._browserDevicesPromise:(this._logger.info("enumerate browser devices"),this._browserDevicesPromise=navigator.mediaDevices.enumerateDevices().then(function(t){e._logger.info("got browser devices"),e._browserDevices=t,e._browserDevicesPromise=void 0}))},t.prototype._fillBrowserDeviceIds=function(e,t){if(c.isEmpty(e))return e;var n=this._browserDevices.filter(function(e){return t===e.kind});return c.isEmpty(n)?e:(this._updateBrowserDeviceIds(e,n),e)},t.prototype._updateBrowserDeviceIds=function(e,t){for(var n=c.sortBy(e,function(e){return-e.label.length}),r=c.sortBy(t,function(e){return e.label.length}),i=this,o=0,a=n;o<a.length;o++)!function(e){var t=c.findIndex(r,function(t){return 0===t.label.indexOf(e.label)});-1!==t?(e.browserId=r[t].deviceId,r.splice(t,1)):i._logger.warn("No browser device found for device "+e.label)}(a[o])},t.prototype.getSpeakerDeviceDomIdAsync=function(e,t){return o(this,void 0,void 0,function(){var t;return a(this,function(n){if((t=c.find(this._speakers.getList(),function(t){return e===t.id}))&&t.browserId)return[2,t.browserId];throw new Error("Can not find speaker device with id"+e)})})},t.prototype._selectAudioDevices=function(){var e=this._microphones.getSelectedDevice(),t=this._speakers.getSelectedDevice();this._logger.info("SlimCore - selectAudioDevices: "+e+", "+t),this._slimcoreInstance.selectAudioDevices(e,t)},t.prototype._slimCoreDevicesChangedHander=function(e){var t=this;this._logger.info("SlimCore Devices changed: "+JSON.stringify(e)),this._updateBrowserDevices().then(function(){(e.video?t._updateVideoDevices():t._updateAudioDevices())?t._raiseDevicesChanged(e.video):t._logger.info("Supress device changed notification as nothing changed isVideo: "+e.video)}).catch(function(e){t._logger.error("Failed to raise device changed notification, error = "+e)})},t.prototype._raiseDevicesChanged=function(e){this._logger.info("Raising device changed notification isVideo: "+e),e&&this.event("videoDevicesChanged").raise(),this.event("devicesChanged").raise(this._enumerateDevices()),this.raiseChanged(),this._logger.info("Raised device changed notification isVideo: "+e)},t.prototype._enumerateDevices=function(){var e=this._cameras.getList(),t=this._microphones.getList(),n=this._speakers.getList(),r=this._compositeDevices.getList();return[].concat(e,t,n,r)},t.prototype.askDevicePermission=function(e){return _.asap(function(){return{audio:!0,video:!0}})},t.prototype._triggerMediaInitOnce=function(){l.hasFeature(f.Feature.LazyMediaInit)&&!this._haveStartedMedia&&(this._slimcoreInstance.fireIntent(f.Intent.MediaInit),this._haveStartedMedia=!0)},t.prototype.enumerateDevicesAsync=function(){var e=this;return new Promise(function(t,n){e._triggerMediaInitOnce(),e._devicesEnumeratedPromise.then(function(){return e._enumerateDevices()}).then(t,n)})},t.prototype.getPreferredCamera=function(){return this._cameras.getBestDevice()},t.prototype.selectDevices=function(e){var t=this;this._devicesEnumeratedPromise.then(function(){t._selectDevices(e)})},t.prototype.getPermissionState=function(e){return"granted"},t.prototype._selectDevices=function(e){this._logger.debug("selectDevices - "+JSON.stringify(e));var t=void 0!==e.camera;if(t&&this._cameras.selectDevice(e.camera),void 0!==e.microphone&&this._microphones.selectDevice(e.microphone),void 0!==e.speaker&&this._speakers.selectDevice(e.speaker),void 0!==e.audioIngestDevice)try{this._slimcoreInstance.selectAudioIngestDevice(e.audioIngestDevice)}catch(e){this._logger.error("Failed to select audio ingest device, Error = "+e)}this._selectAudioDevices(),this._raiseDevicesChanged(t)},t.prototype.setVideoCaptureConfigAsync=function(e,t){var n=this;return this._mediaReadyPromise.then(function(){n._slimcoreInstance.setVideoCaptureConfig?n._slimcoreInstance.setVideoCaptureConfig(e,t):n._logger.warn("setVideoCaptureConfig is not available")}).catch(function(e){throw n._logger.error("Failed to set video capture config, Error = "+e),e})},t.prototype._slimCoreVideoEffectsEventHandler=function(e){this._logger.info("SlimCore VideoEffects events: "+JSON.stringify(e));var t={type:e.type,payload:e.payload};this.event("videoEffectsEvent").raise(e.deviceId,t)},t.prototype.enableShellSharing=function(){return o(this,void 0,void 0,function(){var e=this;return a(this,function(t){if(this._slimcoreInstance.enableShellSharing)return[2,this._mediaReadyPromise.then(function(){return e._slimcoreInstance.enableShellSharing()})];throw new Error("Function does not exist")})})},t.prototype.disableShellSharing=function(){return o(this,void 0,void 0,function(){var e=this;return a(this,function(t){if(this._slimcoreInstance.disableShellSharing)return[2,this._mediaReadyPromise.then(function(){return e._slimcoreInstance.disableShellSharing()})];throw new Error("Function does not exist")})})},t.prototype._onShellSharingEvent=function(e){this.event("shellSharingEvent").raise(e.windowId,e.doShare)},t.prototype.setDeviceEffectsAsync=function(e,t){var n=this;return this._mediaReadyPromise.then(function(){n._slimcoreInstance.setDeviceEffects?n._slimcoreInstance.setDeviceEffects(e,p.convertVideoEffectType(t)):n._logger.warn("setDeviceEffects is not available")}).catch(function(e){throw n._logger.error("Failed to set Video Effects, Error = "+e),e})},t.prototype.getDeviceEffectsCapabilityAsync=function(e,t){var n=this;return this._mediaReadyPromise.then(function(){return n._slimcoreInstance.getDeviceEffectsCapability?n._slimcoreInstance.getDeviceEffectsCapability(e,t):(n._logger.warn("getDeviceEffectsCapability is not available"),0)}).catch(function(e){throw n._logger.error("Error in getDeviceEffectsCapabilityAsync, error = "+e),e})},t.prototype.setBackgroundImageAsync=function(e,t){var n=this;return this._mediaReadyPromise.then(function(){n._slimcoreInstance.setBackgroundImage?n._slimcoreInstance.setBackgroundImage(e,t):n._logger.warn("setBackgroundImage is not available")}).catch(function(e){throw n._logger.error("Failed to set background image, Error = "+e),e})},t.prototype.getImagePropertyAsync=function(e){var t=this;return this._mediaReadyPromise.then(function(){if(t._slimcoreInstance.getImageProperty)return t._slimcoreInstance.getImageProperty(e);throw t._logger.warn("getImageProperty API is not available"),new Error("getImageProperty API is not available")}).catch(function(n){throw t._logger.error("Failed to check image "+e+", Error = "+n),n})},t.prototype.transformImageAsync=function(e,t,n,r){var i=this;return this._mediaReadyPromise.then(function(){if(i._slimcoreInstance.transformImage)return i._slimcoreInstance.transformImage(e,t,n,r);throw i._logger.warn("transformImage API is not available"),new Error("transformImage API is not available")}).catch(function(t){throw i._logger.error("Failed to transform image "+e+", Error = "+t),t})},t.prototype.sendMessageDeviceVideoEffectsAsync=function(e,t){var n=this;return this._mediaReadyPromise.then(function(){return n._slimcoreInstance.sendMessageDeviceVideoEffects?n._slimcoreInstance.sendMessageDeviceVideoEffects(e,t):(n._logger.warn("sendMessageDeviceVideoEffects is not available"),{type:t.type,code:1})}).catch(function(e){throw n._logger.error("Failed to send message Video Effects, Error = "+e),e})},t.prototype.sendMessageDeviceVideoExtensibilityAsync=function(e,t){var n=this;return this._mediaReadyPromise.then(function(){return n._slimcoreInstance.sendMessageDeviceVideoExtensibility?n._slimcoreInstance.sendMessageDeviceVideoExtensibility(e,t):(n._logger.warn("sendMessageDeviceVideoExtensibility is not available"),{type:t.type,code:1})}).catch(function(e){throw n._logger.error("Failed to send message Video Extensibility, Error = "+e),e})},t.prototype._slimCoreVideoExtensibilityIpcChangedEventHandler=function(e){var t={sharedMemoryName:e.sharedMemoryName,frameReadyEventName:e.frameReadyEventName,frameProcessedEventName:e.frameProcessedEventName};this.event("videoExtensibilityIpcChangedEvent").raise(e.deviceId,t)},t.prototype._slimCoreVideoExtensibilityErrorHandler=function(e){var t={errorType:e.errorType,errorId:e.errorId,errorMessage:e.errorMessage};this.event("videoExtensibilityError").raise(e.deviceId,t)},t.prototype.getSelectedDevices=function(){var e={camera:this._cameras.getSelectedDevice(),microphone:this._microphones.getSelectedDevice(),speaker:this._speakers.getSelectedDevice()};return this._logger.debug("getSelectedDevices - "+JSON.stringify(e)),e},t.prototype.getCamera=function(e){return c.find(this._cameras.getList(),function(t){return t.id===e})},t.prototype.getChildCameras=function(e){return c.filter(this._cameras.getList(),function(n){return t.isChildVideoDeviceDescr(n)&&n.parentId===e})},t.isChildVideoDeviceDescr=function(e){return 5===e.kind},t.prototype.getLabelByCameraPosition=function(e){if(l.hasFeature(f.Feature.MediaLabels))switch(e.position){case 6:return"panoramic-video";case 7:return"participant-video-"+e.participantCameraId;default:return"main-video"}return""},t.prototype._getCameraForPreview=function(e){var t=this.getChildCameras(e);return c.isEmpty(t)?this.getCamera(e):c.find(t,function(e){return e.useForPreview})},t.prototype.getCameraForPreview=function(e){var t=this._getCameraForPreview(e);return this._logger.debug("getCameraForPreview id "+e+" - "+JSON.stringify(t)),t},t.prototype.getSelectedCameraForPreview=function(){var e=this._cameras.getSelectedDevice(),t=this._getCameraForPreview(e);return this._logger.debug("getSelectedCameraForPreview id "+e+" - "+JSON.stringify(t)),t},t.prototype.getSelectedCamera=function(){var e=this._cameras.getSelectedDevice(),t=this.getCamera(e);return this._logger.debug("getSelectedCamera - "+JSON.stringify(t)),t},t.prototype.createPreview=function(e,t,n,r){return void 0===r&&(r=m.generateCauseId()),o(this,void 0,void 0,function(){var i,o,s=this;return a(this,function(a){switch(a.label){case 0:(i=new h.default(r,this._logger,this._settings,this._slimcoreInstance,e,this,t,n)).deferredDispose.then(function(){c.remove(s._previewRenderers,function(e){return e===i})}),this._previewRenderers.push(i),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,i.startVideoAsync(r)];case 2:return a.sent(),[2,i];case 3:throw o=a.sent(),i.dispose(r),o;case 4:return[2]}})})},t.prototype.createPreviewRenderer=function(e,t,n){return void 0===n&&(n=m.generateCauseId()),this.createPreview(e,{kind:"camera"},t,n)},t.prototype.createScreenSharingPreviewRenderer=function(e,t,n){return void 0===n&&(n=m.generateCauseId()),this.createPreview(e,{kind:"sharing"},t,n)},t.prototype.getDeviceNameAsync=function(e){var t=this;return _.asap(function(){var n=c.find(t._enumerateDevices(),function(t){return t.id===e});if(!n)throw new Error("Device with id: "+e+" not found");return n.label})},t.prototype.setAudioProcessingFlags=function(e){this._logger.warn("setAudioProcessingFlags not supported")},t.prototype.getSpeakerVolume=function(){var e=this;return this._mediaReadyPromise.then(function(){return e._slimcoreInstance.getSpeakerVolume()})},t.prototype.getSpeakerSystemVolume=function(){var e=this;return this._mediaReadyPromise.then(function(){return e._slimcoreInstance.getSpeakerSystemVolume()})},t.prototype.setSpeakerVolume=function(e){var t=this;return this._mediaReadyPromise.then(function(){return t._slimcoreInstance.setSpeakerVolume(e)})},t.prototype.setSpeakerSystemVolume=function(e){var t=this;return this._mediaReadyPromise.then(function(){return t._slimcoreInstance.setSpeakerSystemVolume(e)})},t.prototype.unmuteMicrophone=function(){var e=this;return this._mediaReadyPromise.then(function(){return e._slimcoreInstance.unmuteMicrophone()})},t.prototype.unmuteSpeaker=function(){var e=this;return this._mediaReadyPromise.then(function(){return e._slimcoreInstance.unmuteSpeaker()})},t.prototype.getNrgLevelsForDeviceTuner=function(e){var t=this;return this._mediaReadyPromise.then(function(){return t._slimcoreInstance.getNrgLevelsForDeviceTuner(e)})},t._callingAudioFeatureTypeToSlimcoreAudioFeatureType=function(e){switch(e){case"HighNoiseSuppression":return f.AudioFeatureType.HighNoiseSuppression;default:return}},t.prototype.getAudioFeatureCapability=function(e){var n=this,r=t._callingAudioFeatureTypeToSlimcoreAudioFeatureType(e);return void 0===r?Promise.reject("Could not find a mapping for given AudioFeatureType of "+e):(this._logger.info("getAudioFeatureCapability called with feature "+e+" which maps to SlimCore feature "+r),this._mediaReadyPromise.then(function(){return n._slimcoreInstance.getAudioFeatureCapability(r)}))},t.prototype.getMicrophoneVolume=function(){var e=this;return this._mediaReadyPromise.then(function(){return e._slimcoreInstance.getMicrophoneVolume()})},t.prototype.setMicrophoneVolume=function(e){var t=this;return this._mediaReadyPromise.then(function(){return t._slimcoreInstance.setMicrophoneVolume(e)})},t._callingDeviceTelemetryDataContextToSlimcoreDeviceTelemetryDataContext=function(e){switch(e){case 0:return f.DeviceTelemetryDataContext.CallStart;case 1:return f.DeviceTelemetryDataContext.SelectedDeviceChangedFromUI;case 2:return f.DeviceTelemetryDataContext.SelectedDeviceChangedFromHid;case 3:return f.DeviceTelemetryDataContext.PairedBTDeviceUpdated;case 4:return f.DeviceTelemetryDataContext.PeriodicSelectedDeviceData;case 5:return f.DeviceTelemetryDataContext.InvalidContext;default:return}},t.prototype.setDeviceTelemetryData=function(e,n,r){var i=this,o=t._callingDeviceTelemetryDataContextToSlimcoreDeviceTelemetryDataContext(n);return void 0===o?Promise.reject("Could not find a mapping for given DeviceTelemetryDataContext of "+n):this._mediaReadyPromise.then(function(){return i._slimcoreInstance.setDeviceTelemetryData(e,o,r)})},t.prototype.hasVideoBindingScreenShare=function(){return!(!this._slimcoreInstance.createVideoBindingScreenShare&&!SlimCore.createVideoBindingScreenShare)},t.prototype._createVideoBindingScreenShare=function(){return this._slimcoreInstance.createVideoBindingScreenShare?this._slimcoreInstance.createVideoBindingScreenShare():SlimCore.createVideoBindingScreenShare()},t.prototype.getDevicePTZCapabilityAsync=function(e){var t=this;return this._mediaReadyPromise.then(function(){if(t._slimcoreInstance.getDevicePTZCapability){var n=e;if(!e){var r=t.getSelectedDevices();if(!r||!r.camera)throw t._logger.warn("applyPTZControlCommand: no camera selected"),new Error("applyPTZControlCommand failed: no camera selected");n=r.camera}return t._slimcoreInstance.getDevicePTZCapability(n)}throw t._logger.error("getDevicePTZCapability is not available"),new Error("getDevicePTZCapability function is null")}).catch(function(e){throw t._logger.error("Error in getDevicePTZCapabilityAsync, error = "+e),e})},t.prototype.applyPTZControlCommandAsync=function(e){var t=this;return this._mediaReadyPromise.then(function(){if(t._slimcoreInstance.applyPTZControlCommand){var n=t.getSelectedDevices();if(!n||!n.camera)throw t._logger.warn("applyPTZControlCommand: no camera selected"),new Error("applyPTZControlCommand: no camera selected");return t._slimcoreInstance.applyPTZControlCommand(n.camera,e)}throw t._logger.error("applyPTZControlCommand is not available"),new Error("getDevicePTZCapability function is null")}).catch(function(e){throw t._logger.error("Failed to apply ptz commands, Error = "+e),e})},t.prototype.getSourceFormats=function(e){return this._slimcoreInstance.getSourceFormats(e)},t}(u.default);t.default=O},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),s=n(12),c=n(30),l=n(9),u=n(57),d=SlimCore.Enums,p=0,h=function(e){function t(t,n,r,i,o,l,u,d){var h=e.call(this,n.createChild(function(){return"LocalVideoPreview["+h._id+"]["+h._selection.kind+"]["+h._previewVideoObjectId+"]"}),r,i)||this;if(h._currentTarget=o,h._deviceManager=l,h._selection=u,h._options=d,h._id=p++,h._previewVideoObjectId=0,h._isDisposed=!1,h._disposedDeferred=s.defer(),h._logger.info("constructor device? "+h._selection.device+" causeId: "+t),"camera"!==h._selection.kind&&("sharing"!==h._selection.kind||!a.isUndefined(h._selection.device)))throw new Error("invalid selection parameters causeId: "+t);return h._chainedApiPromise=new c.default(n.createChild(function(){return"LocalVideoPreview["+h._id+"]["+h._selection.kind+"]["+h._previewVideoObjectId+"]"})),"camera"===h._selection.kind&&a.isUndefined(h._selection.device)&&h._registerDisposable(h._deviceManager.on("videoDevicesChanged",function(){return h._videoDevicesChanged(t)})),h}return r(t,e),t.prototype._videoDevicesChanged=function(e){var t=this;this._logger.info("_videoDevicesChanged causeId: "+e),this._chainedApiPromise.chainPromise(function(){return t._swapVideoDevice(e)},"swapVideoDevice",e)},t.prototype.startVideoAsync=function(e){return i(this,void 0,void 0,function(){var t=this;return o(this,function(n){switch(n.label){case 0:return this._logger.info("startVideoAsync causeId: "+e),[4,this._chainedApiPromise.chainPromise(function(){return t._startVideo(e)},"startVideoAsync",e)];case 1:return n.sent(),[2]}})})},t.prototype.dumpVideoSourceImages=function(){return i(this,void 0,void 0,function(){return o(this,function(e){if(!this._previewVideoObjectId)throw new Error("Cannot dump video fx debug images when there is no preview video");return[2,this._slimcoreInstance.dumpVideoSourceImages(this._previewVideoObjectId)]})})},t.prototype.cameraAutoControl=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){if(!this._previewVideoObjectId)throw new Error("Cannot access camera controls when there is no preview video");if(!this._slimcoreInstance.cameraAutoControl)throw new Error("Camera control access not available in slimcore");return[2,this._slimcoreInstance.cameraAutoControl(this._previewVideoObjectId,e)]})})},t.prototype.getCameraManualControlStates=function(e){return i(this,void 0,void 0,function(){var t,n;return o(this,function(r){switch(r.label){case 0:if(!this._previewVideoObjectId)throw new Error("Cannot access camera controls when there is no preview video");if(!this._slimcoreInstance.getCameraManualControlStates)throw new Error("cameraManualControlGetStates not available in slimcore");return t=this._convertToSlimCoreCameraControlModeSelection(e),[4,this._slimcoreInstance.getCameraManualControlStates(this._previewVideoObjectId,t)];case 1:return n=r.sent(),[2,this._convertToCameraControlStates(n)]}})})},t.prototype.setCameraManualControlStates=function(e){return i(this,void 0,void 0,function(){var t;return o(this,function(n){if(!this._previewVideoObjectId)throw new Error("Cannot access camera controls when there is no preview video");if(!this._slimcoreInstance.setCameraManualControlStates)throw new Error("cameraManualControlSetStates not available in slimcore");return t=this._convertToSlimCoreCameraControlStates(e),[2,this._slimcoreInstance.setCameraManualControlStates(this._previewVideoObjectId,t)]})})},t.prototype.enumerateCameraManualControls=function(){return i(this,void 0,void 0,function(){return o(this,function(e){if(!this._previewVideoObjectId)throw new Error("Cannot access camera controls when there is no preview video");if(!this._slimcoreInstance.enumerateCameraManualControls)throw new Error("cameraManualControlEnumerate not available in slimcore");return[2,this._slimcoreInstance.enumerateCameraManualControls(this._previewVideoObjectId)]})})},t.prototype.dispose=function(e){return void 0===e&&(e=l.generateCauseId()),i(this,void 0,void 0,function(){var t=this;return o(this,function(n){switch(n.label){case 0:return this._logger.info("dispose causeId: "+e+" isDisposed: "+this._isDisposed),this._isDisposed||(this._isDisposed=!0,this._chainedApiPromise.chainPromise(function(){return t._dispose(e)},"dispose",e)),[4,this.deferredDispose];case 1:return n.sent(),[2]}})})},Object.defineProperty(t.prototype,"deferredDispose",{get:function(){return this._disposedDeferred.promise},enumerable:!1,configurable:!0}),t.prototype._isRunning=function(){return 0!==this._previewVideoObjectId&&!!this._videoBinding},t.prototype._dispose=function(t){return i(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return n.trys.push([0,,2,3]),[4,this._stopVideo(t)];case 1:return n.sent(),[3,3];case 2:return this._disposedDeferred.resolve(),this._currentTarget=null,e.prototype.dispose.call(this,t),[7];case 3:return[2]}})})},t.prototype._canSuppressDeviceSwap=function(e){return!!this._ignoredVideoDeviceInVideoSwap&&this._ignoredVideoDeviceInVideoSwap.id===e.id&&this._ignoredVideoDeviceInVideoSwap.generation===e.generation},t.prototype._swapVideoDevice=function(e){return i(this,void 0,void 0,function(){var t,n;return o(this,function(r){switch(r.label){case 0:return this._isDisposed?(this._logger.info("_swapVideoDevice causeId: "+e+" noop, isDisposed: "+this._isDisposed+" is running: "+this._isRunning()),[2]):(t=this._deviceManager.getSelectedCameraForPreview())?this._canSuppressDeviceSwap(t)?[2]:this._isRunning()?(n=this._ignoredVideoDeviceInVideoSwap?this._ignoredVideoDeviceInVideoSwap.id:null,this._logger.info("_swapVideoDevice causeId: "+e+" will change video preview device: "+n+" -> "+t.id),[4,this._stopVideoDevice(e,!0)]):[3,2]:(this._logger.info("_swapVideoDevice causeId: "+e+" noop, no selected device, isDisposed: "+this._isDisposed+" is running: "+this._isRunning()),this._ignoredVideoDeviceInVideoSwap=void 0,[2]);case 1:return r.sent(),[3,3];case 2:this._logger.info("_swapVideoDevice causeId: "+e+" will resurrect video preview device: "+t.id),r.label=3;case 3:return this._isDisposed?(this._logger.info("_swapVideoDevice causeId: "+e+" skip, isDisposed: "+this._isDisposed+" is running: "+this._isRunning()),[2]):(this._ignoredVideoDeviceInVideoSwap=t,[4,this._startVideoDevice(e,t.label,t.id,d.VideoType.Video)]);case 4:return r.sent(),[2]}})})},t.prototype._startVideo=function(e){return i(this,void 0,void 0,function(){var t,n,r,i;return o(this,function(o){switch(o.label){case 0:if(this._isDisposed||this._isRunning())return[3,2];if(t="",n="",r=d.VideoType.ScreenShare,i=void 0,"camera"===this._selection.kind){if(!(i=a.isUndefined(this._selection.device)?this._deviceManager.getSelectedCameraForPreview():this._deviceManager.getCameraForPreview(this._selection.device)))throw new Error("_startVideo causeId: "+e+" no camera to start video preview");r=d.VideoType.Video,t=i.label,n=i.id}return this._logger.info("_startVideo causeId: "+e+" will start video preview now for device name: "+t+" path: "+n),this._ignoredVideoDeviceInVideoSwap=i,[4,this._startVideoDevice(e,t,n,r)];case 1:return o.sent(),[3,3];case 2:this._logger.info("_startVideo causeId: "+e+" noop, isDisposed: "+this._isDisposed+" is running: "+this._isRunning()),o.label=3;case 3:return[2]}})})},t.prototype._startVideoDevice=function(e,t,n,r){return i(this,void 0,void 0,function(){var i,a,s,c=this;return o(this,function(o){switch(o.label){case 0:return i=this,[4,this._deviceManager.getPreviewVideo(e,r,t,n)];case 1:return i._previewVideoObjectId=o.sent(),a=this,[4,this._deviceManager.getRendererBindingManager().acquire(e,this,this._previewVideoObjectId)];case 2:return a._videoBinding=o.sent(),s=this._options||{scalingMode:1,transparent:!1},this._createVideoRenderer(e,this._currentTarget,s,!0),this._videoErrorChangedHandler=this._slimcoreInstance.handle("object-property-changed",{objectId:this._previewVideoObjectId,propKey:d.Property.VideoError},function(e){return c._videoErrorChanged(e.value)}),[2]}})})},t.prototype._stopVideo=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return this._isRunning()?(this._logger.info("_stopVideo causeId: "+e+" isDisposed: "+this._isDisposed+" will stop video preview now"),this._ignoredVideoDeviceInVideoSwap=void 0,[4,this._stopVideoDevice(e)]):[3,2];case 1:return t.sent(),[3,3];case 2:this._logger.info("_stopVideo causeId: "+e+" noop, isDisposed: "+this._isDisposed+" is running: "+this._isRunning()),t.label=3;case 3:return[2]}})})},t.prototype._stopVideoDevice=function(e,t){return void 0===t&&(t=!1),i(this,void 0,void 0,function(){var n;return o(this,function(r){switch(r.label){case 0:try{this._disposeVideoRenderer(e,t)}catch(t){this._logger.warn("_stopVideoDevice causeId: "+e+" _disposeVideoRenderer error: "+t+" falied @ "+(new Error).stack)}return n=this._deviceManager.getRendererBindingManager().release(e,this,this._previewVideoObjectId),this._previewVideoObjectId=0,this._videoBinding=null,this._videoErrorChangedHandler&&(this._videoErrorChangedHandler.dispose(),this._videoErrorChangedHandler=null),[4,n];case 1:return r.sent(),[2]}})})},t.prototype._videoErrorChanged=function(e){e&&(this._logger.error("VideoError: "+e),this.event("videoError").raise(e))},t.prototype._convertToSlimCoreCameraControlStates=function(e){return e.map(function(e){return{id:e.id,mode:e.mode,value:e.value,context:e.context}})},t.prototype._convertToSlimCoreCameraControlModeSelection=function(e){return e.map(function(e){return{id:e.id,mode:e.mode}})},t.prototype._convertToCameraControlStates=function(e){return e.map(function(e){return{id:e.id,mode:e.mode,value:e.value,context:e.context}})},t}(u.default);t.default=h},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),o=n(12),a=n(11),s=n(59),c=function(e){function t(t,n,r,i,o){var a=e.call(this,t.createChild("ScreenSharingManager"),n,r)||this;a._appHooks=i,a._deviceManager=o,a._logger.info("constructor");try{a._screenScraper=new s.default(a._slimcoreInstance)}catch(e){a._logger.warn(""+e)}return a._registerDisposable(a._appHooks.onDisplaysChanged(function(){return a._raiseScreensChanged()})),a}return r(t,e),t.prototype.enumerateScreensAsync=function(){var e=this;return o.asap(function(){return e._enumerateScreens()})},t.prototype.enumerateWindowsAsync=function(){var e=this;return o.asap(function(){return e._enumerateWindows()})},t.prototype.enumerateCamerasAsync=function(){var e=this;try{return this._deviceManager?this._deviceManager.enumerateDevicesAsync().then(function(t){var n=t.filter(function(e){return 1===e.kind});return e._logger.debug("enumerateCameras() result: "+JSON.stringify(n)),i.map(n,function(e){return new d(e)})}):Promise.resolve([])}catch(e){return this._logger.error("enumerateCameras() failed: "+e),Promise.reject("enumerateCameras() failed: "+e)}},t.prototype._enumerateScreens=function(){var e=this;try{var t=this._screenScraper&&this._screenScraper.getMonitorList()||[];return this._logger.debug("screenScraper.getMonitorList() result: "+JSON.stringify(t)),i.map(t,function(t){return new l(t,e._logger,e._screenScraper)})}catch(e){throw this._logger.error("screenScraper.getMonitorList() failed: "+e),e}},t.prototype._enumerateWindows=function(){var e=this;try{var t=this._screenScraper&&this._screenScraper.getWindowList()||[];return this._logger.debug("screenScraper.getWindowList() result: "+JSON.stringify(t)),i.map(t,function(t){return new u(t,e._logger,e._screenScraper)})}catch(e){throw this._logger.error("screenScraper.getWindowList() failed: "+e),e}},t.prototype._raiseScreensChanged=function(){this._logger.debug("raising onScreensChanged"),this.event("screensChanged").raise()},t}(a.default);t.default=c;var l=function(){function e(e,t,n){this._monitorInfo=e,this._logger=t,this._screenScraper=n}return e.prototype.getId=function(){return this._monitorInfo.monitorId},e.prototype.getDeviceId=function(){return String(this._monitorInfo.monitorId)},e.prototype.getType=function(){return 1},e.prototype.getPreview=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t,n){var r=this;return new Promise(function(i){i(r._screenScraper.getMonitorPreview(r.getId(),e,t,n,r._monitorInfo.region))}).then(function(e){return r._logger.debug("screenScraper.getMonitorPreview("+r.getId()+") result: "+e.width+"x"+e.height),e},function(e){throw r._logger.error("screenScraper.getMonitorPreview("+r.getId()+") failed: "+e),e})},e.prototype.getDescription=function(){return this._monitorInfo.name},e.prototype.getIcon=function(e,t){return Promise.resolve(null)},e.prototype.getBounds=function(){return{x:this._monitorInfo.region.x,y:this._monitorInfo.region.y,width:this._monitorInfo.region.width,height:this._monitorInfo.region.height}},e}(),u=function(){function e(e,t,n){this._windowInfo=e,this._logger=t,this._screenScraper=n}return e.prototype.getId=function(){return this._windowInfo.windowId},e.prototype.getDeviceId=function(){return String(this._windowInfo.windowId)},e.prototype.getType=function(){return 2},e.prototype.getPreview=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t,n){var r=this;return new Promise(function(i){i(r._screenScraper.getWindowPreview(r.getId(),e,t,n))}).then(function(e){return r._logger.debug("screenScraper.getWindowPreview("+r.getId()+") result: "+e.width+"x"+e.height),e},function(e){throw r._logger.error("screenScraper.getWindowPreview("+r.getId()+") failed: "+e),e})},e.prototype.getDescription=function(){return this._windowInfo.title},e.prototype.getAppName=function(){return this._windowInfo.applicationName},e.prototype.getIcon=function(e,t,n){var r=this;return new Promise(function(i){i(r._screenScraper.getWindowIcon(r.getId(),e,t,n))}).then(function(e){return r._logger.debug("screenScraper.getWindowIcon("+r.getId()+") result: "+e.width+"x"+e.height),e},function(e){throw r._logger.error("screenScraper.getWindowIcon("+r.getId()+") failed: "+e),e})},e.prototype.getBounds=function(){},e}(),d=function(){function e(e){this._cameraDescription=e}return e.prototype.getId=function(){return null},e.prototype.getDeviceId=function(){return this._cameraDescription.id},e.prototype.getType=function(){return 3},e.prototype.getPreview=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getDescription=function(){return this._cameraDescription.label},e.prototype.getIcon=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getBounds=function(){},e}()},function(e,t,n){"use strict";function r(e){var t;if(e.telemetryLoggers)t=e.telemetryLoggers;else if(e.telemetryService&&e.telemetryService.getGenericTelemetryLogger&&e.telemetryTenantTokens)l.forEach(Object.keys(e.telemetryTenantTokens),function(n){return t[n]=e.telemetryService.getGenericTelemetryLogger(e.telemetryTenantTokens[n])});else if(e.telemetryService&&e.telemetryService.sendEvent){var n={sendEvent:function(t){e.telemetryService.sendEvent(t.eventName,t.props)}};t={media:n,rootTools:n,signaling:n}}return t}function i(){return SlimCore.getApiVersion&&SlimCore.getApiVersion()}function o(){return!(!SlimCore||!SlimCore.getVersion)}var a=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0}),t.slimCoreUwpStackFactory=t.slimCoreElectronStackFactory=t.SlimCoreUwpStack=t.SlimCoreElectronStack=t.TelemetryEventFilteringProxy=void 0;var l=n(7),u=n(12),d=n(88),p=n(18),h=n(29),g=n(98),f=n(10),_=n(106),m=n(11),v=n(107),y=n(62),C=n(63),S=n(46),I=n(65),O=n(47),T=n(108),E=n(109),P=SlimCore.Enums,b=n(9),A=n(26),R=n(45),w=n(110),L=7,N=function(){function e(e){this._telemetryManager=e,this._eventCache=[]}return e.prototype.dispatch=function(e,t){var n=this;if(this._eventCache.push(e),t){var r=this._eventCache;this._eventCache=[],r.forEach(function(e){var r=e.serializedEvent.filter(function(e){return JSON.parse(e).userId===t});0!==r.length&&n._telemetryManager.dispatch(r)})}},e}();t.TelemetryEventFilteringProxy=N;var D=function(e){function t(t,n){void 0===n&&(n=1);var r=e.call(this,t)||this;return r.callSupport=n,r}return a(t,e),t}(Error),M=function(e){function t(t){var n=e.call(this,new R.default(t.logger).createChild("CallingStack"),l.assign(t.settings,{platform:f.PlatformType.Electron}),f.wrap(t.slimCoreInstance,t.settings))||this;if(n.callRegistries=[],n._startSlimcorePromiseDefered=u.defer(),n._telemetryLoggers={},n._stackLoginPromise=u.defer(),n._mediaStartDeferredPromise=u.defer(),n._rtLogger=null,!o())throw new D("slimcore module is not available",1);if(i()<L)throw new D("slimcore module API version "+i()+" incompatible with required "+L,2);t.settings.enableTsCallingULLogging&&(n._rtLogger=g.initLogger(n._slimcoreInstance,t)),n._appHooks=t.appHooks,n._telemetryLoggers=r(t),n._setup=new O.default(n._slimcoreInstance),n._ecsProvider=new S.default(n._slimcoreInstance),n._callFeedback=new v.default(n._logger,n._slimcoreInstance),n._aiMdp=new _.default(n._logger,n._slimcoreInstance),n._stackLoginPromise.promise.then(function(){return n._startSlimcorePromiseDefered.resolve(n._slimcoreInstance)});var a=new R.default(t.logger),s=f.hasFeature(P.Feature.MultiUserSupport)?n._startSlimcorePromiseDefered.promise:n._stackLoginPromise.promise;n._telemetryManager=new w.TelemetryManager(n._logger.createChild("OneDSTelemetry"),n._slimcoreInstance,s,t.settings.oneDsTelemetryCollectorUrlTs||""),n._telemetryFilter=new N(n._telemetryManager);var c=f.hasFeature(P.Feature.LazyMediaInit)?s.then(function(){return n._mediaStartDeferredPromise.promise}):s;return n._deviceManager=new C.default(a,n._settings,n._slimcoreInstance,c,t.appHooks),n._screenSharingManager=new I.default(a,n._settings,n._slimcoreInstance,t.appHooks,n._deviceManager),n._registerDisposable(n._slimcoreInstance.handle("e911-info-changed",void 0,function(e){return n._onE911Info(e)})),n._registerDisposable(n._slimcoreInstance.handle("probe-devices-status-changed",void 0,function(e){return n._onProbeDevicesStatusChanged(e)})),f.hasFeature(P.Feature.ExternalEventsCollector)&&n._registerDisposable(n._slimcoreInstance.handle("incoming-telemetry-event",void 0,function(e){return n._onIncomingTelemetryEvent(e)})),n}return a(t,e),t.prototype.dispose=function(t){return s(this,void 0,void 0,function(){var n,r,i,o=this;return c(this,function(a){return(n=this._logger.createFnLogger("dispose",t)).info("dispose"),this._libStatus!==P.LibStatus.Running&&this._startSlimcorePromiseDefered.reject(new Error("CallingStack dispose called before slimcore reached Running state")),this._mediaStartDeferredPromise.reject(new Error("CallingStack dispose called before media was initialized")),r=function(){return s(o,void 0,void 0,function(){return c(this,function(r){switch(r.label){case 0:return this.callRegistries=[],n.info("call registries are disposed"),this._screenSharingManager.dispose(t),this._screenSharingManager=void 0,n.info("screensharing manager is disposed"),[4,this._deviceManager.dispose(t)];case 1:return r.sent(),this._deviceManager=void 0,n.info("device manager is disposed"),this._rtLogger&&(this._rtLogger.dispose(t),this._rtLogger=null),e.prototype.dispose.call(this,t),n.info("will dispose slimcore"),this._slimcoreInstance.dispose(),this._slimcoreInstance=void 0,n.info("slimcore instance is disposed"),[2]}})})},i=this.callRegistries.map(function(e){return e.dispose(t)}),[2,Promise.all(i).then(r,r)]})})},t.prototype.init=function(e,t){return void 0===e&&(e={block:!0}),void 0===t&&(t=b.generateCauseId()),s(this,void 0,void 0,function(){var n,r,i,o=this;return c(this,function(a){switch(a.label){case 0:return(n=this._logger.createFnLogger("init",t)).info("init"),this._slimcoreInstance?(f.hasFeature(P.Feature.AsyncStart)||(e.block=!0),[4,Promise.all([this.getSetup().setNumber("*Lib/LazyMediaInit",f.hasFeature(P.Feature.LazyMediaInit)&&e.lazyMediaInit?1:0),this.getSetup().setString("*Lib/SCT/Telemetry/DiagnosticLevel",e.telemetryDiagnosticLevel||"")])]):[2,Promise.reject(new Error("slimcore instance is already disposed"))];case 1:return a.sent(),this._registerDisposable(this._slimcoreInstance.handle("media-status-changed",void 0,function(e){return o._onMediaStatusChanged(e)})),e.block||this._registerDisposable(this._slimcoreInstance.handle("lib-status-changed",{libStatus:SlimCore.Enums.LibStatus.Running},function(e){return o._onLibStatusChanged(e)})),n.info("starting slimcoreInstance block="+e.block),this._slimcoreInstance.start(e.block),r=e.block?P.LibStatus.Running:this._slimcoreInstance.getLibStatus?this._slimcoreInstance.getLibStatus():void 0,n.info("after slimcoreInstance.start, libStatus="+r),r===P.LibStatus.Running&&this._onLibStatusChanged({libStatus:r}),void 0!==(i=this._slimcoreInstance.getMediaStatus?this._slimcoreInstance.getMediaStatus():void 0)&&i!==P.MediaStatus.NotAvailable&&this._onMediaStatusChanged({mediaStatus:i}),[2,this._startSlimcorePromiseDefered.promise.then(A.noop)]}})})},t.prototype._onLibStatusChanged=function(e){this._logger.info("_onLibStatusChanged from "+this._libStatus+" => "+e.libStatus),e.libStatus===P.LibStatus.Running&&this._startSlimcorePromiseDefered.resolve(this._slimcoreInstance),this._libStatus=e.libStatus},t.prototype.getCallRegistry=function(){return this._logger.info("returning default callRegistry"),this.callRegistries[0]?this.callRegistries[0]:this._createCallRegistry()},t.prototype.createCallRegistry=function(e,t){var n=this;void 0===t&&(t=b.generateCauseId());var r=e?p.mriOrId(e.id):void 0,i=this._logger.createFnLogger("createCallRegistry[identity="+r+"]",t),o=this.callRegistries.find(function(t){return t.identity===e.id});if(o&&!o.isDisposing)return i.info("callRegistry already exists for "+p.mriOrId(e.id)),Promise.resolve(o);var a=o&&o.isDisposing?o.disposePromise:Promise.resolve().then(A.noop);return this._startSlimcorePromiseDefered.promise.then(function(){return s(n,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,a];case 1:return t.sent(),o=this._createCallRegistry(e),[2,o]}})})})},t.prototype._createCallRegistry=function(e){var t=this,n=new y.default(this._logger,this._settings,this._slimcoreInstance,this._deviceManager,this._appHooks,this._telemetryLoggers,e);return n.on("disposed",function(){t.callRegistries.splice(t.callRegistries.indexOf(n),1)}),n.loginPromise.then(this._stackLoginPromise.resolve,this._stackLoginPromise.reject),n.on("callAdded",function(e){return t._handleCallState(e)}),this.callRegistries.push(n),n},t.prototype.getDeviceManager=function(){return this._deviceManager},t.prototype.createDeviceManager=function(e){return this._deviceManager},t.prototype.getScreenSharingManager=function(){return this._screenSharingManager},t.prototype.getSetup=function(){return this._setup},t.prototype.getEcsProvider=function(){return this._ecsProvider},t.prototype.getCallFeedback=function(){return this._callFeedback},t.prototype.getAiMdp=function(){return this._aiMdp},t.prototype.fireIntent=function(e,n){if(this._slimcoreInstance){var r=t._callingIntentToSlimcoreIntent(e);r&&this._slimcoreInstance.fireIntent(r,n)}},t.prototype.getVersion=function(){return{build:h.getTsCallingVersion(),ovb:h.getOvb()}},t._callingIntentToSlimcoreIntent=function(e){switch(e){case 0:return P.Intent.CallPush;case 1:return P.Intent.CallUser;case 2:return P.Intent.CallPreheat;case 3:return P.Intent.MediaInit;default:return}},t.prototype._slimcoreMediaStatusToCallingMediaStatus=function(e){switch(e){case P.MediaStatus.Initialized:return 1;case P.MediaStatus.NotAvailable:return 0;case P.MediaStatus.Failed:return 2;case P.MediaStatus.Uninitialized:return 3;default:return}},t.prototype.getMediaStatus=function(){return this._slimcoreMediaStatusToCallingMediaStatus(this._slimcoreInstance.getMediaStatus())},t.prototype.setMediaConfig=function(e){var t=this;return new Promise(function(n){t._setMediaConfig(e,t._startSlimcorePromiseDefered.promise),n()})},t.prototype._setMediaConfig=function(e,t){var n=this;if(!!this._slimcoreInstance.setMediaConfig)this._logger.info("Set Media Configuration, using setMediaConfig"),this._slimcoreInstance.setMediaConfig(e);else{var r=!!this._slimcoreInstance.setMediaPortRanges,i=!!this._slimcoreInstance.enableMediaQoS,o=!!this._slimcoreInstance.createMediaConfig,a=!!this._slimcoreInstance.setOpenCameraInMaxResolution,s=!!this._slimcoreInstance.enableTtySupport,c=!!this._slimcoreInstance.enableAGC,l=e.hasOwnProperty("mediaPortRanges"),u=e.hasOwnProperty("enableMediaQoS"),d=e.hasOwnProperty("openCameraInMaxResolution"),p=e.hasOwnProperty("enableTtySupport"),h=e.hasOwnProperty("enableAGC");if(a&&d&&(this._logger.info("Set Media Configuration, using OpenCameraInMaxResolution"),this._slimcoreInstance.setOpenCameraInMaxResolution(e.openCameraInMaxResolution)),u||l)if(i&&r)u&&(this._logger.info("Set Media Configuration, using set enableMediaQos"),this._slimcoreInstance.enableMediaQoS(e.enableMediaQoS)),l&&(this._logger.info("Set Media Configuration, using set Media port ranges"),this._slimcoreInstance.setMediaPortRanges(e.mediaPortRanges));else if(o){this._logger.info("Set Media Configuration, using CreateMediaConfig");var g=this._slimcoreInstance.createMediaConfig();u&&g.enableMediaQoS(e.enableMediaQoS),l&&g.setMediaPortRanges(e.mediaPortRanges)}else this._logger.error("Set Media Configuration, failed no suitable methods found for qos or port ranges");(p||h)&&(this._logger.info("Set Media Configuration, queuing operation to run when media is ready"),t.then(function(){if(p)if(s)n._logger.info("Set Media Configuration, using enableTtySupport"),n._slimcoreInstance.enableTtySupport(e.enableTtySupport);else if(o){var t=n._slimcoreInstance.createMediaConfig();t.enableTtySupport?(n._logger.info("Set Media Configuration, using CreateMediaConfig.enableTtySupport"),t.enableTtySupport(e.enableTtySupport)):n._logger.error("Set Media Configuration, failed no suitable methods found for enableTtySupport on CreateMediaConfig")}else n._logger.error("Set Media Configuration, failed no suitable methods found for enableTtySupport");h&&c&&(n._logger.info("Set Media Configuration, using enableAGC"),n._slimcoreInstance.enableAGC(e.enableAGC))}))}},t.prototype.getE911Info=function(){var e=this;return this._slimcoreInstance?this._slimcoreInstance.getE911Info?this._startSlimcorePromiseDefered.promise.then(function(){var t=e._slimcoreInstance.getE911Info();try{return JSON.parse(t)}catch(e){return Promise.reject(new Error("failed to parse e911Info "+e))}}):Promise.reject(new Error("getE911Info is not available")):Promise.reject(new Error("slimcore instance is already disposed"))},t.prototype.getLocationInfo=function(){var e=this;return this._slimcoreInstance?this._slimcoreInstance.getLocationInfo?this._startSlimcorePromiseDefered.promise.then(function(){var t=e._slimcoreInstance.getLocationInfo();try{return JSON.parse(t)}catch(e){return Promise.reject(new Error("failed to parse LocationInfo "+e))}}):Promise.reject(new Error("getLocationInfo is not available")):Promise.reject(new Error("slimcore instance is already disposed"))},t.prototype.getLiveStreamClient=function(){var e=this;return new d.LiveStreamClient(this._ecsProvider,this._logger.createChild("LiveStreamClient"),function(){return e._telemetryLoggers.media})},t.prototype._onE911Info=function(e){var t,n;try{t=JSON.parse(e.info)}catch(e){return void this._logger.error("failed to parse e911Info: "+e)}try{n=JSON.parse(e.areaContent)}catch(t){this._logger.error("failed to parse areaContent from areaContent: "+t);try{var r=e;n=JSON.parse(r.location)}catch(e){this._logger.error("failed to parse areaContent from location: "+e),n={}}}this.event("e911InfoChanged").raise(t,n)},t.prototype._onMediaStatusChanged=function(e){var t=this._slimcoreMediaStatusToCallingMediaStatus(e.mediaStatus);this.event("mediaStatusChanged").raise(t),1===t?this._mediaStartDeferredPromise.resolve(this._slimcoreInstance):2===t&&this._mediaStartDeferredPromise.reject(new Error("Media initialization FatalError"))},t.prototype._onProbeDevicesStatusChanged=function(e){this.event("probeDevicesStatusChanged").raise(e.ready)},t.prototype._getCurrentUserId=function(){return 0!==this.callRegistries.length&&null!==this.callRegistries[0].identity?this.callRegistries[0].identity:void 0},t.prototype._onIncomingTelemetryEvent=function(e){this._telemetryFilter.dispatch(e,this._getCurrentUserId())},t.prototype._handleCallState=function(e){var t=this;e.on("callStateChanged",function(){2===e.state&&t._telemetryManager.pauseLogger(),7===e.state&&t._telemetryManager.resumeLogger()})},t.prototype.createVoipCallCoordinator=function(){var e=new T.default(this._slimcoreInstance,this._logger,this._settings);return this._registerDisposable(e),e},t}(m.default);t.SlimCoreElectronStack=M;var j=function(e){function t(t){var n=e.call(this,new R.default(t.logger).createChild("CallingStack",!0),l.assign(t.settings,{platform:f.PlatformType.Uwp}),f.wrap(new E.UwpEngineWrapped(t.slimCoreInstance).objectAsWrapped,t.settings))||this;if(n.callRegistries=[],n._startSlimcorePromiseDefered=u.defer(),n._stackLoginPromise=u.defer(),n._mediaStartDeferredPromise=u.defer(),!f.isSlimCoreRTModuleAvailable())throw new D("slimcore module is not available",1);n._appHooks=t.appHooks,n._telemetryLoggers=r(t),n._setup=new O.default(n._slimcoreInstance),n._callFeedback=new v.default(n._logger,n._slimcoreInstance),n._aiMdp=new _.default(n._logger,n._slimcoreInstance),n._stackLoginPromise.promise.then(function(){return n._startSlimcorePromiseDefered.resolve(n._slimcoreInstance)});var i=f.hasFeature(P.Feature.MultiUserSupport)?n._startSlimcorePromiseDefered.promise:n._stackLoginPromise.promise;n._telemetryManager=new w.TelemetryManager(n._logger.createChild("OneDSTelemetry"),n._slimcoreInstance,i,t.settings.oneDsTelemetryCollectorUrlTs||""),n._telemetryFilter=new N(n._telemetryManager);var o=f.hasFeature(P.Feature.LazyMediaInit)?i.then(function(){return n._mediaStartDeferredPromise.promise}):i;return n._deviceManager=new C.default(n._logger,n._settings,n._slimcoreInstance,o,t.appHooks),n._screenSharingManager=new I.default(n._logger,n._settings,n._slimcoreInstance,t.appHooks,n._deviceManager),n._registerDisposable(n._slimcoreInstance.handle("media-status-changed",void 0,function(e){return n._onMediaStatusChanged(e)})),f.hasFeature(P.Feature.ExternalEventsCollector)&&n._registerDisposable(n._slimcoreInstance.handle("incoming-telemetry-event",void 0,function(e){return n._onIncomingTelemetryEvent(e)})),n}return a(t,e),t.prototype.dispose=function(t){return void 0===t&&(t=b.generateCauseId()),s(this,void 0,void 0,function(){var n,r,i,o=this;return c(this,function(a){return(n=this._logger.createFnLogger("dispose",t)).info("dispose"),this._libStatus!==P.LibStatus.Running&&this._startSlimcorePromiseDefered.reject(new Error("CallingStack dispose called before slimcore reached Running state")),this._mediaStartDeferredPromise.reject(new Error("CallingStack dispose called before media was initialized")),r=function(){return s(o,void 0,void 0,function(){return c(this,function(r){switch(r.label){case 0:return this.callRegistries=[],n.info("call registries are disposed"),this._screenSharingManager.dispose(t),this._screenSharingManager=void 0,n.info("screensharing manager is disposed"),[4,this._deviceManager.dispose(t)];case 1:return r.sent(),this._deviceManager=void 0,n.info("device manager is disposed"),e.prototype.dispose.call(this,t),n.info("will dispose slimcore"),this._slimcoreInstance.dispose(),this._slimcoreInstance=void 0,n.info("slimcore instance is disposed"),[2]}})})},i=this.callRegistries.map(function(e){return e.dispose(t)}),[2,Promise.all(i).then(r,r)]})})},t.prototype.init=function(e,t){return void 0===e&&(e={block:!0}),void 0===t&&(t=b.generateCauseId()),s(this,void 0,void 0,function(){var n,r=this;return c(this,function(i){switch(i.label){case 0:return(n=this._logger.createFnLogger("init",t)).info("init"),this._slimcoreInstance?(f.hasFeature(P.Feature.AsyncStart)||(e.block=!0),e.block||this._registerDisposable(this._slimcoreInstance.handle("lib-status-changed",{libStatus:SlimCore.Enums.LibStatus.Running},function(e){return r._onLibStatusChanged(e)})),[4,Promise.all([this.getSetup().setNumber("*Lib/LazyMediaInit",f.hasFeature(P.Feature.LazyMediaInit)&&e.lazyMediaInit?1:0),this.getSetup().setString("*Lib/SCT/Telemetry/DiagnosticLevel",e.telemetryDiagnosticLevel||"")])]):[2,Promise.reject(new Error("slimcore instance is already disposed"))];case 1:return i.sent(),this._slimcoreInstance.start(e.block),n.info("starting slimcoreInstance block="+e.block),e.block&&(this._libStatus=P.LibStatus.Running,this._startSlimcorePromiseDefered.resolve(this._slimcoreInstance)),[2,this._startSlimcorePromiseDefered.promise.then(A.noop)]}})})},t.prototype._onLibStatusChanged=function(e){this._logger.info("_onLibStatusChanged from "+this._libStatus+" => "+e.libStatus),e.libStatus===P.LibStatus.Running&&this._startSlimcorePromiseDefered.resolve(this._slimcoreInstance),this._libStatus=e.libStatus},t.prototype.getCallRegistry=function(){return this._logger.info("returning default callRegistry"),this.callRegistries[0]?this.callRegistries[0]:this._createCallRegistry()},t.prototype.createCallRegistry=function(e,t){var n=this;void 0===t&&(t=b.generateCauseId());var r=e?p.mriOrId(e.id):void 0,i=this._logger.createFnLogger("createCallRegistry[identity="+r+"]",t),o=this.callRegistries.find(function(t){return t.identity===e.id});if(o&&!o.isDisposing)return i.info("callRegistry already exists for "+p.mriOrId(e.id)),Promise.resolve(o);var a=o&&o.isDisposing?o.disposePromise:Promise.resolve().then(A.noop);return this._startSlimcorePromiseDefered.promise.then(function(){return s(n,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return[4,a];case 1:return t.sent(),o=this._createCallRegistry(e),[2,o]}})})})},t.prototype._createCallRegistry=function(e){var t=this,n=new y.default(this._logger,this._settings,this._slimcoreInstance,this._deviceManager,this._appHooks,this._telemetryLoggers,e);return n.on("disposed",function(){t.callRegistries.splice(t.callRegistries.indexOf(n),1)}),n.loginPromise.then(this._stackLoginPromise.resolve,this._stackLoginPromise.reject),this.callRegistries.push(n),n.on("callAdded",function(e){return t._handleCallState(e)}),n},t.prototype.createDeviceManager=function(e){return this._deviceManager},t.prototype.getDeviceManager=function(){return this._logger.info("retrieving device manager"),this._deviceManager},t.prototype.getScreenSharingManager=function(){return this._screenSharingManager},t.prototype.getSetup=function(){return this._setup},t.prototype.getEcsProvider=function(){return null},t.prototype.getCallFeedback=function(){return this._callFeedback},t.prototype.getAiMdp=function(){return this._aiMdp},t.prototype.fireIntent=function(e,t){},t.prototype.getVersion=function(){return{build:h.getTsCallingVersion(),ovb:h.getOvb()}},t.prototype.getMediaStatus=function(){return null},t.prototype.setMediaConfig=function(e){var t=this;return new Promise(function(n){t._logger.info("Set Media Configuration, using new default method"),t._slimcoreInstance.setMediaConfig(e),n()})},t.prototype.getLiveStreamClient=function(){var e=this;return new d.LiveStreamClient(this.getEcsProvider(),this._logger.createChild("LiveStreamClient"),function(){return e._telemetryLoggers.media})},t.prototype._slimcoreMediaStatusToCallingMediaStatus=function(e){switch(e){case P.MediaStatus.Initialized:return 1;case P.MediaStatus.NotAvailable:return 0;case P.MediaStatus.Failed:return 2;case P.MediaStatus.Uninitialized:return 3;default:return}},t.prototype._onMediaStatusChanged=function(e){var t=this._slimcoreMediaStatusToCallingMediaStatus(e.mediaStatus);this.event("mediaStatusChanged").raise(t),1===t?this._mediaStartDeferredPromise.resolve(this._slimcoreInstance):2===t&&this._mediaStartDeferredPromise.reject(new Error("Media initialization FatalError"))},t.prototype._getCurrentUserId=function(){return 0!==this.callRegistries.length&&null!==this.callRegistries[0].identity?this.callRegistries[0].identity:void 0},t.prototype._onIncomingTelemetryEvent=function(e){this._telemetryFilter.dispatch(e,this._getCurrentUserId())},t.prototype._handleCallState=function(e){var t=this;e.on("callStateChanged",function(){2===e.state&&t._telemetryManager.pauseLogger(),7===e.state&&t._telemetryManager.resumeLogger()})},t.prototype.createVoipCallCoordinator=function(){},t}(m.default);t.SlimCoreUwpStack=j,t.slimCoreElectronStackFactory={build:function(e){return Promise.resolve().then(function(){return e.settings.enableTsCallingULLogging&&g.patchLogger(e),new M(e)}).catch(function(e){throw e instanceof D?e:new D(""+e)})},getVersion:function(){return{build:h.getTsCallingVersion(),ovb:h.getOvb()}}},t.slimCoreUwpStackFactory={build:function(e){return Promise.resolve().then(function(){return new j(e)}).catch(function(e){throw e instanceof D?e:new D(""+e)})},getVersion:function(){return{build:h.getTsCallingVersion(),ovb:h.getOvb()}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=t.isStreamValid=void 0,t.isStreamValid=function(e){return e&&!!e.url&&!!e.decryptionToken},t.assert=function(e,t){if(!e)throw new Error("Assert failed"+(void 0!==t?": "+t:""))}},function(e,t,n){"use strict";function r(){return(new Date).getTime()}var i=n(23),o=n(16),a=n(2),s=6e5,c=0,l=[],u=[],d=[],p=function(){function e(t,n){function p(e){var t=Object(o.a)();t&&t.QUnit&&console&&console.log("ESPromiseScheduler["+f+"] "+e)}function h(e){n&&n.warnToConsole("ESPromiseScheduler["+f+"] "+e)}var g=0,f=(t||"<unnamed>")+"."+c;c++,Object(a.a)(e,this,function(e){function t(e,t){for(var n=0;n<e.length;n++)if(e[n].id===t)return e.splice(n,1)[0];return null}var n=null,o=0;e.scheduleEvent=function(e,a,c){function _(e){for(var t=r(),n=t-s,i=e.length,o=0;o<i;){var a=e[o];if(a&&a.tm<n){var c=null;a.abort?(c="Aborting ["+a.id+"] due to Excessive runtime ("+(t-a.tm)+" ms)",a.abort(c)):c="Removing ["+a.id+"] due to Excessive runtime ("+(t-a.tm)+" ms)",h(c),e.splice(o,1),i--}else o++}}function m(e,i){var o=!1,a=t(l,e);if(a||(a=t(d,e),o=!0),a){a.to&&(clearTimeout(a.to),a.to=null);var s=r()-a.tm;i?o?h("Timed out event ["+e+"] finally complete -- "+s+" ms"):p("Promise ["+e+"] Complete -- "+s+" ms"):(d.push(a),h("Event ["+e+"] Timed out and removed -- "+s+" ms"))}else p("Failed to remove ["+e+"] from running queue");n&&n.id===e&&(n=null),_(l),_(u),_(d)}function v(e,t){return function(n){return m(e,!0),t&&t(n),n}}function y(e,t,n,r){t.then(function(t){return t instanceof i.a?(p("Event ["+e+"] returned a promise -- waiting"),y(e,t,n,r),t):v(e,n)(t)},v(e,r))}function C(e,t){var n=e.id;return new i.a(function(o,a){p("Event ["+n+"] Starting -- waited for "+(e.wTm||"--")+" ms"),e.isRunning=!0,e.abort=function(t){e.abort=null,e.isAborted=!0,m(n,!1),a(new Error(t))};var s=t(n);s instanceof i.a?(c&&(e.to=setTimeout(function(){m(n,!1),a(new Error("Timed out after ["+c+"] ms"))},c)),y(n,s,function(t){p("Event ["+n+"] Resolving after "+(r()-e.tm)+" ms"),o(t)},a)):(p("Promise ["+n+"] Auto completed as the start action did not return a promise"),o())})}function S(t){var n=r();return t.wTm=n-t.tm,t.tm=n,t.isAborted?i.a.reject(new Error("["+I+"] was aborted")):(l.push(t),C(t,e))}var I=f+"."+o;o++,a&&(I+="-("+a+")");var O=I+"{"+g+"}";g++;var T={evt:null,tm:r(),id:O,isRunning:!1,isAborted:!1};return T.evt=n?function(e,n){var o=new i.a(function(i,o){var a=r()-n.tm,s=n.id;p("["+I+"] is waiting for ["+s+":"+a+" ms] to complete before starting -- ["+u.length+"] waiting and ["+l.length+"] running"),e.abort=function(n){e.abort=null,t(u,I),e.isAborted=!0,o(new Error(n))},n.evt.then(function(n){t(u,I),S(e).then(i,o)},function(n){t(u,I),S(e).then(i,o)})});return u.push(e),o}(T,n):S(T),n=T,n.evt._schId=O,T.evt}})}return e.incomplete=function(){return l},e.waitingToStart=function(){return u},e}();t.a=p},function(e,t,n){"use strict";var r=n(74),i=n(28),o=n(0),a=n(15),s=n(73),c=n(71),l=n(70),u=n(31),d=n(2),p=function(e){function t(){var n=e.call(this)||this;return Object(d.a)(t,n,function(e,t){function n(e){if(Object(o.r)(e.name))throw r(e),Error("telemetry name required")}function r(t){var n=e.getNotifyMgr();n&&n.eventsDiscarded([t],c.a.InvalidEvent)}e.initialize=function(e,n,r,i){t.initialize(e,n,r||new u.a(e),i||new l.a(e))},e.track=function(a){Object(i.c)(e.getPerfMgr(),function(){return"AppInsightsCore:track"},function(){null===a&&(r(a),Object(o.J)("Invalid telemetry item")),n(a),t.track(a)},function(){return{item:a}},!a.sync)},e.addNotificationListener=function(t){var n=e.getNotifyMgr();n&&n.addNotificationListener(t)},e.removeNotificationListener=function(t){var n=e.getNotifyMgr();n&&n.removeNotificationListener(t)},e.pollInternalLogs=function(t){var n=e.config.diagnosticLogInterval;return n&&n>0||(n=1e4),setInterval(function(){var n=e.logger?e.logger.queue:[];Object(o.a)(n,function(n){var r={name:t||"InternalMessageId: "+n.messageId,iKey:e.config.instrumentationKey,time:Object(o.K)(new Date),baseType:u.b.dataType,baseData:{message:n.message}};e.track(r)}),n.length=0},n)}}),n}return Object(r.b)(t,e),t}(s.a),h=n(6),g=n(3),f="version",_="properties",m=function(e){function t(){var n=e.call(this)||this;return n.pluginVersionStringArr=[],n.pluginVersionString="",Object(d.a)(t,n,function(e,t){e.initialize=function(n,r,s,c){Object(i.c)(e,function(){return"AppInsightsCore.initialize"},function(){if(n){n.endpointUrl||(n.endpointUrl="https://browser.events.data.microsoft.com/OneCollector/1.0/");var i=n.propertyStorageOverride;if(i&&(!i.getProperty||!i.setProperty))throw new Error("Invalid property storage override passed.");n.channels&&Object(o.a)(n.channels,function(t){t&&Object(o.a)(t,function(t){if(t.identifier&&t.version){var n=t.identifier+"="+t.version;e.pluginVersionStringArr.push(n)}})})}e.getWParam=function(){return"undefined"!=typeof document?0:-1},r&&Object(o.a)(r,function(t){if(t&&t.identifier&&t.version){var n=t.identifier+"="+t.version;e.pluginVersionStringArr.push(n)}}),e.pluginVersionString=e.pluginVersionStringArr.join(";");try{t.initialize(n,r,s,c)}catch(t){e.logger.throwInternal(a.a.CRITICAL,h.f.ErrorProvidedChannels,"Channels must be provided through config.channels only")}e.pollInternalLogs("InternalLog")},function(){return{config:n,extensions:r,logger:s,notificationManager:c}})},e.track=function(n){Object(i.c)(e,function(){return"AppInsightsCore.track"},function(){var r=n;if(r){r.timings=r.timings||{},r.timings.trackStart=Object(g.o)(),Object(g.t)(r.latency)||(r.latency=h.a.Normal);var i=r.ext=r.ext||{};i.sdk=i.sdk||{},i.sdk.ver=g.b;var o=r.baseData=r.baseData||{};o[_]||(o[_]={});var a=o[_];a[f]||(a[f]=""),""!==e.pluginVersionString&&(a[f]=e.pluginVersionString)}t.track(r)},function(){return{item:n}},!n.sync)}}),n}return Object(r.b)(t,e),t}(p);t.a=m},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(2),i=n(0),o=function(){function e(t){this.listeners=[];var n=!!(t||{}).perfEvtsSendAll;Object(r.a)(e,this,function(e){e.addNotificationListener=function(t){e.listeners.push(t)},e.removeNotificationListener=function(t){for(var n=Object(i.b)(e.listeners,t);n>-1;)e.listeners.splice(n,1),n=Object(i.b)(e.listeners,t)},e.eventsSent=function(t){Object(i.a)(e.listeners,function(e){e&&e.eventsSent&&setTimeout(function(){return e.eventsSent(t)},0)})},e.eventsDiscarded=function(t,n){Object(i.a)(e.listeners,function(e){e&&e.eventsDiscarded&&setTimeout(function(){return e.eventsDiscarded(t,n)},0)})},e.eventsSendRequest=function(t,n){Object(i.a)(e.listeners,function(e){if(e&&e.eventsSendRequest)if(n)setTimeout(function(){return e.eventsSendRequest(t,n)},0);else try{e.eventsSendRequest(t,n)}catch(e){}})},e.perfEvent=function(t){t&&(!n&&t.isChildEvt()||Object(i.a)(e.listeners,function(e){if(e&&e.perfEvent)if(t.isAsync)setTimeout(function(){return e.perfEvent(t)},0);else try{e.perfEvent(t)}catch(e){}}))}})}return e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r={Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(21),i=n(0),o=n(32),a="getPlugin",s=function(){function e(){var e=this,t=!1,n=null,s=null;e.core=null,e.diagLog=function(t){return e._getTelCtx(t).diagLog()},e.isInitialized=function(){return t},e.setInitialized=function(e){t=e},e.setNextPlugin=function(e){s=e},e.processNext=function(e,t){t?t.processNext(e):s&&Object(i.o)(s.processTelemetry)&&s.processTelemetry(e,null)},e._getTelCtx=function(t){void 0===t&&(t=null);var i=t;if(!i){var o=n||new r.a(null,{},e.core);i=s&&s[a]?o.createNew(null,s[a]):o.createNew(null,s)}return i},e._baseTelInit=function(c,l,u,d){c&&Object(i.E)(c,o.a,[],null,i.r),!d&&l&&(d=l.getProcessTelContext().getNext());var p=s;s&&s[a]&&(p=s[a]()),e.core=l,n=new r.a(d,c,l,p),t=!0}}return e.prototype.initialize=function(e,t,n,r){this._baseTelInit(e,t,n,r)},e}()},function(e,t,n){"use strict";function r(e,t){for(var n=[],r=null,i=e.getNext();i;){var o=i.getPlugin();o&&(r&&Object(u.o)(r[h])&&Object(u.o)(o[d])&&r[h](o),Object(u.o)(o[g])&&o[g]()||n.push(o),r=o,i=i.getNext())}Object(u.a)(n,function(n){n.initialize(e.getCfg(),e.core(),t,e.getNext())})}function i(e){return e.sort(function(e,t){var n=0,r=Object(u.o)(t[d]);return Object(u.o)(e[d])?n=r?e[p]-t[p]:1:r&&(n=-1),n})}n.d(t,"a",function(){return O});var o=n(16),a=n(2),s=n(74),c=n(72),l=n(21),u=n(0),d="processTelemetry",p="priority",h="setNextPlugin",g="isInitialized",f=500,_="Channel has invalid priority",m=function(e){function t(){function n(e){Object(u.a)(e,function(e){e.priority<f&&Object(u.J)(_+e.identifier)})}function i(e){e&&e.length>0&&(n(e=e.sort(function(e,t){return e.priority-t.priority})),c.push(e))}function o(e,t){if(c=[],e&&Object(u.a)(e,function(e){return i(e)}),t){var n=[];Object(u.a)(t,function(e){e.priority>f&&n.push(e)}),i(n)}}var s=e.call(this)||this;s.identifier="ChannelControllerPlugin",s.priority=f;var c;return Object(a.a)(t,s,function(e,t){e.setNextPlugin=function(e){},e.processTelemetry=function(e,t){c&&Object(u.a)(c,function(n){n.length>0&&s._getTelCtx(t).createNew(n).processNext(e)})},e.getChannelControls=function(){return c},e.initialize=function(n,i,a){e.isInitialized()||(t.initialize(n,i,a),o((n||{}).channels,a),Object(u.a)(c,function(e){return r(new l.a(e,n,i),a)}))}}),s}return Object(s.b)(t,e),t._staticInit=function(){var e=t.prototype;Object(u.z)(e,"ChannelControls",e.getChannelControls),Object(u.z)(e,"channelQueue",e.getChannelControls)}(),t}(c.a),v=n(28),y=n(14),C=n(32),S="Extensions must provide callback to initialize",I="_notificationManager",O=function(){function e(){var t,n,s,c,d,p=!1;Object(a.a)(e,this,function(e){e._extensions=new Array,n=new m,e.logger=Object(o.b)({throwInternal:function(e,t,n,r,i){void 0===i&&(i=!1)},warnToConsole:function(e){},resetInternalMessageCount:function(){}}),t=[],e.isInitialized=function(){return p},e.initialize=function(t,o,a,c){e.isInitialized()&&Object(u.J)("Core should not be initialized more than once"),t&&!Object(u.r)(t.instrumentationKey)||Object(u.J)("Please provide instrumentation key"),s=c,e[I]=c,e.config=t||{},t.extensions=Object(u.r)(t.extensions)?[]:t.extensions,Object(u.i)(t,C.a).NotificationManager=c,a&&(e.logger=a);var d=[];d.push.apply(d,o.concat(t.extensions)),d=i(d);var h=[],g=[],f={};Object(u.a)(d,function(e){(Object(u.r)(e)||Object(u.r)(e.initialize))&&Object(u.J)(S);var t=e.priority,r=e.identifier;e&&t&&(Object(u.r)(f[t])?f[t]=r:a.warnToConsole("Two extensions have same priority #"+t+" - "+f[t]+", "+r)),!t||t<n.priority?h.push(e):g.push(e)}),d.push(n),h.push(n),d=i(d),e._extensions=d,r(new l.a([n],t,e),d),r(new l.a(h,t,e),d),e._extensions=h,0===e.getTransmissionControls().length&&Object(u.J)("No channels available"),p=!0,e.releaseQueue()},e.getTransmissionControls=function(){return n.getChannelControls()},e.track=function(n){Object(u.E)(n,C.b,e.config.instrumentationKey,null,u.q),Object(u.E)(n,"time",Object(u.K)(new Date),null,u.q),Object(u.E)(n,"ver","4.0",null,u.r),e.isInitialized()?e.getProcessTelContext().processNext(n):t.push(n)},e.getProcessTelContext=function(){var t=e._extensions,r=t;return t&&0!==t.length||(r=[n]),new l.a(r,e.config,e)},e.getNotifyMgr=function(){return s||(s=Object(o.b)({addNotificationListener:function(e){},removeNotificationListener:function(e){},eventsSent:function(e){},eventsDiscarded:function(e,t){},eventsSendRequest:function(e,t){}}),e[I]=s),s},e.getCookieMgr=function(){return d||(d=Object(y.c)(e.config,e.logger)),d},e.setCookieMgr=function(e){d=e},e.getPerfMgr=function(){return c||e.config&&e.config.enablePerfMgr&&(c=new v.b(e.getNotifyMgr())),c},e.setPerfMgr=function(e){c=e},e.eventCnt=function(){return t.length},e.releaseQueue=function(){t.length>0&&(Object(u.a)(t,function(t){e.getProcessTelContext().processNext(t)}),t=[])}})}return e}()},function(e,t,n){"use strict";function r(e,t){function n(){this.constructor=e}typeof t!==i.h&&null!==t&&Object(o.c)("Class extends value "+String(t)+" is not a constructor or null"),s(e,t),e[i.k]=null===t?Object(o.b)(t):(n[i.k]=t[i.k],new n)}n.d(t,"a",function(){return a}),n.d(t,"b",function(){return r});var i=n(1),o=n(16),a=(Object(o.a)(),Object(o.a)(),i.a||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)i.f[i.i].call(t,o)&&(e[o]=t[o])}return e}),s=function(e,t){return(s=i.b.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t[i.i](n)&&(e[n]=t[n])})(e,t)}},,function(e,t,n){n(10),n(11),n(37),n(55),n(62),n(63),n(46),n(58),n(60),n(64),n(36),n(42),n(56),n(65),n(47),n(66),e.exports=n(111)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.build=t.Stopwatch=void 0;var r=function(){function e(){var e=this;this.msElapsed=0,this.isPaused=!1,this._startTime=(new Date).getTime(),this.pause=function(){e.isPaused||(e.msElapsed+=(new Date).getTime()-e._startTime,e.isPaused=!0)},this.resume=function(){e.isPaused&&(e.isPaused=!1,e._startTime=(new Date).getTime())},this.duration=function(){return e.isPaused?e.msElapsed:e.msElapsed+(new Date).getTime()-e._startTime},this.durationInMinutes=function(){var t=e.duration()/6e4;return Math.ceil(t)},this.durationInSeconds=function(){var t=e.duration()/1e3;return Math.ceil(t)}}return Object.defineProperty(e.prototype,"startTime",{get:function(){return this._startTime},enumerable:!1,configurable:!0}),e}();t.Stopwatch=r,t.build=function(){return new r}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.validStateTransitions=t.callStateIsAnyOf=void 0,t.callStateIsAnyOf=function(e,t){return-1!==t.indexOf(e)},t.validStateTransitions=(r={},r[0]=[1,2,8,6,10,11,9],r[1]=[2,6,7,10,13],r[2]=[1,3,6,7,9,10,13],r[3]=[6,7,4,5,10,13],r[8]=[1,11,10,2,9,6,7],r[4]=[6,7,3,5,10,13],r[5]=[6,7,3,4,10,13],r[9]=[3,6,7,10,13],r[10]=[3,6,7,9,4,5,13],r[13]=[3,6,7,4,5],r[11]=[12,1,2,6,7],r[12]=[2,6,7],r[6]=[7],r[7]=[],r)},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(12),c=n(22),l=n(80),u=n(11),d=SlimCore.Enums,p=n(9),h=n(34),g=n(35),f=function(e){function t(t,n,r,i,o,a,s){var u=e.call(this,t.createChild(function(){return"ContentSharing["+u.slimCoreContentSharingObjectId+"]"}),n,r)||this;return u._slimcoreCallHandler=i,u.slimCoreContentSharingObjectId=o,u._nativeContentSharing=a,u.callTelemetry=s,u.noFailureReason=SlimCore.Enums.ContentSharingFailureReason.NoFailure,u._getCallEndOperation=function(){return u._callOperationHandler.hasPendingOperation(c.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING)?u._callOperationHandler.waitForOperation(c.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING):Promise.resolve()},u._logger.info("constructor"),u._session=new l.ContentSharingSession(u,u._logger),u._callOperationHandler=new g.default(u._logger,u.callTelemetry),u._onContentSharingPropertyChanged(SlimCore.Enums.Property.ContentSharingStatus,function(e){return u._onContentSharingStatusChanged(e.value)}),u._onContentSharingPropertyChanged(SlimCore.Enums.Property.ContentSharingState,function(e){return u._onContentSharingStateChanged(e.value)}),u._onContentSharingPropertyChanged(SlimCore.Enums.Property.ContentSharingFailureReason,function(e){return u._onContentSharingResultCodeChanged(e.value)}),u.contentSharingStatus=u.convertContentSharingStatus(u.getIntProperty(SlimCore.Enums.Property.ContentSharingStatus)),u.contentSharingGuid=u.getStrProperty(SlimCore.Enums.Property.ContentSharingId),u.contentSharingState=u.getStrProperty(SlimCore.Enums.Property.ContentSharingState),u.contentSharingIdentity=u.getStrProperty(SlimCore.Enums.Property.ContentSharingIdentity),u._logger.info("Session created with status "+u.contentSharingStatus+", guid "+u.contentSharingGuid),u._registerDisposable(u._nativeContentSharing.handle("update-session-state-result",void 0,function(e){return u._onSessionStateResult(e)})),u._registerDisposable(u._nativeContentSharing.handle("take-control-result",void 0,function(e){return u._onTakeControlResult(e)})),u._registerDisposable(u._nativeContentSharing.handle("update-participant-state-result",void 0,function(e){return u._onUpdateParticipantStateResult(e)})),u._registerDisposable(u._nativeContentSharing.handle("join-result",void 0,function(e){return u._onJoinResult(e)})),u}return r(t,e),t.prototype._onContentSharingPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.slimCoreContentSharingObjectId,e,t)},t.prototype.setContentSharingStatus=function(e){if(this._logger.info("setContentSharingStatus. currentStatus: "+this.contentSharingStatus+" newStatus: "+e),this.contentSharingStatus!==e&&7!==this.contentSharingStatus&&8!==this.contentSharingStatus){if(this._logger.info("Changing content sharing status to: "+e),this.contentSharingStatus=e,7===e||8===e){if(this.contentSharingTerminationReason&&0!==this.contentSharingTerminationReason.terminatedReason)return;var t=this.getIntProperty(d.Property.ContentSharingFailureReason),n=this.getIntProperty(d.Property.ContentSharingFailureCode),r=this.getIntProperty(d.Property.ContentSharingFailureSubCode),i=this.convertFailureReason(t);this._logger.info("setting failure reason for content sharing session. reason: "+i),this.contentSharingTerminationReason={terminatedReason:i,terminatedReasonCode:n,terminatedReasonSubCode:r,errorMessage:"Session is terminated"}}this._session.statusChanged(e),this.raiseChanged()}},t.prototype.getStrProperty=function(e,t){return this._getStrProperty(this._slimcoreCallHandler,this.slimCoreContentSharingObjectId,e,t)},t.prototype.getIntProperty=function(e,t){return this._getIntProperty(this._slimcoreCallHandler,this.slimCoreContentSharingObjectId,e,t)},t.prototype._onContentSharingStatusChanged=function(e){this._logger.info("_onContentSharingStateChanged called"),this.setContentSharingStatus(this.convertContentSharingStatus(e))},t.prototype._onContentSharingStateChanged=function(e){this._logger.info("_onContentSharingStateChanged called"),this.contentSharingState=e,this.raiseChanged()},t.prototype._onContentSharingResultCodeChanged=function(e){if(this._logger.info("_onContentSharingResultCodeChanged called"),!this.contentSharingTerminationReason||0===this.contentSharingTerminationReason.terminatedReason){var t=this.getIntProperty(d.Property.ContentSharingFailureCode),n=this.getIntProperty(d.Property.ContentSharingFailureSubCode),r=this.convertFailureReason(e);this._logger.info("setting failure reason for content sharing session. reason: "+r),this.contentSharingTerminationReason={terminatedReason:r,terminatedReasonCode:t,terminatedReasonSubCode:n,errorMessage:"Session is terminated"}}},t.prototype.convertContentSharingStatus=function(e){switch(e){case d.ContentSharingStatus.Routing:return 1;case d.ContentSharingStatus.Ringing:return 2;case d.ContentSharingStatus.Connected:return 4;case d.ContentSharingStatus.Presenting:return 3;case d.ContentSharingStatus.Viewing:return 5;case d.ContentSharingStatus.Finishing:return 6;case d.ContentSharingStatus.Done:case d.ContentSharingStatus.Failed:case d.ContentSharingStatus.TimedOut:return 7;default:return 0}},t.prototype.startContentSharing=function(e){return void 0===e&&(e=p.generateCauseId()),this._session.startContentSharing(e)},t.prototype.joinContentSharing=function(e){return void 0===e&&(e=p.generateCauseId()),this._session.joinContentSharing(e)},t.prototype.updateContentSharingParticipantStateToViewer=function(e){return void 0===e&&(e=p.generateCauseId()),this._session.updateContentSharingParticipantStateToViewer(e)},t.prototype.updateContentSharingSessionState=function(e,t,n){return void 0===n&&(n=p.generateCauseId()),this._session.updateContentSharingSessionState(e,t,n)},t.prototype.takeContentSharingControl=function(e){return void 0===e&&(e=p.generateCauseId()),this._session.takeContentSharingControl(e)},t.prototype.stopContentSharing=function(e){return void 0===e&&(e=p.generateCauseId()),this._session.stopContentSharing(e)},t.prototype._onJoinResult=function(e){this._session.onJoinResultEvent(e)},t.prototype._onUpdateParticipantStateResult=function(e){this._session.onUpdateParticipantStateResultEvent(e)},t.prototype._onSessionStateResult=function(e){this._session.onSessionStateResultEvent(e)},t.prototype._onTakeControlResult=function(e){this._session.onTakeControlResultEvent(e)},t.prototype.callStartContentSharing=function(){var e=this;return s.asap(function(){return e._nativeContentSharing.startContentSharing()})},t.prototype.callStopContentSharing=function(){var e=this;return s.asap(function(){return e._nativeContentSharing.stopContentSharing()})},t.prototype.callUpdateContentSharingSessionState=function(e,t){var n=this;return s.asap(function(){return n._nativeContentSharing.updateContentSharingSessionState(e,t)})},t.prototype.callTakeContentSharingControl=function(){var e=this;return s.asap(function(){return e._nativeContentSharing.takeContentSharingControl()})},t.prototype.callUpdateContentSharingParticipantState=function(){var e=this;return s.asap(function(){return e._nativeContentSharing.updateContentSharingParticipantState()})},t.prototype.convertFailureReason=function(e){switch(e){case d.ContentSharingFailureReason.NoFailure:return 1;case d.ContentSharingFailureReason.SessionNotFound:return 34;case d.ContentSharingFailureReason.SessionTimedOut:return 35;case d.ContentSharingFailureReason.NetworkError:return 3;case d.ContentSharingFailureReason.NetworkCannotConnectError:return 52;case d.ContentSharingFailureReason.ServiceFailure:return 48;case d.ContentSharingFailureReason.RequestTimedOut:return 45;case d.ContentSharingFailureReason.AuthFailure:return 29;case d.ContentSharingFailureReason.ActionNotAllowed:return 60;case d.ContentSharingFailureReason.Forbidden:return 8;case d.ContentSharingFailureReason.Failure:default:return 32}},t.prototype.dispose=function(t){var n=this;void 0===t&&(t=p.generateCauseId()),this._logger.info("dispose causeId: "+t);var r=this.contentSharingTerminationReason?this.contentSharingTerminationReason:{terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Call ended"};this.slimCoreContentSharingObjectId=0,this._getCallEndOperation().then(function(){n._callOperationHandler.rejectPendingOperations(r,t),e.prototype.dispose.call(n,t)})},i([h.callOperation(c.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING),a(0,h.causeId),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],t.prototype,"startContentSharing",null),i([h.callOperation(c.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING),a(0,h.causeId),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],t.prototype,"joinContentSharing",null),i([h.callOperation(c.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE),a(0,h.causeId),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],t.prototype,"updateContentSharingParticipantStateToViewer",null),i([h.callOperation(c.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE),a(0,h.operationId),a(2,h.causeId),o("design:type",Function),o("design:paramtypes",[String,String,Object]),o("design:returntype",Promise)],t.prototype,"updateContentSharingSessionState",null),i([h.callOperation(c.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL),a(0,h.causeId),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],t.prototype,"takeContentSharingControl",null),i([h.callOperation(c.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,{waitFor:c.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING}),a(0,h.causeId),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],t.prototype,"stopContentSharing",null),t}(u.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContentSharingSession=void 0;var r=n(7),i=n(12),o=n(45),a={CANCELED_TERMINATION_REASON:{terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Content sharing is disconnected"},ACTION_NOT_ALLOWED:function(e){return{terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:e}}},s=function(){function e(e,t){var n=this;this._platformImpl=e,this._pendingDeferreds=[],this._updateContentSharingSessionStateDeferredPromises={},this.onJoinResultEvent=function(e){if(n._joinContenSharingDeferredPromise)if(n._logger.info("JoinContentSharing completed for: "+n._platformImpl.contentSharingGuid+", status: "+JSON.stringify(e)),e.failureReason===n._platformImpl.noFailureReason)n._invokeDeferred(n._joinContenSharingDeferredPromise);else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Join failed with reason "+i;n._logger.error(o),n._rejectDeferred(n._joinContenSharingDeferredPromise,{terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}else n._logger.warn("No pending promise for join. Event data: "+e)},this.onUpdateParticipantStateResultEvent=function(e){if(n._updateParticipantStateDeferredPromise)if(n._logger.info("UpdateContentSharingParticipantStateToViewer completed for: "+n._platformImpl.contentSharingGuid+", status: "+JSON.stringify(e)),e.failureReason===n._platformImpl.noFailureReason)n._invokeDeferred(n._updateParticipantStateDeferredPromise);else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Update participant state failed with reason "+i;n._logger.error(o),n._rejectDeferred(n._updateParticipantStateDeferredPromise,{terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}else n._logger.warn("No pending promise for update participant state. Event data: "+e)},this.onSessionStateResultEvent=function(e){if(n._logger.info("UpdateContentSharingSessionState completed for: "+n._platformImpl.contentSharingGuid+", status: "+JSON.stringify(e)),n._updateContentSharingSessionStateDeferredPromises.hasOwnProperty(e.id))if(e.failureReason===n._platformImpl.noFailureReason)n._updateContentSharingSessionStateDeferredPromises[e.id].resolve();else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Update SessionState failed with reason "+i;n._logger.error(o),n._updateContentSharingSessionStateDeferredPromises[e.id].reject({terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}},this.onTakeControlResultEvent=function(e){if(n._takeControlDeferredPromise)if(n._logger.info("TakeContentSharingControl completed for: "+n._platformImpl.contentSharingGuid+", "+JSON.stringify(e)),e.failureReason===n._platformImpl.noFailureReason)n._invokeDeferred(n._takeControlDeferredPromise);else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Take content sharing control failed with reason "+i;n._logger.error(o),n._rejectDeferred(n._takeControlDeferredPromise,{terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}else n._logger.warn("No pending promise for take control. Event data: "+e)},this._logger=new o.default(t)}return e.prototype.statusChanged=function(e){if(7===e||8===e){if(this._stopContentSharingDeferredPromise&&this._invokeDeferred(this._stopContentSharingDeferredPromise),this._startContentSharingDeferredPromise){n=this._platformImpl.contentSharingTerminationReason&&0!==this._platformImpl.contentSharingTerminationReason.terminatedReason?this._platformImpl.contentSharingTerminationReason:a.CANCELED_TERMINATION_REASON;this._rejectDeferred(this._startContentSharingDeferredPromise,n)}this._logger.info("Content sharing is disconnected"),this._rejectPendingPromises(a.CANCELED_TERMINATION_REASON)}else if(2===e||5===e||4===e){if(this._stopContentSharingDeferredPromise){var t="Content sharing cannot be ended when not presenting",n=a.ACTION_NOT_ALLOWED(t);this._logger.error(t),this._rejectDeferred(this._stopContentSharingDeferredPromise,n)}}else 3===e&&(this._startContentSharingDeferredPromise&&this._invokeDeferred(this._startContentSharingDeferredPromise),this._takeControlDeferredPromise&&this._invokeDeferred(this._takeControlDeferredPromise))},e.prototype.startContentSharing=function(e){var t=this,n=this._logger.createFnLogger("startContentSharing",e);if(this._startContentSharingDeferredPromise)return this._startContentSharingDeferredPromise.promise;if(0!==this._platformImpl.contentSharingStatus){var r="Content sharing cannot be started as it is not in the initial state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Start content sharing for : "+this._platformImpl.contentSharingGuid),this._startContentSharingDeferredPromise=i.defer();var s=function(){t._startContentSharingDeferredPromise=null};return this._startContentSharingDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then(function(){return t._platformImpl.callStartContentSharing()}).then(function(){return t._pendingDeferreds.push(t._startContentSharingDeferredPromise)}).then(function(){return t._startContentSharingDeferredPromise.promise}).catch(function(e){t.handleContentSharingOperationError(e,"startContentSharing",n)})},e.prototype.joinContentSharing=function(e){var t=this,n=this._logger.createFnLogger("joinContentSharing",e);if(this._joinContenSharingDeferredPromise)return this._joinContenSharingDeferredPromise.promise;if(2!==this._platformImpl.contentSharingStatus){var r="Content sharing cannot be joined as it is not in ringing state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Join content sharing for : "+this._platformImpl.contentSharingGuid),this._joinContenSharingDeferredPromise=i.defer();var s=function(){t._joinContenSharingDeferredPromise=null};return this._joinContenSharingDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then(function(){return t._platformImpl.callStartContentSharing()}).then(function(){return t._pendingDeferreds.push(t._joinContenSharingDeferredPromise)}).then(function(){return t._joinContenSharingDeferredPromise.promise}).catch(function(e){t.handleContentSharingOperationError(e,"joinContentSharing",n)})},e.prototype.updateContentSharingParticipantStateToViewer=function(e){var t=this,n=this._logger.createFnLogger("updateContentSharingParticipantStateToViewer",e);if(this._updateParticipantStateDeferredPromise)return this._updateParticipantStateDeferredPromise.promise;if(4!==this._platformImpl.contentSharingStatus){var r="Cannot update participant state as content sharing is not in connected state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Update content sharing participant state for : "+this._platformImpl.contentSharingGuid),this._updateParticipantStateDeferredPromise=i.defer();var s=function(){t._updateParticipantStateDeferredPromise=null};return this._updateParticipantStateDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then(function(){return t._platformImpl.callUpdateContentSharingParticipantState()}).then(function(){return t._pendingDeferreds.push(t._updateParticipantStateDeferredPromise)}).then(function(){return t._updateParticipantStateDeferredPromise.promise}).catch(function(e){t.handleContentSharingOperationError(e,"joinContentSharing",n)})},e.prototype.updateContentSharingSessionState=function(e,t,n){var r=this,o=this._logger.createFnLogger("updateContentSharingSessionState",n);if(this._updateContentSharingSessionStateDeferredPromises[e])return this._updateContentSharingSessionStateDeferredPromises[e].promise;if(3!==this._platformImpl.contentSharingStatus){var s="Cannot update session state as content sharing is not in presenting state",c=a.ACTION_NOT_ALLOWED(s);return o.logFailure(s),Promise.reject(c)}var l=i.defer();this._updateContentSharingSessionStateDeferredPromises[e]=l;var u=function(){delete r._updateContentSharingSessionStateDeferredPromises[e]};return this._updateContentSharingSessionStateDeferredPromises[e].promise.then(u,u),o.info("Update content sharing session state for : "+this._platformImpl.contentSharingGuid),Promise.resolve(void 0).then(function(){return r._platformImpl.callUpdateContentSharingSessionState(e,t)}).then(function(){return r._updateContentSharingSessionStateDeferredPromises[e].promise}).catch(function(e){r.handleContentSharingOperationError(e,"updateContentSharingSessionState",o)})},e.prototype.takeContentSharingControl=function(e){var t=this,n=this._logger.createFnLogger("takeContentSharingControl",e);if(this._takeControlDeferredPromise)return this._takeControlDeferredPromise.promise;if(5!==this._platformImpl.contentSharingStatus){var r="Cannot take control of content sharing as it is not in viewing state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Taking control of content sharing for : "+this._platformImpl.contentSharingGuid),this._takeControlDeferredPromise=i.defer();var s=function(){t._takeControlDeferredPromise=null};return this._takeControlDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then(function(){return t._platformImpl.callTakeContentSharingControl()}).then(function(){return t._pendingDeferreds.push(t._takeControlDeferredPromise)}).then(function(){return t._takeControlDeferredPromise.promise}).catch(function(e){t.handleContentSharingOperationError(e,"takeContentSharingControl",n)})},e.prototype.stopContentSharing=function(e){var t=this,n=this._logger.createFnLogger("stopContentSharing",e);if(this._stopContentSharingDeferredPromise)return this._stopContentSharingDeferredPromise.promise;if(2===this._platformImpl.contentSharingStatus||4===this._platformImpl.contentSharingStatus||5===this._platformImpl.contentSharingStatus){var r="Incoming content sharing cannot be stopped",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}this._stopContentSharingDeferredPromise=i.defer();var s=function(){t._stopContentSharingDeferredPromise=null};return this._stopContentSharingDeferredPromise.promise.then(s,s),n.info("Stop content sharing for : "+this._platformImpl.contentSharingGuid),Promise.resolve(void 0).then(function(){return t._platformImpl.callStopContentSharing()}).then(function(){return t._pendingDeferreds.push(t._stopContentSharingDeferredPromise)}).then(function(){return t._stopContentSharingDeferredPromise.promise}).catch(function(e){t.handleContentSharingOperationError(e,"stopContentSharing",n)})},e.prototype.handleContentSharingOperationError=function(e,t,n){var r=e instanceof Error?e.toString():JSON.stringify(e);throw n.logFailure("Error in "+t+"(), contentSharingGuid = "+this._platformImpl.contentSharingGuid+", error = "+r),e&&e.hasOwnProperty("terminatedReason")?e:a.ACTION_NOT_ALLOWED(r)},e.prototype._rejectPendingPromises=function(e){this._logger.info("rejectPendingPromises"),this._pendingDeferreds.forEach(function(t){t.reject(e)}),this._pendingDeferreds=[],r.forEach(this._updateContentSharingSessionStateDeferredPromises,function(t){t.reject(e)}),this._updateContentSharingSessionStateDeferredPromises={}},e.prototype._invokeDeferred=function(e){this._logger.info("_invokeDeferred"),e&&(r.pull(this._pendingDeferreds,e),e.resolve())},e.prototype._rejectDeferred=function(e,t){this._logger.info("_rejectDeferred"),e&&(r.pull(this._pendingDeferreds,e),e.reject(t))},e}();t.ContentSharingSession=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(30),i=n(10),o=function(){function e(e,t,n,r){this.dataId=e,this.handler=t,this.sourceSinkInternallyCreated=n,this.direction=r,this.isAttached=!1}return e.prototype.isSourceEnabled=function(){return 0===this.direction||1===this.direction},e.prototype.isSinkEnabled=function(){return 0===this.direction||2===this.direction},e}(),a=function(){function e(e,t){this.logger=e,this._slimcoreInstance=t,this._dataChannel=null,this._dataChannelStatus=SlimCore.Enums.DataChannelStatus.Unknown,this._handlers={},this._availableHandlers=0,this._dataChannelStartCalled=!1,this.setInternalSourceSink=this.setInternalSourceSink.bind(this),this._handlerPromises=new r.default(this.logger)}return e.prototype.addHandler=function(e,t,n,r,i){var a=this;return void 0===n&&(n=!1),void 0===i&&(i=0),this._handlerPromises.chainPromise(function(){if(e<0||e>=64)return Promise.reject(new Error("Data Id "+e+" is outside the valid range of 0-63"));if(a._handlers.hasOwnProperty(e)&&a._handlers[e].handler)return Promise.reject(new Error("Data Id "+e+" is already registered to a non-null handler"));a.logger.info("Adding handler to dataId: "+e+", "+(n?"skipping source sink creation":"making source sink"));var s=null,c=!1;e in a._handlers?((s=a._handlers[e]).handler=t,c=!0):(s=new o(e,t,n,i),a._handlers[e]=s,n||(c=!0));var l=Promise.resolve();return c&&(a._availableHandlers++,a._isDataChannelAvailable&&(a._negotiationTag=r,l.then(function(){return a.start()})),a._isDataChannelActive&&l.then(function(){return a._attachHandler(s)})),l},"addHandler")},e.prototype.removeHandler=function(e){var t=this;return this._handlerPromises.chainPromise(function(){var n=t._handlers[e];return n?t._detachHandler(n).then(function(){delete t._handlers[e],t._availableHandlers--}):Promise.reject(new Error("Handler associated with Data Id "+e+" wasn't attached in the first place"))},"removeHandler")},e.prototype.updateNegotiationTag=function(e){return this._negotiationTag=e,Promise.resolve()},e.prototype.dispose=function(){this._detachAllHandlers(),this._dataChannel&&(this._dataChannel=null)},e.prototype.setDataChannel=function(e){if(this._dataChannel)throw new Error("Unexpected setting of data channel when we already have one");return this._dataChannel=e,Promise.resolve()},e.prototype.onDataChannelStatusChanged=function(e){var t=this;return e!==SlimCore.Enums.DataChannelStatus.Active||this._isDataChannelActive?e===SlimCore.Enums.DataChannelStatus.Available&&(this._isDataChannelActive||this._isDataChannelStopping?(this._dataChannelStartCalled=!1,this._handlerPromises.chainPromise(function(){return t._detachAllHandlers()},"onDataChannelStatusChanged, _detachAllHandlers")):this._availableHandlers>0&&this._handlerPromises.chainPromise(function(){return t.start()},"onDataChannelStatusChanged, start")):this._handlerPromises.chainPromise(function(){return t._attachAllHandlers().catch(function(e){t.logger.error("Failed to attach all handlers error: "+e)})},"onDataChannelStatusChanged, _attachAllHandlers"),this._dataChannelStatus=e,Promise.resolve()},e.prototype.setProtocolDataSource=function(e){return Promise.resolve()},e.prototype.processProtocolMessage=function(e,t,n,r){return Promise.resolve()},Object.defineProperty(e.prototype,"_isDataChannelAvailable",{get:function(){return!!this._dataChannel&&this._dataChannelStatus===SlimCore.Enums.DataChannelStatus.Available},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_isDataChannelActive",{get:function(){return!!this._dataChannel&&this._dataChannelStatus===SlimCore.Enums.DataChannelStatus.Active},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_isDataChannelStopping",{get:function(){return!!this._dataChannel&&this._dataChannelStatus===SlimCore.Enums.DataChannelStatus.Stopping},enumerable:!1,configurable:!0}),e.prototype._attachAllHandlers=function(){var e=this;return Promise.all(Object.keys(this._handlers).map(function(t){var n=e._handlers[t];return n&&(n.handler&&n.dataSource&&n.dataSink||!n.sourceSinkInternallyCreated)?e._attachHandler(n):Promise.resolve(null)}))},e.prototype.setInternalSourceSink=function(e,t,n){if(e<0||e>=64)throw new Error("Data Id "+e+" is outside the valid range of 0-63");if(this._handlers.hasOwnProperty(e)&&(this._handlers[e].dataSource||this._handlers[e].dataSink))this.logger.info("Data Id "+e+" for internal source sink is already registered");else if(this.logger.info("Setting internal source sink for dataId: "+e),e in this._handlers)this._handlers[e].dataSource=t,this._handlers[e].dataSink=n,this.logger.info("Completed adapter details for dataId: "+e),this._availableHandlers++;else{var r=new o(e,null,!0,0);r.dataSource=t,r.dataSink=n,this._handlers[e]=r}},e.prototype._attachHandler=function(e){var t=this;if(e.isAttached)return Promise.resolve();this.logger.info("Attaching handler for dataId: "+e.dataId+", "+(e.sourceSinkInternallyCreated?"skipping source sink creation":"making source sink"));var n=[];return e.sourceSinkInternallyCreated?e.dataSource&&e.dataSink||(this.logger.error("Attaching handler with null datasource or datasink"),n.push(Promise.reject(new Error("Attaching handler with null datasource or datasink")))):(e.isSourceEnabled()&&(e.dataSource=i.createDataSource(this._slimcoreInstance,e.dataId),n.push(this._dataChannel.registerDataSource(e.dataSource))),e.isSinkEnabled()&&(e.dataSink=i.createDataSink(this._slimcoreInstance,e.dataId),n.push(this._dataChannel.registerDataSink(e.dataSink)))),Promise.all(n).then(function(){e.dataSink&&(e.listener=function(n){try{e.handler.onDataReceived(e.dataId,n.data,n.sourceID)}catch(n){t.logger.error("Exception thrown from onDataReceived for data id "+e.dataId+", error: "+n)}},e.dataSink.on("data",e.listener));return e.isAttached=!0,e.handler.onStarted(e.dataId,function(t,n){if(!e.dataSource)return Promise.reject(new Error("Data sent to sink-only DataChannelAdapter"));try{return e.dataSource.sendData(t,n),Promise.resolve()}catch(e){return Promise.reject(e)}}),Promise.resolve()}).catch(function(n){return t.logger.error("Attaching handler for data id "+e.dataId+" threw exception: "+n),Promise.reject(n)})},e.prototype._detachAllHandlers=function(){var e=this;return Promise.all(Object.keys(this._handlers).map(function(t){return e._detachHandler(e._handlers[t])}))},e.prototype._detachHandler=function(e){var t=this;if(!e.isAttached)return Promise.resolve();try{if(this.logger.info("Detaching data handler dataid: "+e.dataId),e.handler&&e.handler.onStopped(e.dataId).catch(function(e){t.logger.warn("Error in handler onStopped :"+e)}),!e.sourceSinkInternallyCreated){var n=[];return e.dataSource&&n.push(this._dataChannel.unregisterDataSource(e.dataSource).catch(function(e){t.logger.warn("Failed to unregister data source, call probably ended: "+e)}).then(function(){e.dataSource.dispose(),e.dataSource=null})),e.dataSink&&(e.dataSink.removeAllListeners("data"),n.push(this._dataChannel.unregisterDataSink(e.dataSink).catch(function(e){t.logger.warn("Failed to unregister data sink, call probably ended: "+e)}).then(function(){e.dataSink.dispose(),e.dataSink=null}))),e.isAttached=!1,Promise.all(n).then()}if(e.dataSink)try{e.dataSink.removeListener("data",e.listener)}catch(e){this.logger.warn("Error removing internal listener, call probably ended: "+e)}e.isAttached=!1}catch(t){this.logger.error("Exception thrown while detaching handler for data id "+e.dataId+", error: "+t)}return Promise.resolve()},e.prototype.start=function(){return this.logger.info("Data channel start called from adapter"),this._dataChannel?this._dataChannelStartCalled?(this.logger.warn("Data channel start called more than once"),Promise.resolve()):(this._dataChannelStartCalled=!0,this._dataChannel.start(this._negotiationTag)):Promise.reject(new Error("Attempted to call start without a data channel"))},e}();t.default=a},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(38),o=n(12),a=n(18),s=n(10),c=function(e){function t(t,n,r,i,o){var a=e.call(this,t.createChild(function(){return"SlimCoreElectronPTZHandler"}),n,r)||this;return a._deviceManager=o,a._handlerSessionState=0,a.role=0,a._ptzDataChannelStatus={id:null,readyForControl:!1,state:0},a._ptzEnabled=!1,a._dataChannelActive=!1,a._participantId=null,a._protocolDataSource=null,a._ptzDataSource=null,a._ptzDataSink=null,a._controllerRequest=null,a._controllerRequestSubscription=null,a._controllerParticipant=null,a._controllerParticipantSubscription=null,a._controlleeParticipant=null,a._requestControlTimer=null,a._acceptControlTimer=null,a._terminateControlTimer=null,a._previousPTZControlDeviceState=0,a._logger.info("constructor(). call.participantId="+i.participantId),a._participantId=i.participantId,i.on("callLegIdChanged",function(e){a._logger.info("callLegIdChanged from:"+a._participantId+" to:"+e),a._participantId=e,a._controlleeParticipant?a._controlleeParticipant.participantId=e:a._controllerParticipant&&(a._controllerParticipant.participantId=e)}),a}return r(t,e),t.prototype.setPTZHandlerFeatureFlag=function(e){this._logger.info("setPTZHandlerFeatureFlag(enabled= "+e+"), previous state: _ptzEnabled= "+this._ptzEnabled),this._ptzEnabled=e,e?this._dataChannel&&(this._dataChannel.start(),this._dataChannelActive||3!==this._ptzDataChannelStatus.state||(this._dataChannelActive=!0,this._createAndAttachPTZDevices())):this._isControllee()?this.shutdownPTZControllee():this._isController()?this.shutdownPTZController():this._logger.info("ptz handler is not involved in session yet. Nothing to cleanup")},t.prototype.isPTZFeatureEnabled=function(){return this._ptzEnabled},t.prototype.setDataChannel=function(e){var t=this;return o.asap(function(){return t._setDataChannel(e)})},t.prototype._setDataChannel=function(e){this._logger.info("Setting DataChannel: "+e.id),this._dataChannel&&!e&&this._detachAndDeletePTZDevices(),this._dataChannel=e,this._dataChannel&&this._ptzEnabled&&(this._logger.info("starting data channel: "+this._dataChannel.id),this._dataChannel.start())},t.prototype.setProtocolDataSource=function(e){var t=this;return o.asap(function(){return t._setProtocolDataSource(e)})},t.prototype._setProtocolDataSource=function(e){this._protocolDataSource=e},t.prototype.getDevicePTZCapability=function(e){return this._deviceManager?this._deviceManager.getDevicePTZCapabilityAsync(e):Promise.reject(new Error("getDevicePTZCapability called but device manager is null"))},t.prototype.shutdownPTZControllee=function(){if(this._logger.info("shutdownPTZControllee()"),this._controllerRequest){this._logger.warn("Rejecting pending control requests");var e=this._getDataSourceIdForParticipantLeg(this._controllerRequest),t=this._controllerRequest;this._clearControlRequest(),this._raiseControlRequestCanceled(t),this._sendRequest({action:103,terminatedReason:5},e)}if(this.role=0,this._controllerParticipant){var n={inControl:!1,id:this._controllerParticipant.participant.id,terminatedReason:5};this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl="+n.inControl+", id="+n.id+", terminatedReason="+n.terminatedReason+"}"),this.event("ptzSessionChanged").raise(n)}this._resetControlState()},t.prototype.shutdownPTZController=function(){if(this._logger.info("shutdownPTZController()"),1===this._handlerSessionState){if(this._controlleeParticipant){var e=this._getDataSourceIdForParticipantLeg(this._controlleeParticipant);this._sendRequest({action:101,terminatedReason:6},e)}else this._logger.warn("shutdownPTZController: control participant is null");t={inControl:!1,id:"",terminatedReason:6};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({sessionStatus:t,details:""}))):this._logger.error("Unexpected, no promise could be resolved - state =PTZHandlerSessionState.RequestSent action =shutdownPTZController")}else if(4===this._handlerSessionState){var t={inControl:!1,id:"",terminatedReason:6};this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl="+t.inControl+", id="+t.id+", terminatedReason="+t.terminatedReason+"}"),this.event("ptzSessionChanged").raise(t)}this._resetControlState()},t.prototype._resetControlRequest=function(e){this._clearControlRequest(),this._controllerRequest=e,this._registerParticipantListener(e),3===e.participantState&&(this._logger.info("sent event:ptzIncomingRequest with request.participant.id="+e.participant.id),this.event("ptzIncomingRequest").raise(e.participant.id))},t.prototype._clearControlRequest=function(){this._stopListeningToParticipantChanges(this._controllerRequest),this._controllerRequest=null},t.prototype._stopListeningToParticipantChanges=function(e){this._controllerRequestSubscription&&(this._controllerRequestSubscription.dispose(),this._controllerRequestSubscription=null)},t.prototype._registerParticipantListener=function(e){var t=this;this._controllerRequestSubscription=e.participant.changed(function(){if(e.participant.state!==e.participantState)switch(e.participantState=e.participant.state,e.participantState){case 3:t._logger.info("sent event:ptzIncomingRequest with request.participant.id="+e.participant.id),t.event("ptzIncomingRequest").raise(e.participant.id);break;case 0:case 5:case 4:t.denyPTZControllerRequest().catch(function(e){t._logger.info("it is ok if denyPTZControllerRequest rejects here as ptz session may have just been stopped. Err is "+e)}),t._logger.info("_registerParticipantListener: participant "+e.participant.id+" is no longer connected. resetting"),t._clearControlRequest(),t._raiseControlRequestCanceled(e);break;case 1:case 2:case 6:case 7:break;default:t._logger.error("unexpected participantState {request.participantState} unhandled")}})},t.prototype._resetControllerParticipant=function(e){var t=this;this._controllerParticipantSubscription&&(this._logger.info("_resetControllerParticipant: stopping tracking changes for "+this._controllerParticipant.participant.id),this._controllerParticipantSubscription.dispose(),this._controllerParticipantSubscription=null),e&&(this._controllerParticipantSubscription=e.participant.changed(function(){3!==e.participant.state&&t.handleParticipantRemoved(e.participant.id)})),this._controllerParticipant=e},t.prototype.handleParticipantRemoved=function(e){if(this._logger.info("handleParticipantRemoved(): Stopping tracking state changes for "+e),this._isControllee()){if(this._controllerParticipant&&this._controllerParticipant.participant.id===e){this._logger.info("handleParticipantRemoved: controller left call, tearing down control session"),this._resetControlState();t={inControl:!1,id:e,terminatedReason:6};this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl="+t.inControl+", id="+t.id+", terminatedReason="+t.terminatedReason),this.event("ptzSessionChanged").raise(t)}}else if(this._controlleeParticipant&&this._controlleeParticipant.participant.id===e&&4===this._handlerSessionState){this._logger.info("handleParticipantRemoved: Controllee left call, tearing down control session"),this._resetControlState();var t={inControl:!1,id:"",terminatedReason:5};this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl="+t.inControl+", id="+t.id+", terminatedReason="+t.terminatedReason+"}"),this.event("ptzSessionChanged").raise(t)}},t.prototype.callStateChanged=function(e){this._callState=e,7===e&&this._handleCallDisconnected()},t.prototype._handleCallDisconnected=function(){this._logger.info("handleCallDisconnected()"),this._isControllee()?this.shutdownPTZControllee():this.shutdownPTZController()},t.prototype._isControllee=function(){return 1===this.role},t.prototype._isController=function(){return 2===this.role},t.prototype._createAndAttachPTZDevices=function(){var e=this;if(this._logger.info("_createAndAttachPTZDevices()"),s.hasCreateDataSource(this._slimcoreInstance)&&s.hasCreateDataSink(this._slimcoreInstance))if(this._dataChannel){var t=Promise.resolve(),n=Promise.resolve();this._ptzDataSource||(this._ptzDataSource=s.createDataSource(this._slimcoreInstance,SlimCore.Enums.DataDeviceId.PTZHandler),this._logger.info("created PTZHandler DataSource"),t=this._dataChannel.registerDataSource(this._ptzDataSource).then(function(){return e._logger.info("registered PTZHandler DataSource")}).catch(function(t){return e._logger.error("registerDataSource threw exception: "+t)})),this._ptzDataSink||(this._ptzDataSink=s.createDataSink(this._slimcoreInstance,SlimCore.Enums.DataDeviceId.PTZHandler),this._logger.info("created PTZHandler DataSink"),n=this._dataChannel.registerDataSink(this._ptzDataSink).then(function(){return e._logger.info("registered PTZHandler DataSink")}).catch(function(t){return e._logger.error("registerDataSink threw exception: "+t)})),Promise.all([t,n]).then(function(){e._ptzDataChannelStatus.readyForControl=!0,e._logger.info("sent event:ptzDataChannelStateChanged with readyForControl(true)"),e.event("ptzDataChannelStateChanged").raise(!0)}),this._ptzDataSink?this._ptzDataSink.on("data",function(t){try{var n=JSON.parse(s.bufferToString(t.data));e._processPTZMessage(n)}catch(t){e._logger.error("Error processing ptz messages error="+t)}}):this._logger.error("registerDataSink callback failed due to null _ptzDataSink")}else this._logger.warn("_createAndAttachPTZDevices() null dataChannel");else this._logger.warn("createDataSource or createDataSink not implemented")},t.prototype._processPTZMessage=function(e){var t=this;0===e.type?this._isControllee()?this._deviceManager?this._deviceManager.applyPTZControlCommandAsync(e.value).then(function(e){t._sendPTZControlCommandState(e)}):this._logger.error("_processPTZMessage {type="+e.type+", value="+e.value+"}, but _deviceManager is null"):this._logger.error("_processPTZMessage type="+e.type+" should be recieved by Controllee only"):1===e.type?this._isController()?this._previousPTZControlDeviceState!==e.value&&(this._logger.info("Remote device state changed. previous:"+this._previousPTZControlDeviceState+", new: "+e.value+". sending event to UI"),this._previousPTZControlDeviceState=e.value,this.event("ptzControlDeviceState").raise(e.value)):this._logger.error("_processPTZMessage type="+e.type+" should be recieved by Controller only"):this._logger.error("Unsupported type="+e.type)},t.prototype.sendPTZControlCommand=function(e){var t=this;if(this._controlleeParticipant)if(4===this._handlerSessionState){var n={type:0,value:e},r=this._getDataSourceIdForParticipantLeg(this._controlleeParticipant);this._sendPTZMessage(n,r)}else this._logger.error("_sendPTZMessage: no remote controler session");else this._deviceManager?this._deviceManager.applyPTZControlCommandAsync(e).then(function(e){t._previousPTZControlDeviceState!==e&&(t._logger.info("Local ptz device state changed. previous:"+t._previousPTZControlDeviceState+", new:"+e+". Updating UI, since controlle and controller is same participant."),t._previousPTZControlDeviceState=e,t.event("ptzControlDeviceState").raise(e))}):this._logger.error("_deviceManager not available, apply ptz command ignored.")},t.prototype._sendPTZControlCommandState=function(e){if(3===this._handlerSessionState){var t=this._getDataSourceIdForParticipantLeg(this._controllerParticipant),n={type:1,value:e};this._sendPTZMessage(n,t)}else this._logger.error("_sendPTZControlCommandState("+e+") ignoring because no remote controller session")},t.prototype._sendPTZMessage=function(e,t){if(this._ptzDataSource)try{var n=[t];this._ptzDataSource.sendData(s.stringToBuffer(JSON.stringify(e)),n)}catch(n){var r="Failed to send ptz device message. Error="+n;this._logger.error(""+r);var i={reason:7,detail:JSON.stringify({PtzDataMessage:e.value,sourceId:t,errorMsg:r})};this._logger.info("sent event:ptzHandlerError with handlerError{reason:"+i.reason+", detail:"+i.detail),this.event("ptzHandlerError").raise(i)}else this._logger.error("Failed to send ptz device message: Data channel not set up")},t.prototype._detachAndDeletePTZDevices=function(){var e=this;this._logger.info("_detachAndDeletePTZDevices()");try{this._ptzDataSink&&this._ptzDataSink.removeAllListeners("data"),this._dataChannel?(this._ptzDataSource&&this._dataChannel.unregisterDataSource(this._ptzDataSource).catch(function(t){e._logger.warn("Failed to unregister data source, call probably ended: "+t)}).then(function(){e._ptzDataSource=null,e._logger.info("deleted Control data source")}),this._ptzDataSink&&this._dataChannel.unregisterDataSink(this._ptzDataSink).catch(function(t){e._logger.warn("Failed to unregister data sink, call probably ended: "+t)}).then(function(){e._ptzDataSink=null,e._logger.info("deleted Control data sink")}),this._ptzDataChannelStatus.readyForControl=!1,this._logger.info("sent event:ptzDataChannelStateChanged with readyForControl(false)"),this.event("ptzDataChannelStateChanged").raise(!1)):this._logger.warn("_detachAndDeletePTZDevices() null dataChannel")}catch(e){this._logger.error("Exception thrown while detaching ptz contro/sink devices, error: "+e)}},t.prototype.onDataChannelStatusChanged=function(e){var t=this;return o.asap(function(){return t._onDataChannelStatusChanged(e)})},t.prototype._onDataChannelStatusChanged=function(e){this._logger.info("Data channel status = "+e),this._ptzDataChannelStatus.state=i.default._mapDataChannelStatus(e),e===SlimCore.Enums.DataChannelStatus.Active?this._dataChannel&&!this._dataChannelActive&&this._ptzEnabled&&(this._dataChannelActive=!0,this._createAndAttachPTZDevices()):this._dataChannel&&this._dataChannelActive&&(this._dataChannelActive=!1,this._detachAndDeletePTZDevices())},t.prototype.processProtocolMessage=function(e,t,n,r){var i=this;return o.asap(function(){return i._processProtocolMessage(e,t,n,r)})},t.prototype._raiseControlRequestCanceled=function(e){this._logger.info("sent event:ptzIncomingRequestCancelled with controlRequest.participant.id="+e.participant.id),this.event("ptzIncomingRequestCancelled").raise(e.participant.id)},t.prototype._processProtocolMessage=function(e,t,n,r){var i;try{i=JSON.parse(e)}catch(e){return void this._logger.error("Error parsing sessionControlMsg")}if(this._logger.info("_processProtocolMessage action="+i.action+", senderParticipantId="+n+", sender="+r),t||this._logger.warn("protocol message from unknown sender with sourceId="+r),100===i.action)!1===this._ptzEnabled?(this._logger.warn("control ptz device is disabled - rejecting request"),this._sendRequest({action:103,terminatedReason:9},r)):this._controllerRequest?(this._logger.warn("Controllee is already processing a control request...rejecting new requests"),this._sendRequest({action:103,terminatedReason:3},r)):this._controllerParticipant&&this._controllerParticipant.participant===t?this._controllerParticipant.participantId&&this._controllerParticipant.participantId!==n?(this._logger.warn("rejecting control request from second endpoint. participantId: "+n),this._sendRequest({action:103,terminatedReason:3},r)):(this._logger.warn("Got control request for someone already in control"),this._sendRequest({action:102,terminatedReason:0},r)):t?this._resetControlRequest({participant:t,participantState:t.state,participantId:n}):this._logger.error("Got ControlRequest message but could not find a sender participant, ignoring");else if(102===i.action)1===this._handlerSessionState?(this._sendRequest({action:104,terminatedReason:0},r)?(this._handlerSessionState=4,this._requestControlPromise?this._requestControlPromise.resolve():this._logger.error("Unexpected, no promise could be resolved - state =PTZHandlerSessionState.RequestSent action ="+i.action)):this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control is accepted, but fail to send ack"}))):this._logger.error("Unexpected, no promise could be resolved - state ="+this._handlerSessionState+" action ="+i.action),this._cancelRequestControlTimer()):this._logger.warn("AcceptRequest message received in _handlerSessionState="+this._handlerSessionState);else if(103===i.action)if(1===this._handlerSessionState){this._handlerSessionState=0;var o={inControl:!1,id:"",terminatedReason:i.terminatedReason};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:o,details:""}))):this._logger.error("Unexpected, no promise could be resolved - state =PTZHandlerSessionState.RequestSent action ="+i.action),this._resetControlState()}else this._logger.warn("RejectRequest message received in _handlerSessionState="+this._handlerSessionState+" reason="+i.terminatedReason);else if(101===i.action){if(this._controllerRequest){var s=this._controllerRequest;this._raiseControlRequestCanceled(s),this._resetControlState()}}else if(104===i.action)if(2===this._handlerSessionState)if(this._controllerParticipant&&this._controllerParticipant.participant===t){var c=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);r!==c&&this._logger.warn("acknowledging source id: "+r+" does not match requesting source id: "+c),this._logger.info("Setting up remote control for controller source id="+c),this._handlerSessionState=3;u={inControl:!0,id:this._controllerParticipant.participant.id,terminatedReason:i.terminatedReason};this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl="+u.inControl+", id="+u.id+", terminatedReason="+u.terminatedReason+"}"),this.event("ptzSessionChanged").raise(u),this._acceptControlPromise?(this._acceptControlPromise.resolve(),this._cancelAcceptControlTimer()):this._logger.error("Unexpected, no promise could be resolved - state =PTZHandlerSessionState.WaitingForControllerAck action ="+i.action)}else t?this._logger.warn("Ignoring ack from participant that does not match controller id = "+a.scrubMriOrOmit(t.id)):this._logger.warn("Ignoring ack from null participant source id = "+r);else 5===this._handlerSessionState?this._terminateControlPromise?(this._terminateControlPromise.resolve(),this._resetControlState()):this._logger.error("Unexpected, no promise could be resolved - state =PTZHandlerSessionState.WaitingForTerminateAck action ="+i.action):this._logger.warn("Unexpected ack in control state = "+this._handlerSessionState);else if(105===i.action||106===i.action){var l=void 0;this._isController()?l="":t?l=t.id:this._logger.error("Got terminate message but could not find a sender participant!");var u={inControl:!1,id:l,terminatedReason:i.terminatedReason};this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl="+u.inControl+", id="+u.id+", terminatedReason="+u.terminatedReason+"}"),this.event("ptzSessionChanged").raise(u),106===i.action&&this._sendRequest({action:104,terminatedReason:0},r),this._resetControlState()}else this._logger.error("Unknown request action received on control protocol data sink, action="+i.action)},t.prototype._sendRequest=function(e,t){var n=!1,r=this._protocolDataSource;if(t<0)return this._logger.error("_sendRequest failed. Invalid sourceID="+t),n;if(r){var i={type:2,message:JSON.stringify(e)};this._logger.info("sending ptz session control message type="+i.type+", message="+i.message+" to sourceID="+t);try{var o=[t];r.sendData(s.stringToBuffer(JSON.stringify(i)),o),n=!0}catch(e){var a="Failed to send ptz session control message. Error="+e;this._logger.error(""+a);var c={reason:7,detail:JSON.stringify({PtzSessionlMessage:i.message,sourceId:t,errorMsg:a})};this._logger.info("sent event:ptzHandlerError with handlerError{reason:"+c.reason+", detail:"+c.detail),this.event("ptzHandlerError").raise(c)}}else this._logger.error("Sending ptz session control message failed: null dataSource in _sendRequest");return n},t.prototype._resetControlState=function(){this._logger.info("_resetControlState()"),this._previousPTZControlDeviceState=0,this._handlerSessionState=0,this.role=0,this._resetControllerParticipant(),this._controlleeParticipant=null,this._clearControlRequest(),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelTerminateControlTimer()},t.prototype.requestPTZControl=function(e){return 3!==this._callState?Promise.reject(new Error("requestPTZControl when call is not connected")):this._dataChannelActive?0!==this._handlerSessionState?Promise.reject(new Error("requestPTZControl called in bad state="+this._handlerSessionState)):e?this._requestControlPromise?Promise.reject(new Error("request control promise has not been resolved yet while requesting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while requesting control")):this._requestPTZControl(e):Promise.reject(new Error("requestPTZControl unexpected null ControlParticipant")):Promise.reject(new Error("requestPTZControl when data channel not active"))},t.prototype._requestPTZControl=function(e){var t=this;this._logger.info("_requestPTZControl()"),this._resetControlState(),this.role=2,this._controlleeParticipant={participant:e,participantState:3,participantId:this._participantId},this._requestControlPromise=o.defer();var n=function(){t._requestControlPromise=null};this._requestControlPromise.promise.then(n,n);var r=this._getDataSourceIdForParticipantLeg(this._controlleeParticipant);if(!this._sendRequest({action:100,terminatedReason:0},r)){var i={inControl:!1,id:"",terminatedReason:7};return this._requestControlPromise.reject(new Error),Promise.reject(new Error(JSON.stringify({controlInfo:i,details:""})))}return this._handlerSessionState=1,this._requestControlTimer=window.setTimeout(function(){if(1===t._handlerSessionState){t._logger.warn("No response to control request - canceling"),t._sendRequest({action:101,terminatedReason:2},r)||t._logger.error("fail to send the cancel control request");var e={inControl:!1,id:"",terminatedReason:2};t._requestControlPromise?t._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:e,details:"we did not get any response to the control - terminating session control request."}))):t._logger.error("Unexpected, no promise could be resolved - _handlerSessionState = PTZHandlerSessionState.RequestSent"),t._resetControlState()}else t._requestControlPromise?t._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control - times out in bad state - do nothing"}))):t._logger.error("Unexpected, no promise could be resolved - _handlerSessionState = "+t._handlerSessionState);t._requestControlTimer=null},3e4),this._requestControlPromise.promise},t.prototype._cancelRequestControlTimer=function(){this._requestControlTimer&&(this._requestControlPromise&&this._requestControlPromise.reject(new Error("cancelled by _cancelRequestControlTimer")),clearTimeout(this._requestControlTimer),this._requestControlTimer=null)},t.prototype.acceptPTZControllerRequest=function(){return this._logger.info("acceptPTZControllerRequest()"),this._dataChannelActive?this._controllerRequest?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while accepting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while accepting control")):this._acceptPTZControllerRequest():Promise.reject(new Error("acceptPTZControllerRequest while no control request pending")):Promise.reject(new Error("acceptPTZControllerRequest when data channel not active"))},t.prototype._acceptPTZControllerRequest=function(){var e=this;this._logger.info("_acceptPTZControllerRequest()"),this._acceptControlPromise=o.defer();var t=function(){e._acceptControlPromise=null};if(this._acceptControlPromise.promise.then(t,t),this._controllerParticipant){this._logger.warn("_acceptPTZControllerRequest called while another participant already has control - terminating control of existing controller");var n=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:105,terminatedReason:10},n)||this._logger.error("fail to send the terminateNoAck request"),this._resetControllerParticipant()}var r=this._getDataSourceIdForParticipantLeg(this._controllerRequest),i=this._controllerRequest.participant.id;return this._sendRequest({action:102,terminatedReason:0},r)?(this._resetControllerParticipant(this._controllerRequest),this._clearControlRequest(),this._handlerSessionState=2,this.role=1,this._acceptControlTimer=window.setTimeout(function(){if(2===e._handlerSessionState){e._logger.error("No ack received when accepting control request - terminating control"),e._sendRequest({action:105,terminatedReason:4},r)||e._logger.error("fail to send the TerminateNoAck request");var t={inControl:!1,id:i,terminatedReason:4};e._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl="+t.inControl+", id="+t.id+", terminatedReason="+t.terminatedReason+"}"),e.event("ptzSessionChanged").raise(t),e._acceptControlPromise?e._acceptControlPromise.reject(new Error("No ack received when accept control - terminating control")):e._logger.error("Unexpected, no promise could be resolved - _handlerSessionState = PTZHandlerSessionState.WaitingForControllerAck")}else e._acceptControlPromise?e._acceptControlPromise.reject(new Error("accept control - times out in bad state - do nothing")):e._logger.error("Unexpected, no promise could be resolved - _handlerSessionState = "+e._handlerSessionState);e._acceptControlTimer=null,e._resetControlState()},1e4),this._acceptControlPromise.promise):(this._logger.error("fail to send the accept control request"),this._acceptControlPromise.reject(new Error),Promise.reject(new Error("fail to send the accept control request!")))},t.prototype._cancelAcceptControlTimer=function(){this._acceptControlTimer&&(this._acceptControlPromise&&this._acceptControlPromise.reject(new Error("cancelled by _cancelAcceptControlTimer")),clearTimeout(this._acceptControlTimer),this._acceptControlTimer=null)},t.prototype.denyPTZControllerRequest=function(){return this._dataChannelActive?this._controllerRequest?this._isControllee()?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while denying control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while denying control")):this._denyPTZControllerRequest():Promise.reject(new Error("denyPTZControllerRequest when not advertized as controllee")):Promise.reject(new Error("denyPTZControllerRequest while no control request pending")):Promise.reject(new Error("denyPTZControllerRequest when data channel not active"))},t.prototype._denyPTZControllerRequest=function(){this._logger.info("_denyPTZControllerRequest()");var e=this._getDataSourceIdForParticipantLeg(this._controllerRequest);return this._clearControlRequest(),this._sendRequest({action:103,terminatedReason:1},e)?new Promise(function(e,t){e()}):Promise.reject(new Error("fail to send the deny control requst"))},t.prototype._getDataSourceIdForParticipantId=function(e,t){return this._dataChannel&&e?e.getSourceId(t,3):(this._logger.error("Null data channel or null participant cannot map participant to source id"),-1)},t.prototype._getDataSourceIdForParticipantLeg=function(e){return e?this._getDataSourceIdForParticipantId(e.participant,e.participantId):(this._logger.error("Null participantLeg cannot map participant to source id"),-1)},t.prototype.terminatePTZSession=function(){if(this._isController()){if(4!==this._handlerSessionState)return Promise.reject(new Error("terminateControl called while not in control"));if(!this._controlleeParticipant)return Promise.reject(new Error("terminateControl called but _controlleeParticipant is null"))}else{if(!this._isControllee())return Promise.reject(new Error("terminateControl called but niether controller nor controllee"));if(!this._controllerParticipant)return Promise.reject(new Error("terminateControl called but controllerParticipant is null"))}return this._requestControlPromise?Promise.reject(new Error("request control promise has not been resolved yet while terminating control")):this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while terminating control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while terminating control")):this._terminatePTZSession()},t.prototype._terminatePTZSession=function(){var e=this;this._logger.info("_terminatePTZSession()"),this._terminateControlPromise=o.defer();var t=function(){e._terminateControlPromise=null};this._terminateControlPromise.promise.then(t,t);var n,r,i=0;if(this._isController()){if(4!==this._handlerSessionState)return this._logger.error("Local Controller called terminateControl when not controlling"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local Controller called terminateControl when not controlling"));i=6,n=this._getDataSourceIdForParticipantLeg(this._controlleeParticipant),r=""}else{if(3!==this._handlerSessionState||!this._controllerParticipant)return this._logger.error("Local Controllee called terminateControl when no one is in control"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local Controllee called terminateControl when no one is in control"));i=5,n=this._getDataSourceIdForParticipantLeg(this._controllerParticipant),r=this._controllerParticipant.participant.id}this._sendRequest({action:105,terminatedReason:i},n)||this._logger.error("fail to send the terminateNoAck request"),this._handlerSessionState=0;var a={inControl:!1,id:r,terminatedReason:i};return this._logger.info("sent event:ptzSessionChanged with sessionStatus= {inControl="+a.inControl+", id="+a.id+", terminatedReason="+a.terminatedReason+"}"),this.event("ptzSessionChanged").raise(a),this._terminateControlPromise.resolve(),this._resetControlState(),new Promise(function(e,t){e()})},t.prototype._cancelTerminateControlTimer=function(){this._terminateControlTimer&&(this._terminateControlPromise&&this._terminateControlPromise.reject(new Error("cancelled by _cancelTerminateControlTimer")),clearTimeout(this._terminateControlTimer),this._terminateControlTimer=null)},t.prototype.dispose=function(t){this._logger.info("dispose causeId: "+t),this._detachAndDeletePTZDevices(),this._resetControlState(),this._dataChannel&&(this._dataChannel=null),e.prototype.dispose.call(this,t)},t}(n(11).default);t.default=c},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(84),c=n(38),l=n(7),u=n(12),d=n(33),p=n(61),h=n(18),g=n(29),f=n(27),_=n(9),m=n(40),v=n(41),y=n(10),C=n(11);!function(e){e.INITIATED="Initiated",e.CALL_STATE="CallState",e.SHARING_STARTED="SharingStarted",e.DATA_CHANNEL_AVAILABLE="DataChannelAvailable",e.DATA_CHANNEL_UNAVAILABLE="DataChannelUnavailable",e.AVAILABLE_HANDSHAKE="AvailableHandshake",e.SESSION_SHUTDOWN="Shutdown",e.SESSION_SHUTDOWN_BY_ANOTHER_SESSION="ShutdownByOtherSession"}(a||(a={}));var S;!function(e){e.INITIATED="Initiated",e.CALL_STATE="CallState",e.DATA_CHANNEL_AVAILABLE="DataChannelAvailable",e.DATA_CHANNEL_UNAVAILABLE="DataChannelUnavailable",e.CONTROL_REQUEST="ControlRequest",e.SESSION_SHUTDOWN="Shutdown",e.SESSION_SHUTDOWN_BY_ANOTHER_SESSION="ShutdownByOtherSession"}(S||(S={}));var I=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t,n,function(){return s.recordedEvents.length>100})||this;return s.negotiationTag=r,s.callId=i,s.participantId=o,s.endpointId=a,s.messagesFromUnknownSender={},s.tsCallingVersion=g.getTsCallingVersion(),s}return r(t,e),t.prototype.recordProtocolMessage=function(e,t){e||(t in this.messagesFromUnknownSender||(this.messagesFromUnknownSender[t]=0),this.messagesFromUnknownSender[t]++)},t.prototype.setCallId=function(e){this.callId=e},t.prototype.setEndpointId=function(e){this.endpointId=e},t.prototype.setParticipantId=function(e){this.participantId=e},t.prototype.setTenantId=function(e){this.tenantId=e},t}(d.TelemetryUtilities),O=function(e){function t(t,n,r,i,o,a,s){var c=e.call(this,t,n,r,i,o,a)||this,u=s.getSharingParticipantLeg();if(u){c.sharerParticipantId=u;var d=l.find(s.endpoints.endpointDetails,function(e){return e.participantId===u});d&&(c.sharerClientVersion=d.clientVersion)}return c}return r(t,e),t.prototype.getEvent=function(t,n){var r=function(e){return void 0===e?"":e};return{CorrelationId:r(this.callId),ParticipantId:r(this.participantId),EndpointId:r(this.endpointId),NegotiationTag:r(this.negotiationTag),TsCallingVersion:r(this.tsCallingVersion),TenantId:r(this.tenantId),SharerParticipantId:r(this.sharerParticipantId),SharerClientVersion:r(this.sharerClientVersion),EventTimestampBag:e.prototype.getEventTimestampBag.call(this,t,n),ProtocolMessages:JSON.stringify({UnknownSender:this.messagesFromUnknownSender})}},t}(I),T=function(e){function t(t,n,r,i,o,a){return e.call(this,t,n,r,i,o,a)||this}return r(t,e),t.prototype.getEvent=function(t,n){var r=function(e){return void 0===e?"":e};return{CorrelationId:r(this.callId),ParticipantId:r(this.participantId),EndpointId:r(this.endpointId),NegotiationTag:r(this.negotiationTag),TsCallingVersion:r(this.tsCallingVersion),TenantId:r(this.tenantId),EventTimestampBag:e.prototype.getEventTimestampBag.call(this,t,n),ProtocolMessages:JSON.stringify({UnknownSender:this.messagesFromUnknownSender})}},t}(I),E=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t.createChild(function(){return"SlimCoreElectronScreenSharingControl"}),n,r)||this;return s._controlInjector=o,s._telemetryLoggers=a,s.controlState=0,s.role=0,s.controlDataChannelStatus={id:null,readyForControl:!1,state:0},s._enabled=!1,s._availableAckEnabled=!0,s._dataChannelActive=!1,s._dataChannelAvailableSent=!1,s._protocolDataSource=null,s._controlDataSource=null,s._controlDataSink=null,s._controlRequest=null,s._controlRequestSubscription=null,s._controllerParticipant=null,s._controllerParticipantSubscription=null,s._screenSharingVideoRenderer=null,s._screenSharingVideoRendererSubscriptions=[],s._sharerParticipant=null,s._pendingSharer=null,s._controlCapturer=null,s._captureEventSubscription=null,s._mouseControlEventSubscription=null,s._keyboardControlEventSubscription=null,s._requestControlTimer=null,s._grantControlTimer=null,s._acceptControlTimer=null,s._terminateControlTimer=null,s._availableAckTimer=null,s._retryAttempt=0,s._injectRawInputErrorTimer=null,s._lastInjectRawInputErrorCount=0,s._raiseRenderedAtViewer=null,s._participantSubscriptions={},s._viewerSessionLastTerminatedReason=0,s._completedViewerSessions=[],s._logger.info("constructor"),s._callId=i.callId,i.on("callIdChanged",function(e){s._callId=e,s._currentViewerSessionTelemetry&&s._currentViewerSessionTelemetry.setCallId(e),s._currentSharerSessionTelemetry&&s._currentSharerSessionTelemetry.setCallId(e)}),s._participantId=i.participantId,i.on("callLegIdChanged",function(e){s._participantId=e,s._currentViewerSessionTelemetry&&s._currentViewerSessionTelemetry.setParticipantId(e),s._currentSharerSessionTelemetry&&s._currentSharerSessionTelemetry.setParticipantId(e)}),s._endpointId=i.endpointId,s._slimcoreInstance.ecsGetSettingAsBool?s._enableControlSessionTelemetry=s._slimcoreInstance.ecsGetSettingAsBool("MediaAgent","EnableGtcTelemetry",!1):s._enableControlSessionTelemetry=!1,s}return r(t,e),t.prototype.enableScreenSharingControl=function(e,t,n,r){if(this._availableAckEnabled!==e||this._allowControlForUser!==r){if(this._allowControlForUser=r,e)this._raiseScreenSharingControlCapableEvent(!0,"");else{if(0===t){var i={reason:2,detail:n};this.event("sharingControlError").raise(i)}this._raiseScreenSharingControlCapableEvent(!1,"")}this._availableAckEnabled=e}},t.prototype.setRaiseRenderedAtViewer=function(e){this._raiseRenderedAtViewer=e},t.prototype.setScreenSharingControlFeatureFlag=function(e){this._enabled=e,this._availableAckEnabled=e},t.prototype.isScreenSharingControlEnabled=function(){return this._enabled},t.prototype._disposeRenderer=function(e){this._disposeControlCapturer(e);for(var t=0,n=this._screenSharingVideoRendererSubscriptions;t<n.length;t++)n[t].dispose();this._screenSharingVideoRendererSubscriptions=[],this._screenSharingVideoRenderer=null},t.prototype.setRenderer=function(e,t){var n=this,r=_.generateCauseId();if(this._disposeRenderer(r),!e)return Promise.resolve();var i=e,o=t||i.renderTarget;return u.asap(function(){return n._setViewingRenderer(i,o)})},t.prototype.testSetControlInjector=function(e){this._controlInjector=e},t.prototype.setDataChannel=function(e){var t=this;return u.asap(function(){return t._setDataChannel(e)})},t.prototype._setDataChannel=function(e){this._logger.info("Setting DataChannel "+(e&&e.id)),this._dataChannel&&!e&&this._detachAndDeleteControlDevices(),this._dataChannel=e,e&&(this.controlDataChannelStatus={id:e.id,readyForControl:!1,state:c.default._mapDataChannelStatus(e._lastDataChannelState)},this.event("controlDataChannelStateChanged").raise(this.controlDataChannelStatus))},t.prototype.setProtocolDataSource=function(e){var t=this;return u.asap(function(){return t._setProtocolDataSource(e)})},t.prototype._setProtocolDataSource=function(e){this._protocolDataSource=e},t.prototype._raiseScreenSharingControlCapableEvent=function(e,t,n){if(this._enabled){this._logger.info("_raiseScreenSharingControlCapableEvent() enabled is true, raising control capability, capable="+e);r={capable:e,id:t,disabledBySharer:n};this.event("sharingControlCapable").raise(r)}else{this._logger.info("_raiseScreenSharingControlCapableEvent() enabled is false, disabling control capability");var r={capable:!1,id:t};this.event("sharingControlCapable").raise(r)}},t.prototype.initControlForSharer=function(e){this._logger.info("initControlForSharer()"),this._resetControlState(),this._screenSharingVideoRenderer=null,this._disposeControlCapturer(),this.role=1,this._dataChannelAvailableSent=!1,this._setInjectorMode(0),this._raiseScreenSharingControlCapableEvent(!0,""),this._initiateSharerSessionTelemetry(e)},t.prototype.shutdownControlForSharer=function(){if(this._logger.info("shutdownControlForSharer()"),this._controlRequest){this._logger.warn("Rejecting pending control requests");var e=this._getDataSourceIdForParticipantLeg(this._controlRequest),t=this._controlRequest;this._clearControlRequest(),this._raiseControlRequestCanceled(t),this._sendRequest({action:4,terminatedReason:5},e)}if(this.role=0,this._controllerParticipant){var n={inControl:!1,id:this._controllerParticipant.participant.id,terminatedReason:5};this.event("sharingControlChanged").raise(n)}this._finalizeSharerSessionTelemetry(S.SESSION_SHUTDOWN),this._teardownSharerRemoteControl(),this._resetControlState(),this._resetParticipantSubscriptions(),this._availableAckEnabled=this._enabled},t.prototype._resetParticipantSubscriptions=function(){this._logger.info("resetParticipantSubscriptions(): Stopping tracking all participant state changes"),l.each(this._participantSubscriptions,function(e){e.dispose()}),this._participantSubscriptions={}},t.prototype._initiateViewerSessionTelemetry=function(e,t,n){if(!n&&!t)return null;if(!n&&l.find(this._completedViewerSessions,function(e){return t===e}))return null;if(this._currentViewerSessionTelemetry){if(this._currentViewerSessionTelemetry.negotiationTag===t)return null;this._finalizeViewerSessionTelemetry(a.SESSION_SHUTDOWN_BY_ANOTHER_SESSION)}return this._logger.info("initiating new viewer session telemetry for "+t),this._currentViewerSessionTelemetry=new O(this._logger,(new Date).getTime(),t,this._callId,this._participantId,this._endpointId,e),this._currentViewerSessionTelemetry.recordEvent(a.CALL_STATE,{state:this._callState}),this._dataChannel&&this._dataChannelActive&&this._currentViewerSessionTelemetry.recordEvent(a.DATA_CHANNEL_AVAILABLE),this._currentViewerSessionTelemetry},t.prototype._recordViewerSessionTelemetry=function(e,t){void 0===t&&(t=!0),this._currentViewerSessionTelemetry?e&&e(this._currentViewerSessionTelemetry):t&&this._logger.error("Cannot record telemetry without current session")},t.prototype._finalizeViewerSessionTelemetry=function(e){if(this._currentViewerSessionTelemetry){this._currentViewerSessionTelemetry.recordEvent(e);var t=this._currentViewerSessionTelemetry.getEvent();this._sendTelemetryEvent("mdsc_gtc_viewer_session",t),this._currentViewerSessionTelemetry.negotiationTag&&this._completedViewerSessions.push(this._currentViewerSessionTelemetry.negotiationTag),this._currentViewerSessionTelemetry.messagesFromUnknownSender&&Object.keys(this._currentViewerSessionTelemetry.messagesFromUnknownSender).length&&f.RootToolsManager.logExternalForDDL("ScreenSharingControl_viewer: messages received from unkonwn sender",JSON.stringify(t.ProtocolMessages)),this._currentViewerSessionTelemetry=null}},t.prototype._initiateSharerSessionTelemetry=function(e){if(this._currentSharerSessionTelemetry){if(this._currentSharerSessionTelemetry.negotiationTag===e)return null;this._finalizeSharerSessionTelemetry(S.SESSION_SHUTDOWN_BY_ANOTHER_SESSION)}this._logger.info("initiating new sharer session telemetry for "+e),this._currentSharerSessionTelemetry=new T(this._logger,(new Date).getTime(),e,this._callId,this._participantId,this._endpointId),this._dataChannel&&this._dataChannelActive&&this._currentSharerSessionTelemetry.recordEvent(S.DATA_CHANNEL_AVAILABLE)},t.prototype._recordSharerSessionTelemetry=function(e,t){void 0===t&&(t=!0),this._currentSharerSessionTelemetry?e&&e(this._currentSharerSessionTelemetry):t&&this._logger.error("Cannot record telemetry without current session")},t.prototype._finalizeSharerSessionTelemetry=function(e){if(this._currentSharerSessionTelemetry){this._currentSharerSessionTelemetry.recordEvent(e);var t=this._currentSharerSessionTelemetry.getEvent();this._sendTelemetryEvent("mdsc_gtc_sharer_session",t),this._currentSharerSessionTelemetry.messagesFromUnknownSender&&Object.keys(this._currentSharerSessionTelemetry.messagesFromUnknownSender).length&&f.RootToolsManager.logExternalForDDL("ScreenSharingControl_sharer: messages received from unkonwn sender",JSON.stringify(t.ProtocolMessages)),this._currentSharerSessionTelemetry=null}},t.prototype._sendTelemetryEvent=function(e,t){var n=this;this._enableControlSessionTelemetry?this._logger.info("sending event "+e+": "):this._logger.info(e+": "),Object.keys(t).forEach(function(e){n._logger.info("     "+e+" => "+t[e])}),this._enableControlSessionTelemetry&&this._telemetryLoggers&&this._telemetryLoggers.media&&this._telemetryLoggers.media.sendEvent({eventName:e,props:t})},t.prototype._recordProtocolMessage=function(e,t){this._currentViewerSessionTelemetry&&this._currentViewerSessionTelemetry.recordProtocolMessage(e,t),this._currentSharerSessionTelemetry&&this._currentSharerSessionTelemetry.recordProtocolMessage(e,t)},t.prototype.reportSharingSessionChangeForViewer=function(e,t){t&&this._initiateViewerSessionTelemetry(e,t,!1)},t.prototype.initControlForViewer=function(e,t){if(this._logger.info("initControlForViewer("+t+")"),3!==this._callState)return this._logger.info("initControlForViewer postponed until call is connected, callState = "+this._callState),this._pendingNegotiationTag=t,void(this._pendingSharer=e);var n=!this._sharerParticipant||this._sharerParticipant&&this._sharerParticipant.id!==e.id||t!==this._currentNegotiationTag;this._currentNegotiationTag=t,this.role=2,this._sharerParticipant?this._sharerParticipant.id!==e.id&&(this._recordViewerSessionTelemetry(function(e){return e.recordEvent(a.SESSION_SHUTDOWN_BY_ANOTHER_SESSION,null,t)}),this._logger.info("initControlForViewer() sharer switched, new sharer id="+h.scrubMriOrOmit(e.id)),this._dataChannelAvailableSent=!1,4===this.controlState&&this._terminateControl(!1)):(this._logger.info("initControlForViewer() setting sharer to id="+h.scrubMriOrOmit(e.id)),this._sharerParticipant=e,this._dataChannelAvailableSent=!1),this._initiateViewerSessionTelemetry(e,t,!0),n&&this._recordViewerSessionTelemetry(function(e){return e.recordEvent(a.SHARING_STARTED)}),this._dataChannel&&this._dataChannelActive&&!this._dataChannelAvailableSent&&(this._resetControlState(),this.role=2,this._sharerParticipant=e,this._logger.info("initControlForViewer() sending Available message to sharer"),this._startAvailableHandshake())},t.prototype.shutdownControlForViewer=function(e){this._logger.info("shutdownControlForViewer()");var t=!1;if((!e||this._sharerParticipant&&e.id===this._sharerParticipant.id)&&(this._logger.info("shutdownControlForViewer: setting shouldShutdownControlForViewer to true"),t=!0),t&&this._isViewing()){if(1===this.controlState){if(this._sharerParticipant){var n=this._getSharerDataSourceId();this._sendRequest({action:2,terminatedReason:6},n)}else this._logger.warn("shutdownControlForViewer: sharer participant is null");r={inControl:!1,id:"",terminatedReason:6};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:r,details:""}))):this._logger.error("Unexpected, no promise could be resolved - state =ControlState.RequestSent action =shutdownControlForViewer")}else if(4===this.controlState){var r={inControl:!1,id:"",terminatedReason:6};this.event("sharingControlChanged").raise(r)}this._teardownViewerRemoteControl(),this._resetControlState(),this._screenSharingVideoRenderer=null,this._disposeControlCapturer(),this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._dataChannelAvailableSent=!1,this._finalizeViewerSessionTelemetry(a.SESSION_SHUTDOWN),this._raiseScreenSharingControlCapableEvent(!1,"")}},t.prototype._resetControlRequest=function(e){this._clearControlRequest(),this._controlRequest=e,this._registerParticipantListener(e),3===e.participantState&&this.event("sharingIncomingControlRequest").raise(e.participant.id)},t.prototype._clearControlRequest=function(){this._stopListeningToParticipantChanges(this._controlRequest),this._controlRequest=null},t.prototype._stopListeningToParticipantChanges=function(e){this._controlRequestSubscription&&(this._logger.info("_stopListeningToParticipantChanges: stopping tracking changes for "+e.participant.id),this._controlRequestSubscription.dispose(),this._controlRequestSubscription=null)},t.prototype._registerParticipantListener=function(e){var t=this;this._logger.info("_registerParticipantListener: tracking changes for "+e.participant.id),this._controlRequestSubscription=e.participant.changed(function(){if(e.participant.state!==e.participantState)switch(e.participantState=e.participant.state,e.participantState){case 3:t.event("sharingIncomingControlRequest").raise(e.participant.id);break;case 0:case 5:case 4:t.denyControlRequest().catch(function(e){t._logger.info("it is ok if denyControlRequest rejects here as screensharing may have just been stopped. Err is "+e)}),t._logger.info("_registerParticipantListener: participant "+e.participant.id+" is no longer connected. resetting"),t._clearControlRequest(),t._raiseControlRequestCanceled(e);break;case 1:case 2:case 6:case 7:break;default:t._logger.error("unexpected participantState {request.participantState} unhandled")}})},t.prototype._resetControllerParticipant=function(e){var t=this;this._controllerParticipantSubscription&&(this._logger.info("_resetControllerParticipant: stopping tracking changes for "+this._controllerParticipant.participant.id),this._controllerParticipantSubscription.dispose(),this._controllerParticipantSubscription=null),e&&(this._logger.info("_resetControllerParticipant: tracking changes for "+e.participant.id),this._controllerParticipantSubscription=e.participant.changed(function(){3!==e.participant.state&&t.handleParticipantRemoved(e.participant.id)})),this._controllerParticipant=e},t.prototype.handleParticipantRemoved=function(e){if(this._participantSubscriptions[e]&&(this._logger.info("handleParticipantRemoved(): Stopping tracking state changes for "+e),this._participantSubscriptions[e].dispose(),delete this._participantSubscriptions[e]),this._isSharing()){if(this._controllerParticipant&&this._controllerParticipant.participant.id===e){this._logger.info("handleParticipantRemoved: controller left call, tearing down control session"),this._teardownSharerRemoteControl(),this.controlState=0,this._resetControllerParticipant();t={inControl:!1,id:e,terminatedReason:5};this.event("sharingControlChanged").raise(t)}this._raiseScreenSharingControlCapableEvent(!1,e)}else if(this._sharerParticipant&&this._sharerParticipant.id===e&&4===this.controlState){this._logger.info("handleParticipantRemoved: sharer left call, tearing down control session"),this._teardownViewerRemoteControl(),this.controlState=0;var t={inControl:!1,id:"",terminatedReason:6};this.event("sharingControlChanged").raise(t)}},t.prototype.callStateChanged=function(e){this._callState=e,this._recordViewerSessionTelemetry(function(t){return t.recordEvent(a.CALL_STATE,{state:e})},!1),this._recordSharerSessionTelemetry(function(t){return t.recordEvent(S.CALL_STATE,{state:e})},!1),3===e?this._handleCallConnected():7===e&&this._handleCallDisconnected()},t.prototype._handleCallConnected=function(){this._logger.info("handleCallConnected()"),this._pendingSharer&&(this.initControlForViewer(this._pendingSharer,this._pendingNegotiationTag),this._pendingSharer=null)},t.prototype._handleCallDisconnected=function(){this._logger.info("handleCallDisconnected()"),this._isSharing()?this.shutdownControlForSharer():this.shutdownControlForViewer()},t.prototype._videoSizeChanged=function(e,t){null!=this._controlCapturer&&this._controlCapturer.updateVideoSize(e,t)},t.prototype._onRenderStarted=function(){var e={action:11,terminatedReason:0};if(this._sharerParticipant){var t=this._getSharerDataSourceId();this._sendRequest(e,t)}else this._logger.error("Attempted to send sharing rendered message to null sharerParticipant")},t.prototype._setViewingRenderer=function(e,t){var n=this;try{this._screenSharingVideoRenderer=e,this._screenSharingVideoRendererSubscriptions.push(this._screenSharingVideoRenderer.on("videoSizeChanged",function(e,t){return n._videoSizeChanged(e,t)})),this._screenSharingVideoRendererSubscriptions.push(this._screenSharingVideoRenderer.on("renderStarted",function(){return n._onRenderStarted()}));var r=1;e.streamSize&&e.streamSize.width>0&&e.streamSize.height>0&&(r=e.streamSize.width/e.streamSize.height),this._controlCapturer=new s.SlimCoreElectronControlCapturer(this._logger,t,!0,r),4===this.controlState?(this._logger.info("_setViewingRenderer: detected local state is controlling"),this._setupViewerRemoteControl()):this._teardownViewerRemoteControl()}catch(e){this._logger.error("_setViewingRenderer: unable to set _screenSharingVideoRenderer error = "+e)}},t.prototype._isSharing=function(){return 1===this.role},t.prototype._isViewing=function(){return 2===this.role},t.prototype._createAndAttachControlDevices=function(){var e=this;if(this._logger.info("_createAndAttachControlDevices()"),y.hasCreateDataSource(this._slimcoreInstance)&&y.hasCreateDataSink(this._slimcoreInstance))if(this._dataChannel){var t=Promise.resolve(),n=Promise.resolve();this._controlDataSource||(this._controlDataSource=y.createDataSource(this._slimcoreInstance,SlimCore.Enums.DataDeviceId.Control),this._logger.info("created Control DataSource"),t=this._dataChannel.registerDataSource(this._controlDataSource).then(function(){return e._logger.info("registered Control DataSource")}).catch(function(t){return e._logger.error("registerDataSource threw exception: "+t)})),this._controlDataSink||(this._controlDataSink=y.createDataSink(this._slimcoreInstance,SlimCore.Enums.DataDeviceId.Control),this._logger.info("created Control DataSink"),n=this._dataChannel.registerDataSink(this._controlDataSink).then(function(){return e._logger.info("registered Control DataSink")}).catch(function(t){return e._logger.error("registerDataSink threw exception: "+t)})),Promise.all([t,n]).then(function(){e.controlDataChannelStatus.readyForControl=!0,e.event("controlDataChannelStateChanged").raise(e.controlDataChannelStatus)}),this._controlDataSink.on("data",function(t){e._controlInjector.injectRawInput(t.data,t.sourceID).catch(function(n){e._lastInjectRawInputErrorCount++,null===e._injectRawInputErrorTimer&&(e._injectRawInputErrorTimer=window.setTimeout(function(){var r={reason:1,detail:JSON.stringify({dataChannelId:e._dataChannel.id,sourceId:t&&t.sourceID,count:e._lastInjectRawInputErrorCount,errorMsg:n})};e.event("sharingControlError").raise(r),e._lastInjectRawInputErrorCount=0,e._injectRawInputErrorTimer=null},1e4))})})}else this._logger.warn("_createAndAttachControlDevices() null dataChannel");else this._logger.warn("createDataSource or createDataSink not implemented")},t.prototype._detachAndDeleteControlDevices=function(){var e=this;this._logger.info("_detachAndDeleteControlDevices()"),this._controlDataSink&&this._controlDataSink.removeAllListeners("data"),this._dataChannel?(this._controlDataSource&&(this._dataChannel.unregisterDataSource(this._controlDataSource).then(function(){return e._logger.info("Control DataSource unregistered")}).catch(function(t){return e._logger.warn("unregisterDataSource threw exception: "+t)}),this._controlDataSource=null,this._logger.info("deleted Control data source")),this._controlDataSink&&(this._dataChannel.unregisterDataSink(this._controlDataSink).then(function(){return e._logger.info("Control DataSink unregistered")}).catch(function(t){return e._logger.warn("unregisterDataSink threw exception: "+t)}),this._controlDataSink=null,this._logger.info("deleted Control data sink"))):this._logger.warn("_detachAndDeleteControlDevices() null dataChannel")},t.prototype.onDataChannelStatusChanged=function(e){var t=this;return u.asap(function(){return t._onDataChannelStatusChanged(e)})},t.prototype._onDataChannelStatusChanged=function(e){this._logger.info("Data channel status = "+e),this.controlDataChannelStatus.readyForControl=this.controlDataChannelStatus.readyForControl&&e===SlimCore.Enums.DataChannelStatus.Active,this.controlDataChannelStatus.state=c.default._mapDataChannelStatus(e),this.event("controlDataChannelStateChanged").raise(this.controlDataChannelStatus),e===SlimCore.Enums.DataChannelStatus.Active?this._enabled&&this._dataChannel&&!this._dataChannelActive&&(this._dataChannelActive=!0,this._recordViewerSessionTelemetry(function(e){return e.recordEvent(a.DATA_CHANNEL_AVAILABLE)},!1),this._recordSharerSessionTelemetry(function(e){return e.recordEvent(S.DATA_CHANNEL_AVAILABLE)},!1),this._createAndAttachControlDevices(),this._isViewing()?this._dataChannelAvailableSent||(this._sharerParticipant?(this._logger.info("_onDataChannelStatusChanged() sending Available message to sharer"),this._startAvailableHandshake()):this._logger.error("Unexpected null _sharerParticipant trying to send Available to sharer")):this._isSharing()&&this._raiseScreenSharingControlCapableEvent(!0,"")):this._dataChannel&&this._dataChannelActive&&(this._recordViewerSessionTelemetry(function(e){return e.recordEvent(a.DATA_CHANNEL_UNAVAILABLE)},!1),this._recordSharerSessionTelemetry(function(e){return e.recordEvent(S.DATA_CHANNEL_UNAVAILABLE)},!1),this._dataChannelActive=!1,this._dataChannelAvailableSent=!1,this._terminateAvailableHandshake&&this._terminateAvailableHandshake(3),this._detachAndDeleteControlDevices(),this._raiseScreenSharingControlCapableEvent(!1,""))},t.prototype._handleAvailableRequest=function(e,t,n){var r=this,i=!1,o=0;if(!1===this._enabled)this._logger.info("feature flag is off. no need to answer the available ack"),i=!0,o=9;else if(!1===this._availableAckEnabled)this._logger.info("available ack is off. no need to answer the available ack"),i=!0,o=9;else if(t&&t.id){if(this._allowControlForUser&&typeof this._allowControlForUser==typeof Function)return void this._allowControlForUser(t).then(function(a){a||(i=!0,o=1),r._sendResponseToAvailableRequest(e,t,n,i,o)})}else i=!0,o=10;this._sendResponseToAvailableRequest(e,t,n,i,o)},t.prototype._sendResponseToAvailableRequest=function(e,t,n,r,i){var o=this;r?(this._logger.info("Rejecting Available for handShake:"+n+":"+e.handshakeId),this.event("controlAvailableHandshake").raise(e.handshakeId,n,7,this._getAvailableHandshakeTerminatedFromControlTerminated(i)),this._sendRequest({action:10,terminatedReason:i,handshakeId:e.handshakeId},n)):(this._raiseScreenSharingControlCapableEvent(!0,t.id),this._participantSubscriptions[t.id]||(this._logger.info("Tracking participant status for "+t.id),this._participantSubscriptions[t.id]=t.changed(function(){3!==t.state&&(o._logger.info("Participant "+t.id+" is not connected. removing"),o.handleParticipantRemoved(t.id))})),this._logger.info("Acking Available for handShake:"+n+":"+e.handshakeId),this.event("controlAvailableHandshake").raise(e.handshakeId,n,3),this._sendRequest({action:9,terminatedReason:0,handshakeId:e.handshakeId},n))},t.prototype.processProtocolMessage=function(e,t,n,r){var i=this;return u.asap(function(){return i._processProtocolMessage(e,t,n,r)})},t.prototype._raiseControlRequestCanceled=function(e){this.event("sharingIncomingControlRequestCancelled").raise(e.participant.id)},t.prototype._processProtocolMessage=function(e,t,n,r){var i;this._recordProtocolMessage(t,r);try{i=JSON.parse(e)}catch(e){return void this._logger.error("Error parsing controlMessage")}if(this._logger.info("_processProtocolMessage action="+i.action+" sender="+r),t||this._logger.warn("protocol message from unknown sender with sourceId="+r),0===i.action)this._handleAvailableRequest(i,t,r);else if(1===i.action)!1===this._enabled?(this._logger.warn("Sharer control is disabled - rejecting request"),this._sendRequest({action:4,terminatedReason:9},r)):this._controlRequest?(this._logger.warn("Sharer is already processing a control request...rejecting new requests"),this._sendRequest({action:4,terminatedReason:3},r)):this._controllerParticipant&&this._controllerParticipant.participant===t?this._controllerParticipant.participantId&&this._controllerParticipant.participantId!==n?(this._logger.warn("rejecting control request from second endpoint. participantId: "+n),this._sendRequest({action:4,terminatedReason:3},r)):(this._logger.warn("Got control request for someone already in control"),this._sendRequest({action:3,terminatedReason:0},r)):t?this._resetControlRequest({participant:t,participantState:t.state,participantId:n}):this._logger.error("Got ControlRequest message but could not find a sender participant, ignoring");else if(3===i.action)1===this.controlState?((s=this._sendRequest({action:5,terminatedReason:0},r))?(this._setupViewerRemoteControl(),this.controlState=4,this._requestControlPromise?this._requestControlPromise.resolve():this._logger.error("Unexpected, no promise could be resolved - state =ControlState.RequestSent action ="+i.action)):this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control is accepted, but fail to send ack"}))):this._logger.error("Unexpected, no promise could be resolved - state ="+this.controlState+" action ="+i.action),this._cancelRequestControlTimer()):this._logger.warn("AcceptRequest message received in controlState="+this.controlState);else if(4===i.action)if(1===this.controlState){this.controlState=0;u={inControl:!1,id:"",terminatedReason:i.terminatedReason};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:u,details:""}))):this._logger.error("Unexpected, no promise could be resolved - state =ControlState.RequestSent action ="+i.action),this._cancelRequestControlTimer()}else this._logger.warn("RejectRequest message received in controlState="+this.controlState+" reason="+i.terminatedReason);else if(2===i.action){if(this._controlRequest){var o=this._controlRequest;this._clearControlRequest(),this._raiseControlRequestCanceled(o)}}else if(6===i.action){var s=this._sendRequest({action:5,terminatedReason:0},r);if(s){this._setupViewerRemoteControl(),this.controlState=4;u={inControl:!0,id:"",terminatedReason:i.terminatedReason};this.event("sharingControlChanged").raise(u)}}else if(5===i.action)if(2===this.controlState)if(this._controllerParticipant&&this._controllerParticipant.participant===t){var c=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);r!==c&&this._logger.warn("acknowledging source id: "+r+" does not match requesting source id: "+c),this._logger.info("Setting up remote control for controller source id="+c),this._setupSharerRemoteControl(c),this.controlState=3;u={inControl:!0,id:this._controllerParticipant.participant.id,terminatedReason:i.terminatedReason};this.event("sharingControlChanged").raise(u),this._grantControlPromise?(this._grantControlPromise.resolve(),this._cancelGrantControlTimer()):this._acceptControlPromise?(this._acceptControlPromise.resolve(),this._cancelAcceptControlTimer()):this._logger.error("Unexpected, no promise could be resolved - state =ControlState.WaitingForControlAck action ="+i.action)}else t?this._logger.warn("Ignoring ack from participant that does not match controller id = "+h.scrubMriOrOmit(t.id)):this._logger.warn("Ignoring ack from null participant source id = "+r);else 5===this.controlState?(this.controlState=0,this._resetControllerParticipant(),this._terminateControlPromise?(this._terminateControlPromise.resolve(),this._cancelTerminateControlTimer()):this._logger.error("Unexpected, no promise could be resolved - state =ControlState.WaitingForTerminateAck action ="+i.action)):this._logger.warn("Unexpected ack in control state = "+this.controlState);else if(7===i.action||8===i.action){var l=void 0;this._isViewing()?(this._teardownViewerRemoteControl(),l=""):(this._teardownSharerRemoteControl(),t?l=t.id:this._logger.error("Got terminate message but could not find a sender participant!")),this.controlState=0,this._resetControllerParticipant();var u={inControl:!1,id:l,terminatedReason:i.terminatedReason};this.event("sharingControlChanged").raise(u),8===i.action&&this._sendRequest({action:5,terminatedReason:0},r)}else if(9===i.action)this._terminateAvailableHandshake&&this._terminateAvailableHandshake(1,i.handshakeId),this._raiseScreenSharingControlCapableEvent(!0,"");else if(10===i.action){if(this._viewerSessionLastTerminatedReason=i.terminatedReason,this._recordViewerSessionTelemetry(function(e){return e.updateOperationData(a.AVAILABLE_HANDSHAKE,{nackReason:i.terminatedReason},i.handshakeId)}),10===i.terminatedReason)return;this._terminateAvailableHandshake&&this._terminateAvailableHandshake(this._getAvailableHandshakeTerminatedFromControlTerminated(i.terminatedReason),i.handshakeId),1===i.terminatedReason?this._raiseScreenSharingControlCapableEvent(!0,"",!0):this._raiseScreenSharingControlCapableEvent(!1,"")}else 11===i.action?this._raiseRenderedAtViewer&&(t?this._raiseRenderedAtViewer(t.id):this._logger.error("Got RenderedAtViewer message but could not find a sender participant!")):this._logger.error("Unknown request action received on control protocol data sink, action="+i.action)},t.prototype._getAvailableHandshakeTerminatedFromControlTerminated=function(e){switch(e){case 10:return 6;case 1:return 7;case 9:default:return 0}},t.prototype._sendRequest=function(e,t){var n=!1,r=this._protocolDataSource;if(t<0)return this._logger.error("Unexpected: invalid sourceID="+t),n;if(r){this._logger.info("sending control message action="+e.action+" to sourceID="+t);var i={type:0,message:JSON.stringify(e)};try{var o=[t];r.sendData(y.stringToBuffer(JSON.stringify(i)),o),n=!0}catch(e){this._logger.error("Unexpected: failure in call to sendData. Error="+e);var a={reason:5,detail:JSON.stringify({sourceId:t,errorMsg:e})};this.event("sharingControlError").raise(a)}}else this._logger.error("Unexpected: null dataSource in _sendRequest");return n},t.prototype._resetControlState=function(){this._logger.info("_resetControlState()"),this.controlState=0,this._resetControllerParticipant(),this._sharerParticipant=null,this._clearControlRequest(),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer()},t.prototype._setupSharerRemoteControl=function(e){var t=this;this._logger.info("_setupSharerRemoteControl() sourceId="+e),this._setInjectorMode(1),this._controlInjector.allowSingleController(e).catch(function(n){var r={reason:3,detail:JSON.stringify({sourceId:e,errorMsg:n})};t.event("sharingControlError").raise(r)})},t.prototype._teardownSharerRemoteControl=function(){var e=this;this._logger.info("_teardownSharerRemoteControl()"),this._controlInjector.allowSingleController(0).catch(function(t){var n={reason:3,detail:JSON.stringify({sourceId:0,errorMsg:t})};e.event("sharingControlError").raise(n)}),this._setInjectorMode(0)},t.prototype._setupViewerRemoteControl=function(){this._logger.info("_setupViewerRemoteControl()"),this._setCapturerMode(3)},t.prototype._teardownViewerRemoteControl=function(){this._logger.info("_teardownViewerRemoteControl()"),this._setCapturerMode(0)},t.prototype._setInjectorMode=function(e){var t=this;this._logger.info("_setInjectorMode() mode="+e);var n={mode:e,noMotionTimeoutMs:0,noMotionSharerTimeoutMs:0};this._controlInjector.setInjectorConfig(n).catch(function(n){var r={reason:0,detail:JSON.stringify({mode:e,errorMsg:n})};t.event("sharingControlError").raise(r)})},t.prototype._clearCapturerEventSubscriptions=function(){this._logger.info("_clearCapturerEventSubscriptions()"),this._captureEventSubscription&&(this._captureEventSubscription.dispose(),this._captureEventSubscription=null),this._mouseControlEventSubscription&&(this._mouseControlEventSubscription.dispose(),this._mouseControlEventSubscription=null),this._keyboardControlEventSubscription&&(this._keyboardControlEventSubscription.dispose(),this._keyboardControlEventSubscription=null)},t.prototype.sendRemoteControlEvent=function(e,t){if(t)switch(e){case"mouseControlEvent":this._sendControlEvent(s.SlimCoreElectronControlCapturer.formatMouseEvent(t));break;case"keyboardControlEvent":this._sendControlEvent(s.SlimCoreElectronControlCapturer.formatKeyboardEvent(t));break;default:return void this._logger.error("sendRemoteControlEvent: Invalid type = ",e)}else this._logger.error("sendRemoteControlEvent: Invalid argument.")},t.prototype._sendControlEvent=function(e){if(this._controlDataSource&&this._sharerParticipant&&4===this.controlState){var t=[this._getSharerDataSourceId()];this._controlDataSource.sendData(e,t)}else this._logger.error("_sendControlEvent: Data channel not set up / Not in control (",!!this._controlDataSource,!!this._sharerParticipant,4!==this.controlState,")")},t.prototype._setCapturerMode=function(e){var t=this;this._logger.info("_setCapturerMode() capturerMode="+e),this._controlCapturer?(this._controlCapturer.setCaptureMode(e),this._clearCapturerEventSubscriptions(),1===e?this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",function(e){0===e&&t.event("sharingRendererClicked").raise()}):2===e?this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",function(e){1===e?t.event("sharingRendererMouseEntering").raise():2===e&&t.event("sharingRendererMouseLeaving").raise()}):3===e&&(this._mouseControlEventSubscription=this._controlCapturer.on("mouseControlEvent",function(e){return t._sendControlEvent(s.SlimCoreElectronControlCapturer.formatMouseEvent(e))}),this._keyboardControlEventSubscription=this._controlCapturer.on("keyboardControlEvent",function(e){return t._sendControlEvent(s.SlimCoreElectronControlCapturer.formatKeyboardEvent(e))}),this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",function(e){1===e?t.event("sharingRendererMouseEntering").raise():2===e&&t.event("sharingRendererMouseLeaving").raise()}))):this._logger.warn("_controlCapturer not found when trying to setup viewer capture mode")},t.prototype.setPointerImage=function(e,t){return this._logger.warn("setPointerImage is deprecated. Use setLocalPointerImage or setRemotePointerImage"),e?this.setRemotePointerImage(e,t):this.setLocalPointerImage(t)},t.prototype.setLocalPointerImage=function(e){return 0===e.length?Promise.reject(new Error("setLocalPointerImage invalid image length")):this._setPointerImage(0,e)},t.prototype.setRemotePointerImage=function(e,t){return i(this,void 0,void 0,function(){var n,r,i,a;return o(this,function(o){switch(o.label){case 0:if(!e)throw new Error("setRemotePointerImage participant is null");if(0===t.length)throw new Error("setRemotePointerImage invalid image length");if(e.enableParticipantLegToSourceIdMapping)return[3,2];if((a=this._mapParticipantToSourceId(e))<0)throw new Error("setRemotePointerImage unable to map participant to sourceId");return[4,this._setPointerImage(a,t)];case 1:return o.sent(),[2];case 2:if(0===(n=this._getParticipantsDataSourceIds(e)).length)throw new Error("setRemotePointerImage unable to map participant to sourceIds");this._logger.info("set pointer image for "+n.length+" sources"),r=0,i=n,o.label=3;case 3:return r<i.length?(a=i[r],[4,this._setPointerImage(a,t)]):[3,6];case 4:o.sent(),o.label=5;case 5:return r++,[3,3];case 6:return[2]}})})},t.prototype._setPointerImage=function(e,t){return this._isSharing()||this._logger.warn("_setPointerImage called when not sharing"),this._controlInjector.setAvatar(y.stringToBuffer(t),e)},t.prototype.startPointerMode=function(){var e=this;return this._dataChannelActive?0!==this.controlState?Promise.reject(new Error("startPointerMode called in bad control state="+this.controlState)):this._isViewing()?u.asap(function(){return e._setCapturerMode(2)}):Promise.reject(new Error("startPointerMode when not viewing")):Promise.reject(new Error("startPointerMode when data channel not active"))},t.prototype.stopPointerMode=function(){var e=this;return 0!==this.controlState?Promise.reject(new Error("stopPointerMode called in bad control state="+this.controlState)):this._isViewing()?u.asap(function(){return e._setCapturerMode(1)}):Promise.reject(new Error("stopPointerMode when not viewing"))},t.prototype._startAvailableHandshake=function(){var e=this,t=this._getSharerDataSourceId();t<0&&this._logger.warn("sharer: "+this._sharerParticipant+" has no data channel");var n=p.default();this._logger.info("_startAvailableHandshake() - handshakeId: "+t+":"+n),this.event("controlAvailableHandshake").raise(n,t,1),this._terminateAvailableHandshake&&(this._logger.warn("Replacing existing availble handshake"),this._terminateAvailableHandshake(4)),this._recordViewerSessionTelemetry(function(e){return e.recordOperation(a.AVAILABLE_HANDSHAKE,n)}),this._sendRequest({action:0,terminatedReason:0,handshakeId:n},t)||this._logger.error("Failed to send Available message to sharer, will retry after backoff"),this._dataChannelAvailableSent=!0,this._waitForAvailableAck(n),this._terminateAvailableHandshake=function(r,i){void 0===r&&(r=0),e._logger.info("_terminateAvailableHandshake() - handshakeId: "+t+":"+n+", status: "+r),e._recordViewerSessionTelemetry(function(t){return t.updateOperationData(a.AVAILABLE_HANDSHAKE,{tries:e._retryAttempt},i)}),1===r?e._recordViewerSessionTelemetry(function(e){return e.recordOperationSuccess(a.AVAILABLE_HANDSHAKE,null,"",i)}):(e._logger.error("GTC handshake failed with code "+r+", last message: "+e._viewerSessionLastTerminatedReason),f.RootToolsManager.logExternalForDDL("GTC handshake failed with code "+r+",",e._viewerSessionLastTerminatedReason.toString()),e._recordViewerSessionTelemetry(function(e){return e.recordOperationFailure(a.AVAILABLE_HANDSHAKE,{reason:r},"",i)})),e._terminateAvailableHandshake=null,e.event("controlAvailableHandshake").raise(n,t,1===r?5:6,r),i&&i!==n&&e._logger.warn("AvailableSeries: Got handshake from another series - expected: "+n+", received: "+i),e._availableAckTimer&&(clearTimeout(e._availableAckTimer),e._availableAckTimer=null),e._retryAttempt=0}},t.prototype._waitForAvailableAck=function(e){var t=this;this._logger.info("_waitForAvailableAck()"),this._availableAckTimer=window.setTimeout(function(){t._logger.warn("No Ack received for Available message from attempt="+t._retryAttempt),t._availableAckTimer=null;var n=t._getSharerDataSourceId();if(t._retryAttempt<=6)t._logger.info("Re-sending Available message handshakeId: "+n+":"+e),t.event("controlAvailableHandshake").raise(e,n,2),t._sendRequest({action:0,terminatedReason:0,handshakeId:e},n),t._waitForAvailableAck(e);else if(t._logger.error("Reached Available retry limit! Control capability will be false"),t._terminateAvailableHandshake)t._terminateAvailableHandshake(5);else{var r={reason:4,detail:JSON.stringify({sourceId:n,errorMsg:"Timed out after "+t._retryAttempt+" tries"})};t.event("sharingControlError").raise(r)}},2e3*++this._retryAttempt)},t.prototype.requestControl=function(){return this._dataChannelActive?0!==this.controlState?Promise.reject(new Error("requestControl called in bad state="+this.controlState)):this._isViewing()?this._sharerParticipant?this._requestControlPromise?Promise.reject(new Error("request control promise has not been resolved yet while requesting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while requesting control")):this._requestControl():Promise.reject(new Error("requestControl unexpected null sharer")):Promise.reject(new Error("requestControl when not viewing")):Promise.reject(new Error("requestControl when data channel not active"))},t.prototype._requestControl=function(){var e=this;this._logger.info("_requestControl()"),this._requestControlPromise=u.defer();var t=function(){e._requestControlPromise=null};this._requestControlPromise.promise.then(t,t);var n=this._getSharerDataSourceId();if(!this._sendRequest({action:1,terminatedReason:0},n)){var r={inControl:!1,id:"",terminatedReason:7};return this._requestControlPromise.reject(new Error),Promise.reject(new Error(JSON.stringify({controlInfo:r,details:""})))}return this.controlState=1,this._requestControlTimer=window.setTimeout(function(){if(1===e.controlState){e.controlState=0,e._logger.warn("No response to control request - canceling"),e._sendRequest({action:2,terminatedReason:2},n)||e._logger.error("fail to send the cancel control request");var t={inControl:!1,id:"",terminatedReason:2};e._requestControlPromise?e._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:t,details:"we did not get any response to the control - terminating control"}))):e._logger.error("Unexpected, no promise could be resolved - controlState = ControlState.RequestSent")}else e._requestControlPromise?e._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control - times out in bad state - do nothing"}))):e._logger.error("Unexpected, no promise could be resolved - controlState = "+e.controlState);e._requestControlTimer=null},3e4),this._requestControlPromise.promise},t.prototype._cancelRequestControlTimer=function(){this._requestControlTimer&&(this._requestControlPromise&&this._requestControlPromise.reject(new Error("cancelled by _cancelRequestControlTimer")),clearTimeout(this._requestControlTimer),this._requestControlTimer=null)},t.prototype.cancelControl=function(){return this._dataChannelActive?1!==this.controlState?Promise.reject(new Error("cancelControl called in bad state="+this.controlState)):this._isViewing()?this._sharerParticipant?this._requestControlPromise?this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while cancelling control")):this._cancelControl():Promise.reject(new Error("request control promise has been resolved while cancelling control")):Promise.reject(new Error("cancelControl unexpected null sharer")):Promise.reject(new Error("cancelControl when not viewing")):Promise.reject(new Error("cancelControl when data channel not active"))},t.prototype._cancelControl=function(){this._logger.info("_cancelControl()");var e=this._getSharerDataSourceId();if(1!==this.controlState)return Promise.reject(new Error("cancel control - in bad state - do nothing"));if(this._cancelRequestControlTimer(),this.controlState=0,this._logger.info("Viewer cancel the control"),!this._sendRequest({action:2,terminatedReason:8},e))return Promise.reject(new Error("fail to send cancel control request"));var t={inControl:!1,id:"",terminatedReason:8};return this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:t,details:""}))),new Promise(function(e,t){e()})},t.prototype.acceptControlRequest=function(){return this._dataChannelActive?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while accepting control")):this._grantControlPromise?Promise.reject(new Error("grant control promise has not been resolved yet while accepting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while accepting control")):this._acceptControlRequest():Promise.reject(new Error("acceptControlRequest when not sharing")):Promise.reject(new Error("acceptControlRequest while no control request pending")):Promise.reject(new Error("acceptControlRequest when data channel not active"))},t.prototype._acceptControlRequest=function(){var e=this;this._logger.info("_acceptControlRequest()"),this._acceptControlPromise=u.defer();var t=function(){e._acceptControlPromise=null};if(this._acceptControlPromise.promise.then(t,t),this._controllerParticipant){this._logger.warn("_acceptControlRequest called while another participant already has control - terminating control"),this._teardownSharerRemoteControl();var n=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},n)||this._logger.error("fail to send the terminateNoAck request"),this._resetControllerParticipant()}var r=this._getDataSourceIdForParticipantLeg(this._controlRequest),i=this._controlRequest.participant.id;return this._sendRequest({action:3,terminatedReason:0},r)?(this._resetControllerParticipant(this._controlRequest),this._clearControlRequest(),this.controlState=2,this._acceptControlTimer=window.setTimeout(function(){if(2===e.controlState){e.controlState=0,e._resetControllerParticipant(),e._logger.error("No ack received when accepting control request - terminating control"),e._sendRequest({action:7,terminatedReason:4},r)||e._logger.error("fail to send the TerminateNoAck request");var t={inControl:!1,id:i,terminatedReason:4};e.event("sharingControlChanged").raise(t),e._acceptControlPromise?e._acceptControlPromise.reject(new Error("No ack received when accept control - terminating control")):e._logger.error("Unexpected, no promise could be resolved - controlState = ControlState.WaitingForControlAck")}else e._acceptControlPromise?e._acceptControlPromise.reject(new Error("accept control - times out in bad state - do nothing")):e._logger.error("Unexpected, no promise could be resolved - controlState = "+e.controlState);e._acceptControlTimer=null},1e4),this._acceptControlPromise.promise):(this._logger.error("fail to send the accept control request"),this._acceptControlPromise.reject(new Error),Promise.reject(new Error("fail to send the accept control request!")))},t.prototype._cancelAcceptControlTimer=function(){this._acceptControlTimer&&(this._acceptControlPromise&&this._acceptControlPromise.reject(new Error("cancelled by _cancelAcceptControlTimer")),clearTimeout(this._acceptControlTimer),this._acceptControlTimer=null)},t.prototype.denyControlRequest=function(){return this._dataChannelActive?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while denying control")):this._grantControlPromise?Promise.reject(new Error("grant control promise has not been resolved yet while denying control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while denying control")):this._denyControlRequest():Promise.reject(new Error("denyControlRequest when not sharing")):Promise.reject(new Error("denyControlRequest while no control request pending")):Promise.reject(new Error("denyControlRequest when data channel not active"))},t.prototype._denyControlRequest=function(){this._logger.info("_denyControlRequest()");var e=this._getDataSourceIdForParticipantLeg(this._controlRequest);return this._clearControlRequest(),this._sendRequest({action:4,terminatedReason:1},e)?new Promise(function(e,t){e()}):Promise.reject(new Error("fail to send the deny control requst"))},t.prototype.grantControl=function(e){return this._dataChannelActive?this._controlRequest?Promise.reject(new Error("grantControl called while control request pending")):this._isSharing()?e?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while granting control")):this._grantControlPromise?Promise.reject(new Error("grant control promise has not been resolved yet while granting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while granting control")):this._grantControl(e):Promise.reject(new Error("grantControl null participant")):Promise.reject(new Error("grantControl when not sharing")):Promise.reject(new Error("grantControl when data channel not active"))},t.prototype._grantControl=function(e){var t=this;this._logger.info("_grantControl()"),this._grantControlPromise=u.defer();var n=function(){t._grantControlPromise=null};if(this._grantControlPromise.promise.then(n,n),3===this.controlState){if(this._controllerParticipant.participant===e)return this._logger.warn("grantControl called for participant who already has control"),this._grantControlPromise.resolve(),new Promise(function(e,t){e()});this._logger.warn("_grantControl called while another participant already has control - terminating control"),this._teardownSharerRemoteControl();var r=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},r)||this._logger.error("fail to send the terminateNoAck request")}var i=this._mapParticipantToSourceId(e);if(!this._sendRequest({action:6,terminatedReason:0},i))return this._logger.error("fail to send the grant control request"),this._grantControlPromise.reject(new Error),Promise.reject(new Error("fail to send the grant control request!"));var o=this._getParticipantIdForDataSourceId(e,i);return this._resetControllerParticipant({participant:e,participantState:e.state,participantId:o}),this.controlState=2,this._grantControlTimer=window.setTimeout(function(){2===t.controlState?(t.controlState=0,t._resetControllerParticipant(),t._logger.error("No ack received when granting control - terminating control"),t._sendRequest({action:7,terminatedReason:4},i)||t._logger.error("fail to send the terminateNoAck request"),t._grantControlPromise?t._grantControlPromise.reject(new Error("No ack received when granting control - terminating control")):t._logger.error("Unexpected, no promise could be resolved - controlState = ControlState.WaitingForControlAck")):t._grantControlPromise?t._grantControlPromise.reject(new Error("grant control - times out in bad state - do nothing")):t._logger.error("Unexpected, no promise could be resolved - controlState = "+t.controlState),t._grantControlTimer=null},1e4),this._grantControlPromise.promise},t.prototype._cancelGrantControlTimer=function(){this._grantControlTimer&&(this._grantControlPromise&&this._grantControlPromise.reject(new Error("cancelled by _cancelGrantControlTimer")),clearTimeout(this._grantControlTimer),this._grantControlTimer=null)},t.prototype._mapParticipantToSourceId=function(e){return this._dataChannel?e.getSourceIdForMediaType(3):(this._logger.error("Null data channel cannot map participant to source id"),-1)},t.prototype._getParticipantsDataSourceIds=function(e){var t=[];try{if(e&&e.endpoints&&e.endpoints.endpointDetails){if(!(1!==e.endpoints.endpointDetails.length||(i=e.endpoints.endpointDetails[0])&&i.mediaStreams))return t.push(m.DATA_SOURCE_ID_ANY),t;for(var n=0,r=e.endpoints.endpointDetails;n<r.length;n++){var i=r[n];if(i&&i.mediaStreams)for(var o=0,a=i.mediaStreams;o<a.length;o++){var s=a[o];if(3===v.mapMediaTypeStringToMediaType(s.type)){if(t.push(s.sourceId),t.length>=8)return this._logger.error("excessive amount of data streams"),t;break}}}}}catch(e){this._logger.error("_getParticipantsDataSourceIds caught exception error="+e)}return t},t.prototype._getParticipantIdForDataSourceId=function(e,t){return e.getParticipantIdForSourceId(3,t)},t.prototype._getDataSourceIdForParticipantId=function(e,t){return this._dataChannel?e.getSourceId(t,3):(this._logger.error("Null data channel cannot map participant to source id"),-1)},t.prototype._getDataSourceIdForParticipantLeg=function(e){return this._getDataSourceIdForParticipantId(e.participant,e.participantId)},t.prototype._getSharerDataSourceId=function(){var e=this._sharerParticipant.getSharingParticipantLeg();return e?this._getDataSourceIdForParticipantId(this._sharerParticipant,e):(this._logger.warn("unable to identify the sharer participantId, falling back to first data channel"),this._mapParticipantToSourceId(this._sharerParticipant))},t.prototype.terminateControl=function(){if(this._isViewing()){if(4!==this.controlState)return Promise.reject(new Error("terminateControl called while not in control"));if(!this._sharerParticipant)return Promise.reject(new Error("terminateControl called but _sharerParticipant is null"))}else{if(!this._isSharing())return Promise.reject(new Error("terminateControl called but not sharing nor viewing"));if(!this._controllerParticipant)return Promise.reject(new Error("terminateControl called but controllerParticipant is null"))}return this._requestControlPromise?Promise.reject(new Error("request control promise has not been resolved yet while terminating control")):this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while terminating control")):this._grantControlPromise?Promise.reject(new Error("grant control promise has not been resolved yet while terminating control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while terminating control")):this._terminateControl()},t.prototype._terminateControl=function(e){var t=this;void 0===e&&(e=!0),this._logger.info("_terminateControl()"),this._terminateControlPromise=u.defer();var n=function(){t._terminateControlPromise=null};this._terminateControlPromise.promise.then(n,n);var r,i,o=0,a=e?8:7;if(this._isViewing()){if(4!==this.controlState)return this._logger.error("Local viewer called terminateControl when not controlling"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local viewer called terminateControl when not controlling"));this._teardownViewerRemoteControl(),o=6,r=this._getSharerDataSourceId(),i=""}else{if(3!==this.controlState||!this._controllerParticipant)return this._logger.error("Local sherer called terminateControl when no one is in control"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local sherer called terminateControl when no one is in control"));this._teardownSharerRemoteControl(),o=5,r=this._getDataSourceIdForParticipantLeg(this._controllerParticipant),i=this._controllerParticipant.participant.id}if(!this._sendRequest({action:a,terminatedReason:o},r)){if(e)return this._logger.error("fail to send the terminate control request"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("fail to send the grant control request!"));this._logger.error("fail to send the terminateNoAck request")}this.controlState=e?5:0;var s={inControl:!1,id:i,terminatedReason:o};return this.event("sharingControlChanged").raise(s),e?(this._terminateControlTimer=window.setTimeout(function(){5===t.controlState?(t.controlState=0,t._resetControllerParticipant(),t._logger.error("No ack received when terminating control - resending terminate request"),t._sendRequest({action:7,terminatedReason:4},r)||t._logger.error("fail to send the terminateNoAck request"),t._terminateControlPromise?t._terminateControlPromise.reject(new Error("No ack received when terminating control - resending terminate request")):t._logger.error("Unexpected, no promise could be resolved - controlState = ControlState.WaitingForTerminateAck")):t._terminateControlPromise?t._terminateControlPromise.reject(new Error("terminate control - times out in bad state - do nothing")):t._logger.error("Unexpected, no promise could be resolved - controlState = "+t.controlState),t._terminateControlTimer=null},1e4),this._terminateControlPromise.promise):(this._terminateControlPromise.resolve(),new Promise(function(e,t){e()}))},t.prototype._cancelTerminateControlTimer=function(){this._terminateControlTimer&&(this._terminateControlPromise&&this._terminateControlPromise.reject(new Error("cancelled by _cancelTerminateControlTimer")),clearTimeout(this._terminateControlTimer),this._terminateControlTimer=null)},t.prototype._disposeControlCapturer=function(e){void 0===e&&(e=_.generateCauseId()),this._logger.info("_disposeControlCapturer causeId: "+e),this._clearCapturerEventSubscriptions(),this._controlCapturer&&(this._controlCapturer.dispose(e),this._controlCapturer=null)},t.prototype.dispose=function(t){this._logger.info("dispose causeId: "+t),this._detachAndDeleteControlDevices(),this._resetControlState(),this._dataChannel&&(this._dataChannel=null),this._disposeRenderer(t),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer(),this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._resetParticipantSubscriptions(),this._finalizeViewerSessionTelemetry(a.SESSION_SHUTDOWN),this._finalizeSharerSessionTelemetry(S.SESSION_SHUTDOWN),e.prototype.dispose.call(this,t)},t}(C.default);t.default=E},function(e,t,n){!function(t,r){e.exports=r(n(7))}(window,function(e){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(t){return e[t]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function r(e){switch(e){case 0:return 0;case 2:return 1;case 1:return 2;default:return}}var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.SlimCoreElectronControlCapturer=void 0;var o=n(2),a=n(6),s=250,c=function(e){function t(t,n,i,o){void 0===i&&(i=!0),void 0===o&&(o=1);var a=e.call(this)||this;return a._logger=t,a._element=n,a._captureRegionPreserveAspectRatio=i,a._mouseMoveCount=0,a._mouseMoveStartTime=0,a._isMouseDown=!1,a._isMouseOnRenderer=!1,a._captureMode=0,a._pollTimerID=0,a._resizeTimerID=0,a._mouseMoveThrottlingEnabled=!1,a._handleResizeEvents=function(){clearTimeout(a._resizeTimerID),a._resizeTimerID=window.setTimeout(function(){return a.updateCaptureRegion()},s)},a._handleMouseLeave=function(e){!a._isOnScreenContent(e)&&a._isMouseOnRenderer&&(a._raiseCaptureEvent(2),a._logger.info("Mouse leaving render region")),a._isMouseOnRenderer=!1},a._handleMouseEnter=function(e){a._isOnScreenContent(e)&&(a._isMouseOnRenderer=!0,a._raiseCaptureEvent(1),a._logger.info("Mouse entering render region"))},a._handleLosingFocus=function(e){a._syncKeyStates(!0)},a._handleClick=function(e){a._isOnScreenContent(e)&&(a._raiseCaptureEvent(0),a._logger.info("Mouse clicked"))},a._handleMouseMove=function(e){if(!a._isOnScreenContent(e)&&a._isMouseOnRenderer)return a._raiseCaptureEvent(2),a._isMouseOnRenderer=!1,void a._logger.info("Mouse leaving render region");if(a._isOnScreenContent(e)&&!a._isMouseOnRenderer&&(a._raiseCaptureEvent(1),a._isMouseOnRenderer=!0,a._logger.info("Mouse entering render region")),2===a._captureMode||3===a._captureMode){if(a._mouseMoveCount++,a._mouseMoveThrottlingEnabled){if(!a._isOnScreenContent(e)||!a._shouldMoveMouse())return}else if(!a._isOnScreenContent(e)||a._mouseMoveCount%2==0)return;var t={type:0};a._normalizeMousePosition(e,t),a._raiseMouseEvent(t)}},a._handleMouseDown=function(e){if((2===a._captureMode||3===a._captureMode)&&a._isOnScreenContent(e)){var t={type:2,buttonType:r(e.button),buttonDown:!0};a._isMouseDown=!0,a._normalizeMousePosition(e,t),a._raiseMouseEvent(t)}},a._handleMouseUp=function(e){if((2===a._captureMode||3===a._captureMode)&&a._isOnScreenContent(e)){var t={type:2,buttonType:r(e.button),buttonDown:!1};a._isMouseDown=!1,a._normalizeMousePosition(e,t),a._raiseMouseEvent(t)}},a._handleKeyDown=function(e){a._raiseKeyboardEvent({codeType:1,code:e.keyCode,repeat:e.repeat,keyUp:!1}),e.stopPropagation(),e.preventDefault()},a._handleKeyUp=function(e){a._raiseKeyboardEvent({codeType:1,code:e.keyCode,repeat:e.repeat,keyUp:!0}),e.stopPropagation(),e.preventDefault()},a._handleWheel=function(e){a._raiseMouseEvent({type:1,wheelRotation:e.deltaY>0?-120:120})},a._handleContextMenu=function(e){e.preventDefault()},a._ensureCanReceiveKeyboardInput(),a._element.ownerDocument&&a._element.ownerDocument.defaultView&&a._element.ownerDocument.defaultView.addEventListener("resize",a._handleResizeEvents,!1),a._captureRegion={left:0,top:0,width:a._element.clientWidth,height:a._element.clientHeight},a._videoSize={width:Math.floor(n.clientHeight*o),height:n.clientHeight},a._origElementSize={width:0,height:0},a._checkElementSize(),a._mouseMoveStartTime=new Date(0).getTime(),a}return i(t,e),Object.defineProperty(t.prototype,"captureMode",{get:function(){return this._captureMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"captureRegion",{get:function(){return this._captureRegion},enumerable:!1,configurable:!0}),t.prototype.setMouseMoveThrottlingFeatureFlag=function(e){this._mouseMoveThrottlingEnabled=e},t.prototype.dispose=function(t){this._logger.info("dispose causeId: "+t),window.clearTimeout(this._pollTimerID),this._element.ownerDocument&&this._element.ownerDocument.defaultView&&this._element.ownerDocument.defaultView.removeEventListener("resize",this._handleResizeEvents,!1),e.prototype.dispose.call(this,t)},t.prototype.updateVideoSize=function(e,t){this._videoSize.width=e,this._videoSize.height=t,this.updateCaptureRegion()},t.prototype.updateCaptureRegion=function(){this._captureRegionPreserveAspectRatio?(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientWidth*this._videoSize.height/this._videoSize.width,this._captureRegion.height>this._element.clientHeight?(this._captureRegion.width=this._element.clientHeight*this._videoSize.width/this._videoSize.height,this._captureRegion.height=this._element.clientHeight,this._captureRegion.left=(this._element.clientWidth-this._captureRegion.width)/2,this._captureRegion.top=0):(this._captureRegion.left=0,this._captureRegion.top=(this._element.clientHeight-this._captureRegion.height)/2)):(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientHeight,this._captureRegion.top=0,this._captureRegion.left=0)},t.prototype.setCaptureMode=function(e){3===this._captureMode&&3!==e&&this._syncKeyStates(!0),this._captureMode=e,0!==e?(this._element.addEventListener("click",this._handleClick),this._element.addEventListener("pointermove",this._handleMouseMove),this._element.addEventListener("pointerdown",this._handleMouseDown),this._element.addEventListener("pointerup",this._handleMouseUp),this._element.addEventListener("pointerenter",this._handleMouseEnter),this._element.addEventListener("pointerleave",this._handleMouseLeave),3===e?(this._element.addEventListener("wheel",this._handleWheel),this._element.addEventListener("keydown",this._handleKeyDown),this._element.addEventListener("keyup",this._handleKeyUp),this._element.addEventListener("contextmenu",this._handleContextMenu),this._element.addEventListener("blur",this._handleLosingFocus)):(this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))):(this._element.removeEventListener("pointermove",this._handleMouseMove),this._element.removeEventListener("pointerdown",this._handleMouseDown),this._element.removeEventListener("pointerup",this._handleMouseUp),this._element.removeEventListener("pointerenter",this._handleMouseEnter),this._element.removeEventListener("pointerleave",this._handleMouseLeave),this._element.removeEventListener("click",this._handleClick),this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))},t.prototype._ensureCanReceiveKeyboardInput=function(){this._element.tabIndex=this._element.tabIndex},t.prototype._checkElementSize=function(){var e=this;this._origElementSize.width===this._element.clientWidth&&this._origElementSize.height===this._element.clientHeight||(this.updateCaptureRegion(),this._origElementSize.width=this._element.clientWidth,this._origElementSize.height=this._element.clientHeight),this._pollTimerID=window.setTimeout(function(){return e._checkElementSize()},3e3)},t.prototype._raiseMouseEvent=function(e){this.event("mouseControlEvent").raise(e)},t.prototype._raiseKeyboardEvent=function(e){this.event("keyboardControlEvent").raise(e)},t.prototype._raiseCaptureEvent=function(e){this.event("ctrlCaptureEvent").raise(e)},t.prototype._normalizeMousePosition=function(e,t){t.xPos=(e.offsetX-this._captureRegion.left)/this._captureRegion.width*65535,t.yPos=(e.offsetY-this._captureRegion.top)/this._captureRegion.height*65535},t.prototype._isOnScreenContent=function(e){var t=this._captureRegion.left,n=this._captureRegion.left+this._captureRegion.width,r=this._captureRegion.top,i=this._captureRegion.top+this._captureRegion.height;return t<=e.offsetX&&e.offsetX<n&&r<=e.offsetY&&e.offsetY<i},t.prototype._shouldMoveMouse=function(){if(this._mouseMoveStartTime){var e=(new Date).getTime(),t=e-this._mouseMoveStartTime;if(this._isMouseDown&&t>=30||!this._isMouseDown&&t>=50)return this._mouseMoveStartTime=e,!0}else this._mouseMoveStartTime=(new Date).getTime();return!1},t.prototype._syncKeyStates=function(e){this._raiseKeyboardEvent({codeType:1,code:17,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:16,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:18,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:91,repeat:!1,keyUp:e}),this._logger.info("Synced Key states.")},t.formatMouseEvent=function(e){return a.ScreenSharingControlProtocol.encodeMouseEvent(e)},t.formatKeyboardEvent=function(e){return a.ScreenSharingControlProtocol.encodeKeyboardEvent(e)},t}(o.default);t.SlimCoreElectronControlCapturer=c},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype.changed=function(e){return this.subscribe({changed:e,on:void 0})},t.prototype.on=function(e,t){return this.subscribe({changed:void 0,on:{name:String(e),handler:this._toEventCallback(t)}})},t.prototype.once=function(e,t,n){var r,i=this;return r=this.on(e,this._fromEventCallback(function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];r.dispose(n),i._toEventCallback(t).apply(void 0,e)}))},t.prototype.raiseChanged=function(){this.raiseEvents(function(e){return e.changed&&e.changed()})},t.prototype.event=function(e){var t=this;return{raise:this._fromEventCallback(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t._raiseEventImpl.apply(t,i([String(e)],n))})}},t.prototype._raiseEventImpl=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.raiseEvents(function(n){var r;return n.on&&n.on.name===e&&(r=n.on).handler.apply(r,t)})},t.prototype._toEventCallback=function(e){return e},t.prototype._fromEventCallback=function(e){return e},t}(n(3).EventSourceImpl);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourceImpl=void 0;var r=n(4),i=n(5),o=function(){function e(e){this.subscriptions=[],this.eventLogger=e}return e.prototype.subscribe=function(e){return new a(this.subscriptions,e)},e.prototype.dispose=function(e){this.subscriptions=[]},e.prototype.raiseEvents=function(e){var t=this;this.subscriptions.slice().forEach(function(n){try{void 0!==n.eventHandler&&e(n.eventHandler)}catch(e){t.eventLogger&&t.eventLogger.warn&&t.eventLogger.warn("Event handler exception caught!",i.stringifyObject(e))}})},e}();t.EventSourceImpl=o;var a=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;r.remove(this.subscriptions,function(t){return t===e}),this.eventHandler=void 0},e}()},function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringifyObject=t.isPromiseLike=t.isStringBase64=t.getRandomizedTimeout=void 0,t.getRandomizedTimeout=function(e){var t=Math.floor(11*Math.random())+10;return Math.floor(e*(1-t/100))},t.isStringBase64=function(e){if(!e)return!1;try{return atob(e),!0}catch(e){return!1}},t.isPromiseLike=function(e){return!!e&&"function"==typeof e.then},t.stringifyObject=function(e){return e?e.toString===Object.prototype.toString?JSON.stringify(e):e.toString():""+e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSharingControlProtocol=void 0;!function(e){var t=7,n=3;e.encodeMouseEvent=function(e){if(!e)return new Uint8Array(0);e.buttonType||(e.buttonType=0),e.xPos||(e.xPos=0),e.yPos||(e.yPos=0),e.wheelRotation||(e.wheelRotation=0);var n=new ArrayBuffer(t),r=new DataView(n),i=(3&e.type)<<0,o=(7&e.buttonType)<<2,a=(e.buttonDown?1:0)<<5,s=(e.wheelButtonDown?1:0)<<6;return r.setUint8(0,1),r.setUint8(1,i|o|a|s|0),r.setUint16(2,e.xPos,!0),r.setUint16(4,e.yPos,!0),r.setUint8(6,e.wheelRotation),new Uint8Array(n)},e.encodeKeyboardEvent=function(e){var t=new ArrayBuffer(n),r=new DataView(t),i=(3&e.codeType)<<0,o=(e.keyUp?1:0)<<4,a=(e.repeat?1:0)<<5;return r.setUint8(0,0),r.setUint8(1,0|i|o|a|0),r.setUint8(2,e.code),new Uint8Array(t)},e.decodeEventType=function(e){return e[0]},e.decodeMouseEvent=function(e){if(1!==e[0]||e.length!==t)return null;var n=new DataView(e.buffer),r=n.getUint8(1);return{type:3&r,buttonType:r>>2&7,buttonDown:!!(r>>5&1),wheelButtonDown:!!(r>>6&1),xPos:n.getUint16(2,!0),yPos:n.getUint16(4,!0),wheelRotation:n.getUint8(6)}},e.decodeKeyboardEvent=function(e){if(0!==e[0]||e.length!==n)return null;var t=new DataView(e.buffer),r=t.getUint8(1);return{codeType:3&r,code:t.getUint8(2),repeat:!!(r>>5&1),keyUp:!!(r>>4&1)}}}(t.ScreenSharingControlProtocol||(t.ScreenSharingControlProtocol={}))}])})},function(e,t,n){"use strict";function r(e){switch(e){case 1:return _.VideoType.ScreenShare;case 0:return _.VideoType.Video;default:return}}function i(e){return e?e.id+":"+e.mediaSourceId+":"+e.label:"none"}function o(e){try{return e.getStats().framesTotal}catch(e){return-1}}var a=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)},c=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},l=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var u=n(7),d=n(12),p=n(9),h=n(25),g=n(10),f=n(11),_=SlimCore.Enums,m=n(36),v=n(43),y=0,C=0,S=function(e){function t(t,n,r,i){void 0===i&&(i=t.createChild(function(){return"View["+o.id+":"+o._frameSinkId+"]"}));var o=e.call(this,i)||this;return o._frameSinkId=n,o._frameSink=r,o._logger=i,o.id=y++,o._bindingRenderer=null,o.currentSubscription=null,o._activationContext={},o}return a(t,e),t.logThis=function(e){return e.id+":"+e._frameSinkId},t.heartBeatLogTemplate=function(){return"vid:fsid:frmcnt"},t.logThisForHeartbeat=function(e){return e.id+":"+e._frameSinkId+":"+o(e._frameSink)},t.prototype.attach=function(e,t,n,r){this._logger.info("attach causeId: "+e+" add frame sink to stream: "+i(r)),this._bindingRenderer&&this.detach(e,this._bindingRenderer),this._activationContext=n,this._bindingRenderer=t;try{t.addFrameSink(this._frameSink)}catch(t){this._logger.error("attach causeId: "+e+" add frame sink failed. error: "+t)}},t.prototype.detach=function(e,t){if(this._bindingRenderer===t){this._logger.info("detach causeId: "+e+" remove frame sink"),this._bindingRenderer=null;try{g.isDisposed(this._frameSink)?this._logger.warn("detach causeId: "+e+" remove frame sink - skip, sink already disposed"):t.removeFrameSink(this._frameSink)}catch(t){this._logger.error("detach causeId: "+e+" remove frame sink failed. error: "+t)}this._activationContext={},null!==this.currentSubscription&&(this._logger.info("detach causeId: "+e+" "+i(this.currentSubscription)+" -> "+i(null)),this.currentSubscription=null,this.event("subscriptionChanged").raise(this.currentSubscription),this.raiseChanged())}},t.prototype.changeVirtualParticipant=function(e){this._logger.info("changeVirtualParticipant: old participantId: "+this.dynamicVirtualParticipantId+" new participantId: "+e),this.dynamicVirtualParticipantId!==e&&(this.dynamicVirtualParticipantId=e,this.raiseChanged())},t.prototype.changeSubscription=function(e,t,n){this.currentSubscription!==n&&this._activationContext===t&&(this._logger.info("changeSubscription causeId: "+e+" "+i(this.currentSubscription)+" -> "+i(n)),this.currentSubscription=n,this.event("subscriptionChanged").raise(this.currentSubscription),this.raiseChanged())},t}(h.default),I=function(){function e(e,t,n,r,i,o,a,s){var c=this;void 0===s&&(s=t.createChild(function(){return"Receiver["+c.id+":"+c.type+"]["+c._streamId+":#"+c._views.length+"]["+c._subscribedStreamId+":"+c._receiverStatus+"]"})),this._settings=n,this._slimcoreInstance=r,this._participantIdMapperFactory=o,this.type=a,this._logger=s,this.id=C++,this._isDisposed=!1,this._deferredRunning=null,this._isRunning=!1,this._subscribeStartTime=0,this._subscribeEndTime=0,this._waitForRunningTimerId=0,this._currentStream=null,this._pendingStream=null,this._views=[],this._videoReceiverSubscriptions=[],this._deferredReady=d.defer(),this._isReady=!1,this._deferredAbandoned=d.defer(),this._receiverStatus=_.VideoReceiverStatus.Stopped,this._subscribedStreamId=0,this._txNdiNotifier=new v.default(this._logger,this._slimcoreInstance),this._dynamicVirtualParticipantMsi=m.SOURCE_NONE,this._createResources(e,i)}return e.logThis=function(e){return e.id+":"+e._streamId+":"+e._isRunning},e.heartBeatLogTemplate=function(){return"rid:sid:rdy?:run?:status:timing ["+S.heartBeatLogTemplate()+"]"},e.logThisForHeartbeat=function(e){var t="";if(0!==e._streamId){var n=Date.now(),r=(e._subscribeEndTime-e._subscribeStartTime)/1e3,i=(n-e._subscribeStartTime)/1e3;t=r>0?r.toFixed(3)+"+"+(i-r).toFixed()+"s":"+"+i.toFixed(1)+"s"}return e.id+":"+e._streamId+":"+e._isReady+":"+e._isRunning+":"+e._receiverStatus+":"+t+" "+("["+u.map(e._views,S.logThisForHeartbeat).join(" ")+"]")},e.prototype.dispose=function(e){return c(this,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:if(!this._isDisposed){this._isDisposed=!0,this._logger.info("dispose causeId: "+e);try{this._mapper&&this._mapper.dispose(),this.suspend(e,!0),this._receiver.abandon(),this._logger.info("dispose causeId: "+e+" release binding"),this._receiver.releaseBinding(this._bindingRenderer)}catch(t){this._logger.error("dispose causeId: "+e+" error: "+t)}}return this._logger.info("dispose causeId: "+e+" synchronize"),[4,this._deferredAbandoned.promise];case 1:return t.sent(),this._logger.info("dispose causeId: "+e+" done"),[2]}})})},e.prototype.subscribeStream=function(e,t,n,r,o,a){return c(this,void 0,void 0,function(){var s,c,d,p,h,g,f,_,m,v,y,C,I,O,T,E,P=this;return l(this,function(l){switch(l.label){case 0:return l.trys.push([0,,5,6]),s=Date.now(),c=n.stream,this._pendingStream=n,this._streamConfig=a,d=s,this._isReady?[3,2]:(this._logger.info("subscribeStream causeId: "+e+" new stream: "+i(c)+"#"+r.length+" config: "+JSON.stringify(a)),t(),[4,this._deferredReady.promise]);case 1:l.sent(),d=Date.now(),l.label=2;case 2:if(this._pendingStream!==n)throw p=!this._pendingStream,h="receiver being "+(p?"suspended":"resubscribed (immediate)"),this._logger.warn("subscribeStream causeId: "+e+" rejecting: "+h),new Error(h);return g=this._currentStream,f=g!==n,_=u.difference(this._views,r),m=u.difference(r,this._views),v={},(y=f||_.length>0||m.length>0)&&(C="stream "+(f&&"changed"||"")+": "+i(g&&g.stream)+" -> "+i(c)+"#"+r.length,O="=["+(I=function(e){return u.map(e,S.logThis).join(" ")})(u.intersection(this._views,r))+"] -["+I(_)+"] +["+I(m)+"]",this._logger.info("subscribeStream causeId: "+e+" executing "+C+" views ("+O+")"),_.forEach(function(t){return t.detach(e,P._bindingRenderer)}),this._views=u.difference(this._views,_),f&&(g&&!this._isRunning&&(this._logger.warn("subscribeStream causeId: "+e+" rejecting: receiver being resubscribed"),this._deferredRunning.reject(new Error("receiver being resubscribed"))),this._subscribeReceiver(e,n,o)),m.forEach(function(t){return t.attach(e,P._bindingRenderer,v,c)}),this._views=r),this._isRunning?[3,4]:(t(),[4,this._deferredRunning.promise]);case 3:l.sent(),l.label=4;case 4:return y&&(m.forEach(function(t){return t.changeSubscription(e,v,c)}),m.forEach(function(e){return e.changeVirtualParticipant(P._dynamicVirtualParticipantId)}),T=d-s,E=Date.now()-s,this._logger.info("subscribeStream causeId: "+e+" duration: "+T+"+"+(E-T)+"ms done")),[3,6];case 5:return t(),[7];case 6:return[2]}})})},e.prototype.suspend=function(e,t){var n=this;void 0===t&&(t=!1),this._pendingStream=null,this._currentStream&&(this._logger.info("suspend causeId: "+e+" isDisposing: "+t+" current stream: "+i(this._currentStream.stream)),this._cancelWaitForRunningTimer(),this._deferredRunning.reject(new Error("receiver being unsubscribed")),this._currentStream=null,this._deferredRunning=null,this._isRunning=!1,this._views.forEach(function(t){return t.detach(e,n._bindingRenderer)}),this._views=[],this._txNdiNotifier.notifyNdiVideoStopped(e),t||this._unsubscribeReceiver(e))},e.prototype.setVideoStreamConfig=function(e,t){this._streamConfig=s(s({},this._streamConfig),t),this._pendingStream===this._currentStream&&this._setSinkDeviceConfig(e,this._streamConfig)},Object.defineProperty(e.prototype,"_streamId",{get:function(){return this._currentStream&&this._currentStream.stream.id||0},enumerable:!1,configurable:!0}),e.prototype._subscribeReceiver=function(e,t,n){this._cancelWaitForRunningTimer(),this._deferredRunning=d.defer(),this._subscribeStartTime=Date.now(),this._subscribeEndTime=this._subscribeStartTime-1,this._isRunning=!1,this._currentStream=t;var r=n.startStreamTimeout;this._logger.info("_subscribeReceiver causeId: "+e+" timeout: "+r);try{this._applyInitialSinkDeviceConfig(e),this._txNdiNotifier.notifyNdiVideoStopped(e),this._receiver.subscribe(this._streamId),this._startWaitForRunningTimer(e,r)}catch(t){this._logger.error("_subscribeReceiver causeId: "+e+" failed. error: "+t),this._deferredRunning.reject(new Error("_subscribeReceiver causeId: "+e+" error: "+t))}},e.prototype._startWaitForRunningTimer=function(e,t){var n=this;t&&(this._waitForRunningTimerId=window.setTimeout(function(){n._deferredRunning.reject(new Error("_subscribeReceiver causeId: "+e+" stream did not go running"))},t))},e.prototype._cancelWaitForRunningTimer=function(){this._waitForRunningTimerId&&(clearTimeout(this._waitForRunningTimerId),this._waitForRunningTimerId=0)},e.prototype._unsubscribeReceiver=function(e){this._logger.info("_unsubscribeReceiver causeId: "+e);try{this._receiver.subscribe(0)}catch(t){this._logger.error("_unsubscribeReceiver causeId: "+e+" failed. error: "+t)}},e.prototype._setSinkDeviceConfig=function(e,t,n){if(!u.isEqual(this._appliedStreamConfig,t))try{this._appliedStreamConfig=t;var r=s(s({},n),t);this._logger.info("_setSinkDeviceConfig causeId: "+e+" json: "+JSON.stringify(r)+" config: "+JSON.stringify(t)),this._bindingRenderer.setSinkDeviceConfig(r)}catch(t){this._logger.error("_setSinkDeviceConfig causeId: "+e+" failed. error: "+t)}},e.prototype._applyInitialSinkDeviceConfig=function(e){u.isEqual(this._appliedStreamConfig,this._streamConfig)||(u.isEmpty(this._appliedStreamConfig)?this._setSinkDeviceConfig(e,this._streamConfig):this._setSinkDeviceConfig(e,this._streamConfig,{isAlphaMaskEnabled:!1,isFocusEnabled:!1}))},e.prototype._subscribed=function(e,t){this._currentStream&&this._currentStream.stream.id===t&&(this._txNdiNotifier.notifyNdiVideoStarted(e,t,this._bindingRenderer),this._cancelWaitForRunningTimer(),this._deferredRunning.resolve(),this._subscribeEndTime=Date.now(),this._isRunning=!0)},e.prototype._createResources=function(e,t){return c(this,void 0,void 0,function(){var n,i,o,a,s,c,u=this;return l(this,function(l){switch(l.label){case 0:n=Date.now(),a=[],l.label=1;case 1:return l.trys.push([1,3,,4]),this._logger.info("_createResources causeId: "+e+" create instances"),i=this._slimcoreInstance.createVideoBindingRenderer({enableDXVA:this._settings.enableDXVA,isLocalPreview:!1}),o=this._slimcoreInstance.createVideoReceiver(t,r(this.type)),a.push(o.handle("subscribed",void 0,function(t){var n=t.videoObjectId;u._logger.info("receiver subscribed event "+u._subscribedStreamId+" -> "+n),u._subscribedStreamId=n,u._subscribed(e,n)})),a.push(o.handle("status-changed",void 0,function(e){u._logger.info("receiver status-changed event "+u._receiverStatus+" -> "+e.status),u._receiverStatus=e.status})),a.push(o.handle("error-occurred",void 0,function(e){u._logger.info("receiver error-occurred event "+e.error)})),a.push(o.handle("abandoned",void 0,function(){u._logger.info("receiver abandoned event"),u._disposeResources(e,u._receiver,u._videoReceiverSubscriptions,u._bindingRenderer,new Error("receiver abandoned"))})),a.push(o.handle("virtual-participant-changed",void 0,function(e){u._onVideoObjectVirtualParticipantChanged(e.virtualParticipantMsi)})),this._receiver=o,this._videoReceiverSubscriptions=a,this._bindingRenderer=i,this._logger.info("_createResources causeId: "+e+" setup renderer binding"),[4,o.createBinding(i)];case 2:if(l.sent(),this._isDisposed)throw new Error("already disposed");return this._isReady=!0,this._deferredReady.resolve(),c=Date.now(),this._logger.info("_createResources causeId: "+e+" done. duration: "+(c-n)+"ms"),[3,4];case 3:return s=l.sent(),c=Date.now(),this._logger.error("_createResources causeId: "+e+" failed. duration: "+(c-n)+"ms error: "+s),this._isDisposed||this._disposeResources(e,o,a,i,new Error("_createResources causeId: "+e+" error: "+s)),[3,4];case 4:return[2]}})})},e.prototype._onVideoObjectVirtualParticipantChanged=function(e){var t=this;this._dynamicVirtualParticipantMsi!==e&&(this._dynamicVirtualParticipantMsi=e,this._logger.info("VideoObjectVirtualParticipantChanged: old msi: "+this._dynamicVirtualParticipantMsi+" new msi: "+e),this._mapper||(this._mapper=this._participantIdMapperFactory(function(e){t._logger.info("VideoObjectVirtualParticipantChanged: old participantId: "+t._dynamicVirtualParticipantId+" new participantId: "+e),t._dynamicVirtualParticipantId=e,t._views.forEach(function(e){return e.changeVirtualParticipant(t._dynamicVirtualParticipantId)})})),this._mapper.update(e))},e.prototype._disposeResources=function(e,t,n,r,i){this._deferredReady.reject(i);try{n.forEach(function(e){return e.dispose()}),t&&t.dispose(),r&&r.dispose()}catch(i){this._logger.error("_disposeResources causeId: "+e+" error: "+i)}this._deferredAbandoned.resolve()},e}(),O=function(e){function t(t,n,r,i,o){var a,s=e.call(this,t.createChild(function(){return"VideoLayout[#"+s._subscriptions.size+":"+s._nrLayoutUpdates+"]"}),n,r)||this;s._slimcoreCallId=i,s._participantIdMapperFactory=o,s._configuration={},s._isDisposed=!1,s._nrLayoutUpdates=0,s._maxIncomingVideoCount=0,s._maxIncomingVbssCount=0,s._capabilites={streamConstraints:(a={},a[0]={maxConcurrentSubscriptions:s._maxIncomingVideoCount},a[1]={maxConcurrentSubscriptions:s._maxIncomingVbssCount},a)},s._subscriptions=new Map,s._cleanups=[],s._streamConfigurations=new Map;var c=u.debounce(function(){var e=s._capabilites.streamConstraints,t=e[0],n=e[1];if(t.maxConcurrentSubscriptions!==s._maxIncomingVideoCount||n.maxConcurrentSubscriptions!==s._maxIncomingVbssCount){t.maxConcurrentSubscriptions=s._maxIncomingVideoCount,n.maxConcurrentSubscriptions=s._maxIncomingVbssCount;var r=s._capabilites.streamConstraints[0].maxConcurrentSubscriptions,i=s._capabilites.streamConstraints[1].maxConcurrentSubscriptions;s._logger.info("raise streamConstraints changed maxConcurrentSubscriptions video: "+r+" vbss: "+i),s.event("capabilitiesChanged").raise(),s.raiseChanged()}},0),l=function(e,t){s._maxIncomingVideoCount===e&&s._maxIncomingVbssCount===t||(s._maxIncomingVideoCount=e,s._maxIncomingVbssCount=t,c())};l(s._getIntProperty(r,i,_.Property.CallMaxIncomingVideoCount,s._maxIncomingVideoCount),s._getIntProperty(r,i,_.Property.CallMaxIncomingVbssCount,s._maxIncomingVbssCount)),s._onObjectPropertyChanged(i,_.Property.CallMaxIncomingVideoCount,function(e){return l(e.value,s._maxIncomingVbssCount)}),s._onObjectPropertyChanged(i,_.Property.CallMaxIncomingVbssCount,function(e){return l(s._maxIncomingVideoCount,e.value)});var d=0;return s._triggerHartbeat=u.throttle(function(){0===d||0!==s._subscriptions.size&&!s._isDisposed||(clearInterval(d),d=0),s._isDisposed||(0!==s._subscriptions.size&&0===d&&(d=window.setInterval(function(){return s._triggerHartbeat()},2e4)),s._logHeartbeat())},2e3),s}return a(t,e),t.isVideoLayoutSupported=function(e){return!!e.createVideoReceiver},t.prototype.dispose=function(t){return c(this,void 0,void 0,function(){return l(this,function(n){switch(n.label){case 0:if(!this._isDisposed){this._isDisposed=!0,this._logger.info("dispose causeId: "+t);try{this.update([])}catch(e){this._logger.error("dispose causeId: "+t+" error: "+e)}this._triggerHartbeat.flush(),this._triggerHartbeat.cancel(),e.prototype.dispose.call(this,t)}return this._cleanups.length>0?(this._logger.info("dispose causeId: "+t+" synchronize pending cleanups: #"+this._cleanups.length),[4,Promise.all(this._cleanups)]):[3,2];case 1:n.sent(),this._logger.info("dispose causeId: "+t+" done"),n.label=2;case 2:return[2]}})})},t.prototype.createView=function(e,t){return new S(this._logger,e,t)},t.prototype.update=function(e){var t=this,n=p.generateCauseId();if(this._isDisposed&&e.length>0)throw this._logger.warn("update causeId: "+n+" video layout already disposed"),new Error("video layout already disposed");var r=[],i=this._toVideoViewUpdateMap(n,e,r),o=Array.from(this._subscriptions.keys()),a=Array.from(i.keys()),s=[],c=function(e){var o=e.stream,a=e.receiverStream,s=e.receiver,c=i.get(o),l=u.map(c,function(e){return e.view}),d=t._streamConfigurations.get(o),p=s.subscribeStream(n,t._triggerHartbeat,a,l,t._configuration,d);c.forEach(function(e){return r[e.index]=p})},l=function(e){var n=u.findIndex(s,function(t){return t.receiver.type===e.type}),r=-1!==n?u.head(s.splice(n,1)):void 0;return r&&(r.stream=e,r.receiverStream=t._makeReceiverStream(e)),r},d=u.difference(o,a),h=u.intersection(o,a),g=u.difference(a,o);return this._logLayoutUpdateStreams(n,d,h,g),d.forEach(function(e){s.push(t._subscriptions.get(e)),t._subscriptions.delete(e)}),h.forEach(function(e){c(t._subscriptions.get(e))}),g.forEach(function(e){var r=l(e);r||(r={stream:e,receiverStream:t._makeReceiverStream(e),receiver:new I(n,t._logger,t._settings,t._slimcoreInstance,t._slimcoreCallId,t._participantIdMapperFactory,e.type)}),t._subscriptions.set(e,r),c(r)}),s.forEach(function(e){var r=e.receiver.dispose(n).catch(u.noop),i=function(){return u.remove(t._cleanups,function(e){return e===r})};t._cleanups.push(r),r.then(i,i)}),this._logLayoutUpdateReceivers(n),this._nrLayoutUpdates++,this._triggerHartbeat(),r},t.prototype.setVideoStreamConfig=function(e,t){var n=this,r=p.generateCauseId();if(this._logger.info("setVideoStreamConfig causeId: "+r+" stream: "+i(e)+" config: "+JSON.stringify(t)),this._streamConfigurations.forEach(function(e,t){t.isDisposed&&n._streamConfigurations.delete(t)}),!u.isEmpty(t)&&!e.isDisposed){var o=s(s({},this._streamConfigurations.get(e)),t);this._streamConfigurations.set(e,o);var a=this._subscriptions.get(e);a&&a.receiver.setVideoStreamConfig(r,o)}},Object.defineProperty(t.prototype,"capabilities",{get:function(){return this._capabilites},enumerable:!1,configurable:!0}),t.prototype.configure=function(e){this._configuration=s(s({},this._configuration),e)},t.prototype._makeReceiverStream=function(e){return{stream:e}},t.prototype._toVideoViewUpdateMap=function(e,t,n){var r=0,i=new Set;return t.reduce(function(t,o){var a=o.stream,s=o.view,c=r++;if(i.has(s))n[c]=Promise.reject(new Error("duplicate view for the video layout update causeId: "+e+" at index "+c));else{i.add(s);var l=t.get(a);l?l.push({index:c,view:s}):t.set(a,[{index:c,view:s}])}return t},new Map)},t.prototype._logHeartbeat=function(){var e=function(e){return u.map(e,I.logThisForHeartbeat).join(" ")},t=Array.from(this._subscriptions.values()).map(function(e){return e.receiver}),n=function(n){var r=t.filter(function(e){return e.type===n});return"#"+r.length+" ["+e(r)+"]"},r=["vbss ("+n(1)+")","video ("+n(0)+")"].join(" ");this._logger.info("heartbeat "+I.heartBeatLogTemplate()+" "+r)},t.prototype._logLayoutUpdateStreams=function(e,t,n,r){var o=this,a=function(e){return u.map(e,i).join(" ")},s=function(e){var i=function(t){return t.type===e},s=t.filter(i),c=n.filter(i),l=r.filter(i),u=o._capabilites.streamConstraints[e].maxConcurrentSubscriptions;return"#"+(c.length+l.length)+"/"+u+" =["+a(c)+"] -["+a(s)+"] +["+a(l)+"]"},c=["vbss ("+s(1)+")","video ("+s(0)+")"].join(" ");this._logger.info("update causeId: "+e+" streams "+c)},t.prototype._logLayoutUpdateReceivers=function(e){var t=function(e){return u.map(e,I.logThis).join(" ")},n=Array.from(this._subscriptions.values()).map(function(e){return e.receiver}),r=function(e){var r=n.filter(function(t){return t.type===e});return"#"+r.length+" ["+t(r)+"]"},i=["vbss ("+r(1)+")","video ("+r(0)+")"].join(" ");this._logger.info("update causeId: "+e+" receivers "+i)},t}(f.default);t.default=O},function(e,t,n){"use strict";function r(e,t,n){if(!e)return n.info("sanitizeMeetingCode["+t+"] empty / undefined meeting code parameter"),e;var r=e.replace(/\s/g,"");return r=r.replace(/-/g,""),n.info("sanitizeMeetingCode["+t+"] meetingCode: "+e+", sanitizedMeetingCode: "+r),r}function i(e,t,n){if(!e)return n.info("getMeetingCodeFromMeetingUrl["+t+"] empty / undefined meeting Url parameter"),e;var r=new URL(e),i="";if(r&&r.pathname&&r.pathname.split("/").length>=2){var a=r.pathname.split("/");"meet"===a[a.length-2]&&(i=a[a.length-1])}return n.info("getMeetingCodeFromMeetingUrl["+t+"] meetingUrl: "+e+", meetingUrlObject: "+o.safeJsonStringify(r)+", meetingCode: "+i),i}Object.defineProperty(t,"__esModule",{value:!0}),t.compareMeetingData=t.getMeetingCodeFromMeetingUrl=t.sanitizeMeetingCode=t.isMeetingCodeUrl=void 0;var o=n(19);t.isMeetingCodeUrl=function(e){var t=new URL(e).pathname.split("/");return t.pop(),"meet"===t.pop()},t.sanitizeMeetingCode=r,t.getMeetingCodeFromMeetingUrl=i,t.compareMeetingData=function(e,t,n,o){var a=r(e&&e.meetingCode||"",n,o),s=r(t&&t.meetingCode||"",n,o),c=function(e,t){return!!e&&!!t&&e===t};if(c(a,s))return!0;var l=i(e&&e.meetingUrl||"",n,o);l=r(l,n,o);var u=i(t&&t.meetingUrl||"",n,o);if(u=r(u,n,o),c(l,u))return!0;if(c(l,s)||c(u,a))return!0;if(e&&e.meetingUrl&&t&&t.meetingUrl){var d=new URL(e.meetingUrl),p=new URL(t.meetingUrl);if(d.hostname===p.hostname&&d.pathname===p.pathname)return!0}return!1}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0}),t.SlimCoreElectronBindingManager=void 0;var o=function(){function e(e,t,n){this._create=e,this._release=t,this._logger=n,this._bindingMap={},this._logger.info("created")}return e.prototype.acquire=function(e,t,n){var r=this;if(!this._bindingMap[n]||this._bindingMap[n].releasePromise){var i=!1,o=void 0;this._bindingMap[n]?(o=this._bindingMap[n].releasePromise.catch(function(t){return r._logger.info("Release binding error: "+t+". videoObjectId: "+n+" causeId: "+e)}),i=!0,this._logger.info("Will wait for the release promise to complete before creating. videoObjectId: "+n+" causeId: "+e)):o=Promise.resolve();var a=o.then(function(){return r._create(e,n)}).then(function(t){return r._logger.info("Binding created for videoObjectId: "+n+" causeId: "+e),t}).catch(function(t){throw delete r._bindingMap[n],r._logger.info("Create binding error: "+t+" for videoObjectId: "+n+" causeId: "+e),t});this._bindingMap[n]={createPromise:a,owners:[],chained:i}}return this._bindingMap[n].owners.push(t),this._logger.info("Added owner for "+n+" causeId: "+e+". Total now: "+this._bindingMap[n].owners.length),this._bindingMap[n].createPromise},e.prototype.release=function(e,t,n){return r(this,void 0,void 0,function(){var r,o,a=this;return i(this,function(i){switch(i.label){case 0:return this._bindingMap[n]?[4,this._bindingMap[n].createPromise]:[3,2];case 1:return r=i.sent(),(o=this._bindingMap[n].owners.indexOf(t))>-1&&(this._bindingMap[n].owners.splice(o,1),this._logger.info("Removed owner for "+n+" causeId: "+e+". Remaining: "+this._bindingMap[n].owners.length)),0===this._bindingMap[n].owners.length?(this._bindingMap[n].releasePromise=this._release(e,n,r).then(function(){a._bindingMap[n].chained||delete a._bindingMap[n]}),[2,this._bindingMap[n].releasePromise]):(this._logger.info("More owners for videoObjectId: "+n+" causeId: "+e),[3,3]);case 2:this._logger.info("BindingManager release() called. _bindingMap empty for videoObjectId: "+n+" causeId: "+e),i.label=3;case 3:return[2]}})})},e}();t.SlimCoreElectronBindingManager=o},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveStreamClient=void 0;var o=n(89),a=n(96),s=function(){function e(e,t,n){this.ecsProvider=e,this.logger=t,this.getTelemetryLogger=n}return e.prototype.configure=function(e){this.configuration=e},e.prototype.initialize=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o;return i(this,function(i){switch(i.label){case 0:return e="SkypeWebMedia",t="liveStream",[4,this.ecsProvider.getEcsSettingAsString(e,t)];case 1:n=i.sent(),r={};try{r=JSON.parse(n)}catch(n){this.logger.warn("failed to parse ECS configuration for "+e+"/"+t)}return[4,this.ecsProvider.getEcsSettingAsString("ConfigIDs",e)];case 2:return o=i.sent(),this._configProvider=new a.LiveStreamConfigProvider(r,this.configuration,o,this.logger.createChild("LiveStreamConfigProvider")),[2]}})})},e.prototype.createLiveStream=function(){return new o.LiveStream(this._configProvider,this.logger.createChild("LiveStream"),this.getTelemetryLogger)},e.prototype.dispose=function(e){},e}();t.LiveStreamClient=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveStream=void 0;var a=n(25),s=n(90),c=n(95),l=function(e){function t(t,n,r){var i=e.call(this)||this;return i.configProvider=t,i.logger=n,i.getTelemetryLogger=r,i.isAvailable=!0,i._isStreaming=!1,i.liveStreamStatistic=new c.LiveStreamStatistic(i.configProvider.config,i.logger.createChild("LiveStreamStatistic")),i.player=new s.AmpLiveStreamPlayer(i.logger.createChild("AmpLiveStreamPlayer"),i.liveStreamStatistic,i.configProvider),i.playerSubs=[],i.isFinalTelemetrySent=!1,i.subscribeForPlayerEvents(),i}return r(t,e),Object.defineProperty(t.prototype,"isStreaming",{get:function(){return this._isStreaming},enumerable:!1,configurable:!0}),t.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},t.prototype.start=function(e,t){return i(this,void 0,void 0,function(){var n,r=this;return o(this,function(i){switch(i.label){case 0:return[4,this.setOptions(t)];case 1:return i.sent(),this.isFinalTelemetrySent=!1,this.telemetryLogger=this.getTelemetryLogger(),[4,this.player.loadPlayer(e)];case 2:if(!(n=i.sent()))throw this.player.stop(),this.logger.error("playerLoadFailed"),this.sendTelemetry(),new Error("playerLoadFailed");return this._isStreaming=!0,this.statsSub=window.setTimeout(function(){clearTimeout(r.statsSub),r.logger.debug("initial telemetry report after "+r.configProvider.config.sendInitialTelemetryAfterMs+" ms"),r.sendTelemetry()},this.configProvider.config.sendInitialTelemetryAfterMs),[2,this.player.getRenderer()]}})})},t.prototype.stop=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return[2]})})},t.prototype.setOptions=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){return this.options=e,[2,this.player.configure(e)]})})},t.prototype.getStats=function(){return this.liveStreamStatistic.playerDiagnosticSnapshot},t.prototype.dispose=function(){this.unsubscribeFromPlayerEvents(),this.player.stop(),clearTimeout(this.statsSub),this.logger.debug("stopping live event"),this.sendFinalTelemetry(),e.prototype.dispose.call(this)},t.prototype.sendFinalTelemetry=function(){this.isFinalTelemetrySent||(this.isFinalTelemetrySent=!0,this.sendTelemetry(!0))},t.prototype.sendTelemetry=function(e){if(this.configProvider.config.sendTelemetry&&this.telemetryLogger){var t={configIds:this.configProvider.configIds,correlationId:this.options&&this.options.correlationId,eTag:this.configProvider.etag,isFinal:e,overflow:this.options&&this.options.overflow,threadId:this.options&&this.options.threadId},n=this.liveStreamStatistic.getReport(t);this.logger.debug("generated live stream report",n),this.telemetryLogger.sendEvent({eventName:"live_events",props:n})}else this.logger.info("telemetry not sent")},t.prototype.subscribeForPlayerEvents=function(){var e=this;this.playerSubs.push(this.player.on("playbackStateChanged",function(){return e.onPlaybackStateChanged()})),this.playerSubs.push(this.player.on("playbackError",function(t,n){return e.onPlaybackError(t,n)})),this.playerSubs.push(this.player.on("urlSwitched",function(t){return e.onUrlSwitched(t)}))},t.prototype.unsubscribeFromPlayerEvents=function(){for(var e=0,t=this.playerSubs;e<t.length;e++)t[e].dispose();this.playerSubs=[]},t.prototype.onPlaybackStateChanged=function(){var e=this.player.getPlaybackState();switch(e){case"Start":this.event("playbackStarted").raise();break;case"Ended":this.event("playbackNotLive").raise(),this.sendFinalTelemetry();break;case"Seeked":this.event("playbackSeeked").raise(this.player.getCaptionsTimestamp());break;default:this.logger.debug("playbackStateChanged: "+e)}this.event("playbackStateChanged").raise(this.player.getPlaybackState())},t.prototype.onPlaybackError=function(e,t){this.event("error").raise(e,t)},t.prototype.onUrlSwitched=function(e){this.event("urlSwitched").raise(e)},t}(a.default);t.LiveStream=l},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0}),t.AmpLiveStreamPlayer=void 0;var a=n(7),s=n(25),c=n(51),l=n(91),u=n(94),d=n(67),p=[2097152,2097552,2097556,2097557,2097564,2097652,2097654,2097655,2097656,2097752,3145728,4194305,4194306,4194307,4194308,4194309,5242880,5242881,5242882,5242884,5242885,5242886],h=function(e){function t(t,n,r){var i=e.call(this)||this;return i.logger=t,i.liveStreamStatistic=n,i.configProvider=r,i.playerState="Destroyed",i.retryCount=0,i.captionsTimestamp=0,i.isSwitchStreamingUrlOngoing=!1,i.streamingUrlSwitchCount=0,i.isPlaybackUnsupported=!1,i}return r(t,e),t.prototype.configure=function(e){return i(this,void 0,void 0,function(){var t;return o(this,function(n){switch(n.label){case 0:return d.isStreamValid(e.stream)||d.isStreamValid(e.altStream)?(this.logger.info("Live Stream configuration provided"),this.liveStreamOptions=e,t=d.isStreamValid(e.stream)?e.stream:e.altStream,!this.playerInstance||this.isPlaybackUnsupported?(this.selectedStreamDetails=t,[2]):[4,this.handleStreamInfoUpdate(t)]):(this.logger.error("Invalid Live Stream configuration provided: no valid primary or alternative stream"),[2]);case 1:return n.sent(),[2]}})})},t.prototype.loadPlayer=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,a=this;return o(this,function(o){switch(o.label){case 0:return d.assert(!this.playerInstance,"loads a player while current one is still active: "+this.playerState),d.assert(this.liveStreamOptions,"live stream options are not provided"),this.playerInstance=new l.AmpPlayerWrapper(this.logger),this.playerInstance.on("stateChanged",function(e,t){return a.ampStateChanged(e,t)}),this.playerInstance.on("captionsToggled",function(e,t,n){return a.captionsToggled(e,t,n)}),this.playerInstance.on("statsUpdated",function(e){return a.liveStreamStatistic.registerStatsUpdated(e)}),[4,this.playerInstance.initialize(e,this.liveStreamOptions,this.configProvider)];case 1:o.sent(),this.liveStreamStatistic.registerPlayerLoadAttempt(),this.loadSucceeded=!1,this.srcLoadPromise||(this.srcLoadPromise=this.playerInstance.message("loadPlayerScript").send()),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this.srcLoadPromise];case 3:return o.sent(),[3,5];case 4:return t=o.sent(),r=c.stringifyObject(t),this.logger.error("playerLoadFailed: player scripts load failed: "+r),this.liveStreamStatistic.registerPlayerLoadFailed("player scripts load failed"),this.srcLoadPromise=null,[2,!1];case 5:return[4,this.tryLoadSdnPlugin()];case 6:o.sent(),o.label=7;case 7:return o.trys.push([7,9,,10]),[4,this.playerInstance.message("createAmp").send()];case 8:return o.sent(),[3,10];case 9:return n=o.sent(),r=c.stringifyObject(n),this.logger.error("playerLoadFailed "+r),this.liveStreamStatistic.registerPlayerLoadFailed("playerLoadFailed "+r),[2,!1];case 10:return d.isStreamValid(this.selectedStreamDetails)?(i=this,[4,this.setPlayerSource(this.selectedStreamDetails)]):(this.liveStreamStatistic.registerPlayerLoadFailed("invalid stream"),[2,!1]);case 11:return i.loadSucceeded=o.sent(),this.logger.info("loadPlayer succeeded: "+this.loadSucceeded),this.loadSucceeded?(this.liveStreamStatistic.registerPlayerLoadSucceeded(),this.playerState="Initialized"):this.liveStreamStatistic.registerPlayerLoadFailed("setPlayerSource failed"),[2,this.loadSucceeded]}})})},t.prototype.getRenderer=function(){return!this.renderer&&this.playerInstance&&(this.renderer=new u.LiveStreamRenderer(this,this.logger.createChild("LiveStreamRenderer"))),this.renderer},t.prototype.stop=function(){this.destroy()},t.prototype.getPlaybackState=function(){return this.playerState},t.prototype.getCaptionsTimestamp=function(){return this.captionsTimestamp},t.prototype.getCaptionsControl=function(){if(!this.captionsControl&&this.playerInstance){var e=this.liveStreamOptions.supportedSubtitleLanguages?this.liveStreamOptions.supportedSubtitleLanguages.map(function(e){return e.culture}):[];this.captionsControl=new g(this.playerInstance,e)}return this.captionsControl},t.prototype.getStreamSize=function(){var e=this.playerInstance?this.playerInstance.getPlayerDiagnosticSnapshot():null;return e?{width:e.mediaWidth,height:e.mediaHeight}:{width:0,height:0}},t.prototype.isRendering=function(){var e=this.getStreamSize();return e.width>0&&e.height>0},t.prototype.ampStateChanged=function(e,t){switch(e){case"error":return this.handlePlaybackError(t);case"canplaythrough":return this.onCanplaythrough();case"play":return this.onPlay();case"playing":return this.onPlaying();case"pause":return this.onPause();case"resume":return this.onResume();case"start":return this.onStart();case"ended":return this.onEnded();case"seeking":return this.onSeeking();case"seeked":return this.onSeeked(t);case"loadedmetadata":return this.onMetadataLoaded();case"waiting":return this.onWaiting();case"playbackbitratechanged":return this.onPlaybackBitrateChanged(t);case"downloadbitratechanged":return this.onDownloadBitrateChanged(t);case"fullscreenchange":return this.onFullscreenChange(t);case"potentialMediaFreeze":return this.onPotentialMediaFreeze();case"mute":return this.onMute();case"unmute":return this.onUnmute();case"volumechange":return this.onVolumeChange(t);case"loadstart":return this.onLoadStart();case"loadeddata":return this.onLoadedData();default:this.logger.warn("Unknown amp event "+e)}},t.prototype.captionsToggled=function(e,t,n){this.event("captionsToggled").raise(e,t,n),this.liveStreamStatistic.registerCaptionToggle(e,t,n)},t.prototype.tryLoadSdnPlugin=function(){return i(this,void 0,void 0,function(){var e;return o(this,function(t){switch(t.label){case 0:if(this.sdnPluginLoadPromise||!this.liveStreamOptions.sdn||!this.configProvider.config.allowSdnPlugins)return[2];switch(this.liveStreamOptions.sdn.name){case"hive":case"kollective":case"ramp":case"peer5":break;default:return this.logger.warn("unsupported SDN provider: "+this.liveStreamOptions.sdn.name),this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,!1),[2]}t.label=1;case 1:return t.trys.push([1,3,,4]),this.sdnPluginLoadPromise=this.playerInstance.message("tryLoadSdnPlugin").send(),[4,this.sdnPluginLoadPromise];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),this.sdnPluginLoadPromise=void 0,this.logger.error("loadSdnPlugin failed: "+c.stringifyObject(e)),[3,4];case 4:return this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,!!this.sdnPluginLoadPromise),[2]}})})},t.prototype.setPlayerSource=function(e){return i(this,void 0,void 0,function(){var t,n;return o(this,function(r){switch(r.label){case 0:if(!this.playerInstance)return this.logger.error("setPlayerSource: playerInstance is null"),[2,!1];this.logger.info("setPlayerSource: AMP source set to: ["+e.url+"]"),this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime,r.label=1;case 1:return r.trys.push([1,3,,4]),this.logger.info("setPlayerSource: src changed"),this.selectedStreamDetails=e,this.liveStreamStatistic.registerSetSourceAttempt(),[4,this.playerInstance.message("setSource").send(e)];case 2:return r.sent(),this.liveStreamStatistic.registerSetSourceSucceeded(),[2,!0];case 3:return t=r.sent(),n=c.stringifyObject(t),this.logger.error("setPlayerSource: failed with error ["+n+"]"),this.liveStreamStatistic.registerSetSourcedFailed(n),[2,!1];case 4:return[2]}})})},t.prototype.handleStreamInfoUpdate=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return this.loadSucceeded&&e.url!==this.selectedStreamDetails.url?[4,this.setPlayerSource(e)]:[3,2];case 1:return t.sent(),[3,3];case 2:this.loadSucceeded&&this.playerInstance&&this.getCurrentTime()>0&&this.setPlaybackState("Start"),t.label=3;case 3:return[2]}})})},t.prototype.switchStreamingUrl=function(e){return i(this,void 0,void 0,function(){var t,n;return o(this,function(r){return this.streamingUrlSwitchCount>=this.configProvider.config.streamingUrlSwitchMaxCount||!a.includes(this.configProvider.config.ampErrorCodesEligibleForStreamingUrlSwitch,e)?[2,!1]:(t=this.selectedStreamDetails.url===(this.liveStreamOptions.stream&&this.liveStreamOptions.stream.url),n=t?this.liveStreamOptions.altStream:this.liveStreamOptions.stream,d.isStreamValid(n)?(this.isSwitchStreamingUrlOngoing=!0,this.streamingUrlSwitchCount++,[2,this.setPlayerSource(n)]):(this.logger.error("Stream to switch ("+(t?"alternative":"primary")+") is not valid"),[2,!1]))})})},t.prototype.destroy=function(){this.srcLoadPromise=null,this.sdnPluginLoadPromise=null,this.renderer&&(this.renderer.dispose(),this.renderer=null),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null),this.playerInstance&&(this.liveStreamStatistic.registerPlayerDestroyed(),this.playerInstance.dispose(),this.playerInstance=null,this.setPlaybackState("Destroyed"))},t.prototype.getCurrentTime=function(){var e=this.playerInstance?this.playerInstance.getPlayerDiagnosticSnapshot():null;return e&&e.currentPlayPosition||0},t.prototype.onCanplaythrough=function(){this.setPlaybackState("Ready")},t.prototype.onPlay=function(){(this.retryCount>0||this.lastKnownPlayTime)&&(this.logger.info("Playing after retry count "+this.retryCount+", Setting current time to "+this.lastKnownPlayTime),this.playerInstance.message("setPlayTime").send(this.lastKnownPlayTime),this.retryCount=0,this.lastKnownPlayTime=void 0),this.setPlaybackState("Play")},t.prototype.onPlaying=function(){this.setPlaybackState("Playing")},t.prototype.onPause=function(){this.setPlaybackState("Paused")},t.prototype.onResume=function(){this.setPlaybackState("Resume")},t.prototype.onStart=function(){this.logger.info("Playback started, retry count: "+this.retryCount),this.setPlaybackState("Start"),this.isSwitchStreamingUrlOngoing&&(this.logger.info("Playback started, switch count: "+this.streamingUrlSwitchCount),this.event("urlSwitched").raise(this.selectedStreamDetails===this.liveStreamOptions.altStream),this.isSwitchStreamingUrlOngoing=!1)},t.prototype.onEnded=function(){this.setPlaybackState("Ended")},t.prototype.onSeeking=function(){this.setPlaybackState("Seeking")},t.prototype.onSeeked=function(e){this.captionsTimestamp=e.captionsTimestamp,this.setPlaybackState("Seeked")},t.prototype.onMetadataLoaded=function(){this.setPlaybackState("LoadedMetadata")},t.prototype.onWaiting=function(){this.setPlaybackState("Buffering")},t.prototype.onLoadedData=function(){this.setPlaybackState("LoadedData")},t.prototype.onLoadStart=function(){this.setPlaybackState("LoadStart")},t.prototype.setPlaybackState=function(e){this.playerState=e,this.logger.debug("playback state changed: "+e),this.liveStreamStatistic.registerPlaybackStateChanged(e),this.event("playbackStateChanged").raise()},t.prototype.onPlaybackBitrateChanged=function(e){this.liveStreamStatistic.registerPlaybackBitratechanged(e.bitrate)},t.prototype.onDownloadBitrateChanged=function(e){this.liveStreamStatistic.registerDownloadBitratechanged(e.bitrate)},t.prototype.onFullscreenChange=function(e){this.logger.debug("fullscreenchange, isFullscreen="+e.isFullscreen),this.event("fullscreenToggled").raise(e.isFullscreen),this.liveStreamStatistic.registerFullScreenChange(e.isFullscreen)},t.prototype.onPotentialMediaFreeze=function(){this.logger.warn("Player detected a potential media freeze"),this.liveStreamStatistic.registerPotentialMediaFreeze()},t.prototype.onMute=function(){this.liveStreamStatistic.registerMute(!0)},t.prototype.onUnmute=function(){this.liveStreamStatistic.registerMute(!1)},t.prototype.onVolumeChange=function(e){this.liveStreamStatistic.registerVolumeChange(e.value)},t.prototype.handlePlaybackError=function(e){return i(this,void 0,void 0,function(){var t,n,r,i,s,l=this;return o(this,function(o){switch(o.label){case 0:return t=4194307,this.playerState="Error",n=c.stringifyObject(e),this.logger.info("Playback error "+n),e.errorCode?(e.errorCode&t)===t?(this.isPlaybackUnsupported=!0,this.raisePlaybackError("UnsupportedPlatform",n),this.destroy(),[2]):(this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime,r=e.errorCode,i=268435455&r,this.logger.error("onError: errorCode: 0x"+r.toString(16)+", errorCodeExcludingTech: 0x"+i.toString(16)+", message: "+e.message),this.retryCount<this.configProvider.config.maxRetryCount&&-1!==a.indexOf(p,i)?(setTimeout(function(){l.logger.info("Retry loading stream because of error code: 0x"+r.toString(16)),l.retryCount++,l.raisePlaybackError("PlaybackRetried",n),l.setPlayerSource(l.selectedStreamDetails)},this.configProvider.config.sourceResetTimeoutInMs),[3,4]):[3,1]):(this.logger.error("onError: error details are not available"),this.raisePlaybackError("Unknown",n),[2]);case 1:return 2097753===i||e.message&&e.message.includes(2097753..toString(16))?(this.raisePlaybackError("NetworkError",n),this.destroy(),[3,4]):[3,2];case 2:return[4,this.switchStreamingUrl(i)];case 3:(s=o.sent())||(this.raisePlaybackError("PlaybackError",n),this.destroy()),o.label=4;case 4:return[2]}})})},t.prototype.raisePlaybackError=function(e,t){this.liveStreamStatistic.registerPlaybackError(e,t),this.event("playbackError").raise(e,t)},t}(s.default);t.AmpLiveStreamPlayer=h;var g=function(){function e(e,t){var n=this;this.amp=e,this.availableCultures=t,this.selectedCulture="",this.disposable=this.amp.on("captionsToggled",function(e,t,r){n.selectedCulture=e?t:""})}return e.prototype.addCues=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.amp.message("addCues").send(e)];case 1:return t.sent(),[2]}})})},e.prototype.clearCues=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this.amp.message("clearCues").send()];case 1:return e.sent(),[2]}})})},e.prototype.showCaptions=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.amp.message("showCaptions").send(e)];case 1:return t.sent(),[2]}})})},e.prototype.getSelectedCulture=function(){return this.selectedCulture},e.prototype.getAvailableCultures=function(){return this.availableCultures},e.prototype.dispose=function(){this.disposable.dispose(),this.amp=null},e}()},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},a=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.AmpPlayerWrapper=void 0;var s=n(12),c=n(25),l=n(92),u=function(e){function t(t){var n=e.call(this)||this;return n.logger=t,n.resultsMap=new Map,n.on("statsUpdated",function(e){n.lastDiagnosticData=e}),n.on("log",function(e,t){return n.logger[e](t)}),n}return r(t,e),t.prototype.initialize=function(e,t,n){return i(this,void 0,void 0,function(){var r,i;return o(this,function(o){switch(o.label){case 0:return r={config:n.config,playerConfig:n.playerConfig},i=this,[4,l.setupAmpAndBuildPipe(e,n.config.loadType,n.playerConfig.nonce)];case 1:return i.pipe=o.sent(),this.pipe.registerObserver(this),[4,this.message("configure").send(t,r)];case 2:return o.sent(),[2]}})})},t.prototype.message=function(e){var t=this;return{send:this.fromMessage(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t.sendMessageImpl.apply(t,a([e],n))})}},t.prototype.fromMessage=function(e){return e},t.prototype.sendMessageImpl=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.pipe.sendMsg(this.buildMsg(e,t)),this.waitForCompletion(e)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.pipe.sendMsg(this.buildMsg("dispose")),this.pipe.dispose()},t.prototype.getPlayerDiagnosticSnapshot=function(){return this.lastDiagnosticData},t.prototype.processMessage=function(e){switch(e.msgType){case"CommandResult":var t=this.resultsMap.get(e.cmd);t&&(e.error?t.reject(e.error):t.resolve(),e.error&&this.logger.warn("remote command failed: "+e.cmd+", "+e.error),this.resultsMap.delete(e.cmd));break;case"AmpNotification":var n=this.event(e.name);n.raise.apply(n,e.args);break;default:this.logger.warn("unexpected message received: "+JSON.stringify(e))}},t.prototype.buildMsg=function(e,t){return{msgType:"Command",cmd:e,args:t}},t.prototype.waitForCompletion=function(e){var t=this.resultsMap.get(e);t&&t.reject(new Error("function "+e+" is invoked again, before previos call is completed"));var n=s.defer();return this.resultsMap.set(e,n),n.promise},t}(c.default);t.AmpPlayerWrapper=u},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0}),t.setupAmpAndBuildPipe=void 0;var o=n(12),a=n(93),s=function(){function e(){}return e.prototype.sendMsg=function(e){this.peer.onMsg(e)},e.prototype.registerObserver=function(e){this.observer=e},e.prototype.onMsg=function(e){this.observer&&this.observer.processMessage(e)},e.prototype.connect=function(e){this.peer=e},e.prototype.dispose=function(){this.peer=null,this.observer=null},e}(),c=function(){function e(e){this.container=e}return Object.defineProperty(e.prototype,"contextWindow",{get:function(){return this.container.ownerDocument.defaultView},enumerable:!1,configurable:!0}),e.prototype.sendMsg=function(e){this.iframe.contentWindow.postMessage(e,"*")},e.prototype.registerObserver=function(e){this.observer=e},e.prototype.dispose=function(){this.contextWindow&&this.contextWindow.removeEventListener("message",this.processMsg),this.container.removeChild(this.iframe),this.iframe=null},e.prototype.initializeIframe=function(e){var t=o.defer();return this.iframe=this.container.ownerDocument.createElement("iframe"),this.iframe.id="amp-iframe",this.iframe.sandbox.add("allow-scripts"),this.iframe.allowFullscreen=!0,this.iframe.allow="autoplay",this.iframe.style.height="100%",this.iframe.style.width="100%",this.iframe.style.border="none",this.iframe.onload=function(){t.resolve()},this.iframe.onerror=function(){t.reject("iframe load failed")},this.setIframeContent(e),this.container.appendChild(this.iframe),this.processMsg=this.processMsg.bind(this),this.contextWindow.addEventListener("message",this.processMsg),t.promise},e.prototype.processMsg=function(e){"null"===e.origin&&e.source===this.iframe.contentWindow&&this.observer&&this.observer.processMessage(e.data)},e.prototype.setIframeContent=function(e){var t=a.buildAmpEmbededSrc(),n="\n            <html class style='height: 100%; width: 100%; overflow: hidden'>\n            <head></head>\n            <body class style='height: 100%; width: 100%; margin: 0px'>\n                "+(e?"<script nonce='"+e+"'> "+t+"<\/script>":"<script> "+t+"<\/script>")+"\n            </body>\n            </html>\n        ";this.iframe.srcdoc=n},e}();t.setupAmpAndBuildPipe=function(e,t,n){return r(this,void 0,void 0,function(){var r,o,l;return i(this,function(i){switch(i.label){case 0:return 0===t?(r=new s,o=new s,r.connect(o),o.connect(r),o.registerObserver(new a.AmpCommunicationHandler(o,e)),[2,r]):1!==t?[3,2]:(l=new c(e),[4,l.initializeIframe(n)]);case 1:return i.sent(),[2,l];case 2:throw new Error("Unsupported communication type "+t)}})})}},function(e,t,n){"use strict";function r(){var e=a(),t=s();return function(){function n(e,t){this.container=e,this.eventsHandler=t,this.playerEvents=[],this.maxMemoryTraceLogCount=1e4,this.videoSourceType="application/dash+xml",this.sdnPluginLoaded=!1,this.statsTimer=-1,this.statsInterval=1e3}return Object.defineProperty(n.prototype,"contextWindow",{get:function(){return this.container.ownerDocument.defaultView},enumerable:!1,configurable:!0}),n.prototype.configure=function(e,t){this.liveStreamOptions=e,this.configProvider=t,this.statsInterval=t.config.playerTelemetryTickMs||this.statsInterval,this.maxMemoryTraceLogCount=t.config.maxPlayerMemoryTraceLogCount||this.maxMemoryTraceLogCount},n.prototype.loadPlayerScript=function(){var e=this;this.log("loadPlayerScript started");for(var t=Promise.resolve(),n=this.configProvider.playerConfig.nonce,r=this.configProvider.playerConfig.css,i=0;i<r.length;i++)!function(i){t=t.then(function(){return e.loadCss(e.container.ownerDocument,r[i],n)})}(i);for(var o=this.configProvider.playerConfig.src,i=0;i<o.length;i++)!function(r){t=t.then(function(){return e.loadScript(e.container.ownerDocument,o[r],n)})}(i);return t},n.prototype.tryLoadSdnPlugin=function(){var e=this;return this.sdnPluginLoaded||!this.liveStreamOptions.sdn?Promise.resolve():this.configProvider.config.allowSdnPlugins?(this.log("tryLoadSdnPlugin started"),this.loadScript(this.container.ownerDocument,this.liveStreamOptions.sdn.url,this.configProvider.playerConfig.nonce).then(function(){e.sdnPluginLoaded=!0,e.log("tryLoadSdnPlugin done")})):(this.log("Loading SDN plugins is not allowed"),Promise.reject("Loading SDN plugins is not allowed"))},n.prototype.createVideoElement=function(){this.log("createVideoElement started"),this.video=this.container.ownerDocument.createElement("video"),this.video.id="amp-player",this.video.setAttribute("playsinline","");var e=this.configProvider.playerConfig.lang;e&&(this.video.setAttribute("lang",e),this.log("createVideoElement: language set to "+e));for(var t=this.configProvider.playerConfig.styles,n=0;n<t.length;n++)this.video.classList.add(t[n]);this.container.appendChild(this.video),this.log("createVideoElement done")},n.prototype.createAmp=function(){this.log("createAmp started"),this.createVideoElement();var n=this.getAmpOptions();if(this.playerInstance=this.contextWindow.amp(this.video.id,n),!this.playerInstance)throw this.log("createAmp failed","error"),new Error("playerInstance is null");this.diagnosticProvider=new e(this.playerInstance,this.contextWindow);var r={isOverflow:this.liveStreamOptions.overflow,logFn:this.log.bind(this),removeEmptyDefaultTextTrack:this.configProvider.config.removeEmptyDefaultTextTrack};this.captionsControl=new t(this.playerInstance,this,r),this.registerPlayerEvents(),this.log("createAmp done")},n.prototype.setSource=function(e){if(this.log("setSource started"),!this.playerInstance)throw this.log("setSource failed: playerInstance is null","error"),new Error("playerInstance is null");var t={src:e.url,type:this.videoSourceType,protectionInfo:e.decryptionToken?[{type:"AES",authenticationToken:e.decryptionToken}]:null};this.configureSdnSource(t,e),this.playerInstance.src([t],this.getTextTracks()),this.log("setSource done")},n.prototype.setPlayTime=function(e){e&&(this.log("setPlayerTime: "+e),this.playerInstance.currentTime(e))},n.prototype.dispose=function(){this.log("dispose started"),this.diagnosticProvider&&(this.stopStatsColletion(),this.diagnosticProvider.dispose(),this.diagnosticProvider=null),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null),this.playerInstance&&(this.removeEventListeners(),this.playerInstance.getMemoryLog(!0),this.playerInstance.dispose(),this.playerInstance=null),this.eventsHandler.ampDisposed(),this.video&&this.video.parentNode&&(this.video.parentNode.removeChild(this.video),this.video=null),this.log("dispose done"),this.eventsHandler=null},n.prototype.showCaptions=function(e){this.log("showCaptions: "+e),this.captionsControl.showCaptions(e)},n.prototype.addCues=function(e){this.captionsControl.addCues(e)},n.prototype.clearCues=function(){this.captionsControl.clearCues()},n.prototype.captionsToggled=function(e,t,n){this.log("captionsToggled: "+e+" for culture "+t+" at "+n),this.eventsHandler.message("captionsToggled").send(e,t,n)},n.prototype.getAmpOptions=function(){var e=[];this.configProvider.config.debug?e.push({target:"memory",maxMemoryTraceCount:this.maxMemoryTraceLogCount}):e.push({target:"console"});var t={TraceTargets:e,maxLogLevel:this.configProvider.config.debug?3:2},n={techOrder:this.configProvider.config.techOrder,nativeControlsForTouch:!1,autoplay:!0,preload:"auto",controls:!this.liveStreamOptions.overflow,logo:{enabled:!1},height:"100%",width:"100%",traceConfig:t,staleDataTimeLimitInSec:this.configProvider.config.staleDataTimeLimitInSec,heuristicProfile:this.contextWindow.amp.Player.HeuristicProfile.HighQuality,customPlayerSettings:{customHeuristicSettings:{bandwidthTestWithTimeThresholdDuringLive:!1,windowSizeHeuristics:this.configProvider.config.useBrowserWindowSizeForBitRate,useBrowserWindowForWindowSizeRule:this.configProvider.config.useBrowserWindowSizeForBitRate,useVariableFragmentSizeMode:!0}},plugins:{}};return this.initializePluginOptions(n),n},n.prototype.isStreamValid=function(e){return e&&!!e.url&&!!e.decryptionToken},n.prototype.initializePluginOptions=function(e){if(this.sdnPluginLoaded&&this.liveStreamOptions.sdn){var t=this.liveStreamOptions.correlationId,n=this.isStreamValid(this.liveStreamOptions.stream)?this.liveStreamOptions.stream:this.liveStreamOptions.altStream;switch(this.liveStreamOptions.sdn.name){case"hive":return void(e.plugins={hive:{debugLevel:this.configProvider.config.debug?"debug":"notice",telemetryId:t}});case"kollective":return void(e.plugins={kollectiveSDN:{playbackInfo:this.parseJson(n.sdnContext,"kollective sdn context"),reportSessionId:t}});case"ramp":var r=this.parseJson(n.sdnContext,"ramp sdn context");return this.configProvider.config.debug&&(r.verbose=!0),void(e.plugins={RampMOPlugin:r});case"peer5":return void(e.plugins={peer5:this.parseJson(n.sdnContext,"peer5 sdn context")});default:return}}},n.prototype.getTextTracks=function(){var e=[];if(this.liveStreamOptions.supportedSubtitleLanguages)for(var t=this.liveStreamOptions.supportedSubtitleLanguages,n=0;n<t.length;n++)e.push({id:"amp-player_"+t[n].culture,kind:this.configProvider.config.textTrackKind,label:t[n].name||t[n].culture,src:"",srclang:t[n].culture.substr(0,2)});return e},n.prototype.configureSdnSource=function(e,t){if(this.sdnPluginLoaded&&this.liveStreamOptions.sdn)switch(this.liveStreamOptions.sdn.name){case"hive":e.sdnList=[{sdnName:"hive",sdnUrl:t.sdnContext}];break;case"kollective":e.sdnList=[{sdnName:"kollectiveSDN",playbackInfo:this.parseJson(t.sdnContext,"kollective sdn list context")}];break;case"ramp":case"peer5":e.sdnList=[];break;default:return}},n.prototype.registerPlayerEvents=function(){var e=this;this.registerPlayerEvent(this.contextWindow.amp.eventName.error,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.error)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.canplaythrough,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.canplaythrough)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.play,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.play)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.playing,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.playing)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.pause,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.pause)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.resume,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.resume)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.start,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.start)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.ended,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.ended)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.seeking,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.seeking)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.seeked,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.seeked)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadedmetadata,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.loadedmetadata)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.waiting,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.waiting)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.playbackbitratechanged,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.playbackbitratechanged)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.downloadbitratechanged,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.downloadbitratechanged)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.fullscreenchange,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.fullscreenchange)}),this.registerPlayerEvent("potentialMediaFreeze",function(){return e.onAmpEvent("potentialMediaFreeze")}),this.registerPlayerEvent(this.contextWindow.amp.eventName.mute,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.mute)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.unmute,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.unmute)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.volumechange,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.volumechange)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadeddata,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.loadeddata)}),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadstart,function(){return e.onAmpEvent(e.contextWindow.amp.eventName.loadstart)})},n.prototype.registerPlayerEvent=function(e,t){this.playerEvents.push(e),this.playerInstance.addEventListener(e,t)},n.prototype.removeEventListeners=function(){var e=this;this.playerEvents.forEach(function(t){e.playerInstance.removeEventListener(t)})},n.prototype.onAmpEvent=function(e){var t;switch(e){case this.contextWindow.amp.eventName.error:var n=this.playerInstance.error();t={currentTime:this.playerInstance.currentTime(),errorCode:n?n.code:0,message:n?n.message:""};break;case this.contextWindow.amp.eventName.canplaythrough:this.initializeStatsColletion();break;case this.contextWindow.amp.eventName.loadedmetadata:this.captionsControl.initialize();break;case this.contextWindow.amp.eventName.fullscreenchange:t={isFullscreen:this.playerInstance.isFullscreen()};break;case this.contextWindow.amp.eventName.playbackbitratechanged:t={bitrate:this.playerInstance.currentPlaybackBitrate()};break;case this.contextWindow.amp.eventName.downloadbitratechanged:t={bitrate:this.playerInstance.currentDownloadBitrate()};break;case this.contextWindow.amp.eventName.seeked:t={captionsTimestamp:this.liveStreamOptions.overflow?this.playerInstance.currentMediaTime():this.playerInstance.currentTime()};break;case this.contextWindow.amp.eventName.volumechange:t={value:this.playerInstance.volume()}}this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()),this.eventsHandler.message("stateChanged").send(e,t)},n.prototype.initializeStatsColletion=function(){var e=this;this.diagnosticProvider.initialize(),this.statsTimer=window.setInterval(function(){e.eventsHandler&&e.eventsHandler.message("statsUpdated").send(e.getPlayerDiagnostics())},this.statsInterval)},n.prototype.stopStatsColletion=function(){this.eventsHandler.message("statsUpdated").send(this.getPlayerDiagnostics()),-1!==this.statsTimer&&window.clearInterval(this.statsTimer),this.statsTimer=-1},n.prototype.getPlayerDiagnostics=function(){var e=this.diagnosticProvider.getPlayerDiagnosticSnapshot();return e.statsInterval=this.statsInterval,this.configProvider.config.debug&&(e.memoryLog=this.playerInstance.getMemoryLog(!0)),e},n.prototype.log=function(e,t){void 0===t&&(t="info");var n="[AmpPlayer"+(1===this.configProvider.config.loadType?"IFrame":"")+"]"+": "+e;this.configProvider.config.debug&&console.log(n),this.eventsHandler.message("log").send(t,n)},n.prototype.getElementLoadPromise=function(e){return new Promise(function(t,n){e.onload=function(){return t()},e.onerror=function(e){return n(e)}})},n.prototype.loadScript=function(e,t,n){var r=e.createElement("script"),i=this.getElementLoadPromise(r);return r.src=t,n&&(r.nonce=n),e.head.appendChild(r),i},n.prototype.loadCss=function(e,t,n){var r=e.createElement("link"),i=this.getElementLoadPromise(r);return r.href=t,r.rel="stylesheet",n&&(r.nonce=n),e.head.appendChild(r),i},n.prototype.parseJson=function(e,t){try{return JSON.parse(e)}catch(e){throw this.log("Error parsing JSON for "+t+", error: "+JSON.stringify(e)),e}},n}()}function i(){var e=r();return function(){function t(t,n){this.pipe=t,this.amp=new e(n,this)}return t.prototype.processMessage=function(e){var t=this;"Command"===e.msgType&&Promise.resolve().then(function(){return t.amp[e.cmd].apply(t.amp,e.args)}).catch(function(e){return e}).then(function(n){t.pipe&&t.pipe.sendMsg({msgType:"CommandResult",cmd:e.cmd,error:n})})},t.prototype.message=function(e){var t=this;return{send:this.fromMessage(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t.sendMessageImpl(e,n)})}},t.prototype.ampDisposed=function(){this.pipe.dispose(),this.pipe=null,this.amp=null},t.prototype.fromMessage=function(e){return e},t.prototype.sendMessageImpl=function(e,t){this.pipe.sendMsg({msgType:"AmpNotification",name:e,args:t})},t}()}function o(){function e(e){return"CommandResult"===e.msgType}function t(e){var t="unknown";try{t="string"==typeof e?e:"toString"in e&&0!==e.toString().indexOf("[object")?e.toString():JSON.stringify(e)}catch(t){console.error("Failed to stringify error",e)}finally{return t}}return function(){function n(){this.processMsg=this.processMsg.bind(this),window.addEventListener("message",this.processMsg)}return n.prototype.sendMsg=function(n){try{var r=n;e(n)&&n.error instanceof Event&&(console.debug("Stringifying error Event before trying to postMessage:",n),r={msgType:n.msgType,cmd:n.cmd,error:"Event: "+t(n.error)}),this.postMessage(r)}catch(e){console.error("Unexpected exception caught from postMessage.\n","message:",n,"\n","exception:",e);var i={msgType:"AmpNotification",name:"log",args:["error","Unexpected error with postMessage: "+t(e)]};throw this.postMessage(i),e}},n.prototype.registerObserver=function(e){this.observer=e},n.prototype.dispose=function(){window.removeEventListener("message",this.processMsg),this.observer=null},n.prototype.processMsg=function(e){this.observer.processMessage(e.data)},n.prototype.postMessage=function(e){window.parent.postMessage(e,"*")},n}()}function a(){return function(){function e(e,t){this.playerInstance=e,this.contextWindow=t,this.videoDownloadLatencies=[],this.audioDownloadLatencies=[],this.audioDownloadBytes=[],this.videoDownloadBytes=[],this.videoDownloadSuccessCount=0,this.audioDownloadSuccessCount=0,this.videoDownloadFailureCount=0,this.audioDownloadFailureCount=0,this.audioDownloadFailures=[],this.videoDownloadFailures=[],this.slidingWindowLengthForLatency=5,this.slidingWindowLengthForDownloadBytes=30,this.downloadFailuresLimit=10,this.onAudioDownloadCompleted=this.onAudioDownloadCompleted.bind(this),this.onAudioDownloadError=this.onAudioDownloadError.bind(this),this.onVideoDownloadCompleted=this.onVideoDownloadCompleted.bind(this),this.onVideoDownloadError=this.onVideoDownloadError.bind(this)}return e.prototype.initialize=function(){this.playerVideoBuffer=this.playerInstance.videoBufferData(),this.playerAudioBuffer=this.playerInstance.audioBufferData(),this.registerForPlayerBufferEvents()},e.prototype.getPlayerDiagnosticSnapshot=function(){var e,t;if(!this.playerInstance)return null;var n=window.screen,r=this.playerInstance.error(),i=function(e){var t=e.slice().sort();return t[Math.floor(t.length/2)]};return{errorCode:r&&r.code||0,currentPlayPosition:this.playerInstance.currentTime(),currentMediaTime:null!==(e=this.playerInstance.currentMediaTime())&&void 0!==e?e:this.playerInstance.currentTime(),currentAbsoluteTime:null!==(t=this.playerInstance.currentAbsoluteTime())&&void 0!==t?t:this.playerInstance.currentTime(),livePosition:this.playerInstance.duration(),playbackBitrate:this.playerInstance.currentPlaybackBitrate(),downloadBitrate:this.playerInstance.currentDownloadBitrate(),perceivedBandwidth:this.playerVideoBuffer?this.playerVideoBuffer.perceivedBandwidth:0,tech:this.playerInstance.currentTechName(),playerVersion:this.playerInstance.getAmpVersion(),isP2PSdnUsed:this.isP2PSdnUsed(),sdnName:this.sdnName(),heuristicProfile:this.playerInstance.currentHeuristicProfile(),encryption:this.playerInstance.currentProtectionInfo()?this.playerInstance.currentProtectionInfo().type:"",streamType:this.playerInstance.isLive()?"LIVE":"DVR",audioStream:this.getAudioStreamData(),videoStream:this.getVideoStreamData(),muted:this.playerInstance.muted(),volume:this.playerInstance.volume(),audioBufferLength:this.playerAudioBuffer?this.playerAudioBuffer.bufferLevel:0,videoBufferLength:this.playerVideoBuffer?this.playerVideoBuffer.bufferLevel:0,mediaHeight:this.playerInstance.videoHeight(),mediaWidth:this.playerInstance.videoWidth(),playerHeight:this.playerInstance.height(),playerWidth:this.playerInstance.width(),windowWidth:n?n.width:0,windowHeight:n?n.height:0,isFullscreen:this.playerInstance.isFullscreen(),avgAudioDownloadLatency:i(this.audioDownloadLatencies),avgVideoDownloadLatency:i(this.videoDownloadLatencies),avgAudioDownloadBytes:i(this.audioDownloadBytes),avgVideoDownloadBytes:i(this.videoDownloadBytes),maxVideoDownloadBytes:Math.max.apply(null,this.videoDownloadBytes),minVideoDownloadBytes:Math.min.apply(null,this.videoDownloadBytes),audioDownloadFailureCount:this.audioDownloadFailureCount,audioDownloadSuccessCount:this.audioDownloadSuccessCount,videoDownloadFailureCount:this.videoDownloadFailureCount,videoDownloadSuccessCount:this.videoDownloadSuccessCount,audioDownloadFailures:this.audioDownloadFailures,videoDownloadFailures:this.videoDownloadFailures}},e.prototype.dispose=function(){this.unsubscribeFromPlayerBufferEvents()},e.prototype.registerForPlayerBufferEvents=function(){this.playerVideoBuffer&&(this.playerVideoBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onVideoDownloadCompleted),this.playerVideoBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onVideoDownloadError)),this.playerAudioBuffer&&(this.playerAudioBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onAudioDownloadCompleted),this.playerAudioBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onAudioDownloadError))},e.prototype.unsubscribeFromPlayerBufferEvents=function(){this.playerVideoBuffer&&(this.playerVideoBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onVideoDownloadCompleted),this.playerVideoBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onVideoDownloadError)),this.playerAudioBuffer&&(this.playerAudioBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onAudioDownloadCompleted),this.playerAudioBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onAudioDownloadError))},e.prototype.isP2PSdnUsed=function(){return!!this.sdnName()},e.prototype.sdnName=function(){return this.playerInstance.options_&&this.playerInstance.options_.sdn&&this.playerInstance.options_.sdn.name},e.prototype.onVideoDownloadCompleted=function(){this.videoDownloadSuccessCount++,this.addToList(this.videoDownloadLatencies,this.playerVideoBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForLatency),this.addToList(this.videoDownloadBytes,this.playerVideoBuffer.downloadCompleted.totalBytes,this.slidingWindowLengthForDownloadBytes)},e.prototype.onAudioDownloadCompleted=function(){this.audioDownloadSuccessCount++,this.addToList(this.audioDownloadLatencies,this.playerAudioBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForLatency),this.addToList(this.audioDownloadBytes,this.playerAudioBuffer.downloadCompleted.totalBytes,this.slidingWindowLengthForDownloadBytes)},e.prototype.addToList=function(e,t,n){e.push(t),e.length>n&&e.shift()},e.prototype.onVideoDownloadError=function(){this.videoDownloadFailureCount++,this.addDownloadFailureInfo(this.playerVideoBuffer.downloadFailed,this.videoDownloadFailures)},e.prototype.onAudioDownloadError=function(){this.audioDownloadFailureCount++,this.addDownloadFailureInfo(this.playerAudioBuffer.downloadFailed,this.audioDownloadFailures)},e.prototype.addDownloadFailureInfo=function(e,t){var n={bitrate:e.mediaDownload.bitrate,errorCode:e.code,mediaTime:e.mediaDownload.mediaTime,message:e.message,timestamp:Date.now()};this.addToList(t,n,this.downloadFailuresLimit)},e.prototype.getAudioStreamData=function(){var e=this.playerInstance.currentAudioStreamList();if(e)try{var t=e.streams[e.enabledIndices[0]];return{bitrate:t.bitrate,codec:t.codec,enabled:t.enabled,name:t.name,language:t.language}}catch(e){return}},e.prototype.getVideoStreamData=function(){var e=this.playerInstance.currentVideoStreamList();if(e)try{var t=e.streams[e.selectedIndex],n=this.playerInstance.currentPlaybackBitrate(),r=t.tracks?t.tracks.map(function(e){return{bitrate:e.bitrate,codec:e.codec,height:e.height,id:e.id,selectable:e.selectable,width:e.width}}).find(function(e){return e.bitrate===n}):null;return{codec:t.codec,name:t.name,currentTrack:r}}catch(e){return}},e}()}function s(){return function(){function e(e,t,n){var r;this.player=e,this.toggleListener=t,this.config=n,this.onTextTrackChanged=this.onTextTrackChanged.bind(this),this.isHtml5Tech="html5"===(null===(r=this.player.currentTechName())||void 0===r?void 0:r.toLowerCase())}return e.prototype.dispose=function(){this.unsubscribeFromTrackEvents(),this.player=null,this.toggleListener=null},e.prototype.initialize=function(){for(var e=this.getPlayerTextTracksAsArray(),t=0;t<e.length;t++)e[t].mode="disabled";this.subscribeOnTrackEvents()},e.prototype.addCues=function(e){var t=this.player.getCurrentTextTrack();if(t)for(var n=this.isHtml5Tech?this.getCurrentTime():this.player.currentAbsoluteTime()||1,r=this.getCurrentTime(),i=this.config.isOverflow?Math.max(n-r,0):n-r,o=this.isHtml5Tech?window.VTTCue:window.vttjs&&window.vttjs.VTTCue||window.VTTCue,a=0;a<e.length;a++){var s=e[a],c=new o(s.start+i,s.end+i,s.text);c.size=100,!this.containsCue(t,c)&&t.addCue(c)}},e.prototype.clearCues=function(){var e=this.player.getCurrentTextTrack();if(e)try{if(e.cues.setCues_){e.cues_&&(e.cues_.length=0),e.cues.setCues_([]);for(var t=Object.getOwnPropertyNames(e.cues),n=0;n<t.length;n++)"length"!==t[n]&&"length_"!==t[n]&&"cues_"!==t[n]&&delete e.cues[t[n]]}}catch(e){}},e.prototype.showCaptions=function(e){this.config.logFn("[CaptionsControl]: showCaptions("+e+")"),e?this.show():this.hide()},e.prototype.hide=function(){this.previouslyVisibleTextTrack=this.player.getCurrentTextTrack(),this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode="disabled"),this.player.captionToggle&&this.player.captionToggle.hide&&this.player.captionToggle.hide(),this.player.MoreOptionscaptionSubtitleButton&&this.player.MoreOptionscaptionSubtitleButton.hide&&this.player.MoreOptionscaptionSubtitleButton.hide(),this.player.MoreOptionscaptionSettingsButton&&this.player.MoreOptionscaptionSettingsButton.hide&&this.player.MoreOptionscaptionSettingsButton.hide()},e.prototype.show=function(){this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode="showing"),this.player.captionToggle&&this.player.captionToggle.show&&this.player.captionToggle.show(),this.player.MoreOptionscaptionSubtitleButton&&this.player.MoreOptionscaptionSubtitleButton.show&&this.player.MoreOptionscaptionSubtitleButton.show(),this.player.MoreOptionscaptionSettingsButton&&this.player.MoreOptionscaptionSettingsButton.show&&this.player.MoreOptionscaptionSettingsButton.show()},e.prototype.subscribeOnTrackEvents=function(){var e=this.player.textTracks();e&&e.addEventListener&&(e.addEventListener("change",this.onTextTrackChanged),this.isHtml5Tech&&this.config.removeEmptyDefaultTextTrack&&e.addEventListener("addtrack",this.onAddTrack.bind(this)))},e.prototype.unsubscribeFromTrackEvents=function(){var e=this.player.textTracks();e&&e.removeEventListener&&(e.removeEventListener("change",this.onTextTrackChanged),this.isHtml5Tech&&this.config.removeEmptyDefaultTextTrack&&e.removeEventListener("addtrack",this.onAddTrack.bind(this)))},e.prototype.onTextTrackChanged=function(){var e=this.player.getCurrentTextTrack();if(!e||!this.currentTextTrack||this.currentTextTrack.label!==e.label||this.currentTextTrack.mode!==e.mode){if(e||this.currentTextTrack){var t=!!e&&"showing"===e.mode,n=this.getCulture(e||this.currentTextTrack),r=this.getCurrentTime();this.toggleListener.captionsToggled(t,n,r),this.config.logFn("[CaptionsControl]: track changed: culture '"+n+"', timestamp '"+r+"'")}this.currentTextTrack=e}},e.prototype.onAddTrack=function(e){var t,n,r=null===e||void 0===e?void 0:e.track;"captions"===(null===r||void 0===r?void 0:r.kind)&&!r.label&&!r.id&&(null===(n=null===(t=this.player)||void 0===t?void 0:t.textTracks_)||void 0===n||n.removeTrack_(r),this.config.logFn("[CaptionsControl]: removing default empty text track"))},e.prototype.getCurrentTime=function(){return this.isHtml5Tech?this.player.currentTime():(this.config.isOverflow?this.player.currentMediaTime():this.player.currentTime())||1},e.prototype.getCulture=function(e){if(!e)return"";if(e.id){var t=e.id.split("_")[1];if(t)return t}return""},e.prototype.getPlayerTextTracksAsArray=function(){var e=this.player.textTracks();return e&&e.tracks_||[]},e.prototype.containsCue=function(e,t){return Array.from((null===e||void 0===e?void 0:e.cues)||[]).some(function(e){return e.start===t.start&&e.end===t.end&&e.text===t.text})},e}()}function c(){var e=o(),t=i(),n=new e,r=new t(n,document.body);n.registerObserver(r)}Object.defineProperty(t,"__esModule",{value:!0}),t.buildAmpEmbededSrc=t.CaptionsControlToggleProvider=t.AmpDiagnosticProvider=t.IFrameMessageHandler=t.AmpCommunicationHandler=t.AmpPlayer=void 0,t.AmpPlayer=r(),t.AmpCommunicationHandler=i(),t.IFrameMessageHandler=o(),t.AmpDiagnosticProvider=a(),t.CaptionsControlToggleProvider=s(),t.buildAmpEmbededSrc=function(){var e="("+c.toString()+")();";return e+=r.toString()+";",e+=o.toString()+";",e+=i.toString()+";",e+=s.toString()+";",e+=a.toString()+";",e+="//# sourceURL=TsCallingAmpPlayer.js"}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.LiveStreamRenderer=void 0;var i=function(e){function t(t,n){var r=e.call(this)||this;return r.player=t,r.logger=n,r.playerSubs=[],r.subscribeForPlayerEvents(),r}return r(t,e),Object.defineProperty(t.prototype,"isRendering",{get:function(){return!!this.player&&this.player.isRendering()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"streamSize",{get:function(){return this.player?this.player.getStreamSize():{width:0,height:0}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendererType",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frameType",{get:function(){return-1},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.stopPlayer(),e.prototype.dispose.call(this)},t.prototype.captions=function(){return this.player.getCaptionsControl()},t.prototype.getStats=function(){throw new Error("Method not implemented.")},t.prototype.setScalingMode=function(e,t){throw new Error("Method not implemented.")},t.prototype.captureFrame=function(e,t){throw new Error("Method not implemented.")},t.prototype.stopPlayer=function(){var e=this.player;this.player=null,e&&(this.logger.info("stopPlayer"),this.unsubscribeFromPlayerEvents(),e.stop())},t.prototype.subscribeForPlayerEvents=function(){var e=this;this.playerSubs.push(this.player.on("fullscreenToggled",function(t){return e.onFullScreenToggled(t)})),this.playerSubs.push(this.player.on("captionsToggled",function(t,n,r){return e.onCaptionsToggled(t,n,r)}))},t.prototype.unsubscribeFromPlayerEvents=function(){for(var e=0,t=this.playerSubs;e<t.length;e++)t[e].dispose();this.playerSubs=[]},t.prototype.onFullScreenToggled=function(e){this.event("fullScreenToggled").raise(e)},t.prototype.onCaptionsToggled=function(e,t,n){this.logger.info("Turned captions "+(e?"ON":"OFF")+" for culture ["+t+"] at player time ["+n+"]"),this.event("captionsToggled").raise(e,t,n)},t}(n(25).default);t.LiveStreamRenderer=i},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveStreamStatistic=void 0;var i=n(18),o=n(29),a=n(67),s=function(){function e(e,t){this.name=e,this.start(t)}return e.prototype.start=function(e){a.assert(!this.startTime,"already started"),this.startTime=Date.now(),this.details=e},e.prototype.complete=function(){a.assert(this.startTime,"not started"),a.assert(void 0===this.duration,"already completed"),this.duration=Date.now()-this.startTime},e.prototype.fail=function(e){this.failReason=e,this.complete()},e.prototype.getTelemetryEvent=function(){a.assert(this.startTime,"not started"),a.assert(void 0!==this.duration,"not completed");var e={name:this.name,startTime:this.startTime,duration:this.duration};return this.failReason&&(e.failReason=this.failReason),this.details&&(e.details=this.details),e},e}(),c=function(){function e(e,t){this.config=e,this.logger=t,this.currentScenarioMap=new Map,this.playerEvents=[],this.playbackEvents=[],this.playerDiagnosticsLog={perceivedBandwidth:[],videoBufferLength:[],playerHeight:[],playerWidth:[],mediaHeight:[],mediaWidth:[],windowWidth:[],windowHeight:[],currentPlayPosition:[],currentMediaTime:[],statsInterval:-1},this.maxPlayerPlaybackEventCount=e.maxPlayerPlaybackEventCount||5,this.maxPlayerDiagnosticsCount=e.maxPlayerDiagnosticsCount||5,this.maxPlayerMemoryTraceLogCount=e.maxPlayerMemoryTraceLogCount||100,this.config.debug&&(this.playerDiagnosticsLog.memoryLog=[])}return Object.defineProperty(e.prototype,"playerDiagnosticSnapshot",{get:function(){return this.currentPlayerDiagnosticSnapshot},enumerable:!1,configurable:!0}),e.prototype.registerStatsUpdated=function(e){var t=this;this.currentPlayerDiagnosticSnapshot=e,Object.keys(this.playerDiagnosticsLog).forEach(function(n){var r=n,i=t.playerDiagnosticsLog[r];if(Array.isArray(i)){i.push(e[r]);var o="memoryLog"===r&&i.length>t.maxPlayerMemoryTraceLogCount,a="memoryLog"!==r&&i.length>t.maxPlayerDiagnosticsCount;(o||a)&&i.splice(0,1)}else t.playerDiagnosticsLog[r]=e[r]})},e.prototype.registerPlayerLoadAttempt=function(){this.registerScenario("Load")},e.prototype.registerPlayerLoadSucceeded=function(){this.completeScenario("Load")},e.prototype.registerPlayerLoadFailed=function(e){this.completeScenario("Load",e)},e.prototype.registerSetSourceAttempt=function(){this.registerScenario("SetSource")},e.prototype.registerSetSourceSucceeded=function(){this.completeScenario("SetSource")},e.prototype.registerSetSourcedFailed=function(e){this.completeScenario("SetSource",e)},e.prototype.registerSdnPluginLoad=function(e,t){this.registerScenario("SdnPluginLoad",e);var n=t?void 0:"script load failed";this.completeScenario("SdnPluginLoad",n)},e.prototype.registerPlayerDestroyed=function(){this.registerScenario("Destroyed"),this.completeScenario("Destroyed")},e.prototype.registerPlaybackStateChanged=function(e){this.registerPlaybackEvent("StateChanged",e)},e.prototype.registerPlaybackError=function(e,t){this.registerPlaybackEvent("Error",{errorType:e,details:t})},e.prototype.registerDownloadBitratechanged=function(e){this.registerPlaybackEvent("BitrateChangedDownload",e)},e.prototype.registerPlaybackBitratechanged=function(e){this.registerPlaybackEvent("BitrateChangedPlayback",e)},e.prototype.registerPotentialMediaFreeze=function(){this.registerPlaybackEvent("PotentialMediaFreeze")},e.prototype.registerCaptionToggle=function(e,t,n){var r={isEnabled:e,culture:t,playerTime:n};this.registerPlaybackEvent("CaptionsToggled",r)},e.prototype.registerFullScreenChange=function(e){this.registerPlaybackEvent("FullscreenChanged",e)},e.prototype.registerMute=function(e){this.registerPlaybackEvent("Mute",e)},e.prototype.registerVolumeChange=function(e){this.registerPlaybackEvent("Volume",e)},e.prototype.registerPlaybackEvent=function(e,t){var n={eventType:e,timestamp:Date.now(),currentPlayPosition:this.playerDiagnosticSnapshot?this.playerDiagnosticSnapshot.currentPlayPosition:-1};void 0!==t&&(n.payload=this.prepareForTelemetry(t)),this.playbackEvents.push(n),this.playbackEvents.length>this.maxPlayerPlaybackEventCount&&this.playbackEvents.splice(0,1),this.logTelemetryEvent(n)},e.prototype.getPlayerDiagnosticLog=function(){var e=this;if(!this.playerDiagnosticSnapshot)return{};var t=this.playerDiagnosticSnapshot,n=this.playerDiagnosticsLog,i=r(r({},t),n),o={};return Object.keys(i).forEach(function(t){o["player_"+t]=e.prepareForTelemetry(i[t])}),o},e.prototype.getReport=function(e){void 0===e&&(e={});var t=this.playerEvents.map(function(e){return e.getTelemetryEvent()}),n=this.playbackEvents;return r(r(r(r(r({configIds:e.configIds||"",correlationId:e.correlationId||"",eTag:e.eTag||"",isFinal:!!e.isFinal,isIframe:1===this.config.loadType,isOverflow:!!e.overflow,threadId:i.getLoggableThreadId(e.threadId||""),telemetryTickMs:this.playerDiagnosticSnapshot?this.playerDiagnosticSnapshot.statsInterval:-1,tsCallingVersion:o.getTsCallingVersion()||""},this.getInitializationReport(t,n)),this.getPlaybackReport(n)),this.getBitrateReport(n)),this.getSdnReport(t)),this.getPlayerDiagnosticLog())},e.prototype.getInitializationReport=function(e,t){var n=e.find(function(e){return"Load"===e.name}),r=t.find(function(e){return"StateChanged"===e.eventType&&"Ready"===e.payload});return{init_timeLoadToReady:(n&&r?r.timestamp-n.startTime:-1)||-1,init_allEvents:this.prepareForTelemetry(e)}},e.prototype.getPlaybackReport=function(e){var t=e.filter(function(e){return"StateChanged"===e.eventType}),n=t.find(function(e){return"Ready"===e.payload}),r=t.find(function(e){return"Play"===e.payload}),i=t.find(function(e){return"Start"===e.payload}),o=t.find(function(e){return"Playing"===e.payload}),a=n&&r?r.timestamp-n.timestamp:-1,s=r&&i?i.timestamp-r.timestamp:-1,c=i&&o?o.timestamp-i.timestamp:-1,l=t.filter(function(e){return"Seeked"===e.payload}),u=t.filter(function(e){return"Seeking"===e.payload}),d=t.filter(function(e){return"Paused"===e.payload}),p=t.filter(function(e){return"Resume"===e.payload}),h=t.filter(function(e){return"Buffering"===e.payload}),g=["BitrateChangedDownload","BitrateChangedPlayback","Error","Mute","StateChanged","Volume"],f=e.filter(function(e){return"Error"===e.eventType}),_=e.filter(function(e){return"Volume"===e.eventType||"Mute"===e.eventType}),m=e.filter(function(e){return!g.includes(e.eventType)});return{playback_timeReadyToPlay:a||-1,playback_timePlayToStart:s||-1,playback_timeStartToPlaying:c||-1,playback_bufferingEvents:this.prepareForTelemetry(h),playback_errorEvents:this.prepareForTelemetry(f),playback_pauseEvents:this.prepareForTelemetry(d),playback_resumeEvents:this.prepareForTelemetry(p),playback_otherEvents:this.prepareForTelemetry(m),playback_seekedEvents:this.prepareForTelemetry(l),playback_seekingEvents:this.prepareForTelemetry(u),playback_stateChangeEvents:this.prepareForTelemetry(t),playback_volumeEvents:this.prepareForTelemetry(_)}},e.prototype.getBitrateReport=function(e){var t=e.filter(function(e){return"BitrateChangedDownload"===e.eventType}),n=t.sort(function(e){return Number(e.payload)}),i=t.length?{bitrate_downloadChanges:this.prepareForTelemetry(t),bitrate_downloadChangeCount:t.length||-1,bitrate_downloadMin:n[0].payload||-1,bitrate_downloadMax:n[n.length-1].payload||-1}:{},o=e.filter(function(e){return"BitrateChangedPlayback"===e.eventType}),a=o.sort(function(e){return Number(e.payload)}),s=o.length?{bitrate_playbackChanges:this.prepareForTelemetry(o),bitrate_playbackChangeCount:o.length||-1,bitrate_playbackMin:a[0].payload||-1,bitrate_playbackMax:a[a.length-1].payload||-1}:{};return r(r({},i),s)},e.prototype.getSdnReport=function(e){var t=e.filter(function(e){return"SdnPluginLoad"===e.name}),n=t.length?t[t.length-1]:void 0;return{sdn_loaded:!(!n||void 0!==n.failReason),sdn_details:n&&n.details||"",sdn_error:n&&n.failReason||"",sdn_events:this.prepareForTelemetry(t)}},e.prototype.registerScenario=function(e,t){a.assert(!this.currentScenarioMap.has(e),"previous scenario is not completed");var n=new s(e,t);this.currentScenarioMap.set(e,n),this.playerEvents.push(n)},e.prototype.completeScenario=function(e,t){var n=this.currentScenarioMap.get(e);a.assert(n,"no scenario to complete"),t?n.fail(t):n.complete(),this.currentScenarioMap.delete(e)},e.prototype.logTelemetryEvent=function(e){this.config.debug&&(this.logger.debug("PlayerTelemetryEvent: "+JSON.stringify(e)),this.logger.debug("PlayerDiagnosticData: "+JSON.stringify(this.playerDiagnosticSnapshot)))},e.prototype.prepareForTelemetry=function(e){return"boolean"==typeof e?e:"string"==typeof e||void 0===e?e||"":"number"==typeof e?e||-1:JSON.stringify(e)},e}();t.LiveStreamStatistic=c},function(e,t,n){"use strict";function r(){var e;switch(s.getBrowserInfo().name){case"Safari":e=new d;break;default:e=new u}return e.getSettings()}function i(e,t){if(a.isArray(e))return t.slice()}var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.LiveStreamConfigProvider=void 0;var a=n(7),s=n(97),c={src:["//amp.azure.net/libs/amp/latest/[[staticsPath]]/hashed/azuremediaplayer.min-ed39760.js","https://amsglob0cdnstream13.azureedge.net/1-0-3013-17/bundles/player-skin.min.js"],css:["https://amsglob0cdnstream13.azureedge.net/1-0-3013-17/bundles/player-skin.min.css","https://statics.teams.cdn.office.net/evergreen-assets/broadcast/video-player.css?v=2"],styles:["azuremediaplayer","amp-stream-skin","amp-big-play-centered"],lang:"en-us"},l=function(){function e(e,t,n,o){this.clientSettings=t,this.configIds=n,this.logger=o,this.settings=r(),this.logger.info("client settings: "+JSON.stringify(this.clientSettings)),this.settings.debug=!!t&&t.debug,a.mergeWith(this.settings,e,i),this.logger.info("applied settings: "+JSON.stringify(this.settings))}return Object.defineProperty(e.prototype,"playerConfig",{get:function(){return this.clientSettings&&this.clientSettings.playerConfig?this.clientSettings.playerConfig:c},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return this.settings},enumerable:!1,configurable:!0}),e}();t.LiveStreamConfigProvider=l;var u=function(){function e(){this.defaultSettings={staleDataTimeLimitInSec:30,loadType:1,allowSdnPlugins:!0,useBrowserWindowSizeForBitRate:!0,techOrder:["azureHtml5JS","html5"],textTrackKind:"subtitles",streamingUrlSwitchMaxCount:2,ampErrorCodesEligibleForStreamingUrlSwitch:[4194309,2097564,2097556,2097752,2097753,5242884],maxRetryCount:10,sourceResetTimeoutInMs:1e3,sendInitialTelemetryAfterMs:6e4,maxPlayerPlaybackEventCount:50,playerTelemetryTickMs:1e3,maxPlayerDiagnosticsCount:50,maxPlayerMemoryTraceLogCount:1e3,sendTelemetry:!0,removeEmptyDefaultTextTrack:!0}}return e.prototype.getSettings=function(){return this.defaultSettings},e}(),d=function(e){function t(){var t=e.call(this)||this;return t.settings=e.prototype.getSettings.call(t),t.settings.loadType=0,t.settings.allowSdnPlugins=!1,t}return o(t,e),t.prototype.getSettings=function(){return this.settings},t}(u)},function(e,t,n){"use strict";function r(e,t){var n;return t.some(function(t){return!!(n=e.match(t))}),!n||n.length<2?o:n[1]&&n[1].replace(/_/g,".")||o}function i(e){return/iPhone|iPad|iPod|Android|Mobi/i.test(e)?"Mobile":"Desktop"}Object.defineProperty(t,"__esModule",{value:!0}),t.getBrowserInfo=void 0;var o="0.0";t.getBrowserInfo=function(){var e,t={name:"Unknown",engine:"Unknown",version:o,formFactor:"Unknown"},n=[{name:"Edge",engine:"Edge",key:"Edge",masks:[new RegExp("Edge/(\\d+.\\d+)")]},{name:"EdgeAnaheim",engine:"Chromium",key:"EdgA",masks:[new RegExp("Chrome/(\\d+.\\d+)")]},{name:"EdgeAnaheim",engine:"Chromium",key:"Edg",masks:[new RegExp("Edg/(\\d+.\\d+)")]},{name:"Chromium",engine:"Chromium",key:"Chromium",masks:[new RegExp("Chromium/(\\d+.\\d+)")]},{name:"Opera",engine:"Chromium",key:"OPR",masks:[new RegExp("OPR/(\\d+.\\d+)")]},{name:"YandexBrowser",engine:"Chromium",key:"YaBrowser",masks:[new RegExp("YaBrowser/(\\d+.\\d+)")]},{name:"Electron",engine:"Chromium",key:"Electron",masks:[new RegExp("Electron/(\\d+.\\d+)")]},{name:"CiscoOS",engine:"Chromium",key:"Cisco",masks:[new RegExp("Chrome/(\\d+.\\d+)")]},{name:"ZoomRoom",engine:"Chromium",key:"ZoomRoom",masks:[new RegExp("Chrome/(\\d+.\\d+)")]},{name:"Chrome",engine:"Chromium",key:"Chrome",masks:[new RegExp("Chrome/(\\d+.\\d+)")]},{name:"Firefox",engine:"Firefox",key:"Firefox",masks:[new RegExp("Firefox/(\\d+.\\d+)")]},{name:"Safari",engine:"Safari",key:"Safari",masks:[new RegExp("Version/(\\d+.\\d+).*?Safari/")]},{name:"AppleWebView",engine:"AppleWebView",key:"like Mac OS X",masks:[new RegExp("(\\d+_\\d+(_\\d+)?).*like Mac OS X")]},{name:"MSIE",engine:"MSIE",key:"Trident",masks:[new RegExp("MSIE (\\d+.\\d+)"),new RegExp("rv:(\\d+.\\d+)")]}],a=navigator.userAgent;return n.some(function(t){return-1!==a.indexOf(t.key)&&(e={name:t.name,engine:t.engine,version:r(a,t.masks),formFactor:i(a)},!0)}),e||t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.patchLogger=t.initLogger=void 0;var r=n(27),i=n(99),o=n(100),a=n(101);t.initLogger=function(e,t){if(!r.RootToolsManager.isDelegateSet()){var n=new a.RootToolsManagerDelegate(e,t.logger);return r.RootToolsManager.setDelegate(n),{dispose:function(e){r.RootToolsManager.stopAsyncOperations(),n.dispose(e)}}}return null},t.patchLogger=function(e){if(!r.RootToolsManager.isDelegateSet()&&e.logger){var t=new o.RedirectingLogAppender(e.logger);r.LogFactory.instance().addAppender(t)}e.logger=new i.TsCallingLogger("JS.TsCalling.Electron",!1)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TsCallingLogger=void 0;var r=n(27),i=n(7),o=function(){function e(e,t,n){void 0===n&&(n=""),this.ulLogComponent=e,this.ulSafeComponent=t,this._getPrefix=i.isFunction(n)?n:function(){return n},this.logComponent=r.LogFactory.instance().component(this.ulLogComponent),r.LogFactory.instance().declareComponentSafe(this.ulLogComponent,t)}return e.prototype.createChild=function(t){var n=this,r=i.isFunction(t)?t:function(){return t};return new e(this.ulLogComponent,this.ulSafeComponent,function(){return n._getPrefix()?n._getPrefix()+"/"+r():r()})},e.prototype.log=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.debug2(null,t)},t)},e.prototype.debug=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.debug4(null,t)},t)},e.prototype.info=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.debug1(null,t)},t)},e.prototype.warn=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.warn(null,t)},t)},e.prototype.error=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply(function(t){return e.logComponent.error(null,t)},t)},e.prototype._apply=function(e,t){void 0===t&&(t=[]),this._addPrefix(t),e(t.map(function(e){return e instanceof DOMException?e.toString():e}).map(function(e){return i.isObject(e)?JSON.stringify(e):e}).join(", "))},e.prototype._addPrefix=function(e){if(e&&e[0]){var t=this._getPrefix()+" "+e[0];e[0]=t}},e}();t.TsCallingLogger=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.RedirectingLogAppender=void 0;var i=n(27),o=function(e){function t(t){var n=e.call(this,new i.StandardLogFormatter(i.SLF_Flags.Component))||this;return n._logger=t,n}return r(t,e),t.prototype.log=function(e,t,n,r){if(this._logger){var o=e.level<=i.LogLevel.Debug4?this._logger.debug:e.level<=i.LogLevel.Debug2?this._logger.log:e.level<=i.LogLevel.Debug1?this._logger.info:e.level<=i.LogLevel.Warning?this._logger.warn:this._logger.error;o&&o.apply(this._logger,[this.formatter().format(e,t,n,r)])}},t}(i.AbstractLogAppender);t.RedirectingLogAppender=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RootToolsManagerDelegate=void 0;var r=n(102),i=function(){function e(e,t,n){void 0===n&&(n=t.createChild("RootToolsManagerDelegate")),this._slimcore=e,this._logger=n,this._eventSubscription=null}return e.prototype.fetchEcsConfig=function(e,t){return r.Resolved(void 0)},e.prototype.sendTelemetry=function(e,t){},e.prototype.sendLoggingEventToNative=function(e,t){this._slimcore.handleLoggingEvent?this._slimcore.handleLoggingEvent(e,t):this._logger.warn("slimcore.handleLoggingEvent is not available")},e.prototype.setNativeLoggingEventCallback=function(e){var t=this;e&&"function"==typeof e?this._setSubscription(this._slimcore.handle("logging-event",void 0,function(n){t._logger.debug("LoggingNativeEvent msg:"+n.message+" aux"+n.auxiliaryPayload),e(n.message,n.auxiliaryPayload)})):this._logger.warn("setNativeLoggingEventCallback invalid callback provided")},e.prototype._setSubscription=function(e){this._eventSubscription&&this._eventSubscription.dispose(),this._eventSubscription=e},e.prototype.dispose=function(e){this._logger.info("dispose causeId: "+e),this._setSubscription(null)},e}();t.RootToolsManagerDelegate=i},function(e,t,n){"use strict";(function(e){function n(e){return null!==e&&void 0!==e&&"function"==typeof e.then}function r(e){return null!==e&&void 0!==e&&"function"==typeof e.cancel}function i(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}function o(t){u.push(t),1===u.length&&(d?e(a):setTimeout(a,0))}function a(){var e=u;u=[];for(var t=0;t<e.length;t++)e[t]()}function s(){return new p.SyncTask}function c(e){return(new p.SyncTask).resolve(e).promise()}function l(e){var t=s(),i=!1;return t.onCancel(function(t){e.forEach(function(e){r(e)&&p.SyncTask.cancelOtherInternal(e,t)})}),e.forEach(function(e){n(e)?e.then(function(e){i||(i=!0,t.resolve(e))},function(e){i||(i=!0,t.reject(e))}):i||(i=!0,t.resolve(e))}),t.promise()}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=s();return e.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise().thenAsync(function(e){return e})};var u=[],d=void 0!==e;t.asyncCallback=o;var p;!function(e){var a=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var r=this,i=new e;return i.onCancel(function(e){t.wasCanceled=!0,t.cancelContext=e,r._cancelInternal(e)}),t.task=i,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:i._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),i.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout(function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach(function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)})},0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach(function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)})}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?o(function(){return e._resolveSuccessCallback(t)}):e._resolveSuccessCallback(t)})}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var o=this;t.successFunc?i(function(){var i=t.successFunc(o._storedResolution);r(i)&&(t.wasCanceled?e.cancelOtherInternal(i,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(i,t)})),n(i)?i.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(i)},function(e){o._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)}):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach(function(t){t.asyncCallback?o(function(){return e._resolveFailureCallback(t)}):e._resolveFailureCallback(t)})}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var o=this;t.failFunc?i(function(){var i=t.failFunc(o._storedErrResolution);r(i)&&(t.wasCanceled?e.cancelOtherInternal(i,t.cancelContext):t.task.onCancel(function(t){return e.cancelOtherInternal(i,t)})),n(i)?i.then(function(e){t.task.resolve(e)},function(e){t.task.reject(e)}):t.task.resolve(i)},function(e){o._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)}):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole&&console.error(n),t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise(function(t,n){return e.then(t,n)})},e._rejectedTasks=[],e}();e.SyncTask=a}(p||(p={})),t.all=function(e){if(0===e.length)return c([]);var t,i=s(),o=e.length,a=Array(e.length);i.onCancel(function(t){e.forEach(function(e){r(e)&&p.SyncTask.cancelOtherInternal(e,t)})});var l=function(){0==--o&&(void 0!==t?i.reject(t):i.resolve(a))};return e.forEach(function(e,r){n(e)?e.then(function(e){a[r]=e,l()},function(e){void 0===t&&(t=void 0===e||e),l()}):(a[r]=e,l())}),i.promise()},t.Defer=s,t.Resolved=c,t.Rejected=function(e){return(new p.SyncTask).reject(e).promise()},t.race=l,t.raceTimer=function(e,t){var n=s(),r=setTimeout(function(){n.resolve({timedOut:!0})},t);return l([e.then(function(e){return clearTimeout(r),{timedOut:!1,result:e}}),n.promise()])}}).call(this,n(103).setImmediate)},function(e,t,n){(function(e){function r(e,t){this._id=e,this._clearFn=t}var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;t.setTimeout=function(){return new r(o.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new r(o.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(104),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(48))},function(e,t,n){(function(e,t){!function(e,n){"use strict";function r(e){delete c[e]}function i(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}function o(e){if(l)setTimeout(o,0,e);else{var t=c[e];if(t){l=!0;try{i(t)}finally{r(e),l=!1}}}}if(!e.setImmediate){var a,s=1,c={},l=!1,u=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?a=function(e){t.nextTick(function(){o(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&o(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),a=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){o(e.data)},a=function(t){e.port2.postMessage(t)}}():u&&"onreadystatechange"in u.createElement("script")?function(){var e=u.documentElement;a=function(t){var n=u.createElement("script");n.onreadystatechange=function(){o(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():a=function(e){setTimeout(o,0,e)},d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return c[s]=r,a(s),s++},d.clearImmediate=r}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(48),n(105))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function o(e){if(d===clearTimeout)return clearTimeout(e);if((d===r||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function a(){f&&h&&(f=!1,h.length?g=h.concat(g):_=-1,g.length&&s())}function s(){if(!f){var e=i(a);f=!0;for(var t=g.length;t;){for(h=g,g=[];++_<t;)h&&h[_].run();_=-1,t=g.length}h=null,f=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var u,d,p=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{d="function"==typeof clearTimeout?clearTimeout:r}catch(e){d=r}}();var h,g=[],f=!1,_=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];g.push(new c(e,t)),1!==g.length||f||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.prependListener=l,p.prependOnceListener=l,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this._slimcoreInstance=t,this._logger=e.createChild("Electron[AiMdp]")}return e.prototype.enableAudioRecording=function(e,t){this._logger.info("enableAudioRecording(callId: "+e+", enable: "+t+")");try{return this._slimcoreInstance.aiMdpEnableAudioRecording?this._slimcoreInstance.aiMdpEnableAudioRecording(e,t):(this._logger.warn("enableAudioRecording() not implemented in SkyLib"),!1)}catch(n){throw this._logger.error("Error in enableAudioRecording(callId: "+e+", enable: "+t+") error: "+n),n}},e}();t.default=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):i(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var o=SlimCore.Enums,a=function(){function e(e,t){this._slimcoreInstance=t,this._logger=e.createChild("Electron[CallFeedback]")}return e.prototype.toCallType=function(e,t){return 0===e?o.EcsCallType.EcsCallTypeGroup:2===e?o.EcsCallType.EcsCallTypePstn:1===e?o.EcsCallType.EcsCallTypeS2s:3===e&&(t.length>1&&t[0]>2021||t[0]>=2021&&t[1]>=3)?o.EcsCallType.EcsCallTypeMeeting:o.EcsCallType.EcsCallTypeS2s},e.prototype.toQualityRating=function(e){return 0===e?o.CallQualityRating2.VeryBad:1===e?o.CallQualityRating2.Bad:2===e?o.CallQualityRating2.Average:3===e?o.CallQualityRating2.Good:4===e?o.CallQualityRating2.VeryGood:o.CallQualityRating2.NotApplicable},e.prototype.getSlimCoreBuildVersion=function(){for(var e=[],t=0,n=this._slimcoreInstance.getBuildVersion().split(".");t<n.length;t++){var r=n[t];e.push(+r)}return e},e.prototype.getCallFeedbackInfo=function(e,t,n,o){return r(this,void 0,void 0,function(){return i(this,function(r){this._logger.info("getCallFeedbackInfo");try{return this._slimcoreInstance.getCallFeedbackInfo?[2,this._slimcoreInstance.getCallFeedbackInfo(t,n,this.toCallType(o,this.getSlimCoreBuildVersion()))]:(this._logger.warn("getCallFeedbackInfo not on SkyLib"),e?[2,e.showCQFInfo(t,o)]:[2,null])}catch(e){throw this._logger.error("Error in getCallFeedbackInfo callId: "+n+", error: "+e),e}return[2]})})},e.prototype.isQuestionaryRendered=function(e,t,n,o){return r(this,void 0,void 0,function(){return i(this,function(r){this._logger.info("isQuestionaryRendered");try{this._slimcoreInstance.isQuestionaryRendered?this._slimcoreInstance.isQuestionaryRendered(t,n,o):(this._logger.warn("isQuestionaryRendered not on SkyLib"),e&&e.isCqfRendered(o))}catch(e){throw this._logger.error("Error in isQuestionaryRendered callId: "+t+", error: "+e),e}return[2]})})},e.prototype.provideCallQualityFeedbackEx=function(e,t,n,o,a,s,c,l,u){return r(this,void 0,void 0,function(){return i(this,function(r){this._logger.info("provideCallQualityFeedback");try{this._slimcoreInstance.provideCallQualityFeedbackEx?this._slimcoreInstance.provideCallQualityFeedbackEx(t,n,o,a,this.toQualityRating(s),c,l,u):(this._logger.warn("provideCallQualityFeedbackEx not on SkyLib"),e&&e.provideCallQualityFeedbackEx(o,a,s,c,l,u))}catch(e){throw this._logger.error("Error in provideCallQualityFeedback callId: "+t+", error: "+e),e}return[2]})})},e}();t.default=a},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=0,o=function(e){function t(t,n,r){var o=e.call(this,n.createChild(function(){return"VoipCallCoordinator["+o._id+"]"}),r,t)||this;o._id=i++,o._voipCallCoordinator=t.createVoipCallCoordinator();return o._registerDisposable(o._voipCallCoordinator.handle("on-air-mute-event",void 0,function(e){o._logger.info("onAirMuteEvent, mute = "+e.mute),o.event("onAirMuteEvent").raise(e.mute)})),o}return r(t,e),t.prototype.initialize=function(e){this._logger.info("creating slimcore voip call coordinator with app name "+e),this._voipCallCoordinator.initialize(e)},t.prototype.dispose=function(t){this._logger.info("releasing slimcore voip call coordinator, causeId is "+t),this._voipCallCoordinator.dispose(),e.prototype.dispose.call(this,t)},t.prototype.setOnAirMute=function(e){this._logger.info("set on air mute: "+e),this._voipCallCoordinator.setOnAirMute(e)},t}(n(11).default);t.default=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.UwpEngineWrapped=void 0;var i,o=n(7),a=n(49);!function(e){e[e.Integer=0]="Integer",e[e.String=1]="String",e[e.Binary=2]="Binary"}(i||(i={}));var s=function(e){function t(t){var n=e.call(this)||this;if(n._nativeObject=t,o.forIn(t,function(e,t,r){o.isFunction(e)?n[t]||(n[t]=function(){return e.apply(r,arguments)}):Object.defineProperty(n,t,{get:function(){return r[t]},set:function(e){r[t]=e}})}),void 0!==t.oncommonwrapperevent){var r=function(e){if("object-property-changed"===e.target){var t=e.detail[0],n={objectType:t.objectType,objectId:t.objectId,propKey:t.propKey,value:void 0};switch(t.value.type){case i.Integer:n.value=t.value.intVal;break;case i.String:n.value=t.value.strVal;break;case i.Binary:n.value=t.value.binVal}return n}return e.detail[0]};t.oncommonwrapperevent=function(e){var t=r(e);n.emit(e.target,t)}}return n}return r(t,e),Object.defineProperty(t.prototype,"objectToWrap",{get:function(){return this._nativeObject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"objectAsWrapped",{get:function(){return this},enumerable:!1,configurable:!0}),t}(a.SlimCoreEventEmitter),c=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t}(s),l=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype.getAccount=function(e){var t=this.objectToWrap.getAccount(e);return new s(t).objectAsWrapped},t.prototype.getCallHandler=function(e){var t=this.objectToWrap.getCallHandler(e);return new s(t).objectAsWrapped},t.prototype.createCallInterface=function(){var e=this.objectToWrap.createCallInterface();return new s(e).objectAsWrapped},t.prototype.getContentSharing=function(e){var t=this.objectToWrap.getContentSharing(e);return new s(t).objectAsWrapped},t.prototype.createVideoBindingRenderer=function(e){var t=this.objectToWrap.createVideoBindingRenderer(e);return new c(t).objectAsWrapped},t.prototype.createVideoBindingScreenShare=function(){var e=this.objectToWrap.createVideoBindingScreenShare();return new c(e).objectAsWrapped},t.prototype.videoCreateBinding=function(e,t){var n=this;return new Promise(function(r,i){var o=t,a=o.objectToWrap;void 0!==a.onvideobindingcreatedevent&&(a.onvideobindingcreatedevent=function(){r()}),void 0!==a.onvideobindingfailedevent&&(a.onvideobindingfailedevent=function(){n.objectToWrap.videoReleaseBinding(e,o.objectToWrap),i("binding creation failed")}),n.objectToWrap.videoCreateBinding(e,o.objectToWrap)})},t.prototype.videoReleaseBinding=function(e,t){var n=this;return new Promise(function(r,i){var o=t,a=o.objectToWrap;void 0!==a.onvideobindingreleasedevent&&(a.onvideobindingreleasedevent=function(){r()}),n.objectToWrap.videoReleaseBinding(e,o.objectToWrap)})},t.prototype.setMediaConfig=function(e){this.objectToWrap.setMediaConfig(JSON.stringify(e))},t}(s);t.UwpEngineWrapped=l},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.OneDsTelemetryLogger=t.TelemetryManager=void 0;var i=n(4),o=n(113),a=n(112),s=function(){function e(e,t,n,r){var i=this;this._logger=e,this._slimcoreInstance=t,this._slimCoreInitPromise=n,this._collectorUrlOverride=r,this._defaultCollectorUrlTs="https://ic3.events.data.microsoft.com/OneCollector/1.0/",this._defaultEventsLimitInMem=200,this._defaultLogDiscardedEvents=!1,this._defaultLogSentEvents=!1,this._telemetryLoggerConfig=this._createLoggerConfig(),this._preConfigEvents=[],this._slimCoreInitPromise.then(function(){i._updateLoggerConfig(),i._slimcoreEventsLogger=i._createTelemetryLogger("SlimCoreEventsTelemetry",i._telemetryLoggerConfig),i._preConfigEvents.forEach(function(e){return i._sendEvent(e)}),i._preConfigEvents=void 0})}return e.prototype.dispatch=function(e){var t,n=this;this._preConfigEvents?(t=this._preConfigEvents).push.apply(t,e):e.forEach(function(e){return n._sendEvent(e)})},e.prototype.pauseLogger=function(){this._slimcoreEventsLogger.pause()},e.prototype.resumeLogger=function(){this._slimcoreEventsLogger.resume()},e.prototype._sendEvent=function(e){try{var t=JSON.parse(e);"RealTime"===t.eventPriority?this._logRealTimeEvent(t):this._slimcoreEventsLogger.sendEvent(this._createOneDsEvent(t),t.tenantToken)}catch(e){this._logger.info("sendEvent failed with error:"+e.message)}},e.prototype._createTelemetryLogger=function(e,t){return new c(this._logger.createChild(e),t)},e.prototype._logRealTimeEvent=function(e){this._realTimeEventsLogger=this._realTimeEventsLogger||this._createTelemetryLogger("RealTimeEventsTelemetry",this._telemetryLoggerConfig),this._realTimeEventsLogger.sendEvent(this._createOneDsEvent(e),e.tenantToken)},e.prototype._createOneDsEvent=function(e){var t={};return this._constructEventProperty(e,t),{name:e.EventType,data:t,latency:this._eventPriorityToLatency(e.eventPriority),time:e.TimestampISO8601,persistence:i.EventPersistence.Normal}},e.prototype._updateLoggerConfig=function(){var e=function(e,t,n,r){return t?t.bind(e)("SCT",n,r):r};if(this._telemetryLoggerConfig.channelConfiguration.eventsLimitInMem=e(this._slimcoreInstance,this._slimcoreInstance.ecsGetSettingAsInt,"EventsLimitInMem",this._defaultEventsLimitInMem),this._telemetryLoggerConfig.logDiscardedEvents=e(this._slimcoreInstance,this._slimcoreInstance.ecsGetSettingAsBool,"LogDiscardedEvents",this._defaultLogDiscardedEvents),this._telemetryLoggerConfig.logSentEvents=e(this._slimcoreInstance,this._slimcoreInstance.ecsGetSettingAsBool,"LogSentEvents",this._defaultLogSentEvents),this._collectorUrlOverride?this._telemetryLoggerConfig.endpointUrl=this._collectorUrlOverride:this._telemetryLoggerConfig.endpointUrl=e(this._slimcoreInstance,this._slimcoreInstance.ecsGetSettingAsString,"CollectorUrlTs",this._defaultCollectorUrlTs),e(this._slimcoreInstance,this._slimcoreInstance.ecsGetSettingAsBool,"EnableLocalStorage",!1)){var t=new o.LocalStorageChannel;this._telemetryLoggerConfig.channels=[[t]]}},e.prototype._createLoggerConfig=function(){return{extensions:[],extensionConfig:{localStorage:{storageKey:"TsCalling_Electron"}},channelConfiguration:{eventsLimitInMem:this._defaultEventsLimitInMem},endpointUrl:this._defaultCollectorUrlTs,logDiscardedEvents:this._defaultLogDiscardedEvents,logSentEvents:this._defaultLogSentEvents}},e.prototype._constructEventProperty=function(e,t){for(var n=r(r({},e.Extensions),e.PIIExtensions),o=0,a=Object.keys(n);o<a.length;o++){var s=a[o],c=n[s],l={value:c.RawContent?c.RawContent:c,kind:c.Kind?this._eventPIIKindToOneDsPII(c.Kind):i.ValueKind.NotSet};t[s]=l}},e.prototype._eventPriorityToLatency=function(e){switch(e){case"Immediate":case"High":case"RealTime":return a.EventLatency.RealTime;case"Unspecified":case"Off":case"Low":return a.EventLatency.CostDeferred;case"Normal":return a.EventLatency.Normal;default:return a.EventLatency.CostDeferred}},e.prototype._eventPIIKindToOneDsPII=function(e){switch(e){case"NotSet":return i.ValueKind.NotSet;case"DistinguishedName":return i.ValueKind.Pii_DistinguishedName;case"Fqdn":return i.ValueKind.Pii_Fqdn;case"GenericData":return i.ValueKind.Pii_GenericData;case"Identity":return i.ValueKind.Pii_Identity;case"IPV4Address":return i.ValueKind.Pii_IPV4Address;case"IPV4AddressLegacy":return i.ValueKind.Pii_IPV4AddressLegacy;case"IPV6Address":return i.ValueKind.Pii_IPv6Address;case"MailSubject":return i.ValueKind.Pii_MailSubject;case"PhoneNumber":return i.ValueKind.Pii_PhoneNumber;case"QueryString":return i.ValueKind.Pii_QueryString;case"SipAddress":return i.ValueKind.Pii_SipAddress;case"SmtpAddress":return i.ValueKind.Pii_SmtpAddress;case"Uri":return i.ValueKind.Pii_Uri;default:return i.ValueKind.NotSet}},e}();t.TelemetryManager=s;var c=function(){function e(e,t){var n=this;this._logger=e,this._loggerConfiguration=t,this.manager=new a.ApplicationInsightsManager,this._callStateCounter=0,this.manager.create(this._loggerConfiguration,[]);var r=this.manager.getPostChannel();r._notificationManager.addNotificationListener({eventsDiscarded:function(e,t){return n._logDiscardedEvents(e,t)},eventsSent:function(e){return n._logSentEvents(e)}}),r._setTransmitProfile("REAL_TIME")}return e.prototype.flush=function(){this.manager.getPostChannel().flush()},e.prototype.pause=function(){this._logger.info("Telemetry pause called, callStateCounter:"+this._callStateCounter),1==++this._callStateCounter&&(this.manager.getPostChannel().pause(),this._logger.info("Telemetry events sending paused"))},e.prototype.resume=function(){this._logger.info("Telemetry resume called, callStateCounter:"+this._callStateCounter),0==--this._callStateCounter&&(this.manager.getPostChannel().resume(),this._logger.info("Telemetry events sending resumed"))},e.prototype.sendEvent=function(e,t){this._getLogger(t).track(e)},e.prototype._getLogger=function(e){return this.manager.getInst(e)||this.manager.newInst(e)},e.prototype._logDiscardedEvents=function(e,t){this._loggerConfiguration.logDiscardedEvents&&this._logger.info("discarded events:"+e.map(function(e){return e.name}).join(";")+" reason:"+t)},e.prototype._logSentEvents=function(e){this._loggerConfiguration.logSentEvents&&this._logger.info("sent events:"+e.map(function(e){return e.name}).join(";"))},e}();t.OneDsTelemetryLogger=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateCauseId=t.getVersion=t.getOvb=t.slimCoreUwpStackFactory=t.slimCoreElectronStackFactory=void 0;var r=n(66);Object.defineProperty(t,"slimCoreElectronStackFactory",{enumerable:!0,get:function(){return r.slimCoreElectronStackFactory}}),Object.defineProperty(t,"slimCoreUwpStackFactory",{enumerable:!0,get:function(){return r.slimCoreUwpStackFactory}});var i=n(29);Object.defineProperty(t,"getOvb",{enumerable:!0,get:function(){return i.getOvb}}),Object.defineProperty(t,"getVersion",{enumerable:!0,get:function(){return i.getTsCallingVersion}});var o=n(9);Object.defineProperty(t,"generateCauseId",{enumerable:!0,get:function(){return o.generateCauseId}})},function(e,t,n){"use strict";function r(e,t){void 0===t&&(t=M);var n=null;if(e)for(var r=e.split(","),o=0;o<r.length;o++)i(r[o],t)&&(n?n+=","+r[o]:n=r[o]);return n}function i(e,t){if(void 0===t&&(t=M),!e||e.length<4)return!1;for(var n=!1,r=e.substring(0,3).toString().toUpperCase(),i=0;i<t.length;i++)if(t[i]+":"===r&&e.length<=256){n=!0;break}return n}function o(e,t,n,r){t?t.setProperty(n,r):e.set(n,r,31536e3)}function a(e,t,n){return t?t.getProperty(n)||"":Object(w.l)(e,n)}function s(){return void 0===y&&(y=!!l(C.LocalStorage)),y}function c(){return s()?l(C.LocalStorage):null}function l(e){var t,n,r=null;try{var i=Object(fe.a)();if(!i)return null;n=new Date,(r=e===C.LocalStorage?i.localStorage:i.sessionStorage)&&Object(I.o)(r.setItem)&&(r.setItem(n,n),t=r.getItem(n)!==n,r.removeItem(n),t&&(r=null))}catch(e){r=null}return r}function u(e,t,n){var r=c();if(null!==r)try{return r.setItem(t,n),!0}catch(t){y=!1,e.throwInternal(T.a.CRITICAL,E.f.BrowserCannotWriteLocalStorage,"Browser failed write to local storage. "+t)}return!1}function d(e,t){var n=c();if(null!==n)try{return n.getItem(t)}catch(t){y=!1,e.throwInternal(T.a.CRITICAL,E.f.BrowserCannotReadLocalStorage,"Browser failed read of local storage. "+t)}return null}function p(e,t,n,r){if(r&&e){var i=Object(w.j)(r.value,r.kind,r.propertyType);if(i>-1){var o=e[Ne];o||(o=e[Ne]={f:{}});var a=o[De];if(a||(a=o[De]={}),t)for(var s=0;s<t.length;s++){var c=t[s];a[c]||(a[c]={f:{}});var l=a[c][De];l||(l=a[c][De]={}),a=l}a=a[n]={},Object(I.k)(r.value)?a.a={t:i}:a.t=i}}}function h(e){try{return e.responseText}catch(e){}return""}function g(e,t){if(e)for(var n=0;n<t.length;n++){var r=t[n];Object(I.r)(e[r])&&(e[r]={}),e=e[r]}return e}function f(e,t,n){if(e&&t){var r=t.split("."),i=r[r.length-1];r.length>1&&(e=g(e,r.splice(-1,1))),Object(I.r)(n)?Object(I.x)(e[i])||delete e[i]:e[i]=n}}function _(e,t){if(t)for(var n=Object(I.B)(t),r=0;r<n.length;r++){var i=n[r];Object(I.j)(e,i)||(e[i]=t[i])}}function m(e){return e.pause&&e.teardown&&e.flush}function v(e,t){var n=null;if(t){t.endpointUrl&&(n=t.endpointUrl);var r=(t.extensionConfig||{})[e]||{};r.overrideEndpointUrl&&(n=r.overrideEndpointUrl)}return n}n.r(t),n.d(t,"ApplicationInsightsManager",function(){return Tt}),n.d(t,"ApplicationInsights",function(){return Et}),n.d(t,"OverridePropertiesPlugin",function(){return It}),n.d(t,"PostChannel",function(){return ct}),n.d(t,"BE_PROFILE",function(){return Te}),n.d(t,"NRT_PROFILE",function(){return Oe}),n.d(t,"RT_PROFILE",function(){return Ie}),n.d(t,"PropertiesPlugin",function(){return Ce}),n.d(t,"Extensions",function(){return de}),n.d(t,"AppExtensionKeys",function(){return $}),n.d(t,"WebExtensionKeys",function(){return ee}),n.d(t,"UserExtensionKeys",function(){return te}),n.d(t,"OSExtKeys",function(){return ne}),n.d(t,"DeviceExtKeys",function(){return ce}),n.d(t,"OperatingSystem",function(){return W}),n.d(t,"Application",function(){return j}),n.d(t,"Device",function(){return Y}),n.d(t,"Session",function(){return Z}),n.d(t,"defaultFlightIdNameSpaces",function(){return M}),n.d(t,"TelemetryContext",function(){return ye}),n.d(t,"ValueKind",function(){return E.e}),n.d(t,"EventLatency",function(){return E.a}),n.d(t,"EventPersistence",function(){return E.b}),n.d(t,"TraceLevel",function(){return E.d}),n.d(t,"MinChannelPriorty",function(){return Pt.a}),n.d(t,"NotificationManager",function(){return O.a}),n.d(t,"EventsDiscardedReason",function(){return Se.a}),n.d(t,"CoreUtils",function(){return w.a}),n.d(t,"DiagnosticLogger",function(){return P.a}),n.d(t,"isValueAssigned",function(){return w.v}),n.d(t,"isArray",function(){return I.k}),n.d(t,"isBeaconsSupported",function(){return w.q}),n.d(t,"isBoolean",function(){return I.l}),n.d(t,"isLatency",function(){return w.t}),n.d(t,"isNumber",function(){return I.s}),n.d(t,"isReactNative",function(){return D.t}),n.d(t,"isString",function(){return I.u}),n.d(t,"isUint8ArrayAvailable",function(){return w.u}),n.d(t,"getISOString",function(){return I.K}),n.d(t,"cookieAvailable",function(){return N.b});var y,C,S=n(74),I=n(0),O=n(70),T=n(15),E=n(6),P=n(31),b=n(28),A=n(69),R=n(2),w=n(3),L=n(72),N=n(14),D=n(5),M=["AX","EX","SF","CS","CF","CT","CU","DC","DF","H5","HL","WS","WP"],j=function(){function e(e,t){this.core=t,this.appExpId=null,this.flightIdNameSpaces=M.slice(0),this.expIdCookieName="Treatments",this._cookieMgr=Object(N.d)(t),this._propertiesConfig=e;var n=Object(D.d)();if(n){var r=n.documentElement;n&&(this.locale=r.lang)}this.env=e.env?e.env:this._getMetaDataFromDOM("awa-").env}return e.prototype.getExpId=function(){return this._propertiesConfig.expId?this._readExpIdFromCoreData(this._propertiesConfig.expId):this._readExpIdFromCookie()},e.prototype._getMetaDataFromDOM=function(e){var t,n={},r=Object(D.d)();if(r){t=r&&r.querySelectorAll("meta");for(var i=0;i<t.length;i++){var o=t[i];o.name&&0===o.name.toLowerCase().indexOf(e)&&(n[o.name.replace(e,"")]=o.content)}}return n},e.prototype._setAppExpId=function(e){e!==this.appExpId&&(this.appExpId=r(e,this.flightIdNameSpaces))},e.prototype._getAppExpId=function(){return this.appExpId},e.prototype._readExpIdFromCookie=function(){var e=Object(w.l)(this._cookieMgr,this.expIdCookieName);return this._setAppExpId(e),this._getAppExpId()},e.prototype._readExpIdFromCoreData=function(e){return this._setAppExpId(e),this._getAppExpId()},e.validateAppExpId=r,e._staticInit=void Object(I.z)(e.prototype,"expId",e.prototype.getExpId),e}(),k=function(){return function(){}}(),F=n(17),x=function(){function e(t,n,r){this.core=r;var i=this._cookieMgr=Object(N.d)(r,t);if(i&&i.isEnabled()){var o=Object(w.l)(i,"MUID");if(o&&this.setLocalId("t:"+o),n.enableApplicationInsightsUser){var a=Object(w.l)(i,e.userCookieName);if(a){var s=a.split(e.cookieSeparator);s.length>0&&(this.id=s[0])}if(!this.id){this.id=Object(F.e)(t&&!Object(I.x)(t.idLength)?t.idLength:22);var c=new Date,l=Object(I.K)(c);this.accountAcquisitionDate=l;var u=[this.id,l],d=n.cookieDomain?n.cookieDomain:void 0;i.set(e.userCookieName,u.join(e.cookieSeparator),31536e3,d)}}}if("undefined"!=typeof navigator){var p=navigator;this.locale=p.userLanguage||p.language}}return e.prototype.getLocalId=function(){if(this._customLocalId)return this._customLocalId;var e=Object(w.l)(this._cookieMgr,"MUID");e&&this.setLocalId("t:"+e)},e.prototype.setLocalId=function(e){this._customLocalId=e},e.cookieSeparator="|",e.userCookieName="ai_user",e._staticInit=void Object(I.z)(e.prototype,"localId",e.prototype.getLocalId,e.prototype.setLocalId),e}(),V={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",OPERA:"Opera"},H=function(){function e(e,t){this._cookieMgr=Object(N.d)(t),this._propertiesConfig=e;var n=Object(D.i)();if(n){var r=n.hostname;r&&(this.domain="file:"===n.protocol?"local":r)}var i="undefined"!=typeof navigator?navigator.userAgent:"";if(e.userAgent&&(i=e.userAgent),e.populateBrowserInfo){if(i){var o=this._getBrowserName(i);this.browser=o,this.browserVer=this._getBrowserVersion(i,o)}var a=this._getScreenResolution();this.screenRes=a.w+"X"+a.h}}return e.prototype.getUserConsent=function(){return this._propertiesConfig.userConsented||!!Object(w.l)(this._cookieMgr,this._propertiesConfig.userConsentCookieName||"MSCC")},e.prototype.getUserConsentDetails=function(){try{if(this._propertiesConfig.callback&&this._propertiesConfig.callback.userConsentDetails){var e=this._propertiesConfig.callback.userConsentDetails();if(e)return JSON.stringify({Required:!!e.Required&&e.Required,Analytics:!!e.Analytics&&e.Analytics,SocialMedia:!!e.SocialMedia&&e.SocialMedia,Advertising:!!e.Advertising&&e.Advertising})}}catch(e){}return null},e.prototype._getBrowserName=function(e){return this._userAgentContainsString("OPR/",e)?V.OPERA:this._userAgentContainsString(V.PHANTOMJS,e)?V.PHANTOMJS:this._userAgentContainsString(V.EDGE,e)?V.EDGE:this._userAgentContainsString("Edg/",e)?V.EDGE:this._userAgentContainsString(V.ELECTRON,e)?V.ELECTRON:this._userAgentContainsString(V.CHROME,e)?V.CHROME:this._userAgentContainsString("Trident",e)?V.MSIE:this._userAgentContainsString(V.FIREFOX,e)?V.FIREFOX:this._userAgentContainsString(V.SAFARI,e)?V.SAFARI:this._userAgentContainsString(V.SKYPE_SHELL,e)?V.SKYPE_SHELL:"Unknown"},e.prototype._userAgentContainsString=function(e,t){return t.indexOf(e)>-1},e.prototype._getBrowserVersion=function(e,t){return t===V.MSIE?this._getIeVersion(e):this._getOtherVersion(t,e)},e.prototype._getIeVersion=function(e){var t=e.match(new RegExp(V.MSIE+" ([\\d,.]+)"));if(t)return t[1];var n=e.match(new RegExp("rv:([\\d,.]+)"));return n?n[1]:void 0},e.prototype._getOtherVersion=function(e,t){e===V.SAFARI?e="Version":e===V.EDGE&&this._userAgentContainsString("Edg/",t)&&(e="Edg");var n=t.match(new RegExp(e+"/([\\d,.]+)"));return n?n[1]:"Unknown"},e.prototype._getScreenResolution=function(){var e={h:0,w:0},t=Object(D.m)();return t&&t.screen&&(e.h=screen.height,e.w=screen.width),e},e._staticInit=void Object(I.z)(e.prototype,"userConsent",e.prototype.getUserConsent),e}(),U={WINDOWS:"Windows",MACOSX:"Mac OS X",ANDROID:"Android",IOS:"iOS"},B={WIN:/(windows|win32)/i,WINRT:/ arm;/i,WINPHONE:/windows\sphone\s\d+\.\d+/i,OSX:/(macintosh|mac os x)/i,IOS:/(ipad|iphone|ipod)(?=.*like mac os x)/i,LINUX:/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,ANDROID:/android/i,CROS:/CrOS/i},G={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},W=function(){function e(e){var t="undefined"!=typeof navigator?navigator.userAgent:"";if(e.userAgent&&(t=e.userAgent),t&&e.populateOperatingSystemInfo){var n=this._getOsName(t.toLowerCase());this.name=n,this.ver=this._getOsVersion(t,n)}}return e.prototype._getOsName=function(e){return e.match(B.WINPHONE)?"Windows Phone":e.match(B.WINRT)?"Windows RT":e.match(B.WIN)?U.WINDOWS:e.match(B.IOS)?U.IOS:e.match(B.ANDROID)?U.ANDROID:e.match(B.LINUX)?"Linux":e.match(B.CROS)?"Chrome OS":-1!==e.indexOf("x11")?"Unix":-1!==e.indexOf("blackberry")?"BlackBerry":-1!==e.indexOf("symbian")?"Symbian":-1!==e.indexOf("nokia")?"Nokia":e.match(B.OSX)?U.MACOSX:"Unknown"},e.prototype._getOsVersion=function(e,t){return t===U.WINDOWS?this._getGenericOsVersion(e,"Windows NT"):t===U.ANDROID?this._getGenericOsVersion(e,t):t===U.MACOSX?this._getMacOsxVersion(e):t===U.IOS?this._getIosVersion(e):"Unknown"},e.prototype._getGenericOsVersion=function(e,t){var n=e.match(new RegExp(t+" ([\\d,.]+)"));return n?G[n[1]]?G[n[1]]:n[1]:"Unknown"},e.prototype._getMacOsxVersion=function(e){var t=e.match(new RegExp(U.MACOSX+" ([\\d,_,.]+)"));if(t){var n=t[1].replace(/_/g,".");if(n){var r=this._getDelimiter(n);return r?n.split(r)[0]:n}}return"Unknown"},e.prototype._getIosVersion=function(e){var t=e.match(new RegExp("OS ([\\d,_,.]+)"));if(t){var n=t[1].replace(/_/g,".");if(n){var r=this._getDelimiter(n);return r?n.split(r)[0]:n}}return"Unknown"},e.prototype._getDelimiter=function(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null},e}(),q=function(){function e(e,t){this.core=t,e.serviceName&&(this.serviceName=e.serviceName),this._cookieMgr=Object(N.d)(t)}return e.prototype.getMsfpc=function(){return Object(w.l)(this._cookieMgr,"MSFPC")},e.prototype.getAnid=function(){return Object(w.l)(this._cookieMgr,"ANON").slice(0,34)},e._staticInit=(Object(I.z)(e.prototype,"msfpc",e.prototype.getMsfpc),void Object(I.z)(e.prototype,"anid",e.prototype.getAnid)),e}(),K=1048576,z=2097152,J=function(){return function(e){this.popSample=100,this.eventFlags=0,e.hashIdentifiers&&(this.eventFlags=this.eventFlags|K),e.dropIdentifiers&&(this.eventFlags=this.eventFlags|z)}}(),Q=function(){return function(){var e=(new Date).getTimezoneOffset(),t=e%60,n=(e-t)/60,r="+";n>0&&(r="-"),n=Math.abs(n),t=Math.abs(t),this.tz=r+(n<10?"0"+n:n.toString())+":"+(t<10?"0"+t:t.toString())}}(),Y=function(){return function(){}}(),Z=function(){function e(){}return e.prototype.setId=function(e){this.customId=e},e.prototype.getId=function(){return Object(I.u)(this.customId)?this.customId:this.automaticId},e._staticInit=void Object(I.z)(e.prototype,"id",e.prototype.getId,e.prototype.setId),e}(),X=function(){return function(e,t,n,r){if(e.enableApplicationInsightsTrace){this.traceId=t||Object(F.c)(),this.parentId=n,this.name=r;var i=Object(D.i)();i&&i.pathname&&(this.name=i.pathname)}}}(),$=function(){function e(){}return e.id="id",e.ver="ver",e.appName="name",e.locale="locale",e.expId="expId",e.env="env",e}(),ee=function(){function e(){}return e.domain="domain",e.browser="browser",e.browserVer="browserVer",e.screenRes="screenRes",e.userConsent="userConsent",e.consentDetails="consentDetails",e}(),te=function(){function e(){}return e.locale="locale",e.localId="localId",e.id="id",e}(),ne=function(){function e(){}return e.osName="name",e.ver="ver",e}(),re=function(){function e(){}return e.ver="ver",e.seq="seq",e.installId="installId",e.epoch="epoch",e}(),ie=function(){function e(){}return e.msfpc="msfpc",e.anid="anid",e.serviceName="serviceName",e}(),oe=function(){function e(){}return e.popSample="popSample",e.eventFlags="eventFlags",e}(),ae=function(){function e(){}return e.tz="tz",e}(),se=function(){function e(){}return e.sessionId="sesId",e}(),ce=function(){function e(){}return e.localId="localId",e.deviceClass="deviceClass",e.make="make",e.model="model",e}(),le=function(){function e(){}return e.role="role",e.roleInstance="roleInstance",e.roleVer="roleVer",e}(),ue=function(){function e(){}return e.traceId="traceID",e.traceName="name",e.parentId="parentID",e}(),de=function(){function e(){}return e.UserExt="user",e.DeviceExt="device",e.TraceExt="trace",e.WebExt="web",e.AppExt="app",e.OSExt="os",e.SdkExt="sdk",e.IntWebExt="intweb",e.UtcExt="utc",e.LocExt="loc",e.CloudExt="cloud",e}(),pe=n(13),he="MicrosoftApplicationsTelemetryDeviceId",ge=function(){function e(e,t){this._sequenceId=0;var n=e.propertyStorageOverride;this.seq=this._sequenceId,this.epoch=Object(pe.c)(!1).toString();var r=Object(N.d)(t,e);if(r.isEnabled()||n){var i=a(r,n,he);i||(i=Object(F.d)()),o(r,n,he,i),this.installId=i}else r.purge(he)}return e.prototype.getSequenceId=function(){return++this._sequenceId},e}(),fe=n(16);!function(e){e[e.LocalStorage=0]="LocalStorage",e[e.SessionStorage=1]="SessionStorage"}(C||(C={}));var _e,me=function(){function e(t,n){var r,i,o=Object(P.c)(t),a=Object(N.d)(t);Object(R.a)(e,this,function(t){function c(){var e=Object(w.k)(i());if(e&&Object(I.o)(e.split))l(e);else{var n=d(o,i());n&&l(n)}t.automaticSession.getId()||p()}function l(e){var n=t.automaticSession,r=e.split("|");r.length>0&&n.setId(r[0]);try{if(r.length>1){var i=+r[1];n.acquisitionDate=+new Date(i),n.acquisitionDate=n.acquisitionDate>0?n.acquisitionDate:0}if(r.length>2){var a=+r[2];n.renewalDate=+new Date(a),n.renewalDate=n.renewalDate>0?n.renewalDate:0}}catch(e){o.throwInternal(T.a.CRITICAL,E.f.ErrorParsingAISessionCookie,"Error parsing ai_session cookie, session will be reset: "+e)}0===n.renewalDate&&o.throwInternal(T.a.WARNING,E.f.SessionRenewalDateIsZero,"AI session renewal date is 0, session will be reset.")}function p(){var e=t.automaticSession,n=(new Date).getTime(),r=t.config.sessionAsGuid();!Object(I.x)(r)&&r?Object(I.l)(r)?e.setId(Object(w.f)()):e.setId(Object(w.f)(r)):e.setId(Object(F.e)(f&&f.idLength?f.idLength():22)),e.acquisitionDate=n,e.renewalDate=n,h(e.getId(),e.acquisitionDate,e.renewalDate),s()||o.throwInternal(T.a.WARNING,E.f.BrowserDoesNotSupportLocalStorage,"Browser does not support local storage. Session durations will be inaccurate.")}function h(e,n,o){var s=n+t.config.sessionExpirationMs(),c=o+t.config.sessionRenewalMs(),l=new Date,u=[e,n,o];s<c?l.setTime(s):l.setTime(c);var d=t.config.cookieDomain?t.config.cookieDomain():null;a.set(i(),u.join("|")+";expires="+l.toUTCString(),null,d),r=(new Date).getTime()}function g(e,t,n){u(o,i(),[e,t,n].join("|"))}var f=function(e){return{sessionRenewalMs:e.sessionRenewalMs&&function(){return e.sessionRenewalMs},sessionExpirationMs:e.sessionExpirationMs&&function(){return e.sessionExpirationMs},cookieDomain:e.cookieDomain&&function(){return e.cookieDomain},namePrefix:e.namePrefix&&function(){return e.namePrefix},sessionAsGuid:function(){return e.sessionAsGuid},idLength:function(){return e.idLength?e.idLength:22}}}(n);Object(I.o)(n.sessionExpirationMs)||(f.sessionExpirationMs=function(){return e.acquisitionSpan}),Object(I.o)(n.sessionRenewalMs)||(f.sessionRenewalMs=function(){return e.renewalSpan}),t.config=f,i=function(){return t.config.namePrefix&&t.config.namePrefix()?e.cookieNameConst+t.config.namePrefix():e.cookieNameConst},t.automaticSession=new Z,t.update=function(){t.automaticSession.getId()||c();var n=t.automaticSession,i=t.config,o=(new Date).getTime(),a=o-n.acquisitionDate>i.sessionExpirationMs(),s=o-n.renewalDate>i.sessionRenewalMs();if(a||s)p();else{var l=r;(!l||o-l>e.cookieUpdateInterval)&&(n.renewalDate=o,h(n.getId(),n.acquisitionDate,n.renewalDate))}},t.backup=function(){var e=t.automaticSession;g(e.getId(),e.acquisitionDate,e.renewalDate)}})}return e.acquisitionSpan=864e5,e.renewalSpan=18e5,e.cookieUpdateInterval=6e4,e.cookieNameConst="ai_session",e}(),ve=I.u,ye=function(){function e(e,t,n){this.app=new j(t,n),this.cloud=new k,this.user=new x(e,t,n),this.os=new W(t),this.web=new H(t,n),this.sdk=new ge(e,n),this.intWeb=new q(t,n),this.utc=new J(t),this.loc=new Q,this.device=new Y,this.telemetryTrace=new X(t),this.sessionManager=new me(n,t),this.session=new Z}return e.prototype.getSessionId=function(){var e=this.session;if(e&&ve(e.customId))return e.customId;var t=this.sessionManager;t.update();var n=t.automaticSession;if(n){var r=n.getId();r&&ve(r)&&(e.automaticId=r)}return e.automaticId},e.prototype.applyApplicationContext=function(e){var t=this.app;ve(t.id)&&(e.ext[de.AppExt][$.id]=t.id),ve(t.ver)&&(e.ext[de.AppExt][$.ver]=t.ver),ve(t.name)&&(e.ext[de.AppExt][$.appName]=t.name),ve(t.locale)&&(e.ext[de.AppExt][$.locale]=t.locale);var n=t.getExpId();ve(n)&&(e.ext[de.AppExt][$.expId]=n),ve(t.env)&&(e.ext[de.AppExt][$.env]=t.env)},e.prototype.applyUserContext=function(e){var t=this.user,n=t.getLocalId();ve(n)&&(e.ext[de.UserExt][te.localId]=n),ve(t.locale)&&(e.ext[de.UserExt][te.locale]=t.locale),ve(t.id)&&(e.ext[de.UserExt][te.id]=t.id)},e.prototype.applyWebContext=function(e){var t=this.web;ve(t.domain)&&(e.ext[de.WebExt][ee.domain]=t.domain),ve(t.browser)&&(e.ext[de.WebExt][ee.browser]=t.browser),ve(t.browserVer)&&(e.ext[de.WebExt][ee.browserVer]=t.browserVer),ve(t.screenRes)&&(e.ext[de.WebExt][ee.screenRes]=t.screenRes),e.ext[de.WebExt][ee.userConsent]=t.getUserConsent(),e.ext[de.WebExt][ee.consentDetails]=t.getUserConsentDetails()},e.prototype.applyOsContext=function(e){var t=this.os;ve(t.name)&&(e.ext[de.OSExt][ne.osName]=t.name),ve(t.ver)&&(e.ext[de.OSExt][ne.ver]=t.ver)},e.prototype.applySdkContext=function(e){var t=this.sdk;e.ext[de.SdkExt][re.seq]=t.getSequenceId(),e.ext[de.SdkExt][re.epoch]=t.epoch,ve(t.installId)&&(e.ext[de.SdkExt][re.installId]=t.installId)},e.prototype.applyIntWebContext=function(e){var t=this.intWeb,n=t.getMsfpc();ve(n)&&(e.ext[de.IntWebExt][ie.msfpc]=n);var r=t.getAnid();ve(r)&&(e.ext[de.IntWebExt][ie.anid]=r),ve(t.serviceName)&&(e.ext[de.IntWebExt][ie.serviceName]=t.serviceName)},e.prototype.applyUtcContext=function(e){var t=this.utc;e.ext[de.UtcExt][oe.popSample]=t.popSample,t.eventFlags>0&&(e.ext[de.UtcExt][oe.eventFlags]=t.eventFlags)},e.prototype.applyLocContext=function(e){e.ext[de.LocExt][ae.tz]=this.loc.tz},e.prototype.applySessionContext=function(e){e.ext[de.AppExt][se.sessionId]=this.getSessionId()},e.prototype.applyDeviceContext=function(e){var t=this.device;ve(t.localId)&&(e.ext[de.DeviceExt][ce.localId]=t.localId),ve(t.make)&&(e.ext[de.DeviceExt][ce.make]=t.make),ve(t.model)&&(e.ext[de.DeviceExt][ce.model]=t.model),ve(t.deviceClass)&&(e.ext[de.DeviceExt][ce.deviceClass]=t.deviceClass)},e.prototype.applyCloudContext=function(e){var t=this.cloud;ve(t.role)&&(e.ext[de.CloudExt][le.role]=t.role),ve(t.roleInstance)&&(e.ext[de.CloudExt][le.roleInstance]=t.roleInstance),ve(t.roleVer)&&(e.ext[de.CloudExt][le.roleVer]=t.roleVer)},e.prototype.applyAITraceContext=function(e){var t=this.telemetryTrace;ve(t.traceId)&&(e.ext[de.TraceExt][ue.traceId]=t.traceId),ve(t.name)&&(e.ext[de.TraceExt][ue.traceName]=t.name),ve(t.parentId)&&(e.ext[de.TraceExt][ue.parentId]=t.parentId)},e}(),Ce=function(e){function t(){var n=e.call(this)||this;n.identifier="SystemPropertiesCollector",n.priority=3,n.version="3.1.2";var r,i={};return Object(R.a)(t,n,function(t,o){function a(e,t){e&&Object(I.A)(e,function(e,n){t[e]||(t[e]=n)})}t.initialize=function(i,o,a){e.prototype.initialize.call(n,i,o,a),r=new ye(i,t._getTelCtx().getExtCfg(t.identifier),o)},t.processTelemetry=function(e,n){Object(w.A)(e,t.identifier),n=t._getTelCtx(n);var o=e.ext=e.ext?e.ext:{};e.data=e.data?e.data:{},o[de.AppExt]=o[de.AppExt]||{},o[de.UserExt]=o[de.UserExt]||{},o[de.WebExt]=o[de.WebExt]||{},o[de.OSExt]=o[de.OSExt]||{},o[de.SdkExt]=o[de.SdkExt]||{},o[de.IntWebExt]=o[de.IntWebExt]||{},o[de.UtcExt]=o[de.UtcExt]||{},o[de.LocExt]=o[de.LocExt]||{},o[de.DeviceExt]=o[de.DeviceExt]||{},o[de.TraceExt]=o[de.TraceExt]||{},o[de.CloudExt]=o[de.CloudExt]||{},r.applyApplicationContext(e),r.applyUserContext(e),r.applyWebContext(e),r.applyOsContext(e),r.applySdkContext(e),r.applyIntWebContext(e),r.applyUtcContext(e),r.applyLocContext(e),r.applySessionContext(e),r.applyDeviceContext(e),r.applyAITraceContext(e),r.applyCloudContext(e),Object(I.a)(Object(I.B)(o),function(e){0===Object(I.B)(o[e]).length&&delete o[e]}),a(i,e.data),t.processNext(e,n)},t.getPropertiesContext=function(){return r},t.setProperty=function(e,t){i[e]=t}}),n}return Object(S.b)(t,e),t}(L.a),Se=n(71),Ie="REAL_TIME",Oe="NEAR_REAL_TIME",Te="BEST_EFFORT",Ee=function(){function e(t,n){var r=n?[].concat(n):[],i=this;i.iKey=function(){return t},i.count=function(){return r.length},i.events=function(){return r},i.addEvents=function(e,t){return void 0===t&&(t=!0),e&&e.length>0?(r=t?r.concat(e):e.concat(r),e.length):0},i.split=function(n,i){var o=new e(t);if(n<r.length){var a=r.length-n;Object(I.r)(i)||(a=i<a?i:a),o.addEvents(r.splice(n,a),!0)}return o}}return e.create=function(t,n){return new e(t,n)},e}(),Pe=n(1),be=20,Ae=3984588,Re=65e3,we=2e6,Le=Math.min(we,Re),Ne="metadata",De="f",Me=/\./,je=function(){function e(t,n,r,i){var o=!!i,a=n,s={};Object(R.a)(e,this,function(e){function n(e,t){var n=s[e];return void 0===n&&(e.length>=7&&(n=Object(I.H)(e,"ext.metadata")||Object(I.H)(e,"ext.web")),s[e]=n),n}function i(e,t,s,c,l,u,d){Object(I.A)(e,function(e,p){var h=null;if(p||Object(w.v)(p)){var g=s,f=e,_=l,m=t;if(o&&!c&&Me.test(e)){var v=e.split("."),y=v.length;if(y>1){_&&(_=_.slice());for(var C=0;C<y-1;C++){var S=v[C];m=m[S]=m[S]||{},g+="."+S,_&&_.push(S)}f=v[y-1]}}if(h=!(c&&n(g,f))&&a&&a.handleField(g,f)?a.value(g,f,p,r):Object(w.y)(f,p,r)){var O=h.value;if(m[f]=O,u&&u(_,f,h),d&&"object"==typeof O&&!Object(I.k)(O)){var T=_;T&&(T=T.slice()).push(f),i(p,O,g+"."+f,c,T,u,d)}}}})}e.createPayload=function(e,t,n,r,i){return{apiKeys:[],payloadBlob:"",overflow:null,sizeExceed:[],failedEvts:[],batches:[],numEvents:0,retryCnt:e,isTeardown:t,isSync:n,isBeacon:r,sendReason:i}},e.appendPayload=function(n,r,i){var o=n&&r&&!n.overflow;return o&&Object(b.c)(t,function(){return"Serializer:appendPayload"},function(){for(var t=r.events(),o=n.payloadBlob,a=n.numEvents,s=!1,c=[],l=[],u=n.isBeacon,d=u?Re:Ae,p=u?Le:we,h=0,g=0;h<t.length;){var f=t[h];if(f){if(a>=i){n.overflow=r.split(h);break}var _=e.getEventBlob(f);if(_&&_.length<=p){var m=_.length;if(o.length+m>d){n.overflow=r.split(h);break}o&&(o+="\n"),o+=_,++g>be&&(o.substr(0,1),g=0),s=!0,a++}else _?c.push(f):l.push(f),t.splice(h,1),h--}h++}if(c&&c.length>0&&n.sizeExceed.push(Ee.create(r.iKey(),c)),l&&l.length>0&&n.failedEvts.push(Ee.create(r.iKey(),l)),s){n.batches.push(r),n.payloadBlob=o,n.numEvents=a;var v=r.iKey();-1===Object(I.b)(n.apiKeys,v)&&n.apiKeys.push(v)}},function(){return{payload:n,theBatch:{iKey:r.iKey(),evts:r.events()},max:i}}),o},e.getEventBlob=function(e){try{return Object(b.c)(t,function(){return"Serializer.getEventBlob"},function(){var t={};t.name=e.name,t.time=e.time,t.ver=e.ver,t.iKey="o:"+Object(w.n)(e.iKey);var n={},r=e.ext;r&&(t.ext=n,Object(I.A)(r,function(e,t){i(t,n[e]={},"ext."+e,!0,null,null,!0)}));var o=t.data={};o.baseType=e.baseType;var a=o.baseData={};return i(e.baseData,a,"baseData",!1,["baseData"],function(e,t,r){p(n,e,t,r)},!0),i(e.data,o,"data",!1,[],function(e,t,r){p(n,e,t,r)},!0),JSON.stringify(t)},function(){return{item:e}})}catch(e){return null}}})}return e}(),ke=function(){function e(){}return e.shouldRetryForStatus=function(e){return!(e>=300&&e<500&&408!==e&&429!==e||501===e||505===e)},e.getMillisToBackoffForRetry=function(e){var t=0,n=Math.floor(1200*Math.random())+2400;return t=Math.pow(2,e)*n,Math.min(t,6e5)},e}(),Fe=1e3,xe=function(){function e(){function t(e){var t=[];return e&&Object(I.a)(e,function(e){t.push(Object(I.I)(e))}),t}var n={};Object(R.a)(e,this,function(e){e.setKillSwitchTenants=function(e,r){if(e&&r)try{var i=t(e.split(","));if("this-request-only"===r)return i;for(var o=parseInt(r,10)*Fe,a=0;a<i.length;++a)n[i[a]]=Object(I.f)()+o}catch(e){return[]}return[]},e.isTenantKilled=function(e){var t=n,r=Object(I.I)(e);return void 0!==t[r]&&t[r]>Object(I.f)()||(delete t[r],!1)}})}return e}(),Ve=function(){function e(){var t=!0,n=!0,r=!0,i="use-collector-delta",o=!1;Object(R.a)(e,this,function(e){e.allowRequestSending=function(){return t},e.firstRequestSent=function(){r&&(r=!1,o||(t=!1))},e.shouldAddClockSkewHeaders=function(){return n},e.getClockSkewHeaderValue=function(){return i},e.setClockSkew=function(e){o||(e?(i=e,n=!0,o=!0):n=!1,t=!0)}})}return e}(),He="POST",Ue="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",Be="drop",Ge="send",We="rspFail",qe="oth",Ke="kill-tokens",ze="kill-duration",Je="kill-duration-seconds",Qe="time-delta-millis",Ye=(_e={},_e[1]="requeue",_e[100]="requeue",_e[200]="sent",_e[8004]=Be,_e[8003]=Be,_e),Ze=function(){function e(t,n,r,i){this._responseHandlers=[];var o,a,s,c,l,u="?cors=true&content-type=application/x-json-stream&client-id=NO_AUTH&client-version="+w.b,d=new xe,p=!1,g=new Ve,f=!1,_=0,m=!0,v=[],y={},C=[],S=null,O=!1;Object(R.a)(e,this,function(e){function P(e){for(var t=0,n=null,r=0;null==n&&r<e.length;)1===(t=e[r])?Object(w.B)()?n=A:"undefined"!=typeof XMLHttpRequest&&(n=L):2===t?n=R:f&&3===t&&Object(w.q)()&&(n=M),r++;return n?{_transport:t,sendPOST:n}:null}function A(e,t,n){var r=new XDomainRequest;r.open(He,e.urlString),r.onload=function(){var e=h(r);N(t,200,{},e),Z(e)},r.onerror=function(){N(t,400,{})},r.ontimeout=function(){N(t,500,{})},r.onprogress=function(){},n?r.send(e.data):o._setTimeoutOverride(function(){r.send(e.data)},0)}function R(e,t){var n,r=(n={body:e.data,method:He},n[Ue]=!0,n);ee&&(r.credentials="include"),e.headers&&Object(I.B)(e.headers).length>0&&(r.headers=e.headers),fetch(e.urlString,r).then(function(e){var n={},r="";e.headers&&e.headers.forEach(function(e,t){n[t]=e}),e.body&&e.text().then(function(e){r=e}),N(t,e.status,n,r),Z(r)}).catch(function(e){N(t,0,{})})}function L(e,t,n){function r(e,t,n){if(!e[n]&&t&&t.getResponseHeader){var r=t.getResponseHeader(n);r&&(e[n]=Object(I.I)(r))}return e}function i(e){var t={};return t=e.getAllResponseHeaders?Q(e.getAllResponseHeaders()):r(t=r(t=r(t,e,Qe),e,ze),e,Je)}function o(e,n){N(t,e.status,i(e),n)}var a=new XMLHttpRequest;try{a[Ue]=!0}catch(e){}ee&&(a.withCredentials=!0),a.open(He,e.urlString,!n),Object(I.A)(e.headers,function(e,t){a.setRequestHeader(e,t)}),a.onload=function(){var e=h(a);o(a,e),Z(e)},a.onerror=function(){o(a)},a.ontimeout=function(){o(a)},a.send(e.data)}function N(e,t,n,r){try{e(t,n,r)}catch(e){o.diagLog().throwInternal(T.a.WARNING,E.f.SendPostOnCompleteFailure,Object(D.a)(e))}}function M(e,t,n){var r=200,i=e._thePayload;try{var a=Object(D.k)();if(!a.sendBeacon(e.urlString,e.data))if(i){var s=[];Object(I.a)(i.batches,function(t){if(s&&t&&t.count()>0){for(var n=t.events(),r=0;r<n.length;r++)if(!a.sendBeacon(e.urlString,S.getEventBlob(n[r]))){s.push(t.split(r));break}}else s.push(t.split(0))}),X(s,8003,i.isSync,!0)}else r=0}catch(e){o.diagLog().warnToConsole("Failed to send telemetry using sendBeacon API. Ex:"+e),r=0}finally{N(t,r,{},"")}}function j(){return!p&&_<n}function k(){var e=C;return C=[],e}function F(e,t,n){var r=!1;return e&&e.length>0&&!p&&a&&S&&(r=t||j()&&(n>0||g.allowRequestSending())),r}function x(e){var t={};return e&&Object(I.a)(e,function(e,n){t[n]={iKey:e.iKey(),evts:e.events()}}),t}function V(e,n,r,i,s,l){if(e&&0!==e.length)if(p)X(e,1,i);else try{var u=e;Object(b.c)(c,function(){return"HttpManager:_sendBatches"},function(o){o&&(e=e.slice(0));for(var c=[],u=null,p=Object(w.o)(),h=(l||a&&3===a._transport)&&U();F(e,i,n);){var g=e.shift();g&&g.count()>0&&(d.isTenantKilled(g.iKey())?c.push(g):(u=u||S.createPayload(n,r,i,h,s),S.appendPayload(u,g,t)?null!==u.overflow&&(e=[u.overflow].concat(e),u.overflow=null,G(u,p,Object(w.o)(),s),p=Object(w.o)(),u=null):(G(u,p,Object(w.o)(),s),p=Object(w.o)(),e=[g].concat(e),u=null)))}u&&G(u,p,Object(w.o)(),s),e.length>0&&(C=e.concat(C)),X(c,8004,i)},function(){return{batches:x(u),retryCount:n,isTeardown:r,isSynchronous:i,sendReason:s,useSendBeacon:l}},!i)}catch(e){o.diagLog().throwInternal(T.a.WARNING,E.f.CannotSerializeObject,"Unexpected Exception sending batch: "+Object(D.a)(e))}}function H(e){var t=u,n="";Object(I.a)(e.apiKeys,function(e){n.length>0&&(n+=","),n+=e}),n.length>0&&(t+="&apikey="+n),t+="&upload-time="+Object(I.f)().toString();var r=Y(e);if(Object(w.v)(r)&&(t=t+"&ext.intweb.msfpc="+r),g.shouldAddClockSkewHeaders()&&(t+="&time-delta-to-apply-millis="+g.getClockSkewHeaderValue()),c.getWParam){var i=c.getWParam();i>=0&&(t+="&w="+i)}for(var o=0;o<v.length;o++)t+="&"+v[o].name+"="+v[o].value;return t}function U(){return!m&&f&&Object(w.q)()}function B(e,t,n){e[t]=e[t]||{},e[t][o.identifier]=n}function G(t,n,r,i){if(t&&t.payloadBlob&&t.payloadBlob.length>0){var l=H(t),u=Object(w.o)();Object(b.c)(c,function(){return"HttpManager:_doPayloadSend"},function(){for(var d=0;d<t.batches.length;d++)for(var p=t.batches[d].events(),h=0;h<p.length;h++){var f=p[h];if(O){var v=f.timings=f.timings||{};B(v,"sendEventStart",u),B(v,"serializationStart",n),B(v,"serializationCompleted",r)}f.sendAttempt>0?f.sendAttempt++:f.sendAttempt=1}X(t.batches,1e3+(i||0),t.isSync,!0);var C={data:t.payloadBlob,urlString:l,headers:Object(w.i)({},y),_thePayload:t,_sendReason:i},S=null,I=!!e.sendHook,T=a;s&&t.isBeacon&&2===t.sendReason&&(T=s),T&&(S=function(n){g.firstRequestSent();var r=function(e,n){q(e,n,t,i)};try{T.sendPOST(n,r,t.isTeardown||t.isSync),e.sendListener&&e.sendListener(C,n,t.isSync||t.isTeardown,t.isBeacon)}catch(e){o.diagLog().warnToConsole("Unexpected exception sending payload. Ex:"+Object(D.a)(e)),N(r,0,{})}}),Object(b.c)(c,function(){return"HttpManager:_doPayloadSend.sender"},function(){if(S)if(t.isSync||t.isBeacon||_++,I&&!t.isBeacon&&3!==T._transport){var n={data:C.data,urlString:C.urlString,headers:C.headers},r=!1;Object(b.c)(c,function(){return"HttpManager:_doPayloadSend.sendHook"},function(){try{e.sendHook(n,function(e){r=!0,m||e._thePayload||(e._thePayload=e._thePayload||C._thePayload,e._sendReason=e._sendReason||C._sendReason),S(e)},t.isSync||t.isTeardown)}catch(e){r||S(C)}})}else S(C)})},function(){return{thePayload:t,serializationStart:n,serializationCompleted:r,sendReason:i}},t.isSync)}t.sizeExceed&&t.sizeExceed.length>0&&X(t.sizeExceed,8003,t.isSync),t.failedEvts&&t.failedEvts.length>0&&X(t.failedEvts,8002,t.isSync)}function W(e,t){O&&Object(I.a)(e,function(e){B(e.timings=e.timings||{},"sendEventCompleted",t)})}function q(e,t,n,i){var o=9e3,a=null,s=!1,c=!1;try{var l=!0;if(typeof e!==Pe.l){if(t){g.setClockSkew(t[Qe]);var u=t[ze]||t["kill-duration-seconds"];Object(I.a)(d.setKillSwitchTenants(t[Ke],u),function(e){Object(I.a)(n.batches,function(t){if(t.iKey()===e){a=a||[];var r=t.split(0);n.numEvents-=r.count(),a.push(r)}})})}if(200===e)return void(o=200);(!ke.shouldRetryForStatus(e)||n.numEvents<=0)&&(l=!1),o=9e3+e%1e3}if(l){o=100;var p=n.retryCnt;n.isSync||n.isBeacon||(p<r?(s=!0,J(function(){n.isSync||n.isBeacon||_--,V(n.batches,p+1,n.isTeardown,n.isSync,5,n.isBeacon)},!0,ke.getMillisToBackoffForRetry(p))):c=!0)}}finally{s||(g.setClockSkew(),K(n,o,i,c)),X(a,8004,n.isSync)}}function K(t,n,r,i){try{i&&o._backOffTransmission(),200===n&&(i||t.isSync||o._clearBackOff(),z(t.batches)),X(t.batches,n,t.isSync,!0)}finally{t.isSync||t.isBeacon||(_--,5!==r&&e.sendQueuedRequests(r,!t.isSync,t.isBeacon))}}function z(e){if(O){var t=Object(w.o)();Object(I.a)(e,function(e){e&&e.count()>0&&W(e.events(),t)})}}function J(e,t,n){t?e():o._setTimeoutOverride(e,n)}function Q(e){var t={};if(Object(I.u)(e)){var n=Object(I.I)(e).split(/[\r\n]+/);Object(I.a)(n,function(e){if(e){var n=e.indexOf(": ");if(-1!==n){var r=Object(I.I)(e.substring(0,n)).toLowerCase(),i=Object(I.I)(e.substring(n+1));t[r]=i}else t[Object(I.I)(e)]=1}})}return t}function Y(e){for(var t=0;t<e.batches.length;t++)for(var n=e.batches[t].events(),r=0;r<n.length;r++){var i=(n[r].ext||{}).intweb||{};if(Object(w.v)(i.msfpc))return encodeURIComponent(i.msfpc)}return""}function Z(t){var n=e._responseHandlers;try{for(var r=0;r<n.length;r++)try{n[r](t)}catch(e){o.diagLog().throwInternal(T.a.CRITICAL,E.f.PostResponseHandler,"Response handler failed: "+e)}if(t){var i=JSON.parse(t);Object(w.v)(i.webResult)&&Object(w.v)(i.webResult.msfpc)&&l.set("MSFPC",i.webResult.msfpc,31536e3)}}catch(e){}}function X(e,t,n,r){if(e&&e.length>0&&i){var a=i[$(t)];a&&Object(b.c)(c,function(){return"HttpManager:_sendBatchesNotification"},function(){J(function(){try{a.call(i,e,t,n)}catch(e){o.diagLog().throwInternal(T.a.CRITICAL,E.f.NotificationException,"send request notification failed: "+e)}},r||n,0)},function(){return{batches:x(e),reason:t,isSync:n,sendSync:r}},!n)}}function $(e){var t=Ye[e];return Object(w.v)(t)||(t=qe,e>=9e3&&e<=9999?t=We:e>=8e3&&e<=8999?t=Be:e>=1e3&&e<=1999&&(t=Ge)),t}var ee=!0;e.initialize=function(e,t,n,r,i){i||(i={}),u=e+u,c=t,l=t.getCookieMgr(),O=!c.config.disableEventTimings;var d=!!c.config.enableCompoundKey;o=n;var p=i.valueSanitizer,h=i.stringifyObjects;if(Object(I.x)(i.enableCompoundKey)||(d=!!i.enableCompoundKey),f=!Object(D.t)(),S=new je(c,p,h,d),s=P([3]),!(a=r)){m=!1;var g=Object(D.i)();g&&g.protocol&&"file:"===g.protocol.toLowerCase()&&(ee=!1);var _=[];_=Object(D.t)()?[2,1]:[1,2,3];var v=i.transports;v&&(Object(I.s)(v)?_=[v].concat(_):Object(I.k)(v)&&(_=v.concat(_))),(a=P(_))||o.diagLog().warnToConsole("No available transport to send events")}},e._getDbgPlgTargets=function(){return[a,d,S]},e.addQueryStringParameter=function(e,t){for(var n=0;n<v.length;n++)if(v[n].name===e)return void(v[n].value=t);v.push({name:e,value:t})},e.addHeader=function(e,t){y[e]=t},e.canSendRequest=function(){return j()&&g.allowRequestSending()},e.sendQueuedRequests=function(e,t,n){var r=!Object(I.r)(t)&&!t;F(C,r,0)&&V(k(),0,!1,r,e||0,!!n)},e.isCompletelyIdle=function(){return!p&&0===_&&0===C.length},e.addBatch=function(e){if(e&&e.count()>0){if(d.isTenantKilled(e.iKey()))return!1;C.push(e)}return!0},e.teardown=function(){C.length>0&&V(k(),0,!0,!0,2,!0)},e.pause=function(){p=!0},e.resume=function(){p=!1,e.sendQueuedRequests(4,!1)},e.sendSynchronousBatch=function(e,t,n){e&&e.count()>0&&V([e],0,!1,!0,t||0,!!n)}})}return e}(),Xe=.25,$e=500,et=20,tt=6,nt=4,rt=w.x?window:void 0,it=2,ot=1,at="eventsDiscarded",st="overrideInstrumentationKey",ct=function(e){function t(){var n=e.call(this)||this;n.identifier="PostChannel",n.priority=1011,n.version="3.1.2";var r,i,o,a,s,c,l=!1,u=[],d=null,p=!1,h=0,g=500,f=0,_=1e4,m={},v=Ie,y=null,C=null,S=0,O=0,P={},A=-1,L=!0;return Object(R.a)(t,n,function(e,t){function n(e,t){if(e.sendAttempt||(e.sendAttempt=0),e.latency||(e.latency=E.a.Normal),e.ext&&e.ext.trace&&delete e.ext.trace,e.ext&&e.ext.user&&e.ext.user.id&&delete e.ext.user.id,L&&(e.ext=Object(I.C)(e.ext),e.baseData&&(e.baseData=Object(I.C)(e.baseData)),e.data&&(e.data=Object(I.C)(e.data))),e.sync)if(S||p)e.latency=E.a.RealTime,e.sync=!1;else if(o)return L&&(e=Object(I.C)(e)),void o.sendSynchronousBatch(Ee.create(e.iKey,[e]),3);var n=e.latency,r=f,i=_;n===E.a.Immediate&&(r=h,i=g);var a=!1;if(r<i)a=!V(e,t);else{var s=E.a.Normal,c=et;n===E.a.Immediate&&(s=E.a.Immediate,c=1),a=!0,H(e.iKey,e.latency,s,c)&&(a=!V(e,t))}a&&J(at,[e],Se.a.QueueFull)}function R(e,t,n,r){var i=B(e,t,n);return o.sendQueuedRequests(t,n,r),i}function N(){return f>0}function D(){if(A>=0&&B(A,c,!0)&&o.sendQueuedRequests(c,!0,!1),h>0&&!C&&!p){var e=m[v][2];e>=0&&(C=M(function(){C=null,R(E.a.Immediate,1,!0),D()},e))}var t=m[v][1];!y&&!d&&t>=0&&!p&&(N()?y=M(function(){y=null,R(0===O?E.a.RealTime:E.a.Normal,1,!0),O++,O%=2,D()},t):O=0)}function M(t,n){0===n&&S&&(n=1);var r=1e3;return S&&(r=ke.getMillisToBackoffForRetry(S-1)),e._setTimeoutOverride(t,n*r)}function j(){null!==y&&(e._clearTimeoutOverride(y),y=null,O=0)}function k(t,n){j(),d&&(e._clearTimeoutOverride(d),d=null),p||R(E.a.Normal,t,n,!0)}function F(e,t,n){var r=P[t];r||(t=E.a.Normal,r=P[t]);var i=r.iKeyMap[e];return!i&&n&&(i=Ee.create(e),r.batches.push(i),r.iKeyMap[e]=i),i}function x(t,n){o.canSendRequest()&&!S&&(a>0&&f>a&&(n=!0),n&&null==d&&e.flush(t,null,20))}function V(e,t){L&&(e=Object(I.C)(e));var n=e.latency,r=F(e.iKey,n,!0);return!!r.addEvents([e],t)&&(n!==E.a.Immediate?(f++,t&&0===e.sendAttempt&&x(!e.sync,s>0&&r.count()>=s)):h++,!0)}function H(e,t,n,r){for(;n<=t;){var i=F(e,t,!0);if(i&&i.count()>0){var o=i.split(0,r),a=o.count();if(a>0)return n===E.a.Immediate?h-=a:f-=a,Q(at,[o],Se.a.QueueFull),!0}n++}return U(),!1}function U(){for(var e=0,t=0,n=E.a.Normal;n<=E.a.Immediate;n++)!function(n){var r=P[n];r&&r.batches&&Object(I.a)(r.batches,function(r){n===E.a.Immediate?e+=r.count():t+=r.count()})}(n);f=t,h=e}function B(t,n,r){var i=!1;return!r||o.canSendRequest()?Object(b.c)(e.core,function(){return"PostChannel._queueBatches"},function(){for(var e=[],n=E.a.Immediate;n>=t;){var r=P[n];r&&r.batches&&(Object(I.a)(r.batches,function(t){o.addBatch(t)?i=i||t&&t.count()>0:e=e.concat(t.events()),n===E.a.Immediate?h-=t.count():f-=t.count()}),r.batches=[],r.iKeyMap={}),n--}e.length>0&&J(at,e,Se.a.KillSwitch),i&&A>=t&&(A=-1,c=0)},function(){return{latency:t,sendReason:n}},r):(A=A>=0?Math.min(A,t):t,c=Math.max(c,n)),i}function G(e,t){R(E.a.Normal,t,!0),W(function(){e&&e(),u.length>0?d=M(function(){return G(u.shift(),t)},0):(d=null,N()&&D())})}function W(e){o.isCompletelyIdle()?e():d=M(function(){W(e)},Xe)}function q(){j(),K(),v=Ie,D()}function K(){(m={})[Ie]=[2,1,0],m[Oe]=[6,3,0],m[Te]=[18,9,0]}function z(t,n){var r=e._notificationManager||{},i=r[t];if(i)try{i.apply(r,n)}catch(n){e.diagLog().throwInternal(T.a.CRITICAL,E.f.NotificationException,t+" notification failed: "+n)}}function J(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t&&t.length>0&&z(e,[t].concat(n))}function Q(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t&&t.length>0&&Object(I.a)(t,function(t){t&&t.count()>0&&z(e,[t.events()].concat(n))})}function Y(){s=r&&r.disableAutoBatchFlushLimit?0:Math.max($e*(it+1),_/6)}K(),P[E.a.Immediate]={batches:[],iKeyMap:{}},P[E.a.RealTime]={batches:[],iKeyMap:{}},P[E.a.CostDeferred]={batches:[],iKeyMap:{}},P[E.a.Normal]={batches:[],iKeyMap:{}},Y(),o=new Ze($e,it,ot,{requeue:function(t,r){var i=[];Object(I.a)(t,function(t){t&&t.count()>0&&Object(I.a)(t.events(),function(t){t&&(t.sync&&(t.latency=E.a.RealTime,t.sync=!1),t.sendAttempt<tt?(Object(w.A)(t,e.identifier),n(t,!1)):i.push(t))})}),i.length>0&&J(at,i,Se.a.NonRetryableStatus)},send:function(e,t,n){e&&e.length>0&&z("eventsSendRequest",[t>=1e3&&t<=1999?t-1e3:0,!0!==n])},sent:function(e,t){Q("eventsSent",e,t),D()},drop:function(e,t){Q(at,e,t>=8e3&&t<=8999?t-8e3:Se.a.Unknown)},rspFail:function(e){Q(at,e,Se.a.NonRetryableStatus),D()},oth:function(e,t){Q(at,e,Se.a.Unknown),D()}}),e._getDbgPlgTargets=function(){return[o]},e.initialize=function(n,s,c){Object(b.c)(s,function(){return"PostChannel:initialize"},function(){var l=s;t.initialize(n,s,c),e.setInitialized(!1);var u=e._getTelCtx();n.extensionConfig[e.identifier]=n.extensionConfig[e.identifier]||{},r=u.getExtCfg(e.identifier),e._setTimeoutOverride=r.setTimeoutOverride?r.setTimeoutOverride:setTimeout.bind(rt),e._clearTimeoutOverride=r.clearTimeoutOverride?r.clearTimeoutOverride:clearTimeout.bind(rt),L=!r.disableOptimizeObj&&Object(w.r)();var d=l.getWParam;l.getWParam=function(){var e=0;return r.ignoreMc1Ms0CookieProcessing&&(e|=2),e|d()},r.eventsLimitInMem>0&&(_=r.eventsLimitInMem),r.immediateEventLimit>0&&(g=r.immediateEventLimit),r.autoFlushEventsLimit>0&&(a=r.autoFlushEventsLimit),Y(),r.httpXHROverride&&r.httpXHROverride.sendPOST&&(i=r.httpXHROverride),Object(w.v)(n.anonCookieName)&&o.addQueryStringParameter("anoncknm",n.anonCookieName),o.sendHook=r.payloadPreprocessor,o.sendListener=r.payloadListener;var p=r.overrideEndpointUrl?r.overrideEndpointUrl:n.endpointUrl;e._notificationManager=n.extensionConfig.NotificationManager,o.initialize(p,e.core,e,i,r),Object(w.e)(function(){k(2,!1)}),e.setInitialized(!0)},function(){return{coreConfig:n,core:s,extensions:c}})},e.processTelemetry=function(t,i){Object(w.A)(t,e.identifier);var o=(i=e._getTelCtx(i)).getExtCfg(e.identifier),a=!!r.disableTelemetry;o&&(a=a||!!o.disableTelemetry);var s=t;a||l||(r[st]&&(s.iKey=r[st]),o&&o[st]&&(s.iKey=o[st]),n(s,!0),D()),e.processNext(s,i)},e.setEventQueueLimits=function(e,t){_=e>0?e:1e4,a=t>0?t:0,Y();var n=f>e;if(!n&&s>0)for(var r=E.a.Normal;!n&&r<=E.a.RealTime;r++){var i=P[r];i&&i.batches&&Object(I.a)(i.batches,function(e){e&&e.count()>=s&&(n=!0)})}x(!0,n)},e.teardown=function(){k(2,!1),l=!0,o.teardown()},e.pause=function(){j(),p=!0,o.pause()},e.resume=function(){p=!1,o.resume(),D()},e.addResponseHandler=function(e){o._responseHandlers.push(e)},e._loadTransmitProfiles=function(e){q(),Object(I.A)(e,function(e,t){var n=t.length;if(n>=2){var r=n>2?t[2]:0;if(t.splice(0,n-2),t[1]<0&&(t[0]=-1),t[1]>0&&t[0]>0){var i=t[0]/t[1];t[0]=Math.ceil(i)*t[1]}r>=0&&t[1]>=0&&r>t[1]&&(r=t[1]),t.push(r),m[e]=t}})},e.flush=function(e,t,n){void 0===e&&(e=!0),p||(j(),n=n||1,e?(B(E.a.Normal,n,e),U(),null==d?d=M(function(){G(t,n)},0):u.push(t)):(R(E.a.Normal,n,!1),null!==t&&void 0!==t&&t()))},e.setMsaAuthTicket=function(e){o.addHeader("AuthMsaDeviceTicket",e)},e.hasEvents=N,e._setTransmitProfile=function(e){v!==e&&void 0!==m[e]&&(j(),v=e,D())},e._backOffTransmission=function(){S<nt&&(S++,j(),D())},e._clearBackOff=function(){S&&(S=0,j(),D())}}),n}return Object(S.b)(t,e),t}(L.a),lt=function(){return function(e){this._setOverride=function(t,n){e.setOverride(t,n)},this._getOverride=function(t){return e.getOverride(t)}}}(),ut=function(e){function t(t,n){var r=e.call(this,t)||this,i=r;return i.setId=function(e){i._setOverride($.id,e)},i.getId=function(){return i._getOverride($.id)},i.setVer=function(e){i._setOverride($.ver,e)},i.getVer=function(){return i._getOverride($.ver)},i.setName=function(e){i._setOverride($.appName,e)},i.getName=function(){return i._getOverride($.appName)},i.setLocale=function(e){i._setOverride($.locale,e)},i.getLocale=function(){return i._getOverride($.locale)},i.setEnv=function(e){i._setOverride($.env,e)},i.getEnv=function(){return i._getOverride($.env)},i.setExpId=function(e){i._setOverride($.expId,j.validateAppExpId(e))},i.getExpId=function(){return i._getOverride($.expId)},n&&(Object(I.x)(n.env)||i.setEnv(n.env),Object(I.r)(n.expId)||i.setExpId(n.expId)),r}return Object(S.b)(t,e),t}(lt),dt=function(e){function t(t){var n=e.call(this,t)||this,r=n;return r.setRole=function(e){r._setOverride(le.role,e)},r.getRole=function(){return r._getOverride(le.role)},r.setRoleInstance=function(e){r._setOverride(le.roleInstance,e)},r.getRoleInstance=function(){return r._getOverride(le.roleInstance)},r.setRoleVer=function(e){r._setOverride(le.roleVer,e)},r.getRoleVer=function(){return r._getOverride(le.roleVer)},n}return Object(S.b)(t,e),t}(lt),pt=function(e){function t(t){var n=e.call(this,t)||this,r=n;return r.setProperty=function(e,t){r._setOverride(e,t)},r.getProperty=function(e){return r._getOverride(e)},n}return Object(S.b)(t,e),t}(lt),ht=function(e){function t(t){var n=e.call(this,t)||this,r=n;return r.setLocalId=function(e){r._setOverride(ce.localId,e)},r.getLocalId=function(){return r._getOverride(ce.localId)},r.setDeviceClass=function(e){r._setOverride(ce.deviceClass,e)},r.getDeviceClass=function(){return r._getOverride(ce.deviceClass)},r.setMake=function(e){r._setOverride(ce.make,e)},r.getMake=function(){return r._getOverride(ce.make)},r.setModel=function(e){r._setOverride(ce.model,e)},r.getModel=function(){return r._getOverride(ce.model)},n}return Object(S.b)(t,e),t}(lt),gt=function(e){function t(t){var n=e.call(this,t)||this,r=n;return r.setTz=function(e){r._setOverride(ae.tz,e)},r.getTz=function(){return r._getOverride(ae.tz)},n}return Object(S.b)(t,e),t}(lt),ft=function(e){function t(t,n){var r=e.call(this,t)||this,i=r;if(i.setOsName=function(e){i._setOverride(ne.osName,e)},i.getOsName=function(){return i._getOverride(ne.osName)},i.setVer=function(e){i._setOverride(ne.ver,e)},i.getVer=function(){return i._getOverride(ne.ver)},n&&n.userAgent&&n.populateOperatingSystemInfo){var o=new W(n);i.setOsName(o.name),i.setVer(o.ver)}return r}return Object(S.b)(t,e),t}(lt),_t=function(){return function(e){var t=this,n=[];t.setOverride=function(e,t){e&&n.push({key:e,value:t})},t.hasOverride=function(e){var t=!1;return Object(I.a)(n,function(n){n.key===e&&(t=!0)}),t},t.getOverride=function(e){var t;return Object(I.a)(n,function(n){n.key===e&&(t=n.value)}),t},t.applyOverrides=function(t,r){if(n.length>0)try{var i=g(t,e);Object(I.a)(n,function(e){f(i,e.key,e.value)})}catch(e){}}}}(),mt=function(e){function t(t){var n=e.call(this,t)||this,r=n;return r.setLocalId=function(e){r._setOverride(te.localId,e)},r.getLocalId=function(){return r._getOverride(te.localId)},r.setLocale=function(e){r._setOverride(te.locale,e)},r.getLocale=function(){return r._getOverride(te.locale)},r.setId=function(e){r._setOverride(te.id,e)},r.getId=function(){return r._getOverride(te.id)},n}return Object(S.b)(t,e),t}(lt),vt=function(e){function t(t,n){var r=e.call(this,t)||this,i=r;return i.setDomain=function(e){i._setOverride(ee.domain,e)},i.getDomain=function(){return i._getOverride(ee.domain)},i.setBrowser=function(e){i._setOverride(ee.browser,e)},i.getBrowser=function(){return i._getOverride(ee.browser)},i.setBrowserVer=function(e){i._setOverride(ee.browserVer,e)},i.getBrowserVer=function(){return i._getOverride(ee.browserVer)},i.setScreenRes=function(e){i._setOverride(ee.screenRes,e)},i.getScreenRes=function(){return i._getOverride(ee.screenRes)},i.setUserConsent=function(e){i._setOverride(ee.userConsent,e)},i.getUserContext=function(){return i._getOverride(ee.userConsent)},n&&(Object(I.x)(n.userConsented)||i.setUserConsent(n.userConsented)),r}return Object(S.b)(t,e),t}(lt),yt=(I.u,"ext"),Ct="data",St=function(){return function(e,t,n){function r(e){for(var t="",n=0;n<e.length;n++)t&&(t+="_"),t+=e[n];return Object(I.x)(o[t])&&(o[t]=new _t(e)),t?o[t]:null}var i=this,o={};i.data=new pt(r([Ct])),i.app=new ut(r([yt,de.AppExt]),t),i.user=new mt(r([yt,de.UserExt])),i.os=new ft(r([yt,de.OSExt]),t),i.web=new vt(r([yt,de.WebExt]),t),i.device=new ht(r([yt,de.DeviceExt])),i.loc=new gt(r([yt,de.LocExt])),i.cloud=new dt(r([yt,de.CloudExt])),i.applyOverrides=function(e,t){var n=Object(I.B)(o);n&&n.length>0&&Object(I.a)(n,function(n){o[n].applyOverrides(e,t)})}}}(),It=function(e){function t(){var t=e.call(this)||this;t.identifier="OverridePropertiesPlugin",t.priority=4,t.version="3.1.2";var n=t,r=null;return n._baseInit=function(e,n,i){r=new St(e,t._getTelCtx().getExtCfg(t.identifier),n)},n.setProperty=function(e,t){r&&r.data.setProperty(e,t)},n.getOverrideContext=function(){return r},t}return Object(S.b)(t,e),t.prototype.initialize=function(t,n,r){e.prototype.initialize.call(this,t,n,r),this._baseInit(t,n,r)},t.prototype.processTelemetry=function(e,t){Object(w.A)(e,this.identifier),t=this._getTelCtx(t);var n=this.getOverrideContext();n&&n.applyOverrides(e,t),this.processNext(e,t)},t}(L.a),Ot=function(e){function t(n,r){var i=e.call(this)||this;return Object(R.a)(t,i,function(e,t){function i(e){var t=[];return e&&Object(I.a)(e,function(e){e.iKey===n&&t.push(e)}),t}function o(t){if(e[t]&&e.listeners)for(var n=0;n<e.listeners.length;n++){var r=e.listeners[n];if(r&&r[t])return!0}return!1}var a={eventsSent:function(t){if(o("eventsSent")){var n=i(t);n.length>0&&e.eventsSent(n)}},eventsDiscarded:function(t,n){if(o("eventsDiscarded")){var r=i(t);r.length>0&&e.eventsDiscarded(r,n)}},eventsSendRequest:function(t,n){o("eventsSendRequest")&&e.eventsSendRequest(t,n)},perfEvent:function(t){o("perfEvent")&&e.perfEvent(t)}};r.addNotificationListener(a)}),i}return Object(S.b)(t,e),t}(O.a),Tt=function(){function e(){var t,n,r,i,o,a,s,c,l={},u=[],d=null,p=[],h=[],g={};Object(R.a)(e,this,function(e){function f(e,t){if(void 0===t&&(t=null),e){(m(e)?h:p).push(e);var n=e.identifier;l.extensionConfig[n]=l.extensionConfig[n]||{},_(l.extensionConfig[n],t)}return e}function y(){var e=l.channels||[[]],t=new ct,n=t.identifier,o=!1;r=null,i=null,Object(I.a)(e,function(e){Object(I.a)(e,function(e){Object(I.o)(e)||(f(e),e.identifier===n&&(o=!0,r=e))})}),o||(e[0].push(t),r=f(t,l.channelConfiguration)),l.channels=e}function C(e){u=[],n=f(new Ce,l.propertyConfiguration),u.push(n),l.extensions&&Object(I.a)(l.extensions,function(e){Object(I.o)(e)||f(e)}),e&&Object(I.a)(e,function(e){e&&!Object(I.o)(e)&&u.push(f(e))})}function S(n){if(!d){c||e.diagLog().throwInternal(T.a.WARNING,E.f.SDKNotInitialized,"The Shared Manager is not yet created, the returned shared instance will be overwritten");var o=A(n||l.instrumentationKey||"_not_defined_",{});t=new O.a,(d=new Et(e,e.diagLog(),t)).initialize(o,u),r&&(i=v(r.identifier,o))}}function A(e,t){var n={};return n.instrumentationKey=e,n.channels=R(t),w(n),_(n,t),_(n,l),n}function R(e){var t=[[]];return l.channels&&Object(I.a)(l.channels,function(e,n){Object(I.o)(e)||(t[n]=t[n]||[],t[n]=t[n].concat(e))}),e&&e.channels&&Object(I.a)(e.channels,function(e,n){Object(I.o)(e)||(t[n]=t[n]||[],t[n]=t[n].concat(e))}),t}function w(e){var t=[];l.extensions&&l.extensions.length>0&&(t=t.concat(l.extensions)),e&&e.extensions&&e.extensions.length>0&&(t=t.concat(e.extensions)),t.length>0&&(e.extensions=t),e.extensionConfig=e.extensionConfig||{},_(e.extensionConfig,l.extensionConfig)}function L(e){var t=[];return u&&u.length>0&&(t=t.concat(u)),e&&e.length>0&&(t=t.concat(e)),t}e.diagLog=function(){return o||(o=new P.a(l)),o},e.getCookieMgr=function(){return S(),d.getCookieMgr()},e.setCookieMgr=function(e){return S(),d.setCookieMgr(e)},e.getPerfMgr=function(){return s||l&&l.enablePerfMgr&&(s=new b.b(e.getNotifyMgr())),s},e.setPerfMgr=function(e){s=e},e.create=function(t,n){c?e.diagLog().throwInternal(T.a.WARNING,E.f.FailedToInitializeSDK,"Shared Manager has already been initialized."):(l=t||{},d=null,y(),C(n))},e.getInst=function(e){return(g[e]||{}).inst},e.newInst=function(n,o,a){var s=e.getInst(n);if(s)return e.diagLog().throwInternal(T.a.WARNING,E.f.FailedToInitializeSDK,"Instance already exists for ["+n+"]"),s;S(n);var c=A(n,o);if(r){var l=v(r.identifier,c);i&&l&&i!==l&&e.diagLog().throwInternal(T.a.WARNING,E.f.ErrorProvidedChannels,"The endpointUrl mismatch, shared Url ["+i+"] is different from configured ["+l+"] shared will be used!")}var u=new Ot(n,t);return s=new Et(e,e.diagLog(),u),g[n]={iKey:n,inst:s,notifyMgr:u},s.setPerfMgr(e.getPerfMgr()),s.initialize(c,L(a)),s},e.getSharedPlugin=function(e){S();var t=null;return Object(I.a)(p,function(n){e===n.identifier&&(t=n)}),t||Object(I.a)(h,function(n){e===n.identifier&&(t=n)}),t},e.getPropertyManager=function(){return S(),n},e.getPostChannel=function(){return S(),r},e.getNotifyMgr=function(){return a||(a=new O.a),a}})}return e}(),Et=function(e){function t(n,r,i){var o,a=e.call(this)||this,s=n;return Object(R.a)(t,a,function(e,t){e.getSharedPropertyManager=function(){return s.getPropertyManager()},e.getSharedPostChannel=function(){return s.getPostChannel()},e.getOverridePropertyManager=function(){return o},e.initialize=function(n,a){Object(b.c)(e,function(){return"ApplicationInsights:initialize"},function(){var s=[o=new It];a&&(s=s.concat(a)),n.extensionConfig=n.extensionConfig||[];var c=n.propertyConfiguration||{};n.propertyConfiguration&&delete n.propertyConfiguration,n.extensionConfig[o.identifier]=c;try{t.initialize(n,s,r,i)}catch(t){e.logger.throwInternal(T.a.CRITICAL,E.f.FailedToInitializeSDK,"Failed to initialize SDK."+t)}},function(){return{config:n,extensions:a}})}}),a}return Object(S.b)(t,e),t}(A.a),Pt=n(114)},function(e,t,n){"use strict";function r(e){return Object(j.s)(e)&&e>=V.b.Normal&&e<=V.b.Critical}function i(e,t){var n=!1;return t instanceof DOMException&&(22!==t.code&&"QuotaExceededError"!==t.name&&1014!==t.code&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||e&&0!==e.length&&(n=!0)),n}function o(e){var t=Object(B.a)()||{},n=null;try{if(n=t[e]){var r="__storage_test__";n.setItem(r,r),n.removeItem(r)}}catch(e){i(n,e)||(n=null)}return n}function a(e,t){if(e)for(var n=Object(j.B)(e),r=0;r<n.length;r++){var i=n[r];if(!t(e[i],i))break}}function s(e){var t=!0;return a(e,function(e,n){return e&&(t=!1),t}),t}function c(e,t){for(var n=Q,r=0;n<=e&&r<G;){var i=function(){var e=[],i=t[n];if(a(i,function(t,n){return e.push(n),++r<G}),r>0){for(var o=0;o<e.length;o++)delete i[e[o]];return{value:!0}}n++}();if("object"==typeof i)return i.value}return r>0}function l(){var e=Object(B.a)()||{},t=null;if(e)try{for(var n=0;n<le.length;n++)if((t=e[le[n]])&&ue(t.open))return t}catch(e){t=null}return t||null}function u(e,t){Object($.e)("QUnit")&&console&&console.log("IndexedDbHelper ["+e+"] "+t)}function d(e,t,n){e&&e.warnToConsole("IndexedDbHelper ["+t+"] "+n)}function p(e,t,n,r){return function(i){n(new Error(t)),u(e,"["+r+"] event rejected")}}function h(e,t){for(var n=null,r=0;r<pe.length;r++)if((n=pe[r]).name===e)return n;return n={name:e,sch:new D.a("IndexedDbHelper["+e+"]",t),dbHdl:[],add:function(t){n.dbHdl.push(t),u(e,"- dbOpened (add) -- hdls ["+n.dbHdl.length+"]")},remove:function(t){for(var r=n.dbHdl,i=0;i<r.length;i++)if(r[i]===t){r.splice(i,1);break}u(e,"- dbClosed (remove) -- hdls ["+n.dbHdl.length+"]")},isOpen:function(){return n.dbHdl.length>0},openHdl:function(){return n.dbHdl.length>0?n.dbHdl[0]:null}},pe.push(n),n}function g(){return(new Date).getTime()}function f(e,t){return function(n){return t(new Error(e))}}function _(e){e.objectStoreNames.contains(Ee)||e.createObjectStore(Ee,{keyPath:"key"}).createIndex("EvntId","key",{unique:!1}),e.objectStoreNames.contains(Pe)||e.createObjectStore(Pe,{keyPath:"iKey"}).createIndex("iKey","iKey",{unique:!0})}function m(e){return e.openStore(Pe,function(t){return new F.a(function(n,r){var i={iKey:e.ctx.iKey,tm:g()},o=t.store.put(i);o.onsuccess=function(e){n(o.result.toString())},o.onerror=function(e){r(new Error(Se))},o.onerror=f(Ie,r)})})}function v(e){for(var t=[],n=V.b.Critical;n>=V.b.Normal;n--)for(var r=0;r<e.length;r++){var i=e[r];i&&i.evt.persistence===n&&t.push(i.evt)}return t}function y(e,t){for(var n=0;n<e.length;n++)if(t.tm<e[n].tm)return void e.splice(n,0,t);e.push(t)}function C(e,t){for(var n=t.length,r=0;r<n;r++)if(e===t[r].id)return r;return-1}function S(e,t){var n=e.tm;return g()-n>t}function I(e){return function(t){return e.continue()}}function O(e){var t=e.cursor.delete();return t.onerror=I(e),t.onsuccess=I(e),1}function T(e,t){return e.openCursor(Ee,t,function(e,t,n){return n.push(t),0})}function E(e,t,n){return e.openCursor(Ee,t,function(e,t,r){return n(t)?(r.push(t),O(e)):0})}function P(e){return new F.a(function(t,n){var r=!1;e.openCursor(Pe,null,function(e,t,n){var i=t.tm;return g()-i<ve?0:(r=!0,2)}).then(function(){if(r){var i={};E(e,null,function(e){if(!e||!e.evt||!e.evt.iKey)return!0;var t=e.tm;return g()-t>ve||(i[e.evt.iKey]=1,!1)}).then(function(){var r=[];e.openCursor(Pe,null,function(e,t,n){var o=t.tm;return g()-o<ve?0:i[t.iKey]?0:(r.push(t),O(e))}).then(function(){t(r)},n)},n)}else t([])},n)})}function b(e){return e.openCursor(Ee,"#key="+e.ctx.iKeyPrefix(),function(t,n){var r=n.key;if(0===r.indexOf(e.ctx.iKeyPrefix())&&-1===r.indexOf(e.ctx.evtKeyPrefix())&&S(n,me)){n.key=e.ctx.evtKeyPrefix()+n.id;var i=t.store.store.put(n);return i.onerror=I(t),i.onsuccess=function(e){try{O(t)}catch(e){t.continue()}},1}return 0})}function A(e){return new F.a(function(t,n){P(e).then(function(){b(e).then(t,t)},n)})}function R(e,t){return new F.a(function(n,r){function i(){n(a)}function o(e,t){return new F.a(function(n){var r=e.store.delete(t.key);r.onsuccess=function(e){a++,n()},r.onerror=function(e){n()}})}var a=0,s=e.ctx.evtKeyPrefix();e.openCursor(Ee,"#key="+s,function(e,n,r){return n.evt.persistence<=t&&0===n.key.indexOf(s)&&(y(r,n),r.length>fe&&r.splice(r.length-1,1)),0}).then(function(t){0!==t.length?e.openStore(Ee,function(e){for(var n=[],r=0;r<t.length;r++)n.push(o(e,t[r]));return F.a.all(n).then(i,i)}):i()},function(){n(0)})})}n.r(t),n.d(t,"LocalStorageChannel",function(){return De}),n.d(t,"StorageProviders",function(){return w}),n.d(t,"BaseTelemetryPlugin",function(){return H.a});var w,L=n(74),N=n(28),D=n(68),M=n(3),j=n(0),k=n(17),F=n(23),x=n(21),V=n(6),H=n(72),U=n(2);!function(e){e[e.LocalStorage=1]="LocalStorage",e[e.SessionStorage=2]="SessionStorage",e[e.IndexedDb=3]="IndexedDb"}(w||(w={}));var B=n(16),G=10,W="3",q="Version",K=6e5,z="AWTEvents",J=5e6,Q=1,Y=2,Z=r,X=function(){function e(t,n){Object(U.a)(e,this,function(e){function r(e,t){return{key:e,db:t}}function i(e,t){void 0===t&&(t=!0);var n=null;if(p){var i=p.getItem(e);if(i)try{n=JSON.parse(i)}catch(t){p.removeItem(e)}}return t&&!n&&(n={events:{1:{},2:{},3:{}},lastAccessTime:0}),r(e,n)}function l(e,t){void 0===t&&(t=!0);var n=!0,r=e.db;if(r){t&&(r.lastAccessTime=(new Date).getTime());for(var i=Q;i<=Y;i++)if(!s(r.events[i])){n=!1;break}}try{if(n)p&&p.removeItem(e.key);else{var o=JSON.stringify(r);if(o.length>v)return!1;p&&p.setItem(e.key,o)}}catch(e){return!1}return!0}function u(e){var t=[],n=i(e,!1),r=n.db;if(r){var o=r.events;try{for(var s=Q;s<=Y;s++)a(o[s],function(e,n){return e&&t.push(e),!0})}catch(e){}p&&p.removeItem(n.key)}return t}function d(){if(p){for(var e=p.getItem(y),t=[],n=i(C),o=!1,s=0;s<p.length;s++){var c=p.key(s);if(0===c.indexOf(h)&&c!==y){if(e!==W){t.push(r(c,null));continue}var u=i(c,!1),d=u.db;if(d){if((new Date).getTime()-d.lastAccessTime>K){for(var g=Q;g<=Y;)!function(){var e=d.events[g],t=n.db.events[g];a(e,function(n,r){return(Object(M.n)(n.iKey)||n.iKey)===m&&(t[r]=n,delete e[r]),!0}),g++}();o=!0,t.push(u)}}else t.push(r(c,null))}}for(s=0;s<t.length;s++)l(t[s],!1);o&&l(n),p.setItem(y,f)}}var p=null,h=z,g=null,f=W,_=null,m=null,v=J,y=null,C=null;e.id=n,p=o(t)||null,e.initialize=function(t){if(!p)return!1;var n=t.storageConfig||{};return v=n.maxStorageSizeInBytes>0?n.maxStorageSizeInBytes:v,h=n.storageKey||z,g=e.id||t.id||Object(k.d)(),C=h+"."+g,y=h+q,_=t.itemCtx.getCfg().instrumentationKey,m=Object(M.n)(_)||_,d(),!0},e.supportsSyncRequests=function(){return!0},e.getAllEvents=function(){try{var e=[],t=i(C,!1).db;if(t)for(var n=t.events,r=Y;r>=Q;r--)a(n[r],function(t){return t&&(Object(M.n)(t.iKey)||t.iKey)===m&&e.push(t),!0});return F.a.resolve(e)}catch(e){return F.a.reject(e)}},e.addEvent=function(e,t,n){try{var r=i(C);t.id=t.id||Object(k.d)(),Z(t.persistence)||(t.persistence=Q);for(var o=t.persistence,a=t.id,s=r.db.events;;){if(s[o][a]=t,l(r))return F.a.resolve(t);if(delete s[o][a],!c(o,s))return F.a.reject(new Error("Unable to free up event space"))}}catch(e){return F.a.reject(e)}},e.removeEvents=function(e){try{var t=i(C,!1),n=t.db;if(n){var r=n.events;try{for(var o=0;o<e.length;++o){var a=e[o];delete r[a.persistence][a.id]}if(l(t))return F.a.resolve(e)}catch(e){}e=u(t.key)}return F.a.resolve(e)}catch(e){return F.a.reject(e)}},e.clear=function(){try{var e=[],t=i(C,!1),n=t.db;if(n){for(var r=n.events,o=Y;o>=Q;o--)!function(t){var n=r[t];a(n,function(t){return t&&(Object(M.n)(t.iKey)||t.iKey)===m&&(delete n[t.id],e.push(t)),!0})}(o);l(t)}return F.a.resolve(e)}catch(e){return F.a.reject(e)}},e.teardown=function(){try{var e=i(C,!1),t=e.db;t&&(t.lastAccessTime=0,l(e,!1))}catch(e){}}})}return e}(),$=n(5),ee="readwrite",te="result",ne="DBError: Unable to open database",re="Database is not open",ie="DBError: Failed to Open Cursor",oe="DBError: Failed to delete the database",ae="DBError: Database does not exist",se="DBError: Database upgrade required",ce="DBError: Feature not supported",le=["indexedDB"],ue=j.o,de=j.u,pe=[],he=function(){function e(t){Object(U.a)(e,this,function(e){function n(e,n){var o=e.db.transaction(n,ee);return o.onabort=function(){d(t,e.dbName,"txn.onabort")},o.onerror=function(){d(t,e.dbName,"txn.onerror")},o.oncomplete=function(){u(e.dbName,"txn.oncomplete")},{db:e,store:o.objectStore(n),tx:o,tbl:n,openCursor:function(t,r){return i(e,n,t,r)},newTransaction:function(t){return r(e,n,t)}}}function r(e,t,r){if(!e||!e.db)return F.a.reject(new Error(re));try{var i=r(n(e,t));return i instanceof F.a?i:F.a.resolve(i)}catch(e){return F.a.reject(e)}}function i(e,t,r,i){if(!e||!e.db)return F.a.reject(new Error(re));var o=null;return r&&de(r)?o=new ge(r):r&&r.isMatch&&(o=r),new F.a(function(r,a){var s=[],c=null,l=null;o&&o.keyRange&&(l=o.keyRange());var u=n(e,t);(c=l?u.store.openCursor(l):u.store.openCursor()).onerror=p(u.db.dbName,ie,a,"openCursor"),c.onsuccess=function(e){var t=e.target[te];if(t){var n={store:u,cursor:t,continue:function(){t.continue()},done:function(){r(s)}},c=t.value;if(!o||o.isMatch(c))if(i)try{switch(i(n,c,s)){case 2:r(s);break;case 1:break;case 0:default:n.continue()}}catch(e){a(e)}else s.push(c),n.continue();else n.continue()}else r(s)}})}function o(e,t,n,r){return h(e).sch.scheduleEvent(n,t,r)}var a=l()||null;e.isAvailable=function(){return!!a},e.openDb=function(e,n,s,c){return o(e,"openDb",function(o){return new F.a(function(l,g){function f(t,o,a,s,c){var l={db:o,dbName:e,dbVersion:n,ctx:null,isNew:s,txn:a?a.transaction:null};return c||(l.openStore=function(e,t){return r(l,e,t)},l.openCursor=function(e,t,n){return i(l,e,t,n)}),l}function _(e,t){var n=f(null,e,t,!0,!0);if(c)v=!0,c(n).then(function(){n.txn||(n.txn=t.transaction)},function(e){try{t.transaction&&t.transaction.abort()}finally{g(e)}});else try{t.transaction&&t.transaction.abort()}finally{g(new Error(se))}}function m(n,r){var i=h(e);i.add(n),n.onabort=function(r){d(t,e,"onabort -- closing the Db"),i.remove(n)},n.onerror=function(r){d(t,e,"onerror -- closing the Db"),i.remove(n)},n.onclose=function(r){d(t,e,"onclose -- closing the Db"),i.remove(n)},n.onversionchange=function(r){d(t,e,"onversionchange -- force closing the Db"),n.close(),i.remove(n)};var o=null,a=null;i.dbHdl.length>0&&(a=i.dbHdl[0]),o=f(i,a,r,v);try{s(o).then(function(e){l(e)},g)}catch(e){g(e)}}var v=!1,y=h(e);if(null==a)g(new Error("No available storage factory"));else if(y.isOpen()){var C=f(y,y.openHdl(),null,!1);s(C).then(l,g)}else{var S=a.open(e,n);S.onblocked=function(n){d(t,e,"Db Open Blocked event ["+o+"] - "+(S.error||"")),g(new Error(ne))},S.onerror=function(n){d(t,e,"Db Open Error event ["+o+"] - "+(S.error||"")),g(new Error(ne))},S.onupgradeneeded=function(t){u(e,"Db Open Create/Upgrade needed event ["+o+"]");try{var n=t.target[te];if(!n)return void g(new Error(ne));_(n,S)}catch(t){p(e,ne,g,o)(t)}},S.onsuccess=function(e){var t=e.target[te];t?m(t,S):g(new Error(ne))}}})})},e.closeDb=function(e){o(e,"closeDb",function(t){var n=h(e),r=n.dbHdl,i=r.length;if(i>0){for(var o=0;o<i;o++)r[o].close();n.dbHdl=[]}return F.a.resolve(1)})},e.deleteDb=function(e){return null==a?F.a.resolve(!1):o(e,"deleteDb",function(n){var r=h(e),i=r.dbHdl,o=i.length;if(o>0){d(t,e,"Db is open ["+o+"] force closing");for(var s=0;s<o;s++)i[s].close();r.dbHdl=[]}return new F.a(function(r,i){setTimeout(function(){try{u(e,"["+n+"] starting");var o=a.deleteDatabase(e);o.onerror=function(r){d(t,e,"["+n+"] error!!"),i(new Error(oe))},o.onblocked=function(r){d(t,e,"["+n+"] blocked!!"),i(new Error(oe))},o.onupgradeneeded=function(r){d(t,e,"["+n+"] upgrade needed!!"),i(new Error(oe))},o.onsuccess=function(t){u(e,"["+n+"] complete"),r(!0)},u(e,"["+n+"] started")}catch(r){d(t,e,"["+n+"] threw - "+r),i(new Error(oe+" - "+r))}},0)})})},e.getDbDetails=function(e){return o(e,"getDbDetails",function(t){return null!=a&&a.databases?new F.a(function(t,n){a.databases().then(function(r){for(var i=0;i<r.length;i++)if(r[i].name===e)return void t(r[i]);n(new Error(ae))},n)}):F.a.reject(new Error(ce))},2e3)}})}return e}(),ge=function(){function e(t){var n=[],r=null;Object(U.a)(e,this,function(e){e.keyRange=function(){return r},e.parseQuery=function(t){if(n=[],t)for(var i=t.split(";"),o=0;o<i.length;o++){var a=i[o],s=a.indexOf("=");if(-1!==s){var c=a.substring(0,s),l=a.substring(s+1);0===c.indexOf("#")&&(c=c.substring(1),r||(r=IDBKeyRange.bound(l,l+"￿"))),e.startsWith(c,l)}}},e.startsWith=function(e,t){n.push({name:e,value:t,type:0})},e.contains=function(e,t){n.push({name:e,value:t,type:1})},e.isMatch=function(e){if(!n||0===n.length)return!0;if(!e)return!1;for(var t=0;t<n.length;t++){var r=n[t],i=e[r.name];if(i)if(0===r.type){if(0!==i.indexOf(r.value))return!1}else if(1===r.type&&-1===i.indexOf(r.value))return!1}return!0},t&&e.parseQuery(t)})}return e}(),fe=10,_e=1,me=6e5,ve=1008e4,ye="Unknown",Ce=-1,Se="DBError: Unable to add event",Ie="DBError: Unable to update iKey",Oe="AppInsightEvents.1",Te=1,Ee="Evts",Pe="iKey",be=r,Ae=function(){function e(t){Object(U.a)(e,this,function(e){function n(e){return i.openDb(o,Te,function(t){return new F.a(function(n,r){var i={iKey:a,storageId:s,iKeyPrefix:function(){return c},evtKeyPrefix:function(){return l}};t.ctx=i,m(t).then(function(){e(t).then(n,r)},r)})},function(e){return new F.a(function(t,n){_(e.db),t()})})}function r(e,t,n){return new F.a(function(i,o){function a(t,n){R(e,t).then(function(e){e>0&&(d-=e),n(e)},function(e){n(0)})}function s(e){i(t.evt)}function c(){e.openStore(Ee,function(c){var l=c.store.put(t);l.onsuccess=function(r){n&&m(e).then(s,s),d++,i(t.evt)},l.onerror=function(s){function c(n){0===n&&o(new Error(Se)),r(e,t,!1).then(function(e){i(t.evt)},function(){o(new Error(Se))})}n?a(V.b.Normal,function(e){e>0?c(e):t.evt.persistence>=V.b.Critical?a(V.b.Critical,function(e){c(e)}):o(new Error(Se))}):o(new Error(Se))}})}u>0&&d>=u?a(V.b.Normal,function(e){0===e?t.evt.persistence>=V.b.Critical?a(V.b.Critical,function(e){c()}):o(new Error(Se)):c()}):c()})}var i=null,o=null,a=ye,s=null,c=null,l=null,u=Ce,d=0;e.id=t,e.initialize=function(t){var r=t.itemCtx.diagLog();if(!(i=new he(r)).isAvailable())return i=null,!1;var d=t.itemCtx.getCfg(),p=t.storageConfig||{};return o=p.indexedDbName||Oe,a=d.instrumentationKey||a,s=e.id||t.id||Object(k.d)(),c=a+"::",l=c+s+"::",u=p.maxStorageItems>0?p.maxStorageItems:u,n(function(e){return e.isNew?F.a.resolve(!0):A(e)}).then(function(e){},function(e){r.warnToConsole("IndexedDbProvider failed to initialize - "+(e||"<unknown>")),i=null}),!0},e.supportsSyncRequests=function(){return!1},e.getAllEvents=function(){return null!=i&&i.isAvailable()?n(function(e){return new F.a(function(t,n){T(e,"#key="+e.ctx.evtKeyPrefix()).then(function(e){d=e.length,t(v(e))},n)})}):F.a.resolve([])},e.addEvent=function(e,t,o){return null!=i&&i.isAvailable()?(t.id=t.id||Object(k.d)(),be(t.persistence)||(t.persistence=V.b.Normal),n(function(n){var i=e||t.id;return r(n,{key:n.ctx.evtKeyPrefix()+i,id:i,evt:t,tm:g(),v:_e},!0)})):F.a.resolve(t)},e.removeEvents=function(e){if(null==i||!i.isAvailable())return F.a.resolve([]);var t=[];return new F.a(function(r,i){n(function(n){return n.openCursor(Ee,"#key="+n.ctx.iKey,function(n,r,i){if(-1!==C(r.id,e)){var o=n.cursor.delete();return o.onerror=I(n),o.onsuccess=function(){t.push(r.evt),n.continue()},1}return 0})}).then(function(e){d-=t.length,r(t)},function(e){d-=t.length,r(t)})})},e.clear=function(){return null!=i&&i.isAvailable()?new F.a(function(e,t){n(function(e){return E(e,"#key="+e.ctx.evtKeyPrefix(),function(t){return 0===t.key.indexOf(e.ctx.evtKeyPrefix())})}).then(function(t){d=0,e(v(t))},t)}):F.a.resolve([])},e.teardown=function(){i&&i.closeDb(o)}})}return e}(),Re="3.1.2",we="LocalStorage",Le=5,Ne=r,De=function(e){function t(){var n=e.call(this)||this;return n.identifier=we,n.priority=1009,n.version=Re,Object(U.a)(t,n,function(e,t){function n(e,t){g||(g=new D.a("LocalStorage")),g.scheduleEvent(function(e){return t(e)},e)}function i(t){Object(N.c)(e.core,function(){return"LocalStorageChannel:_sendStoredEventsToNextPlugin"},function(){n("sendToNext",function(n){return t.provider.getAllEvents().then(function(n){for(var r=0;r<n.length;r++)try{var i=n[r];(Object(M.n)(i.iKey)||i.iKey)===t.tenantId&&e.processNext(i,t.coreRootCtx.createNew())}catch(e){}})})},function(){return{iKeyConfig:t}})}function o(t,r){Object(N.c)(e.core,function(){return"LocalStorageChannel:_removeEvents"},function(){n("removeEvents",function(e){var n=[];return Object(j.a)(r,function(e){(Object(M.n)(e.iKey)||e.iKey)===t.tenantId&&n.push(e)}),n.length>0?t.provider.removeEvents(n).then(function(e){}).catch(function(e){}):F.a.resolve()})},function(){return{iKeyConfig:t,events:r}})}function a(e,t){return!(t.sync||t.persistence<e.minPersistenceCacheLevel)}function s(e){var t=new Ae;return t.initialize(e)||(t=null),t}function c(e,t){var n=new X(e);return n.initialize(t)||(n=null),n}function l(e){for(var t=e.storageConfig.providers,n=null,r=0;!n&&r<t.length&&r<Le;)switch(t[r++]){case w.LocalStorage:n=c("localStorage",e);break;case w.SessionStorage:n=c("sessionStorage",e);break;case w.IndexedDb:n=s(e)}return n}function u(t,n,r,i){t&&(t.extensionConfig=t.extensionConfig||[]),!i&&n&&(i=n.getProcessTelContext().getNext());var o=null,a=e._getTelCtx().getNext();return a&&(o=a.getPlugin()),new x.a(i,t,n,o)}function d(t,n,r,a){var s=e.identifier,c=t.extensionConfig=t.extensionConfig||[],d=c[s]=c[s]||{};d.providers||(d.providers=[w.LocalStorage,w.IndexedDb]);var p=u(t,n,r,a),h={itemCtx:p,storageConfig:d,id:e.id},g=l(h);if(g){var _={iKey:t.instrumentationKey,tenantId:Object(M.n)(t.instrumentationKey)||t.instrumentationKey,minPersistenceCacheLevel:V.b.Normal,coreRootCtx:p,providerContext:h,provider:g};Ne(d.minPersistenceLevel||-1)&&(_.minPersistenceCacheLevel=d.minPersistenceLevel),f.push(_),n.addNotificationListener({eventsSent:function(e){o(_,e)},eventsDiscarded:function(e,t){o(_,e)}}),i(_)}}var p=!1,h=!1,g=null,f=[];e.initialize=function(e,n,r,i){Object(N.c)(n,function(){return"LocalStorageChannel.initialize"},function(){p||(t.initialize(e,n,r),t.setInitialized(!1),p=!0,g=new D.a("LocalStorage",n.logger)),d(e,n,r,i)},function(){return{coreConfig:e,core:n,extensions:r,pluginChain:i}})},e.processTelemetry=function(t,i){i=e._getTelCtx(i),Object(M.A)(t,e.identifier);var o=null;Object(j.a)(f,function(e){e.iKey===t.iKey&&(o=e)});var s=h,c=o?o.provider:null,l=t;!l.sync&&c?(l.id=l.id||Object(k.d)(),r(l.persistence)||(l.persistence=1),a(o,l)&&n("processTelemetry",function(e){return c.addEvent(l.id,l,i)}),s||e.processNext(l,i)):e.processNext(l,i)},e.pause=function(){h=!0},e.resume=function(){Object(N.c)(e.core,function(){return"LocalStorageChannel:resume"},function(){h=!1,Object(j.a)(f,function(e){e.provider&&i(e)})})},e.teardown=function(){Object(j.a)(f,function(e){var t=e.provider;t&&t.teardown()}),f=[]},e.flush=function(e,t){void 0===e&&(e=!0)}}),n}return Object(L.b)(t,e),t}(H.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=100}])});