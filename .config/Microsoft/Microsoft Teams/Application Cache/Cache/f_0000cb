webpackJsonp([29],{2861:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s(2862),s(2864),s(2866)},2862:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(2863),r=s(59),n=function(){function e(e,t,s,i,n,o,l,c,a){var p=this;this.$scope=e,this.loggingService=t,this.resources=s,this.$translate=i,this.constants=n,this.routeUtilityService=o,this.analyticsService=l,this.htmlSanitizer=c,this.settingsService=a,this.selectedUsers=[],this.peoplePickerInputs={},this.isMultiSelect=!1,this.conversationId="",this.directorySearchMode=r.DirectorySearchMode.Unknown,this.title="",this.setSelected=[],this.maxSelectionCount=0,this.subTitle="",this.peoplePickerInputs=e.ngDialogData.selectPeopleInputArgs,this.conversationId=this.getCurrentConversationId(),this.isMultiSelect=!this.peoplePickerInputs||!this.peoplePickerInputs.singleSelect,this.directorySearchMode=this.getDirectorySearchMode(),this.title=this.getTitle(),this.setSelected=this.peoplePickerInputs&&this.peoplePickerInputs.setSelected&&this.peoplePickerInputs.setSelected.length>0?this.peoplePickerInputs.setSelected:[],this.maxSelectionCount=this.isMultiSelect?a.valueFor(n.settings.names.selectPeopleMaxAllowedSelectionLimit):1,this.selectedUsers=[],this.subTitle=i.instant(s.strings.select_people_picker_subtitle),this.isTaskModuleContext=document.getElementsByClassName("task-module").length>0,this.logTelemetryForSelectPeopleDialog();var h={disabled:!0,func:function(){return p.onDone()},secondaryStyle:!1,text:i.instant(s.strings.select_people_picker_dialog_done_button),tid:"selectPeoplePickerDialog-DoneBtn",type:teamspace.components.PanelModuleType.button,scenario:teamspace.components.PanelActionScenario.selectPeopleDoneButtonClick,name:teamspace.components.PanelModuleName.selectPeople,summary:"send selected users",scenarioType:teamspace.components.PanelActionScenarioType.sdkSelectPeopleApi,state:"0"},d={disabled:!1,func:function(){return p.onCancel()},text:i.instant(s.strings.select_people_picker_dialog_cancel_button),secondaryStyle:!0,tid:"selectPeoplePickerDialog-CancelBtn",type:teamspace.components.PanelModuleType.button,name:teamspace.components.PanelModuleName.selectPeople,scenario:teamspace.components.PanelActionScenario.selectPeopleCancelButtonClick,summary:"Close select people picker dialog",scenarioType:teamspace.components.PanelActionScenarioType.sdkSelectPeopleApi};this.footerButtons=[d,h]}return e.$inject=["$scope","loggingService","resources","$translate","constants","routeUtilityService","analyticsService","htmlSanitizer","settingsService"],e.prototype.onDone=function(){this.loggingService.event(this.constants.events.selectPeopleApiEvents.selectPeoplePickerDialogDonePressed);var e=[];this.selectedUsers.forEach(function(t){var s=t.displayName||"",i={objectId:t.objectId?t.objectId:t.mri?t.mri.split(SkypeX.Services.ChatServiceUtils.MriPrefix_SkypeSpacesUser)[1]:"",displayName:s,email:t.userPrincipalName};e.push(i)}),this.$scope.ngDialogData.selectPeopleCallback&&this.$scope.ngDialogData.selectPeopleCallback(e),this.$scope.closeThisDialog()},e.prototype.onCancel=function(){this.loggingService.event(this.constants.events.selectPeopleApiEvents.selectPeoplePickerDialogCancelPressed),this.$scope.ngDialogData.cancelCallback&&this.$scope.ngDialogData.cancelCallback(),this.$scope.closeThisDialog()},e.prototype.onUsersSelection=function(e){this.selectedUsers=e,this.updateDoneButtonState()},e.prototype.$onDestroy=function(){this.selectedUsers=null,this.peoplePickerInputs=null},e.prototype.updateDoneButtonState=function(){this.footerButtons[1].disabled=!(this.selectedUsers.length>0)},e.prototype.logTelemetryForSelectPeopleDialog=function(){var e={panel:{type:teamspace.PanelType.selectPeopleDialog},app:{id:this.$scope.ngDialogData.appId,scenarioCapability:teamspace.components.PanelAppScenarioCapability.tabs},dataBag:{isLOB:this.$scope.ngDialogData.isLOBApp}};this.analyticsService.onPanelView(this.$scope,e)},e.prototype.getCurrentConversationId=function(){var e=null,t=this.routeUtilityService.getRootRouteParams();return t&&t.threadId?e=t.threadId:t&&t.peopleSlug&&(e=t.peopleSlug),e},e.prototype.getDirectorySearchMode=function(){var e=r.DirectorySearchMode.Organization;return this.peoplePickerInputs&&this.peoplePickerInputs.openOrgWideSearchInChatOrChannel&&this.conversationId?e=r.DirectorySearchMode.Organization:this.conversationId&&(e=r.DirectorySearchMode.Conversation),e},e.prototype.getTitle=function(){if(this.peoplePickerInputs&&this.peoplePickerInputs.title&&!_.isEmpty(this.peoplePickerInputs.title)){var e=_.escape(this.htmlSanitizer.sanitizeHtml(this.peoplePickerInputs.title));if(!_.isEmpty(e))return e}var t=this.$translate.instant(this.resources.strings.select_people_picker_dialog_multiple_selection_title);return this.isMultiSelect||(t=this.$translate.instant(this.resources.strings.select_people_picker_dialog_single_selection_title)),t},e}();t.SelectPeoplePickerDialog=n,angular.module("teamspace.selectPeoplePickerDialogCtrl",[]).component("selectPeoplePickerDialog",{bindings:{},controller:n,controllerAs:"ppCtrl",templateUrl:"components/select-people-picker/select-people-picker-dialog.html"}).run(["constants","dialogService","$templateCache",function(e,t,s){s.put("components/select-people-picker/select-people-picker-dialog.html",i);t.register(e.lazyDialogs.selectPeoplePickerDialog,{template:"components/select-people-picker/select-people-picker-dialog.html",className:"ts-modal-dialog custom-width select-people-picker-dialog",showClose:!1,controller:n,controllerAs:"ppCtrl",ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title",closeByNavigation:!1,closeByEscape:!0})}])},2863:function(e,t){e.exports='<div ng-class="{\'spp-dialog-task-module-container\': ppCtrl.isTaskModuleContext, \'spp-dialog-container\': !ppCtrl.isTaskModuleContext}" acc-role="dialog" role="dialog" data-tid="selectPeoplePickerDialog">\n  <modal-dialog dialog-title="{{::ppCtrl.title}}" footer-buttons="::ppCtrl.footerButtons" add-close-icon="true" suppress-default-button="true">\n    <div class="spp-desc" id="select-people-picker-desc" ng-bind="ppCtrl.subTitle"></div>\n    <select-people-picker set-selected="ppCtrl.setSelected" directory-search-mode="ppCtrl.directorySearchMode" is-multi-select="ppCtrl.isMultiSelect" conversation-id="ppCtrl.conversationId" max-selection-count="ppCtrl.maxSelectionCount" on-users-selection="ppCtrl.onUsersSelection(users)">\n    </select-people-picker>\n  </modal-dialog>\n</div>'},2864:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(2865),r=s(59),n=function(){function e(e,t,s,i,r,n,o,l,c,a,p,h){var d=this;this.$element=e,this.$scope=t,this.$q=s,this.resources=i,this.$translate=r,this.constants=n,this.conversationsService=o,this.peopleService=l,this.atMentionService=c,this.channelService=a,this.teamMembershipService=p,this.ariaLiveService=h,this.placeHolderText="",this.maxSelectionLimitReachedMsg="",this.selectedUsers=[],this.UPS_TIMEOUT_IN_MS=1e4,this.selectedUsers=[],this.placeHolderText=r.instant(i.strings.member_add_member_people_search),this.maxSelectionLimitReachedMsg=this.getMaxSelectionLimitReachedMsg(),this.peoplePickerFilter=new teamspace.services.PeoplePickerFilters(teamspace.services.PeoplePickerFor.selectPeoplePicker),t.searchFields="displayName,userPrincipalName",this.resolveSetSelectedObjectIds(),this.onUserSelected=this.onUserSelected.bind(this),this.maxSelectionLimitMsgAriaLive||(this.maxSelectionLimitMsgAriaLive=document.getElementById("spp-limit-error-aria-live")),setTimeout(function(){d.focusOnInput()},0,!1)}return e.$inject=["$element","$scope","$q","resources","$translate","constants","conversationsService","peopleService","atMentionService","channelService","teamMembershipService","ariaLiveService"],e.prototype.onUserSelected=function(e){var t=this;this.selectedUsers.find(function(t){return t.mri===e.mri})||(this.selectedUsers.push(e),this.selectedUsersUpdated(),setTimeout(function(){t.focusOnInput()},0,!1))},Object.defineProperty(e.prototype,"excludedUsersMris",{get:function(){return this.selectedUsers.map(function(e){return e.mri})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"excludedUsersObjectIds",{get:function(){return this.selectedUsers.map(function(e){return e.objectId})},enumerable:!0,configurable:!0}),e.prototype.fetchAllowedUsers=function(e){switch(this.$scope.ctrl.searchText=e,this.directorySearchMode){case r.DirectorySearchMode.Conversation:return this.doConversationSearch()}},e.prototype.onRemoveUserCallback=function(e){var t=this.selectedUsers.findIndex(function(t){return t.mri===e.mri});t>=0&&(this.selectedUsers.splice(t,1),this.selectedUsersUpdated(),this.ariaLiveService.update(this.$translate.instant(this.resources.strings.select_people_picker_user_removed_aria_label),!0))},e.prototype.$onDestroy=function(){this.selectedUsers=null,this.setSelected=null},e.prototype.doConversationSearch=function(){var e=this.conversationsService.getConversation(this.conversationId);return this.searchUsersInConversation(e)},e.prototype.searchUsersInConversation=function(e){if(e.isChannelConversation()){var t=this.channelService.getParentTeamAndChannelByChannelId(this.conversationId);return this.channel=t.channel,this.team=t.team,this.searchMembersForChannelConversation()}return this.searchMembersForChatConversation(e)},e.prototype.searchMembersForChannelConversation=function(){var e=this;this.usersSearchProfilePromise&&(teamspace.services.QCancelable.cancel(this.usersSearchProfilePromise),this.usersSearchProfilePromise=null);var t=this.atMentionService.searchForUserProfileInChannel(this.getTargetId(),this.$scope.ctrl.searchText,void 0,"select-people-picker",void 0,!0,void 0,!0,{timeout:this.UPS_TIMEOUT_IN_MS},void 0,this.isSharedChannelContext());return this.usersSearchProfilePromise=services.QCancelable.toCancelablePromise(this.$q,t),this.usersSearchProfilePromise.then(function(t){return e.searchContacts(e.$scope.ctrl.searchText,t)})},e.prototype.searchMembersForChatConversation=function(e){var t=this;this.usersSearchProfilePromise&&(teamspace.services.QCancelable.cancel(this.usersSearchProfilePromise),this.usersSearchProfilePromise=null);var s=e.members.map(function(e){return SkypeX.Services.ChatServiceUtils.getMri(e&&e.id)}),i=this.peopleService.getAllPeopleProfileForConversation(s,this.conversationId,!1,this.constants.scenarios.extensibility.bots.peoplePickerInAdaptiveCard.peoplePicker,this.peoplePickerFilter);return this.usersSearchProfilePromise=services.QCancelable.toCancelablePromise(this.$q,i),this.usersSearchProfilePromise.then(function(e){return t.searchContacts(t.$scope.ctrl.searchText,e)})},e.prototype.getTargetId=function(){return this.isPrivateOrSharedChannelContext()?this.channel.objectId:this.team.objectId},e.prototype.isPrivateOrSharedChannelContext=function(){return this.channel&&(this.channel.channelType===teamspace.services.ChannelType.Private||this.channel.channelType===teamspace.services.ChannelType.Shared)},e.prototype.isSharedChannelContext=function(){return this.channel&&this.channel.channelType===teamspace.services.ChannelType.Shared},e.prototype.searchContacts=function(e,t){var s=this,i=this.searchFields,r=[];return _.isEmpty(t)||t.forEach(function(t){for(var n=!1,o=0;o<i.length&&!(n=n||"string"==typeof t[i[o]]&&"string"==typeof e&&s.checkRegExMatch(t[i[o]],e));o++);n&&r.push(t)}),r},e.prototype.checkRegExMatch=function(e,t){var s=_.escapeRegExp(t);return new RegExp("\\s"+s+"|(^"+s+")","gi").test(e)},Object.defineProperty(e.prototype,"searchFields",{get:function(){var e=[];return _.isEmpty(this.$scope.searchFields)||(e=this.$scope.searchFields.split(",")),e},enumerable:!0,configurable:!0}),e.prototype.updateInputSearchElementState=function(){var e=this,t=this.$element.find("input[data-tid='peoplePicker']");t&&t.length>0&&t[0]&&(t[0].readOnly=this.selectedUsers.length>=this.maxSelectionCount,t[0].readOnly?setTimeout(function(){e.maxSelectionLimitMsgAriaLive.innerText=e.maxSelectionLimitReachedMsg},3e3,!1):this.maxSelectionLimitMsgAriaLive.innerText.length>0&&(this.maxSelectionLimitMsgAriaLive.innerText=""))},e.prototype.resolveSetSelectedObjectIds=function(){var e=this;if(this.setSelected&&this.setSelected.length>0){var t=[];if((this.setSelected.length>this.maxSelectionCount?this.setSelected.slice(0,this.maxSelectionCount):this.setSelected).forEach(function(e){var s=SkypeX.Services.ChatServiceUtils.MriPrefix_SkypeSpacesUser+e.trim();t.push(s)}),this.directorySearchMode==r.DirectorySearchMode.Conversation){var s=this.conversationsService.getConversation(this.conversationId);if(s.isChannelConversation()){var i=this.channelService.getParentTeamAndChannelByChannelId(this.conversationId);this.channel=i.channel,this.team=i.team;var n=t.map(function(t){return e.teamMembershipService.isMemberOfTeam(t,e.getTargetId())});this.$q.all(n).then(function(s){for(var i=[],r=0;r<s.length;r++)s[r]&&i.push(t[r]);e.resolveUsers(i)})}else{var o=s.members.map(function(e){return SkypeX.Services.ChatServiceUtils.getMri(e&&e.id)}),l=[];t.forEach(function(e){o.length>0&&o.indexOf(e)>-1&&l.push(e)}),this.resolveUsers(l)}}else this.resolveUsers(t)}},e.prototype.resolveUsers=function(e){var t=this;_.isEmpty(e)||this.peopleService.getAllPeopleProfile(e,this.constants.scenarios.extensibility.tabs.framework.selectPeople).then(function(e){_.isEmpty(e)||(t.selectedUsers.length>0?t.selectedUsers=t.selectedUsers.concat(e):t.selectedUsers=e,t.selectedUsersUpdated())})},e.prototype.getMaxSelectionLimitReachedMsg=function(){return this.isMultiSelect?this.$translate.instant(this.resources.strings.select_people_picker_max_selection_limit_msg):this.$translate.instant(this.resources.strings.select_people_picker_single_selection_limit_msg)},e.prototype.selectedUsersUpdated=function(){this.updateInputSearchElementState(),this.onUsersSelection&&this.onUsersSelection({users:this.selectedUsers})},e.prototype.focusOnInput=function(){var e=angular.element(".ts-search-input");e&&e.length>0&&e.focus()},e}();t.SelectPeoplePickerController=n,angular.module("teamspace.selectPeoplePicker",[]).component("selectPeoplePicker",{bindings:{setSelected:"<?",directorySearchMode:"<?",isMultiSelect:"<?",conversationId:"<?",maxSelectionCount:"<?",onUsersSelection:"&?"},controllerAs:"ctrl",controller:n,templateUrl:"components/select-people-picker/select-people-picker.html"}).run(["$templateCache",function(e){e.put("components/select-people-picker/select-people-picker.html",i)}])},2865:function(e,t){e.exports='<div data-tid="selectPeoplePicker" role="application">\n  <people-picker id="select-people-picker" type="search" placeholder="{{::ctrl.placeHolderText}}" acc-role="focus-default" hide-logged-in-user="false" add-number-contact="false" is-external-search-enabled="false" class="mam-people-picker" contact-selected="ctrl.onUserSelected" use-people-provider="ctrl.directorySearchMode !== 2" people-provider="ctrl.fetchAllowedUsers(filter)" get-excluded-user-mris="ctrl.excludedUsersMris" get-excluded-object-ids="ctrl.getExcludedUserObjectIds" is-bot-search-enabled="false" include-distribution-lists="false" people-picker-filters="{{ctrl.peoplePickerFilter}}" should-hide-guest-results="false" picker-usage-area="SelectPeoplePicker" aria-labelledby="modalDialog-title select-people-picker-desc"/>\n  <div class="spp-limit-error" ng-if="ctrl.selectedUsers.length >= ctrl.maxSelectionCount" id="select-people-picker-max-limit" ng-bind="ctrl.maxSelectionLimitReachedMsg"></div>\n  <div id="spp-limit-error-aria-live" class="spp-aria-live" aria-atomic="true" aria-live="assertive" role="alert"></div>\n  <select-people-picker-selected-users users="ctrl.selectedUsers" on-remove-user-callback="ctrl.onRemoveUserCallback(user)"/>\n</div>'},2866:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(2867),r=function(){function e(e,t,s,i,r){this.loggingService=e,this.constants=t,this.resources=s,this.$translate=i,this.htmlSanitizer=r}return e.$inject=["loggingService","constants","resources","$translate","htmlSanitizer"],Object.defineProperty(e.prototype,"sanitizedUsersData",{get:function(){return(!this._sanitizedUsersData||this.users&&this._sanitizedUsersData.length!==this.users.length)&&(this._sanitizedUsersData=this.getSanitizedUsersData()),this._sanitizedUsersData},enumerable:!0,configurable:!0}),e.prototype.getSanitizedUsersData=function(){var e=this,t=[];return this.users&&this.users.forEach(function(s){var i={title:_.escape(e.htmlSanitizer.sanitizeHtml(s.displayName)),description:_.escape(e.htmlSanitizer.sanitizeHtml(s.userPrincipalName)),originalObject:s};t.push(i)}),t},e.prototype.removeUser=function(e){this.loggingService.event(this.constants.events.selectPeopleApiEvents.selectPeoplePickerDialogRemoveUserPressed),this.onRemoveUserCallback&&this.onRemoveUserCallback({user:e.originalObject})},e.prototype.getAriaTextForRow=function(e){var t=e.title+", "+e.description;return t+=", "+this.$translate.instant(this.resources.strings.select_people_picker_remove_user_aria_label)},e.prototype.$onDestroy=function(){this.users=null,this._sanitizedUsersData=null,this.onRemoveUserCallback=null},e}();t.SelectPeoplePickerSelectedUsersController=r,angular.module("teamspace.selectPeoplePickerSelectedUsers",[]).component("selectPeoplePickerSelectedUsers",{bindings:{users:"<?",onRemoveUserCallback:"&?"},controllerAs:"ctrl",controller:r,templateUrl:"components/select-people-picker/select-people-picker-selected-users.html"}).run(["$templateCache",function(e){e.put("components/select-people-picker/select-people-picker-selected-users.html",i)}])},2867:function(e,t){e.exports='<div simple-scrollbar class="spp-users-body" data-tid="selectPeoplePickerSelectedUsers" ng-if="ctrl.sanitizedUsersData && ctrl.sanitizedUsersData.length > 0">\n  <div acc-role="list" role="grid" aria-label="{{::$root.resources.strings.select_people_picker_selected_people_grid_aria_label|translate}}">\n    <div acc-row id="selectedUser-{{::user.description}}" class="spp-row" role="row" ng-repeat="user in ctrl.sanitizedUsersData track by user.description" data-tid="selectedUser-{{::user.description}}">\n      <profile-picture css-class="img-circle ts-profile-img" principal-name="user.originalObject.userPrincipalName" display-name="user.originalObject.displayName" source="select-people-picker" disable-pop-out-chat="true"></profile-picture>\n      <div role="gridcell" class="spp-user-profile">\n        <div id="userDisplayName-{{::user.title}}" data-tid="user-{{::user.title}}" class="spp-user-display-name single-line-truncation" ng-bind="::user.title"></div>\n        <div class="spp-user-description app-font-caption single-line-truncation" ng-bind="::user.description"></div>\n      </div>\n      <div title="{{::$root.resources.strings.select_people_picker_remove_user_button_text|translate}}" role="gridcell" class="ts-teammate-icon-btn">\n        <button class="spp-remove-btn" ng-click="ctrl.removeUser(user)" data-tid="removeUser-{{::user.description}}" role="button" aria-label="{{::ctrl.getAriaTextForRow(user)}}">\n          <ng-include class="icon" src="\'svg/icons-close.html\'"></ng-include>\n        </button>\n      </div>\n    </div>\n  </div>\n</div>'}},[2861]);